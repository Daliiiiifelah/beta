{
  "version": 3,
  "sources": ["../../cookie/src/index.ts", "../../@convex-dev/auth/src/server/implementation/index.ts", "../../@convex-dev/auth/src/server/utils.ts", "../../@convex-dev/auth/src/server/cookies.ts", "../../@auth/core/lib/utils/cookie.js", "../../@auth/core/errors.js", "../../@panva/hkdf/dist/web/runtime/hkdf.js", "../../@panva/hkdf/dist/web/index.js", "../../jose/dist/browser/runtime/webcrypto.js", "../../jose/dist/browser/runtime/digest.js", "../../jose/dist/browser/lib/buffer_utils.js", "../../jose/dist/browser/runtime/base64url.js", "../../jose/dist/browser/util/errors.js", "../../jose/dist/browser/runtime/random.js", "../../jose/dist/browser/lib/iv.js", "../../jose/dist/browser/lib/check_iv_length.js", "../../jose/dist/browser/runtime/check_cek_length.js", "../../jose/dist/browser/runtime/timing_safe_equal.js", "../../jose/dist/browser/lib/crypto_key.js", "../../jose/dist/browser/lib/invalid_key_input.js", "../../jose/dist/browser/runtime/is_key_like.js", "../../jose/dist/browser/runtime/decrypt.js", "../../jose/dist/browser/lib/is_disjoint.js", "../../jose/dist/browser/lib/is_object.js", "../../jose/dist/browser/runtime/bogus.js", "../../jose/dist/browser/runtime/aeskw.js", "../../jose/dist/browser/runtime/ecdhes.js", "../../jose/dist/browser/lib/check_p2s.js", "../../jose/dist/browser/runtime/pbes2kw.js", "../../jose/dist/browser/runtime/subtle_rsaes.js", "../../jose/dist/browser/runtime/check_key_length.js", "../../jose/dist/browser/runtime/rsaes.js", "../../jose/dist/browser/lib/is_jwk.js", "../../jose/dist/browser/runtime/jwk_to_key.js", "../../jose/dist/browser/runtime/normalize_key.js", "../../jose/dist/browser/lib/cek.js", "../../jose/dist/browser/runtime/asn1.js", "../../jose/dist/browser/key/import.js", "../../jose/dist/browser/lib/check_key_type.js", "../../jose/dist/browser/runtime/encrypt.js", "../../jose/dist/browser/lib/aesgcmkw.js", "../../jose/dist/browser/lib/decrypt_key_management.js", "../../jose/dist/browser/lib/validate_crit.js", "../../jose/dist/browser/lib/validate_algorithms.js", "../../jose/dist/browser/jwe/flattened/decrypt.js", "../../jose/dist/browser/jwe/compact/decrypt.js", "../../jose/dist/browser/lib/private_symbols.js", "../../jose/dist/browser/runtime/key_to_jwk.js", "../../jose/dist/browser/key/export.js", "../../jose/dist/browser/lib/encrypt_key_management.js", "../../jose/dist/browser/jwe/flattened/encrypt.js", "../../jose/dist/browser/runtime/subtle_dsa.js", "../../jose/dist/browser/runtime/get_sign_verify_key.js", "../../jose/dist/browser/lib/epoch.js", "../../jose/dist/browser/lib/secs.js", "../../jose/dist/browser/lib/jwt_claims_set.js", "../../jose/dist/browser/jwt/decrypt.js", "../../jose/dist/browser/jwe/compact/encrypt.js", "../../jose/dist/browser/runtime/sign.js", "../../jose/dist/browser/jws/flattened/sign.js", "../../jose/dist/browser/jws/compact/sign.js", "../../jose/dist/browser/jwt/produce.js", "../../jose/dist/browser/jwt/sign.js", "../../jose/dist/browser/jwt/encrypt.js", "../../jose/dist/browser/jwk/thumbprint.js", "../../jose/dist/browser/jwks/remote.js", "../../jose/dist/browser/util/base64url.js", "../../@auth/core/lib/vendored/cookie.js", "../../@auth/core/jwt.js", "../../@auth/core/lib/utils/logger.js", "../../@auth/core/lib/utils/web.js", "../../@auth/core/lib/symbols.js", "../../preact/src/constants.js", "../../preact/src/util.js", "../../preact/src/options.js", "../../preact/src/create-element.js", "../../preact/src/component.js", "../../preact/src/diff/props.js", "../../preact/src/create-context.js", "../../preact/src/diff/children.js", "../../preact/src/diff/index.js", "../../preact/src/render.js", "../../preact/src/clone-element.js", "../../preact/src/diff/catch-error.js", "../../preact-render-to-string/src/lib/util.js", "../../preact-render-to-string/src/index.js", "../../preact/jsx-runtime/src/utils.js", "../../preact/src/constants.js", "../../preact/jsx-runtime/src/index.js", "../../oauth4webapi/src/index.ts", "../../@auth/core/lib/actions/callback/oauth/checks.js", "../../@auth/core/lib/utils/env.js", "../../@convex-dev/auth/src/server/provider_utils.ts", "../../@convex-dev/auth/src/server/implementation/types.ts", "../../oslo/dist/crypto/sha.js", "../../oslo/dist/bytes.js", "../../oslo/dist/crypto/random.js", "../../oslo/dist/encoding/hex.js", "../../oslo/dist/encoding/base32.js", "../../oslo/dist/encoding/base64.js", "../../@convex-dev/auth/src/server/implementation/utils.ts", "../../@convex-dev/auth/src/server/implementation/tokens.ts", "../../@convex-dev/auth/src/server/implementation/refreshTokens.ts", "../../@convex-dev/auth/src/server/implementation/sessions.ts", "../../@convex-dev/auth/src/server/implementation/mutations/signIn.ts", "../../@convex-dev/auth/src/server/implementation/mutations/signOut.ts", "../../@convex-dev/auth/src/server/implementation/mutations/refreshSession.ts", "../../@convex-dev/auth/src/server/implementation/rateLimit.ts", "../../@convex-dev/auth/src/server/implementation/users.ts", "../../@convex-dev/auth/src/server/implementation/mutations/verifyCodeAndSignIn.ts", "../../@convex-dev/auth/src/server/implementation/mutations/verifierSignature.ts", "../../@convex-dev/auth/src/server/implementation/mutations/userOAuth.ts", "../../@convex-dev/auth/src/server/implementation/mutations/createVerificationCode.ts", "../../@convex-dev/auth/src/server/implementation/provider.ts", "../../@convex-dev/auth/src/server/implementation/mutations/createAccountFromCredentials.ts", "../../@convex-dev/auth/src/server/implementation/mutations/retrieveAccountWithCredentials.ts", "../../@convex-dev/auth/src/server/implementation/mutations/modifyAccount.ts", "../../@convex-dev/auth/src/server/implementation/mutations/invalidateSessions.ts", "../../@convex-dev/auth/src/server/implementation/mutations/verifier.ts", "../../@convex-dev/auth/src/server/implementation/mutations/index.ts", "../../@convex-dev/auth/src/server/implementation/redirects.ts", "../../@convex-dev/auth/src/server/implementation/signIn.ts", "../../@convex-dev/auth/src/server/oauth/checks.ts", "../../@convex-dev/auth/src/server/oauth/lib/utils/customFetch.ts", "../../@convex-dev/auth/src/server/oauth/convexAuth.ts", "../../@convex-dev/auth/src/server/oauth/authorizationUrl.ts", "../../@convex-dev/auth/src/server/oauth/lib/utils/providers.ts", "../../@convex-dev/auth/src/server/oauth/callback.ts"],
  "sourcesContent": ["/**\n * RegExp to match cookie-name in RFC 6265 sec 4.1.1\n * This refers out to the obsoleted definition of token in RFC 2616 sec 2.2\n * which has been replaced by the token definition in RFC 7230 appendix B.\n *\n * cookie-name       = token\n * token             = 1*tchar\n * tchar             = \"!\" / \"#\" / \"$\" / \"%\" / \"&\" / \"'\" /\n *                     \"*\" / \"+\" / \"-\" / \".\" / \"^\" / \"_\" /\n *                     \"`\" / \"|\" / \"~\" / DIGIT / ALPHA\n *\n * Note: Allowing more characters - https://github.com/jshttp/cookie/issues/191\n * Allow same range as cookie value, except `=`, which delimits end of name.\n */\nconst cookieNameRegExp = /^[\\u0021-\\u003A\\u003C\\u003E-\\u007E]+$/;\n\n/**\n * RegExp to match cookie-value in RFC 6265 sec 4.1.1\n *\n * cookie-value      = *cookie-octet / ( DQUOTE *cookie-octet DQUOTE )\n * cookie-octet      = %x21 / %x23-2B / %x2D-3A / %x3C-5B / %x5D-7E\n *                     ; US-ASCII characters excluding CTLs,\n *                     ; whitespace DQUOTE, comma, semicolon,\n *                     ; and backslash\n *\n * Allowing more characters: https://github.com/jshttp/cookie/issues/191\n * Comma, backslash, and DQUOTE are not part of the parsing algorithm.\n */\nconst cookieValueRegExp = /^[\\u0021-\\u003A\\u003C-\\u007E]*$/;\n\n/**\n * RegExp to match domain-value in RFC 6265 sec 4.1.1\n *\n * domain-value      = <subdomain>\n *                     ; defined in [RFC1034], Section 3.5, as\n *                     ; enhanced by [RFC1123], Section 2.1\n * <subdomain>       = <label> | <subdomain> \".\" <label>\n * <label>           = <let-dig> [ [ <ldh-str> ] <let-dig> ]\n *                     Labels must be 63 characters or less.\n *                     'let-dig' not 'letter' in the first char, per RFC1123\n * <ldh-str>         = <let-dig-hyp> | <let-dig-hyp> <ldh-str>\n * <let-dig-hyp>     = <let-dig> | \"-\"\n * <let-dig>         = <letter> | <digit>\n * <letter>          = any one of the 52 alphabetic characters A through Z in\n *                     upper case and a through z in lower case\n * <digit>           = any one of the ten digits 0 through 9\n *\n * Keep support for leading dot: https://github.com/jshttp/cookie/issues/173\n *\n * > (Note that a leading %x2E (\".\"), if present, is ignored even though that\n * character is not permitted, but a trailing %x2E (\".\"), if present, will\n * cause the user agent to ignore the attribute.)\n */\nconst domainValueRegExp =\n  /^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i;\n\n/**\n * RegExp to match path-value in RFC 6265 sec 4.1.1\n *\n * path-value        = <any CHAR except CTLs or \";\">\n * CHAR              = %x01-7F\n *                     ; defined in RFC 5234 appendix B.1\n */\nconst pathValueRegExp = /^[\\u0020-\\u003A\\u003D-\\u007E]*$/;\n\nconst __toString = Object.prototype.toString;\n\nconst NullObject = /* @__PURE__ */ (() => {\n  const C = function () {};\n  C.prototype = Object.create(null);\n  return C;\n})() as unknown as { new (): any };\n\n/**\n * Parse options.\n */\nexport interface ParseOptions {\n  /**\n   * Specifies a function that will be used to decode a [cookie-value](https://datatracker.ietf.org/doc/html/rfc6265#section-4.1.1).\n   * Since the value of a cookie has a limited character set (and must be a simple string), this function can be used to decode\n   * a previously-encoded cookie value into a JavaScript string.\n   *\n   * The default function is the global `decodeURIComponent`, wrapped in a `try..catch`. If an error\n   * is thrown it will return the cookie's original value. If you provide your own encode/decode\n   * scheme you must ensure errors are appropriately handled.\n   *\n   * @default decode\n   */\n  decode?: (str: string) => string | undefined;\n}\n\n/**\n * Parse a cookie header.\n *\n * Parse the given cookie header string into an object\n * The object has the various cookies as keys(names) => values\n */\nexport function parse(\n  str: string,\n  options?: ParseOptions,\n): Record<string, string | undefined> {\n  const obj: Record<string, string | undefined> = new NullObject();\n  const len = str.length;\n  // RFC 6265 sec 4.1.1, RFC 2616 2.2 defines a cookie name consists of one char minimum, plus '='.\n  if (len < 2) return obj;\n\n  const dec = options?.decode || decode;\n  let index = 0;\n\n  do {\n    const eqIdx = str.indexOf(\"=\", index);\n    if (eqIdx === -1) break; // No more cookie pairs.\n\n    const colonIdx = str.indexOf(\";\", index);\n    const endIdx = colonIdx === -1 ? len : colonIdx;\n\n    if (eqIdx > endIdx) {\n      // backtrack on prior semicolon\n      index = str.lastIndexOf(\";\", eqIdx - 1) + 1;\n      continue;\n    }\n\n    const keyStartIdx = startIndex(str, index, eqIdx);\n    const keyEndIdx = endIndex(str, eqIdx, keyStartIdx);\n    const key = str.slice(keyStartIdx, keyEndIdx);\n\n    // only assign once\n    if (obj[key] === undefined) {\n      let valStartIdx = startIndex(str, eqIdx + 1, endIdx);\n      let valEndIdx = endIndex(str, endIdx, valStartIdx);\n\n      const value = dec(str.slice(valStartIdx, valEndIdx));\n      obj[key] = value;\n    }\n\n    index = endIdx + 1;\n  } while (index < len);\n\n  return obj;\n}\n\nfunction startIndex(str: string, index: number, max: number) {\n  do {\n    const code = str.charCodeAt(index);\n    if (code !== 0x20 /*   */ && code !== 0x09 /* \\t */) return index;\n  } while (++index < max);\n  return max;\n}\n\nfunction endIndex(str: string, index: number, min: number) {\n  while (index > min) {\n    const code = str.charCodeAt(--index);\n    if (code !== 0x20 /*   */ && code !== 0x09 /* \\t */) return index + 1;\n  }\n  return min;\n}\n\n/**\n * Serialize options.\n */\nexport interface SerializeOptions {\n  /**\n   * Specifies a function that will be used to encode a [cookie-value](https://datatracker.ietf.org/doc/html/rfc6265#section-4.1.1).\n   * Since value of a cookie has a limited character set (and must be a simple string), this function can be used to encode\n   * a value into a string suited for a cookie's value, and should mirror `decode` when parsing.\n   *\n   * @default encodeURIComponent\n   */\n  encode?: (str: string) => string;\n  /**\n   * Specifies the `number` (in seconds) to be the value for the [`Max-Age` `Set-Cookie` attribute](https://tools.ietf.org/html/rfc6265#section-5.2.2).\n   *\n   * The [cookie storage model specification](https://tools.ietf.org/html/rfc6265#section-5.3) states that if both `expires` and\n   * `maxAge` are set, then `maxAge` takes precedence, but it is possible not all clients by obey this,\n   * so if both are set, they should point to the same date and time.\n   */\n  maxAge?: number;\n  /**\n   * Specifies the `Date` object to be the value for the [`Expires` `Set-Cookie` attribute](https://tools.ietf.org/html/rfc6265#section-5.2.1).\n   * When no expiration is set clients consider this a \"non-persistent cookie\" and delete it the current session is over.\n   *\n   * The [cookie storage model specification](https://tools.ietf.org/html/rfc6265#section-5.3) states that if both `expires` and\n   * `maxAge` are set, then `maxAge` takes precedence, but it is possible not all clients by obey this,\n   * so if both are set, they should point to the same date and time.\n   */\n  expires?: Date;\n  /**\n   * Specifies the value for the [`Domain` `Set-Cookie` attribute](https://tools.ietf.org/html/rfc6265#section-5.2.3).\n   * When no domain is set clients consider the cookie to apply to the current domain only.\n   */\n  domain?: string;\n  /**\n   * Specifies the value for the [`Path` `Set-Cookie` attribute](https://tools.ietf.org/html/rfc6265#section-5.2.4).\n   * When no path is set, the path is considered the [\"default path\"](https://tools.ietf.org/html/rfc6265#section-5.1.4).\n   */\n  path?: string;\n  /**\n   * Enables the [`HttpOnly` `Set-Cookie` attribute](https://tools.ietf.org/html/rfc6265#section-5.2.6).\n   * When enabled, clients will not allow client-side JavaScript to see the cookie in `document.cookie`.\n   */\n  httpOnly?: boolean;\n  /**\n   * Enables the [`Secure` `Set-Cookie` attribute](https://tools.ietf.org/html/rfc6265#section-5.2.5).\n   * When enabled, clients will only send the cookie back if the browser has a HTTPS connection.\n   */\n  secure?: boolean;\n  /**\n   * Enables the [`Partitioned` `Set-Cookie` attribute](https://tools.ietf.org/html/draft-cutler-httpbis-partitioned-cookies/).\n   * When enabled, clients will only send the cookie back when the current domain _and_ top-level domain matches.\n   *\n   * This is an attribute that has not yet been fully standardized, and may change in the future.\n   * This also means clients may ignore this attribute until they understand it. More information\n   * about can be found in [the proposal](https://github.com/privacycg/CHIPS).\n   */\n  partitioned?: boolean;\n  /**\n   * Specifies the value for the [`Priority` `Set-Cookie` attribute](https://tools.ietf.org/html/draft-west-cookie-priority-00#section-4.1).\n   *\n   * - `'low'` will set the `Priority` attribute to `Low`.\n   * - `'medium'` will set the `Priority` attribute to `Medium`, the default priority when not set.\n   * - `'high'` will set the `Priority` attribute to `High`.\n   *\n   * More information about priority levels can be found in [the specification](https://tools.ietf.org/html/draft-west-cookie-priority-00#section-4.1).\n   */\n  priority?: \"low\" | \"medium\" | \"high\";\n  /**\n   * Specifies the value for the [`SameSite` `Set-Cookie` attribute](https://tools.ietf.org/html/draft-ietf-httpbis-rfc6265bis-09#section-5.4.7).\n   *\n   * - `true` will set the `SameSite` attribute to `Strict` for strict same site enforcement.\n   * - `'lax'` will set the `SameSite` attribute to `Lax` for lax same site enforcement.\n   * - `'none'` will set the `SameSite` attribute to `None` for an explicit cross-site cookie.\n   * - `'strict'` will set the `SameSite` attribute to `Strict` for strict same site enforcement.\n   *\n   * More information about enforcement levels can be found in [the specification](https://tools.ietf.org/html/draft-ietf-httpbis-rfc6265bis-09#section-5.4.7).\n   */\n  sameSite?: boolean | \"lax\" | \"strict\" | \"none\";\n}\n\n/**\n * Serialize data into a cookie header.\n *\n * Serialize a name value pair into a cookie string suitable for\n * http headers. An optional options object specifies cookie parameters.\n *\n * serialize('foo', 'bar', { httpOnly: true })\n *   => \"foo=bar; httpOnly\"\n */\nexport function serialize(\n  name: string,\n  val: string,\n  options?: SerializeOptions,\n): string {\n  const enc = options?.encode || encodeURIComponent;\n\n  if (!cookieNameRegExp.test(name)) {\n    throw new TypeError(`argument name is invalid: ${name}`);\n  }\n\n  const value = enc(val);\n\n  if (!cookieValueRegExp.test(value)) {\n    throw new TypeError(`argument val is invalid: ${val}`);\n  }\n\n  let str = name + \"=\" + value;\n  if (!options) return str;\n\n  if (options.maxAge !== undefined) {\n    if (!Number.isInteger(options.maxAge)) {\n      throw new TypeError(`option maxAge is invalid: ${options.maxAge}`);\n    }\n\n    str += \"; Max-Age=\" + options.maxAge;\n  }\n\n  if (options.domain) {\n    if (!domainValueRegExp.test(options.domain)) {\n      throw new TypeError(`option domain is invalid: ${options.domain}`);\n    }\n\n    str += \"; Domain=\" + options.domain;\n  }\n\n  if (options.path) {\n    if (!pathValueRegExp.test(options.path)) {\n      throw new TypeError(`option path is invalid: ${options.path}`);\n    }\n\n    str += \"; Path=\" + options.path;\n  }\n\n  if (options.expires) {\n    if (\n      !isDate(options.expires) ||\n      !Number.isFinite(options.expires.valueOf())\n    ) {\n      throw new TypeError(`option expires is invalid: ${options.expires}`);\n    }\n\n    str += \"; Expires=\" + options.expires.toUTCString();\n  }\n\n  if (options.httpOnly) {\n    str += \"; HttpOnly\";\n  }\n\n  if (options.secure) {\n    str += \"; Secure\";\n  }\n\n  if (options.partitioned) {\n    str += \"; Partitioned\";\n  }\n\n  if (options.priority) {\n    const priority =\n      typeof options.priority === \"string\"\n        ? options.priority.toLowerCase()\n        : undefined;\n    switch (priority) {\n      case \"low\":\n        str += \"; Priority=Low\";\n        break;\n      case \"medium\":\n        str += \"; Priority=Medium\";\n        break;\n      case \"high\":\n        str += \"; Priority=High\";\n        break;\n      default:\n        throw new TypeError(`option priority is invalid: ${options.priority}`);\n    }\n  }\n\n  if (options.sameSite) {\n    const sameSite =\n      typeof options.sameSite === \"string\"\n        ? options.sameSite.toLowerCase()\n        : options.sameSite;\n    switch (sameSite) {\n      case true:\n      case \"strict\":\n        str += \"; SameSite=Strict\";\n        break;\n      case \"lax\":\n        str += \"; SameSite=Lax\";\n        break;\n      case \"none\":\n        str += \"; SameSite=None\";\n        break;\n      default:\n        throw new TypeError(`option sameSite is invalid: ${options.sameSite}`);\n    }\n  }\n\n  return str;\n}\n\n/**\n * URL-decode string value. Optimized to skip native call when no %.\n */\nfunction decode(str: string): string {\n  if (str.indexOf(\"%\") === -1) return str;\n\n  try {\n    return decodeURIComponent(str);\n  } catch (e) {\n    return str;\n  }\n}\n\n/**\n * Determine if value is a Date.\n */\nfunction isDate(val: any): val is Date {\n  return __toString.call(val) === \"[object Date]\";\n}\n", "import { OAuth2Config, OAuthConfig } from \"@auth/core/providers\";\nimport {\n  Auth,\n  DocumentByName,\n  GenericActionCtx,\n  GenericDataModel,\n  HttpRouter,\n  WithoutSystemFields,\n  actionGeneric,\n  queryGeneric,\n  httpActionGeneric,\n  internalMutationGeneric,\n} from \"convex/server\";\nimport { ConvexError, GenericId, Value, v } from \"convex/values\";\nimport { parse as parseCookies, serialize as serializeCookie } from \"cookie\";\nimport { redirectToParamCookie, useRedirectToParam } from \"../cookies.js\";\nimport { FunctionReferenceFromExport, GenericDoc } from \"../convex_types.js\";\nimport {\n  configDefaults,\n  listAvailableProviders,\n  materializeProvider,\n} from \"../provider_utils.js\";\nimport {\n  AuthProviderConfig,\n  ConvexAuthConfig,\n  GenericActionCtxWithAuthConfig,\n} from \"../types.js\";\nimport { requireEnv } from \"../utils.js\";\nimport { ActionCtx, MutationCtx, Tokens } from \"./types.js\";\nexport { authTables, Doc, Tokens } from \"./types.js\";\nimport {\n  LOG_LEVELS,\n  TOKEN_SUB_CLAIM_DIVIDER,\n  logError,\n  logWithLevel,\n} from \"./utils.js\";\nimport { GetProviderOrThrowFunc } from \"./provider.js\";\nimport {\n  callCreateAccountFromCredentials,\n  callInvalidateSessions,\n  callModifyAccount,\n  callRetreiveAccountWithCredentials,\n  callSignOut,\n  callUserOAuth,\n  callVerifierSignature,\n  storeArgs,\n  storeImpl,\n} from \"./mutations/index.js\";\nimport { signInImpl } from \"./signIn.js\";\nimport { redirectAbsoluteUrl, setURLSearchParam } from \"./redirects.js\";\nimport { getAuthorizationUrl } from \"../oauth/authorizationUrl.js\";\nimport {\n  defaultCookiesOptions,\n  oAuthConfigToInternalProvider,\n} from \"../oauth/convexAuth.js\";\nimport { handleOAuth } from \"../oauth/callback.js\";\nexport { getAuthSessionId } from \"./sessions.js\";\n\n/**\n * The type of the signIn Convex Action returned from the auth() helper.\n *\n * This type is exported for implementors of other client integrations.\n * However it is not stable, and may change until this library reaches 1.0.\n */\nexport type SignInAction = FunctionReferenceFromExport<\n  ReturnType<typeof convexAuth>[\"signIn\"]\n>;\n/**\n * The type of the signOut Convex Action returned from the auth() helper.\n *\n * This type is exported for implementors of other client integrations.\n * However it is not stable, and may change until this library reaches 1.0.\n */\nexport type SignOutAction = FunctionReferenceFromExport<\n  ReturnType<typeof convexAuth>[\"signOut\"]\n>;\n/**\n * The type of the isAuthenticated Convex Query returned from the auth() helper.\n *\n * This type is exported for implementors of other client integrations.\n * However it is not stable, and may change until this library reaches 1.0.\n */\nexport type IsAuthenticatedQuery = FunctionReferenceFromExport<\n  ReturnType<typeof convexAuth>[\"isAuthenticated\"]\n>;\n\n/**\n * Configure the Convex Auth library. Returns an object with\n * functions and `auth` helper. You must export the functions\n * from `convex/auth.ts` to make them callable:\n *\n * ```ts filename=\"convex/auth.ts\"\n * import { convexAuth } from \"@convex-dev/auth/server\";\n *\n * export const { auth, signIn, signOut, store, isAuthenticated } = convexAuth({\n *   providers: [],\n * });\n * ```\n *\n * @returns An object with fields you should reexport from your\n *          `convex/auth.ts` file.\n */\nexport function convexAuth(config_: ConvexAuthConfig) {\n  const config = configDefaults(config_ as any);\n  const hasOAuth = config.providers.some(\n    (provider) => provider.type === \"oauth\" || provider.type === \"oidc\",\n  );\n  const getProvider = (id: string, allowExtraProviders: boolean = false) => {\n    return (\n      config.providers.find((provider) => provider.id === id) ??\n      (allowExtraProviders\n        ? config.extraProviders.find((provider) => provider.id === id)\n        : undefined)\n    );\n  };\n  const getProviderOrThrow: GetProviderOrThrowFunc = (\n    id: string,\n    allowExtraProviders: boolean = false,\n  ) => {\n    const provider = getProvider(id, allowExtraProviders);\n    if (provider === undefined) {\n      const message =\n        `Provider \\`${id}\\` is not configured, ` +\n        `available providers are ${listAvailableProviders(config, allowExtraProviders)}.`;\n      logWithLevel(LOG_LEVELS.ERROR, message);\n      throw new Error(message);\n    }\n    return provider;\n  };\n  const enrichCtx = <DataModel extends GenericDataModel>(\n    ctx: GenericActionCtx<DataModel>,\n  ) => ({ ...ctx, auth: { ...ctx.auth, config } });\n\n  const auth = {\n    /**\n     * @deprecated - Use `getAuthUserId` from \"@convex-dev/auth/server\":\n     *\n     * ```ts\n     * import { getAuthUserId } from \"@convex-dev/auth/server\";\n     * ```\n     *\n     * @hidden\n     */\n    getUserId: async (ctx: { auth: Auth }) => {\n      const identity = await ctx.auth.getUserIdentity();\n      if (identity === null) {\n        return null;\n      }\n      const [userId] = identity.subject.split(TOKEN_SUB_CLAIM_DIVIDER);\n      return userId as GenericId<\"users\">;\n    },\n    /**\n     * @deprecated - Use `getAuthSessionId` from \"@convex-dev/auth/server\":\n     *\n     * ```\n     * import { getAuthSessionId } from \"@convex-dev/auth/server\";\n     * ```\n     *\n     * @hidden\n     */\n    getSessionId: async (ctx: { auth: Auth }) => {\n      const identity = await ctx.auth.getUserIdentity();\n      if (identity === null) {\n        return null;\n      }\n      const [, sessionId] = identity.subject.split(TOKEN_SUB_CLAIM_DIVIDER);\n      return sessionId as GenericId<\"authSessions\">;\n    },\n    /**\n     * Add HTTP actions for JWT verification and OAuth sign-in.\n     *\n     * ```ts\n     * import { httpRouter } from \"convex/server\";\n     * import { auth } from \"./auth.js\";\n     *\n     * const http = httpRouter();\n     *\n     * auth.addHttpRoutes(http);\n     *\n     * export default http;\n     * ```\n     *\n     * The following routes are handled always:\n     *\n     * - `/.well-known/openid-configuration`\n     * - `/.well-known/jwks.json`\n     *\n     * The following routes are handled if OAuth is configured:\n     *\n     * - `/api/auth/signin/*`\n     * - `/api/auth/callback/*`\n     *\n     * @param http your HTTP router\n     */\n    addHttpRoutes: (http: HttpRouter) => {\n      http.route({\n        path: \"/.well-known/openid-configuration\",\n        method: \"GET\",\n        handler: httpActionGeneric(async () => {\n          return new Response(\n            JSON.stringify({\n              issuer: requireEnv(\"CONVEX_SITE_URL\"),\n              jwks_uri:\n                requireEnv(\"CONVEX_SITE_URL\") + \"/.well-known/jwks.json\",\n              authorization_endpoint:\n                requireEnv(\"CONVEX_SITE_URL\") + \"/oauth/authorize\",\n            }),\n            {\n              status: 200,\n              headers: {\n                \"Content-Type\": \"application/json\",\n                \"Cache-Control\":\n                  \"public, max-age=15, stale-while-revalidate=15, stale-if-error=86400\",\n              },\n            },\n          );\n        }),\n      });\n\n      http.route({\n        path: \"/.well-known/jwks.json\",\n        method: \"GET\",\n        handler: httpActionGeneric(async () => {\n          return new Response(requireEnv(\"JWKS\"), {\n            status: 200,\n            headers: {\n              \"Content-Type\": \"application/json\",\n              \"Cache-Control\":\n                \"public, max-age=15, stale-while-revalidate=15, stale-if-error=86400\",\n            },\n          });\n        }),\n      });\n\n      if (hasOAuth) {\n        http.route({\n          pathPrefix: \"/api/auth/signin/\",\n          method: \"GET\",\n          handler: httpActionGeneric(\n            convertErrorsToResponse(400, async (ctx, request) => {\n              const url = new URL(request.url);\n              const pathParts = url.pathname.split(\"/\");\n              const providerId = pathParts.at(-1)!;\n              if (providerId === null) {\n                throw new Error(\"Missing provider id\");\n              }\n              const verifier = url.searchParams.get(\"code\");\n              if (verifier === null) {\n                throw new Error(\"Missing sign-in verifier\");\n              }\n              const provider = getProviderOrThrow(\n                providerId,\n              ) as OAuthConfig<any>;\n              const { redirect, cookies, signature } =\n                await getAuthorizationUrl({\n                  provider: await oAuthConfigToInternalProvider(provider),\n                  cookies: defaultCookiesOptions(providerId),\n                });\n\n              await callVerifierSignature(ctx, {\n                verifier,\n                signature,\n              });\n\n              const redirectTo = url.searchParams.get(\"redirectTo\");\n\n              if (redirectTo !== null) {\n                cookies.push(redirectToParamCookie(providerId, redirectTo));\n              }\n\n              const headers = new Headers({ Location: redirect });\n              for (const { name, value, options } of cookies) {\n                headers.append(\n                  \"Set-Cookie\",\n                  serializeCookie(name, value, options),\n                );\n              }\n\n              return new Response(null, { status: 302, headers });\n            }),\n          ),\n        });\n\n        const callbackAction = httpActionGeneric(\n          async (genericCtx, request) => {\n            const ctx = genericCtx as unknown as ActionCtx;\n            const url = new URL(request.url);\n            const pathParts = url.pathname.split(\"/\");\n            const providerId = pathParts.at(-1)!;\n            logWithLevel(\n              LOG_LEVELS.DEBUG,\n              \"Handling OAuth callback for provider:\",\n              providerId,\n            );\n            const provider = getProviderOrThrow(\n              providerId,\n            ) as OAuth2Config<any>;\n\n            const cookies = getCookies(request);\n\n            const maybeRedirectTo = useRedirectToParam(provider.id, cookies);\n\n            const destinationUrl = await redirectAbsoluteUrl(config, {\n              redirectTo: maybeRedirectTo?.redirectTo,\n            });\n\n            const params = url.searchParams;\n\n            // Handle OAuth providers that use formData (such as Apple)\n            if (\n              request.headers.get(\"Content-Type\") ===\n              \"application/x-www-form-urlencoded\"\n            ) {\n              const formData = await request.formData();\n              for (const [key, value] of formData.entries()) {\n                if (typeof value === \"string\") {\n                  params.append(key, value);\n                }\n              }\n            }\n\n            try {\n              const { profile, tokens, signature } = await handleOAuth(\n                Object.fromEntries(params.entries()),\n                cookies,\n                {\n                  provider: await oAuthConfigToInternalProvider(provider),\n                  cookies: defaultCookiesOptions(provider.id),\n                },\n              );\n\n              const { id, ...profileFromCallback } = await provider.profile!(\n                profile,\n                tokens,\n              );\n\n              if (typeof id !== \"string\") {\n                throw new Error(\n                  `The profile method of the ${providerId} config must return a string ID`,\n                );\n              }\n\n              const verificationCode = await callUserOAuth(ctx, {\n                provider: providerId,\n                providerAccountId: id,\n                profile: profileFromCallback,\n                signature,\n              });\n\n              return new Response(null, {\n                status: 302,\n                headers: {\n                  Location: setURLSearchParam(\n                    destinationUrl,\n                    \"code\",\n                    verificationCode,\n                  ),\n                  \"Cache-Control\": \"must-revalidate\",\n                },\n              });\n            } catch (error) {\n              logError(error);\n              return Response.redirect(destinationUrl);\n            }\n          },\n        );\n\n        http.route({\n          pathPrefix: \"/api/auth/callback/\",\n          method: \"GET\",\n          handler: callbackAction,\n        });\n\n        http.route({\n          pathPrefix: \"/api/auth/callback/\",\n          method: \"POST\",\n          handler: callbackAction,\n        });\n      }\n    },\n  };\n  return {\n    /**\n     * Helper for configuring HTTP actions.\n     */\n    auth,\n    /**\n     * Action called by the client to sign the user in.\n     *\n     * Also used for refreshing the session.\n     */\n    signIn: actionGeneric({\n      args: {\n        provider: v.optional(v.string()),\n        params: v.optional(v.any()),\n        verifier: v.optional(v.string()),\n        refreshToken: v.optional(v.string()),\n        calledBy: v.optional(v.string()),\n      },\n      handler: async (\n        ctx,\n        args,\n      ): Promise<{\n        redirect?: string;\n        verifier?: string;\n        tokens?: Tokens | null;\n        started?: boolean;\n      }> => {\n        if (args.calledBy !== undefined) {\n          logWithLevel(\"INFO\", `\\`auth:signIn\\` called by ${args.calledBy}`);\n        }\n        const provider =\n          args.provider !== undefined\n            ? getProviderOrThrow(args.provider)\n            : null;\n        const result = await signInImpl(enrichCtx(ctx), provider, args, {\n          generateTokens: true,\n          allowExtraProviders: false,\n        });\n        switch (result.kind) {\n          case \"redirect\":\n            return { redirect: result.redirect, verifier: result.verifier };\n          case \"signedIn\":\n          case \"refreshTokens\":\n            return { tokens: result.signedIn?.tokens ?? null };\n          case \"started\":\n            return { started: true };\n          default: {\n            const _typecheck: never = result;\n            throw new Error(`Unexpected result from signIn, ${result as any}`);\n          }\n        }\n      },\n    }),\n    /**\n     * Action called by the client to invalidate the current session.\n     */\n    signOut: actionGeneric({\n      args: {},\n      handler: async (ctx) => {\n        await callSignOut(ctx);\n      },\n    }),\n\n    /**\n     * Internal mutation used by the library to read and write\n     * to the database during signin and signout.\n     */\n    store: internalMutationGeneric({\n      args: storeArgs,\n      handler: async (ctx: MutationCtx, args) => {\n        return storeImpl(ctx, args, getProviderOrThrow, config);\n      },\n    }),\n\n    /**\n     * Utility function for frameworks to use to get the current auth state\n     * based on credentials that they've supplied separately.\n     */\n    isAuthenticated: queryGeneric({\n      args: {},\n      handler: async (ctx, _args): Promise<boolean> => {\n        const ident = await ctx.auth.getUserIdentity();\n        return ident !== null;\n      },\n    }),\n  };\n}\n\n/**\n * Return the currently signed-in user's ID.\n *\n * ```ts filename=\"convex/myFunctions.tsx\"\n * import { mutation } from \"./_generated/server\";\n * import { getAuthUserId } from \"@convex-dev/auth/server\";\n *\n * export const doSomething = mutation({\n *   args: {/* ... *\\/},\n *   handler: async (ctx, args) => {\n *     const userId = await getAuthUserId(ctx);\n *     if (userId === null) {\n *       throw new Error(\"Client is not authenticated!\")\n *     }\n *     const user = await ctx.db.get(userId);\n *     // ...\n *   },\n * });\n * ```\n *\n * @param ctx query, mutation or action `ctx`\n * @returns the user ID or `null` if the client isn't authenticated\n */\nexport async function getAuthUserId(ctx: { auth: Auth }) {\n  const identity = await ctx.auth.getUserIdentity();\n  if (identity === null) {\n    return null;\n  }\n  const [userId] = identity.subject.split(TOKEN_SUB_CLAIM_DIVIDER);\n  return userId as GenericId<\"users\">;\n}\n\n/**\n * Use this function from a\n * [`ConvexCredentials`](https://labs.convex.dev/auth/api_reference/providers/ConvexCredentials)\n * provider to create an account and a user with a unique account \"id\" (OAuth\n * provider ID, email address, phone number, username etc.).\n *\n * @returns user ID if it successfully creates the account\n * or throws an error.\n */\nexport async function createAccount<\n  DataModel extends GenericDataModel = GenericDataModel,\n>(\n  ctx: GenericActionCtx<DataModel>,\n  args: {\n    /**\n     * The provider ID (like \"password\"), used to disambiguate accounts.\n     *\n     * It is also used to configure account secret hashing via the provider's\n     * `crypto` option.\n     */\n    provider: string;\n    account: {\n      /**\n       * The unique external ID for the account, for example email address.\n       */\n      id: string;\n      /**\n       * The secret credential to store for this account, if given.\n       */\n      secret?: string;\n    };\n    /**\n     * The profile data to store for the user.\n     * These must fit the `users` table schema.\n     */\n    profile: WithoutSystemFields<DocumentByName<DataModel, \"users\">>;\n    /**\n     * If `true`, the account will be linked to an existing user\n     * with the same verified email address.\n     * This is only safe if the returned account's email is verified\n     * before the user is allowed to sign in with it.\n     */\n    shouldLinkViaEmail?: boolean;\n    /**\n     * If `true`, the account will be linked to an existing user\n     * with the same verified phone number.\n     * This is only safe if the returned account's phone is verified\n     * before the user is allowed to sign in with it.\n     */\n    shouldLinkViaPhone?: boolean;\n  },\n): Promise<{\n  account: GenericDoc<DataModel, \"authAccounts\">;\n  user: GenericDoc<DataModel, \"users\">;\n}> {\n  const actionCtx = ctx as unknown as ActionCtx;\n  return await callCreateAccountFromCredentials(actionCtx, args);\n}\n\n/**\n * Use this function from a\n * [`ConvexCredentials`](https://labs.convex.dev/auth/api_reference/providers/ConvexCredentials)\n * provider to retrieve a user given the account provider ID and\n * the provider-specific account ID.\n *\n * @returns the retrieved user document, or `null` if there is no account\n * for given account ID or throws if the provided\n * secret does not match.\n */\nexport async function retrieveAccount<\n  DataModel extends GenericDataModel = GenericDataModel,\n>(\n  ctx: GenericActionCtx<DataModel>,\n  args: {\n    /**\n     * The provider ID (like \"password\"), used to disambiguate accounts.\n     *\n     * It is also used to configure account secret hashing via the provider's\n     * `crypto` option.\n     */\n    provider: string;\n    account: {\n      /**\n       * The unique external ID for the account, for example email address.\n       */\n      id: string;\n      /**\n       * The secret that should match the stored credential, if given.\n       */\n      secret?: string;\n    };\n  },\n): Promise<{\n  account: GenericDoc<DataModel, \"authAccounts\">;\n  user: GenericDoc<DataModel, \"users\">;\n}> {\n  const actionCtx = ctx as unknown as ActionCtx;\n  const result = await callRetreiveAccountWithCredentials(actionCtx, args);\n  if (typeof result === \"string\") {\n    throw new Error(result);\n  }\n  return result;\n}\n\n/**\n * Use this function to modify the account credentials\n * from a [`ConvexCredentials`](https://labs.convex.dev/auth/api_reference/providers/ConvexCredentials)\n * provider.\n */\nexport async function modifyAccountCredentials<\n  DataModel extends GenericDataModel = GenericDataModel,\n>(\n  ctx: GenericActionCtx<DataModel>,\n  args: {\n    /**\n     * The provider ID (like \"password\"), used to disambiguate accounts.\n     *\n     * It is also used to configure account secret hashing via the `crypto` option.\n     */\n    provider: string;\n    account: {\n      /**\n       * The unique external ID for the account, for example email address.\n       */\n      id: string;\n      /**\n       * The new secret credential to store for this account.\n       */\n      secret: string;\n    };\n  },\n): Promise<void> {\n  const actionCtx = ctx as unknown as ActionCtx;\n  return await callModifyAccount(actionCtx, args);\n}\n\n/**\n * Use this function to invalidate existing sessions.\n */\nexport async function invalidateSessions<\n  DataModel extends GenericDataModel = GenericDataModel,\n>(\n  ctx: GenericActionCtx<DataModel>,\n  args: {\n    userId: GenericId<\"users\">;\n    except?: GenericId<\"authSessions\">[];\n  },\n): Promise<void> {\n  const actionCtx = ctx as unknown as ActionCtx;\n  return await callInvalidateSessions(actionCtx, args);\n}\n\n/**\n * Use this function from a\n * [`ConvexCredentials`](https://labs.convex.dev/auth/api_reference/providers/ConvexCredentials)\n * provider to sign in the user via another provider (usually\n * for email verification on sign up or password reset).\n *\n * Returns the user ID if the sign can proceed,\n * or `null`.\n */\nexport async function signInViaProvider<\n  DataModel extends GenericDataModel = GenericDataModel,\n>(\n  ctx: GenericActionCtxWithAuthConfig<DataModel>,\n  provider: AuthProviderConfig,\n  args: {\n    accountId?: GenericId<\"authAccounts\">;\n    params?: Record<string, Value | undefined>;\n  },\n) {\n  const result = await signInImpl(ctx, materializeProvider(provider), args, {\n    generateTokens: false,\n    allowExtraProviders: true,\n  });\n  return result.kind === \"signedIn\"\n    ? result.signedIn !== null\n      ? { userId: result.signedIn.userId, sessionId: result.signedIn.sessionId }\n      : null\n    : null;\n}\n\nfunction convertErrorsToResponse(\n  errorStatusCode: number,\n  action: (ctx: GenericActionCtx<any>, request: Request) => Promise<Response>,\n) {\n  return async (ctx: GenericActionCtx<any>, request: Request) => {\n    try {\n      return await action(ctx, request);\n    } catch (error) {\n      if (error instanceof ConvexError) {\n        return new Response(null, {\n          status: errorStatusCode,\n          statusText: error.data,\n        });\n      } else {\n        logError(error);\n        return new Response(null, {\n          status: 500,\n          statusText: \"Internal Server Error\",\n        });\n      }\n    }\n  };\n}\nfunction getCookies(request: Request): Record<string, string | undefined> {\n  return parseCookies(request.headers.get(\"Cookie\") ?? \"\");\n}\n", "export function requireEnv(name: string) {\n  const value = process.env[name];\n  if (value === undefined) {\n    throw new Error(`Missing environment variable \\`${name}\\``);\n  }\n  return value;\n}\n\nexport function isLocalHost(host?: string) {\n  return /(localhost|127\\.0\\.0\\.1):\\d+/.test(\n  host ?? \"\");\n}", "import { isLocalHost } from \"./utils.js\";\n\nexport const SHARED_COOKIE_OPTIONS = {\n  httpOnly: true,\n  sameSite: \"none\" as const,\n  secure: true,\n  path: \"/\",\n  partitioned: true,\n};\n\nconst REDIRECT_MAX_AGE = 60 * 15; // 15 minutes in seconds\nexport function redirectToParamCookie(providerId: string, redirectTo: string) {\n  return {\n    name: redirectToParamCookieName(providerId),\n    value: redirectTo,\n    options: { ...SHARED_COOKIE_OPTIONS, maxAge: REDIRECT_MAX_AGE },\n  };\n}\n\nexport function useRedirectToParam(\n  providerId: string,\n  cookies: Record<string, string | undefined>,\n) {\n  const cookieName = redirectToParamCookieName(providerId);\n  const redirectTo = cookies[cookieName];\n  if (redirectTo === undefined) {\n    return null;\n  }\n\n  // Clear the cookie\n  const updatedCookie = {\n    name: cookieName,\n    value: \"\",\n    options: { ...SHARED_COOKIE_OPTIONS, maxAge: 0 },\n  };\n\n  return { redirectTo, updatedCookie };\n}\n\nfunction redirectToParamCookieName(providerId: string) {\n  return (!isLocalHost(process.env.CONVEX_SITE_URL) ? \"__Host-\" : \"\") + providerId + \"RedirectTo\";\n}\n", "var __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _SessionStore_instances, _SessionStore_chunks, _SessionStore_option, _SessionStore_logger, _SessionStore_chunk, _SessionStore_clean;\n// Uncomment to recalculate the estimated size\n// of an empty session cookie\n// import * as cookie from \"../vendored/cookie.js\"\n// const { serialize } = cookie\n// console.log(\n//   \"Cookie estimated to be \",\n//   serialize(`__Secure.authjs.session-token.0`, \"\", {\n//     expires: new Date(),\n//     httpOnly: true,\n//     maxAge: Number.MAX_SAFE_INTEGER,\n//     path: \"/\",\n//     sameSite: \"strict\",\n//     secure: true,\n//     domain: \"example.com\",\n//   }).length,\n//   \" bytes\"\n// )\nconst ALLOWED_COOKIE_SIZE = 4096;\n// Based on commented out section above\nconst ESTIMATED_EMPTY_COOKIE_SIZE = 160;\nconst CHUNK_SIZE = ALLOWED_COOKIE_SIZE - ESTIMATED_EMPTY_COOKIE_SIZE;\n/**\n * Use secure cookies if the site uses HTTPS\n * This being conditional allows cookies to work non-HTTPS development URLs\n * Honour secure cookie option, which sets 'secure' and also adds '__Secure-'\n * prefix, but enable them by default if the site URL is HTTPS; but not for\n * non-HTTPS URLs like http://localhost which are used in development).\n * For more on prefixes see https://googlechrome.github.io/samples/cookie-prefixes/\n *\n * @TODO Review cookie settings (names, options)\n */\nexport function defaultCookies(useSecureCookies) {\n    const cookiePrefix = useSecureCookies ? \"__Secure-\" : \"\";\n    return {\n        // default cookie options\n        sessionToken: {\n            name: `${cookiePrefix}authjs.session-token`,\n            options: {\n                httpOnly: true,\n                sameSite: \"lax\",\n                path: \"/\",\n                secure: useSecureCookies,\n            },\n        },\n        callbackUrl: {\n            name: `${cookiePrefix}authjs.callback-url`,\n            options: {\n                httpOnly: true,\n                sameSite: \"lax\",\n                path: \"/\",\n                secure: useSecureCookies,\n            },\n        },\n        csrfToken: {\n            // Default to __Host- for CSRF token for additional protection if using useSecureCookies\n            // NB: The `__Host-` prefix is stricter than the `__Secure-` prefix.\n            name: `${useSecureCookies ? \"__Host-\" : \"\"}authjs.csrf-token`,\n            options: {\n                httpOnly: true,\n                sameSite: \"lax\",\n                path: \"/\",\n                secure: useSecureCookies,\n            },\n        },\n        pkceCodeVerifier: {\n            name: `${cookiePrefix}authjs.pkce.code_verifier`,\n            options: {\n                httpOnly: true,\n                sameSite: \"lax\",\n                path: \"/\",\n                secure: useSecureCookies,\n                maxAge: 60 * 15, // 15 minutes in seconds\n            },\n        },\n        state: {\n            name: `${cookiePrefix}authjs.state`,\n            options: {\n                httpOnly: true,\n                sameSite: \"lax\",\n                path: \"/\",\n                secure: useSecureCookies,\n                maxAge: 60 * 15, // 15 minutes in seconds\n            },\n        },\n        nonce: {\n            name: `${cookiePrefix}authjs.nonce`,\n            options: {\n                httpOnly: true,\n                sameSite: \"lax\",\n                path: \"/\",\n                secure: useSecureCookies,\n            },\n        },\n        webauthnChallenge: {\n            name: `${cookiePrefix}authjs.challenge`,\n            options: {\n                httpOnly: true,\n                sameSite: \"lax\",\n                path: \"/\",\n                secure: useSecureCookies,\n                maxAge: 60 * 15, // 15 minutes in seconds\n            },\n        },\n    };\n}\nexport class SessionStore {\n    constructor(option, cookies, logger) {\n        _SessionStore_instances.add(this);\n        _SessionStore_chunks.set(this, {});\n        _SessionStore_option.set(this, void 0);\n        _SessionStore_logger.set(this, void 0);\n        __classPrivateFieldSet(this, _SessionStore_logger, logger, \"f\");\n        __classPrivateFieldSet(this, _SessionStore_option, option, \"f\");\n        if (!cookies)\n            return;\n        const { name: sessionCookiePrefix } = option;\n        for (const [name, value] of Object.entries(cookies)) {\n            if (!name.startsWith(sessionCookiePrefix) || !value)\n                continue;\n            __classPrivateFieldGet(this, _SessionStore_chunks, \"f\")[name] = value;\n        }\n    }\n    /**\n     * The JWT Session or database Session ID\n     * constructed from the cookie chunks.\n     */\n    get value() {\n        // Sort the chunks by their keys before joining\n        const sortedKeys = Object.keys(__classPrivateFieldGet(this, _SessionStore_chunks, \"f\")).sort((a, b) => {\n            const aSuffix = parseInt(a.split(\".\").pop() || \"0\");\n            const bSuffix = parseInt(b.split(\".\").pop() || \"0\");\n            return aSuffix - bSuffix;\n        });\n        // Use the sorted keys to join the chunks in the correct order\n        return sortedKeys.map((key) => __classPrivateFieldGet(this, _SessionStore_chunks, \"f\")[key]).join(\"\");\n    }\n    /**\n     * Given a cookie value, return new cookies, chunked, to fit the allowed cookie size.\n     * If the cookie has changed from chunked to unchunked or vice versa,\n     * it deletes the old cookies as well.\n     */\n    chunk(value, options) {\n        // Assume all cookies should be cleaned by default\n        const cookies = __classPrivateFieldGet(this, _SessionStore_instances, \"m\", _SessionStore_clean).call(this);\n        // Calculate new chunks\n        const chunked = __classPrivateFieldGet(this, _SessionStore_instances, \"m\", _SessionStore_chunk).call(this, {\n            name: __classPrivateFieldGet(this, _SessionStore_option, \"f\").name,\n            value,\n            options: { ...__classPrivateFieldGet(this, _SessionStore_option, \"f\").options, ...options },\n        });\n        // Update stored chunks / cookies\n        for (const chunk of chunked) {\n            cookies[chunk.name] = chunk;\n        }\n        return Object.values(cookies);\n    }\n    /** Returns a list of cookies that should be cleaned. */\n    clean() {\n        return Object.values(__classPrivateFieldGet(this, _SessionStore_instances, \"m\", _SessionStore_clean).call(this));\n    }\n}\n_SessionStore_chunks = new WeakMap(), _SessionStore_option = new WeakMap(), _SessionStore_logger = new WeakMap(), _SessionStore_instances = new WeakSet(), _SessionStore_chunk = function _SessionStore_chunk(cookie) {\n    const chunkCount = Math.ceil(cookie.value.length / CHUNK_SIZE);\n    if (chunkCount === 1) {\n        __classPrivateFieldGet(this, _SessionStore_chunks, \"f\")[cookie.name] = cookie.value;\n        return [cookie];\n    }\n    const cookies = [];\n    for (let i = 0; i < chunkCount; i++) {\n        const name = `${cookie.name}.${i}`;\n        const value = cookie.value.substr(i * CHUNK_SIZE, CHUNK_SIZE);\n        cookies.push({ ...cookie, name, value });\n        __classPrivateFieldGet(this, _SessionStore_chunks, \"f\")[name] = value;\n    }\n    __classPrivateFieldGet(this, _SessionStore_logger, \"f\").debug(\"CHUNKING_SESSION_COOKIE\", {\n        message: `Session cookie exceeds allowed ${ALLOWED_COOKIE_SIZE} bytes.`,\n        emptyCookieSize: ESTIMATED_EMPTY_COOKIE_SIZE,\n        valueSize: cookie.value.length,\n        chunks: cookies.map((c) => c.value.length + ESTIMATED_EMPTY_COOKIE_SIZE),\n    });\n    return cookies;\n}, _SessionStore_clean = function _SessionStore_clean() {\n    const cleanedChunks = {};\n    for (const name in __classPrivateFieldGet(this, _SessionStore_chunks, \"f\")) {\n        delete __classPrivateFieldGet(this, _SessionStore_chunks, \"f\")?.[name];\n        cleanedChunks[name] = {\n            name,\n            value: \"\",\n            options: { ...__classPrivateFieldGet(this, _SessionStore_option, \"f\").options, maxAge: 0 },\n        };\n    }\n    return cleanedChunks;\n};\n", "/**\n * Base error class for all Auth.js errors.\n * It's optimized to be printed in the server logs in a nicely formatted way\n * via the [`logger.error`](https://authjs.dev/reference/core#logger) option.\n */\nexport class AuthError extends Error {\n    constructor(message, errorOptions) {\n        if (message instanceof Error) {\n            super(undefined, {\n                cause: { err: message, ...message.cause, ...errorOptions },\n            });\n        }\n        else if (typeof message === \"string\") {\n            if (errorOptions instanceof Error) {\n                errorOptions = { err: errorOptions, ...errorOptions.cause };\n            }\n            super(message, errorOptions);\n        }\n        else {\n            super(undefined, message);\n        }\n        this.name = this.constructor.name;\n        // @ts-expect-error https://github.com/microsoft/TypeScript/issues/3841\n        this.type = this.constructor.type ?? \"AuthError\";\n        // @ts-expect-error https://github.com/microsoft/TypeScript/issues/3841\n        this.kind = this.constructor.kind ?? \"error\";\n        Error.captureStackTrace?.(this, this.constructor);\n        const url = `https://errors.authjs.dev#${this.type.toLowerCase()}`;\n        this.message += `${this.message ? \". \" : \"\"}Read more at ${url}`;\n    }\n}\nexport class SignInError extends AuthError {\n}\nSignInError.kind = \"signIn\";\n/**\n * One of the database [`Adapter` methods](https://authjs.dev/reference/core/adapters#methods)\n * failed during execution.\n *\n * :::tip\n * If `debug: true` is set, you can check out `[auth][debug]` in the logs to learn more about the failed adapter method execution.\n * @example\n * ```sh\n * [auth][debug]: adapter_getUserByEmail\n * { \"args\": [undefined] }\n * ```\n * :::\n */\nexport class AdapterError extends AuthError {\n}\nAdapterError.type = \"AdapterError\";\n/**\n * Thrown when the execution of the [`signIn` callback](https://authjs.dev/reference/core/types#signin) fails\n * or if it returns `false`.\n */\nexport class AccessDenied extends AuthError {\n}\nAccessDenied.type = \"AccessDenied\";\n/**\n * This error occurs when the user cannot finish login.\n * Depending on the provider type, this could have happened for multiple reasons.\n *\n * :::tip\n * Check out `[auth][details]` in the logs to know which provider failed.\n * @example\n * ```sh\n * [auth][details]: { \"provider\": \"github\" }\n * ```\n * :::\n *\n * For an [OAuth provider](https://authjs.dev/getting-started/authentication/oauth), possible causes are:\n * - The user denied access to the application\n * - There was an error parsing the OAuth Profile:\n *   Check out the provider's `profile` or `userinfo.request` method to make sure\n *   it correctly fetches the user's profile.\n * - The `signIn` or `jwt` callback methods threw an uncaught error:\n *   Check the callback method implementations.\n *\n * For an [Email provider](https://authjs.dev/getting-started/authentication/email), possible causes are:\n * - The provided email/token combination was invalid/missing:\n *   Check if the provider's `sendVerificationRequest` method correctly sends the email.\n * - The provided email/token combination has expired:\n *   Ask the user to log in again.\n * - There was an error with the database:\n *   Check the database logs.\n *\n * For a [Credentials provider](https://authjs.dev/getting-started/authentication/credentials), possible causes are:\n * - The `authorize` method threw an uncaught error:\n *   Check the provider's `authorize` method.\n * - The `signIn` or `jwt` callback methods threw an uncaught error:\n *   Check the callback method implementations.\n *\n * :::tip\n * Check out `[auth][cause]` in the error message for more details.\n * It will show the original stack trace.\n * :::\n */\nexport class CallbackRouteError extends AuthError {\n}\nCallbackRouteError.type = \"CallbackRouteError\";\n/**\n * Thrown when Auth.js is misconfigured and accidentally tried to require authentication on a custom error page.\n * To prevent an infinite loop, Auth.js will instead render its default error page.\n *\n * To fix this, make sure that the `error` page does not require authentication.\n *\n * Learn more at [Guide: Error pages](https://authjs.dev/guides/pages/error)\n */\nexport class ErrorPageLoop extends AuthError {\n}\nErrorPageLoop.type = \"ErrorPageLoop\";\n/**\n * One of the [`events` methods](https://authjs.dev/reference/core/types#eventcallbacks)\n * failed during execution.\n *\n * Make sure that the `events` methods are implemented correctly and uncaught errors are handled.\n *\n * Learn more at [`events`](https://authjs.dev/reference/core/types#eventcallbacks)\n */\nexport class EventError extends AuthError {\n}\nEventError.type = \"EventError\";\n/**\n * Thrown when Auth.js is unable to verify a `callbackUrl` value.\n * The browser either disabled cookies or the `callbackUrl` is not a valid URL.\n *\n * Somebody might have tried to manipulate the callback URL that Auth.js uses to redirect the user back to the configured `callbackUrl`/page.\n * This could be a malicious hacker trying to redirect the user to a phishing site.\n * To prevent this, Auth.js checks if the callback URL is valid and throws this error if it is not.\n *\n * There is no action required, but it might be an indicator that somebody is trying to attack your application.\n */\nexport class InvalidCallbackUrl extends AuthError {\n}\nInvalidCallbackUrl.type = \"InvalidCallbackUrl\";\n/**\n * Can be thrown from the `authorize` callback of the Credentials provider.\n * When an error occurs during the `authorize` callback, two things can happen:\n * 1. The user is redirected to the signin page, with `error=CredentialsSignin&code=credentials` in the URL. `code` is configurable.\n * 2. If you throw this error in a framework that handles form actions server-side, this error is thrown, instead of redirecting the user, so you'll need to handle.\n */\nexport class CredentialsSignin extends SignInError {\n    constructor() {\n        super(...arguments);\n        /**\n         * The error code that is set in the `code` query parameter of the redirect URL.\n         *\n         *\n         *  NOTE: This property is going to be included in the URL, so make sure it does not hint at sensitive errors.\n         *\n         * The full error is always logged on the server, if you need to debug.\n         *\n         * Generally, we don't recommend hinting specifically if the user had either a wrong username or password specifically,\n         * try rather something like \"Invalid credentials\".\n         */\n        this.code = \"credentials\";\n    }\n}\nCredentialsSignin.type = \"CredentialsSignin\";\n/**\n * One of the configured OAuth or OIDC providers is missing the `authorization`, `token` or `userinfo`, or `issuer` configuration.\n * To perform OAuth or OIDC sign in, at least one of these endpoints is required.\n *\n * Learn more at [`OAuth2Config`](https://authjs.dev/reference/core/providers#oauth2configprofile) or [Guide: OAuth Provider](https://authjs.dev/guides/configuring-oauth-providers)\n */\nexport class InvalidEndpoints extends AuthError {\n}\nInvalidEndpoints.type = \"InvalidEndpoints\";\n/**\n * Thrown when a PKCE, state or nonce OAuth check could not be performed.\n * This could happen if the OAuth provider is configured incorrectly or if the browser is blocking cookies.\n *\n * Learn more at [`checks`](https://authjs.dev/reference/core/providers#checks)\n */\nexport class InvalidCheck extends AuthError {\n}\nInvalidCheck.type = \"InvalidCheck\";\n/**\n * Logged on the server when Auth.js could not decode or encode a JWT-based (`strategy: \"jwt\"`) session.\n *\n * Possible causes are either a misconfigured `secret` or a malformed JWT or `encode/decode` methods.\n *\n * :::note\n * When this error is logged, the session cookie is destroyed.\n * :::\n *\n * Learn more at [`secret`](https://authjs.dev/reference/core#secret), [`jwt.encode`](https://authjs.dev/reference/core/jwt#encode-1) or [`jwt.decode`](https://authjs.dev/reference/core/jwt#decode-2) for more information.\n */\nexport class JWTSessionError extends AuthError {\n}\nJWTSessionError.type = \"JWTSessionError\";\n/**\n * Thrown if Auth.js is misconfigured. This could happen if you configured an Email provider but did not set up a database adapter,\n * or tried using a `strategy: \"database\"` session without a database adapter.\n * In both cases, make sure you either remove the configuration or add the missing adapter.\n *\n * Learn more at [Database Adapters](https://authjs.dev/getting-started/database), [Email provider](https://authjs.dev/getting-started/authentication/email) or [Concept: Database session strategy](https://authjs.dev/concepts/session-strategies#database-session)\n */\nexport class MissingAdapter extends AuthError {\n}\nMissingAdapter.type = \"MissingAdapter\";\n/**\n * Thrown similarily to [`MissingAdapter`](https://authjs.dev/reference/core/errors#missingadapter), but only some required methods were missing.\n *\n * Make sure you either remove the configuration or add the missing methods to the adapter.\n *\n * Learn more at [Database Adapters](https://authjs.dev/getting-started/database)\n */\nexport class MissingAdapterMethods extends AuthError {\n}\nMissingAdapterMethods.type = \"MissingAdapterMethods\";\n/**\n * Thrown when a Credentials provider is missing the `authorize` configuration.\n * To perform credentials sign in, the `authorize` method is required.\n *\n * Learn more at [Credentials provider](https://authjs.dev/getting-started/authentication/credentials)\n */\nexport class MissingAuthorize extends AuthError {\n}\nMissingAuthorize.type = \"MissingAuthorize\";\n/**\n * Auth.js requires a secret or multiple secrets to be set, but none was not found. This is used to encrypt cookies, JWTs and other sensitive data.\n *\n * :::note\n * If you are using a framework like Next.js, we try to automatically infer the secret from the `AUTH_SECRET`, `AUTH_SECRET_1`, etc. environment variables.\n * Alternatively, you can also explicitly set the [`AuthConfig.secret`](https://authjs.dev/reference/core#secret) option.\n * :::\n *\n *\n * :::tip\n * To generate a random string, you can use the Auth.js CLI: `npx auth secret`\n * :::\n */\nexport class MissingSecret extends AuthError {\n}\nMissingSecret.type = \"MissingSecret\";\n/**\n * Thrown when an Email address is already associated with an account\n * but the user is trying an OAuth account that is not linked to it.\n *\n * For security reasons, Auth.js does not automatically link OAuth accounts to existing accounts if the user is not signed in.\n *\n * :::tip\n * If you trust the OAuth provider to have verified the user's email address,\n * you can enable automatic account linking by setting [`allowDangerousEmailAccountLinking: true`](https://authjs.dev/reference/core/providers#allowdangerousemailaccountlinking)\n * in the provider configuration.\n * :::\n */\nexport class OAuthAccountNotLinked extends SignInError {\n}\nOAuthAccountNotLinked.type = \"OAuthAccountNotLinked\";\n/**\n * Thrown when an OAuth provider returns an error during the sign in process.\n * This could happen for example if the user denied access to the application or there was a configuration error.\n *\n * For a full list of possible reasons, check out the specification [Authorization Code Grant: Error Response](https://www.rfc-editor.org/rfc/rfc6749#section-4.1.2.1)\n */\nexport class OAuthCallbackError extends SignInError {\n}\nOAuthCallbackError.type = \"OAuthCallbackError\";\n/**\n * This error occurs during an OAuth sign in attempt when the provider's\n * response could not be parsed. This could for example happen if the provider's API\n * changed, or the [`OAuth2Config.profile`](https://authjs.dev/reference/core/providers#oauth2configprofile) method is not implemented correctly.\n */\nexport class OAuthProfileParseError extends AuthError {\n}\nOAuthProfileParseError.type = \"OAuthProfileParseError\";\n/**\n * Logged on the server when Auth.js could not retrieve a session from the database (`strategy: \"database\"`).\n *\n * The database adapter might be misconfigured or the database is not reachable.\n *\n * Learn more at [Concept: Database session strategy](https://authjs.dev/concepts/session-strategies#database)\n */\nexport class SessionTokenError extends AuthError {\n}\nSessionTokenError.type = \"SessionTokenError\";\n/**\n * Happens when login by [OAuth](https://authjs.dev/getting-started/authentication/oauth) could not be started.\n *\n * Possible causes are:\n * - The Authorization Server is not compliant with the [OAuth 2.0](https://www.ietf.org/rfc/rfc6749.html) or the [OIDC](https://openid.net/specs/openid-connect-core-1_0.html) specification.\n *   Check the details in the error message.\n *\n * :::tip\n * Check out `[auth][details]` in the logs to know which provider failed.\n * @example\n * ```sh\n * [auth][details]: { \"provider\": \"github\" }\n * ```\n * :::\n */\nexport class OAuthSignInError extends SignInError {\n}\nOAuthSignInError.type = \"OAuthSignInError\";\n/**\n * Happens when the login by an [Email provider](https://authjs.dev/getting-started/authentication/email) could not be started.\n *\n * Possible causes are:\n * - The email sent from the client is invalid, could not be normalized by [`EmailConfig.normalizeIdentifier`](https://authjs.dev/reference/core/providers/email#normalizeidentifier)\n * - The provided email/token combination has expired:\n *   Ask the user to log in again.\n * - There was an error with the database:\n *   Check the database logs.\n */\nexport class EmailSignInError extends SignInError {\n}\nEmailSignInError.type = \"EmailSignInError\";\n/**\n * Represents an error that occurs during the sign-out process. This error\n * is logged when there are issues in terminating a user's session, either\n * by failing to delete the session from the database (in database session\n * strategies) or encountering issues during other parts of the sign-out\n * process, such as emitting sign-out events or clearing session cookies.\n *\n * The session cookie(s) are emptied even if this error is logged.\n *\n */\nexport class SignOutError extends AuthError {\n}\nSignOutError.type = \"SignOutError\";\n/**\n * Auth.js was requested to handle an operation that it does not support.\n *\n * See [`AuthAction`](https://authjs.dev/reference/core/types#authaction) for the supported actions.\n */\nexport class UnknownAction extends AuthError {\n}\nUnknownAction.type = \"UnknownAction\";\n/**\n * Thrown when a Credentials provider is present but the JWT strategy (`strategy: \"jwt\"`) is not enabled.\n *\n * Learn more at [`strategy`](https://authjs.dev/reference/core#strategy) or [Credentials provider](https://authjs.dev/getting-started/authentication/credentials)\n */\nexport class UnsupportedStrategy extends AuthError {\n}\nUnsupportedStrategy.type = \"UnsupportedStrategy\";\n/** Thrown when an endpoint was incorrectly called without a provider, or with an unsupported provider. */\nexport class InvalidProvider extends AuthError {\n}\nInvalidProvider.type = \"InvalidProvider\";\n/**\n * Thrown when the `trustHost` option was not set to `true`.\n *\n * Auth.js requires the `trustHost` option to be set to `true` since it's relying on the request headers' `host` value.\n *\n * :::note\n * Official Auth.js libraries might attempt to automatically set the `trustHost` option to `true` if the request is coming from a trusted host on a trusted platform.\n * :::\n *\n * Learn more at [`trustHost`](https://authjs.dev/reference/core#trusthost) or [Guide: Deployment](https://authjs.dev/getting-started/deployment)\n */\nexport class UntrustedHost extends AuthError {\n}\nUntrustedHost.type = \"UntrustedHost\";\n/**\n * The user's email/token combination was invalid.\n * This could be because the email/token combination was not found in the database,\n * or because the token has expired. Ask the user to log in again.\n */\nexport class Verification extends AuthError {\n}\nVerification.type = \"Verification\";\n/**\n * Error for missing CSRF tokens in client-side actions (`signIn`, `signOut`, `useSession#update`).\n * Thrown when actions lack the double submit cookie, essential for CSRF protection.\n *\n * CSRF ([Cross-Site Request Forgery](https://owasp.org/www-community/attacks/csrf))\n * is an attack leveraging authenticated user credentials for unauthorized actions.\n *\n * Double submit cookie pattern, a CSRF defense, requires matching values in a cookie\n * and request parameter. More on this at [MDN Web Docs](https://developer.mozilla.org/en-US/docs/Glossary/CSRF).\n */\nexport class MissingCSRF extends SignInError {\n}\nMissingCSRF.type = \"MissingCSRF\";\nconst clientErrors = new Set([\n    \"CredentialsSignin\",\n    \"OAuthAccountNotLinked\",\n    \"OAuthCallbackError\",\n    \"AccessDenied\",\n    \"Verification\",\n    \"MissingCSRF\",\n    \"AccountNotLinked\",\n    \"WebAuthnVerificationError\",\n]);\n/**\n * Used to only allow sending a certain subset of errors to the client.\n * Errors are always logged on the server, but to prevent leaking sensitive information,\n * only a subset of errors are sent to the client as-is.\n * @internal\n */\nexport function isClientError(error) {\n    if (error instanceof AuthError)\n        return clientErrors.has(error.type);\n    return false;\n}\n/**\n * Thrown when multiple providers have `enableConditionalUI` set to `true`.\n * Only one provider can have this option enabled at a time.\n */\nexport class DuplicateConditionalUI extends AuthError {\n}\nDuplicateConditionalUI.type = \"DuplicateConditionalUI\";\n/**\n * Thrown when a WebAuthn provider has `enableConditionalUI` set to `true` but no formField has `webauthn` in its autocomplete param.\n *\n * The `webauthn` autocomplete param is required for conditional UI to work.\n */\nexport class MissingWebAuthnAutocomplete extends AuthError {\n}\nMissingWebAuthnAutocomplete.type = \"MissingWebAuthnAutocomplete\";\n/**\n * Thrown when a WebAuthn provider fails to verify a client response.\n */\nexport class WebAuthnVerificationError extends AuthError {\n}\nWebAuthnVerificationError.type = \"WebAuthnVerificationError\";\n/**\n * Thrown when an Email address is already associated with an account\n * but the user is trying an account that is not linked to it.\n *\n * For security reasons, Auth.js does not automatically link accounts to existing accounts if the user is not signed in.\n */\nexport class AccountNotLinked extends SignInError {\n}\nAccountNotLinked.type = \"AccountNotLinked\";\n/**\n * Thrown when an experimental feature is used but not enabled.\n */\nexport class ExperimentalFeatureNotEnabled extends AuthError {\n}\nExperimentalFeatureNotEnabled.type = \"ExperimentalFeatureNotEnabled\";\n", "const getGlobal = () => {\n    if (typeof globalThis !== 'undefined')\n        return globalThis;\n    if (typeof self !== 'undefined')\n        return self;\n    if (typeof window !== 'undefined')\n        return window;\n    throw new Error('unable to locate global object');\n};\nexport default async (digest, ikm, salt, info, keylen) => {\n    const { crypto: { subtle }, } = getGlobal();\n    return new Uint8Array(await subtle.deriveBits({\n        name: 'HKDF',\n        hash: `SHA-${digest.substr(3)}`,\n        salt,\n        info,\n    }, await subtle.importKey('raw', ikm, 'HKDF', false, ['deriveBits']), keylen << 3));\n};\n", "import derive from './runtime/hkdf.js';\nfunction normalizeDigest(digest) {\n    switch (digest) {\n        case 'sha256':\n        case 'sha384':\n        case 'sha512':\n        case 'sha1':\n            return digest;\n        default:\n            throw new TypeError('unsupported \"digest\" value');\n    }\n}\nfunction normalizeUint8Array(input, label) {\n    if (typeof input === 'string')\n        return new TextEncoder().encode(input);\n    if (!(input instanceof Uint8Array))\n        throw new TypeError(`\"${label}\"\" must be an instance of Uint8Array or a string`);\n    return input;\n}\nfunction normalizeIkm(input) {\n    const ikm = normalizeUint8Array(input, 'ikm');\n    if (!ikm.byteLength)\n        throw new TypeError(`\"ikm\" must be at least one byte in length`);\n    return ikm;\n}\nfunction normalizeInfo(input) {\n    const info = normalizeUint8Array(input, 'info');\n    if (info.byteLength > 1024) {\n        throw TypeError('\"info\" must not contain more than 1024 bytes');\n    }\n    return info;\n}\nfunction normalizeKeylen(input, digest) {\n    if (typeof input !== 'number' || !Number.isInteger(input) || input < 1) {\n        throw new TypeError('\"keylen\" must be a positive integer');\n    }\n    const hashlen = parseInt(digest.substr(3), 10) >> 3 || 20;\n    if (input > 255 * hashlen) {\n        throw new TypeError('\"keylen\" too large');\n    }\n    return input;\n}\nasync function hkdf(digest, ikm, salt, info, keylen) {\n    return derive(normalizeDigest(digest), normalizeIkm(ikm), normalizeUint8Array(salt, 'salt'), normalizeInfo(info), normalizeKeylen(keylen, digest));\n}\nexport { hkdf, hkdf as default };\n", "export default crypto;\nexport const isCryptoKey = (key) => key instanceof CryptoKey;\n", "import crypto from './webcrypto.js';\nconst digest = async (algorithm, data) => {\n    const subtleDigest = `SHA-${algorithm.slice(-3)}`;\n    return new Uint8Array(await crypto.subtle.digest(subtleDigest, data));\n};\nexport default digest;\n", "import digest from '../runtime/digest.js';\nexport const encoder = new TextEncoder();\nexport const decoder = new TextDecoder();\nconst MAX_INT32 = 2 ** 32;\nexport function concat(...buffers) {\n    const size = buffers.reduce((acc, { length }) => acc + length, 0);\n    const buf = new Uint8Array(size);\n    let i = 0;\n    for (const buffer of buffers) {\n        buf.set(buffer, i);\n        i += buffer.length;\n    }\n    return buf;\n}\nexport function p2s(alg, p2sInput) {\n    return concat(encoder.encode(alg), new Uint8Array([0]), p2sInput);\n}\nfunction writeUInt32BE(buf, value, offset) {\n    if (value < 0 || value >= MAX_INT32) {\n        throw new RangeError(`value must be >= 0 and <= ${MAX_INT32 - 1}. Received ${value}`);\n    }\n    buf.set([value >>> 24, value >>> 16, value >>> 8, value & 0xff], offset);\n}\nexport function uint64be(value) {\n    const high = Math.floor(value / MAX_INT32);\n    const low = value % MAX_INT32;\n    const buf = new Uint8Array(8);\n    writeUInt32BE(buf, high, 0);\n    writeUInt32BE(buf, low, 4);\n    return buf;\n}\nexport function uint32be(value) {\n    const buf = new Uint8Array(4);\n    writeUInt32BE(buf, value);\n    return buf;\n}\nexport function lengthAndInput(input) {\n    return concat(uint32be(input.length), input);\n}\nexport async function concatKdf(secret, bits, value) {\n    const iterations = Math.ceil((bits >> 3) / 32);\n    const res = new Uint8Array(iterations * 32);\n    for (let iter = 0; iter < iterations; iter++) {\n        const buf = new Uint8Array(4 + secret.length + value.length);\n        buf.set(uint32be(iter + 1));\n        buf.set(secret, 4);\n        buf.set(value, 4 + secret.length);\n        res.set(await digest('sha256', buf), iter * 32);\n    }\n    return res.slice(0, bits >> 3);\n}\n", "import { encoder, decoder } from '../lib/buffer_utils.js';\nexport const encodeBase64 = (input) => {\n    let unencoded = input;\n    if (typeof unencoded === 'string') {\n        unencoded = encoder.encode(unencoded);\n    }\n    const CHUNK_SIZE = 0x8000;\n    const arr = [];\n    for (let i = 0; i < unencoded.length; i += CHUNK_SIZE) {\n        arr.push(String.fromCharCode.apply(null, unencoded.subarray(i, i + CHUNK_SIZE)));\n    }\n    return btoa(arr.join(''));\n};\nexport const encode = (input) => {\n    return encodeBase64(input).replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n};\nexport const decodeBase64 = (encoded) => {\n    const binary = atob(encoded);\n    const bytes = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i++) {\n        bytes[i] = binary.charCodeAt(i);\n    }\n    return bytes;\n};\nexport const decode = (input) => {\n    let encoded = input;\n    if (encoded instanceof Uint8Array) {\n        encoded = decoder.decode(encoded);\n    }\n    encoded = encoded.replace(/-/g, '+').replace(/_/g, '/').replace(/\\s/g, '');\n    try {\n        return decodeBase64(encoded);\n    }\n    catch {\n        throw new TypeError('The input to be decoded is not correctly encoded.');\n    }\n};\n", "export class JOSEError extends Error {\n    constructor(message, options) {\n        super(message, options);\n        this.code = 'ERR_JOSE_GENERIC';\n        this.name = this.constructor.name;\n        Error.captureStackTrace?.(this, this.constructor);\n    }\n}\nJOSEError.code = 'ERR_JOSE_GENERIC';\nexport class JWTClaimValidationFailed extends JOSEError {\n    constructor(message, payload, claim = 'unspecified', reason = 'unspecified') {\n        super(message, { cause: { claim, reason, payload } });\n        this.code = 'ERR_JWT_CLAIM_VALIDATION_FAILED';\n        this.claim = claim;\n        this.reason = reason;\n        this.payload = payload;\n    }\n}\nJWTClaimValidationFailed.code = 'ERR_JWT_CLAIM_VALIDATION_FAILED';\nexport class JWTExpired extends JOSEError {\n    constructor(message, payload, claim = 'unspecified', reason = 'unspecified') {\n        super(message, { cause: { claim, reason, payload } });\n        this.code = 'ERR_JWT_EXPIRED';\n        this.claim = claim;\n        this.reason = reason;\n        this.payload = payload;\n    }\n}\nJWTExpired.code = 'ERR_JWT_EXPIRED';\nexport class JOSEAlgNotAllowed extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JOSE_ALG_NOT_ALLOWED';\n    }\n}\nJOSEAlgNotAllowed.code = 'ERR_JOSE_ALG_NOT_ALLOWED';\nexport class JOSENotSupported extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JOSE_NOT_SUPPORTED';\n    }\n}\nJOSENotSupported.code = 'ERR_JOSE_NOT_SUPPORTED';\nexport class JWEDecryptionFailed extends JOSEError {\n    constructor(message = 'decryption operation failed', options) {\n        super(message, options);\n        this.code = 'ERR_JWE_DECRYPTION_FAILED';\n    }\n}\nJWEDecryptionFailed.code = 'ERR_JWE_DECRYPTION_FAILED';\nexport class JWEInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWE_INVALID';\n    }\n}\nJWEInvalid.code = 'ERR_JWE_INVALID';\nexport class JWSInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWS_INVALID';\n    }\n}\nJWSInvalid.code = 'ERR_JWS_INVALID';\nexport class JWTInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWT_INVALID';\n    }\n}\nJWTInvalid.code = 'ERR_JWT_INVALID';\nexport class JWKInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWK_INVALID';\n    }\n}\nJWKInvalid.code = 'ERR_JWK_INVALID';\nexport class JWKSInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWKS_INVALID';\n    }\n}\nJWKSInvalid.code = 'ERR_JWKS_INVALID';\nexport class JWKSNoMatchingKey extends JOSEError {\n    constructor(message = 'no applicable key found in the JSON Web Key Set', options) {\n        super(message, options);\n        this.code = 'ERR_JWKS_NO_MATCHING_KEY';\n    }\n}\nJWKSNoMatchingKey.code = 'ERR_JWKS_NO_MATCHING_KEY';\nexport class JWKSMultipleMatchingKeys extends JOSEError {\n    constructor(message = 'multiple matching keys found in the JSON Web Key Set', options) {\n        super(message, options);\n        this.code = 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\n    }\n}\nSymbol.asyncIterator;\nJWKSMultipleMatchingKeys.code = 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\nexport class JWKSTimeout extends JOSEError {\n    constructor(message = 'request timed out', options) {\n        super(message, options);\n        this.code = 'ERR_JWKS_TIMEOUT';\n    }\n}\nJWKSTimeout.code = 'ERR_JWKS_TIMEOUT';\nexport class JWSSignatureVerificationFailed extends JOSEError {\n    constructor(message = 'signature verification failed', options) {\n        super(message, options);\n        this.code = 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n    }\n}\nJWSSignatureVerificationFailed.code = 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n", "import crypto from './webcrypto.js';\nexport default crypto.getRandomValues.bind(crypto);\n", "import { JOSENotSupported } from '../util/errors.js';\nimport random from '../runtime/random.js';\nexport function bitLength(alg) {\n    switch (alg) {\n        case 'A128GCM':\n        case 'A128GCMKW':\n        case 'A192GCM':\n        case 'A192GCMKW':\n        case 'A256GCM':\n        case 'A256GCMKW':\n            return 96;\n        case 'A128CBC-HS256':\n        case 'A192CBC-HS384':\n        case 'A256CBC-HS512':\n            return 128;\n        default:\n            throw new JOSENotSupported(`Unsupported JWE Algorithm: ${alg}`);\n    }\n}\nexport default (alg) => random(new Uint8Array(bitLength(alg) >> 3));\n", "import { JWEInvalid } from '../util/errors.js';\nimport { bitLength } from './iv.js';\nconst checkIvLength = (enc, iv) => {\n    if (iv.length << 3 !== bitLength(enc)) {\n        throw new JWEInvalid('Invalid Initialization Vector length');\n    }\n};\nexport default checkIvLength;\n", "import { JWEInvalid } from '../util/errors.js';\nconst checkCekLength = (cek, expected) => {\n    const actual = cek.byteLength << 3;\n    if (actual !== expected) {\n        throw new JWEInvalid(`Invalid Content Encryption Key length. Expected ${expected} bits, got ${actual} bits`);\n    }\n};\nexport default checkCekLength;\n", "const timingSafeEqual = (a, b) => {\n    if (!(a instanceof Uint8Array)) {\n        throw new TypeError('First argument must be a buffer');\n    }\n    if (!(b instanceof Uint8Array)) {\n        throw new TypeError('Second argument must be a buffer');\n    }\n    if (a.length !== b.length) {\n        throw new TypeError('Input buffers must have the same length');\n    }\n    const len = a.length;\n    let out = 0;\n    let i = -1;\n    while (++i < len) {\n        out |= a[i] ^ b[i];\n    }\n    return out === 0;\n};\nexport default timingSafeEqual;\n", "function unusable(name, prop = 'algorithm.name') {\n    return new TypeError(`CryptoKey does not support this operation, its ${prop} must be ${name}`);\n}\nfunction isAlgorithm(algorithm, name) {\n    return algorithm.name === name;\n}\nfunction getHashLength(hash) {\n    return parseInt(hash.name.slice(4), 10);\n}\nfunction getNamedCurve(alg) {\n    switch (alg) {\n        case 'ES256':\n            return 'P-256';\n        case 'ES384':\n            return 'P-384';\n        case 'ES512':\n            return 'P-521';\n        default:\n            throw new Error('unreachable');\n    }\n}\nfunction checkUsage(key, usages) {\n    if (usages.length && !usages.some((expected) => key.usages.includes(expected))) {\n        let msg = 'CryptoKey does not support this operation, its usages must include ';\n        if (usages.length > 2) {\n            const last = usages.pop();\n            msg += `one of ${usages.join(', ')}, or ${last}.`;\n        }\n        else if (usages.length === 2) {\n            msg += `one of ${usages[0]} or ${usages[1]}.`;\n        }\n        else {\n            msg += `${usages[0]}.`;\n        }\n        throw new TypeError(msg);\n    }\n}\nexport function checkSigCryptoKey(key, alg, ...usages) {\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512': {\n            if (!isAlgorithm(key.algorithm, 'HMAC'))\n                throw unusable('HMAC');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'RS256':\n        case 'RS384':\n        case 'RS512': {\n            if (!isAlgorithm(key.algorithm, 'RSASSA-PKCS1-v1_5'))\n                throw unusable('RSASSA-PKCS1-v1_5');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'PS256':\n        case 'PS384':\n        case 'PS512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-PSS'))\n                throw unusable('RSA-PSS');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'EdDSA': {\n            if (key.algorithm.name !== 'Ed25519' && key.algorithm.name !== 'Ed448') {\n                throw unusable('Ed25519 or Ed448');\n            }\n            break;\n        }\n        case 'Ed25519': {\n            if (!isAlgorithm(key.algorithm, 'Ed25519'))\n                throw unusable('Ed25519');\n            break;\n        }\n        case 'ES256':\n        case 'ES384':\n        case 'ES512': {\n            if (!isAlgorithm(key.algorithm, 'ECDSA'))\n                throw unusable('ECDSA');\n            const expected = getNamedCurve(alg);\n            const actual = key.algorithm.namedCurve;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.namedCurve');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usages);\n}\nexport function checkEncCryptoKey(key, alg, ...usages) {\n    switch (alg) {\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM': {\n            if (!isAlgorithm(key.algorithm, 'AES-GCM'))\n                throw unusable('AES-GCM');\n            const expected = parseInt(alg.slice(1, 4), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            if (!isAlgorithm(key.algorithm, 'AES-KW'))\n                throw unusable('AES-KW');\n            const expected = parseInt(alg.slice(1, 4), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'ECDH': {\n            switch (key.algorithm.name) {\n                case 'ECDH':\n                case 'X25519':\n                case 'X448':\n                    break;\n                default:\n                    throw unusable('ECDH, X25519, or X448');\n            }\n            break;\n        }\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW':\n            if (!isAlgorithm(key.algorithm, 'PBKDF2'))\n                throw unusable('PBKDF2');\n            break;\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-OAEP'))\n                throw unusable('RSA-OAEP');\n            const expected = parseInt(alg.slice(9), 10) || 1;\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usages);\n}\n", "function message(msg, actual, ...types) {\n    types = types.filter(Boolean);\n    if (types.length > 2) {\n        const last = types.pop();\n        msg += `one of type ${types.join(', ')}, or ${last}.`;\n    }\n    else if (types.length === 2) {\n        msg += `one of type ${types[0]} or ${types[1]}.`;\n    }\n    else {\n        msg += `of type ${types[0]}.`;\n    }\n    if (actual == null) {\n        msg += ` Received ${actual}`;\n    }\n    else if (typeof actual === 'function' && actual.name) {\n        msg += ` Received function ${actual.name}`;\n    }\n    else if (typeof actual === 'object' && actual != null) {\n        if (actual.constructor?.name) {\n            msg += ` Received an instance of ${actual.constructor.name}`;\n        }\n    }\n    return msg;\n}\nexport default (actual, ...types) => {\n    return message('Key must be ', actual, ...types);\n};\nexport function withAlg(alg, actual, ...types) {\n    return message(`Key for the ${alg} algorithm must be `, actual, ...types);\n}\n", "import { isCryptoKey } from './webcrypto.js';\nexport default (key) => {\n    if (isCryptoKey(key)) {\n        return true;\n    }\n    return key?.[Symbol.toStringTag] === 'KeyObject';\n};\nexport const types = ['CryptoKey'];\n", "import { concat, uint64be } from '../lib/buffer_utils.js';\nimport checkIvLength from '../lib/check_iv_length.js';\nimport checkCekLength from './check_cek_length.js';\nimport timingSafeEqual from './timing_safe_equal.js';\nimport { JOSENotSupported, JWEDecryptionFailed, JWEInvalid } from '../util/errors.js';\nimport crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkEncCryptoKey } from '../lib/crypto_key.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nasync function cbcDecrypt(enc, cek, ciphertext, iv, tag, aad) {\n    if (!(cek instanceof Uint8Array)) {\n        throw new TypeError(invalidKeyInput(cek, 'Uint8Array'));\n    }\n    const keySize = parseInt(enc.slice(1, 4), 10);\n    const encKey = await crypto.subtle.importKey('raw', cek.subarray(keySize >> 3), 'AES-CBC', false, ['decrypt']);\n    const macKey = await crypto.subtle.importKey('raw', cek.subarray(0, keySize >> 3), {\n        hash: `SHA-${keySize << 1}`,\n        name: 'HMAC',\n    }, false, ['sign']);\n    const macData = concat(aad, iv, ciphertext, uint64be(aad.length << 3));\n    const expectedTag = new Uint8Array((await crypto.subtle.sign('HMAC', macKey, macData)).slice(0, keySize >> 3));\n    let macCheckPassed;\n    try {\n        macCheckPassed = timingSafeEqual(tag, expectedTag);\n    }\n    catch {\n    }\n    if (!macCheckPassed) {\n        throw new JWEDecryptionFailed();\n    }\n    let plaintext;\n    try {\n        plaintext = new Uint8Array(await crypto.subtle.decrypt({ iv, name: 'AES-CBC' }, encKey, ciphertext));\n    }\n    catch {\n    }\n    if (!plaintext) {\n        throw new JWEDecryptionFailed();\n    }\n    return plaintext;\n}\nasync function gcmDecrypt(enc, cek, ciphertext, iv, tag, aad) {\n    let encKey;\n    if (cek instanceof Uint8Array) {\n        encKey = await crypto.subtle.importKey('raw', cek, 'AES-GCM', false, ['decrypt']);\n    }\n    else {\n        checkEncCryptoKey(cek, enc, 'decrypt');\n        encKey = cek;\n    }\n    try {\n        return new Uint8Array(await crypto.subtle.decrypt({\n            additionalData: aad,\n            iv,\n            name: 'AES-GCM',\n            tagLength: 128,\n        }, encKey, concat(ciphertext, tag)));\n    }\n    catch {\n        throw new JWEDecryptionFailed();\n    }\n}\nconst decrypt = async (enc, cek, ciphertext, iv, tag, aad) => {\n    if (!isCryptoKey(cek) && !(cek instanceof Uint8Array)) {\n        throw new TypeError(invalidKeyInput(cek, ...types, 'Uint8Array'));\n    }\n    if (!iv) {\n        throw new JWEInvalid('JWE Initialization Vector missing');\n    }\n    if (!tag) {\n        throw new JWEInvalid('JWE Authentication Tag missing');\n    }\n    checkIvLength(enc, iv);\n    switch (enc) {\n        case 'A128CBC-HS256':\n        case 'A192CBC-HS384':\n        case 'A256CBC-HS512':\n            if (cek instanceof Uint8Array)\n                checkCekLength(cek, parseInt(enc.slice(-3), 10));\n            return cbcDecrypt(enc, cek, ciphertext, iv, tag, aad);\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM':\n            if (cek instanceof Uint8Array)\n                checkCekLength(cek, parseInt(enc.slice(1, 4), 10));\n            return gcmDecrypt(enc, cek, ciphertext, iv, tag, aad);\n        default:\n            throw new JOSENotSupported('Unsupported JWE Content Encryption Algorithm');\n    }\n};\nexport default decrypt;\n", "const isDisjoint = (...headers) => {\n    const sources = headers.filter(Boolean);\n    if (sources.length === 0 || sources.length === 1) {\n        return true;\n    }\n    let acc;\n    for (const header of sources) {\n        const parameters = Object.keys(header);\n        if (!acc || acc.size === 0) {\n            acc = new Set(parameters);\n            continue;\n        }\n        for (const parameter of parameters) {\n            if (acc.has(parameter)) {\n                return false;\n            }\n            acc.add(parameter);\n        }\n    }\n    return true;\n};\nexport default isDisjoint;\n", "function isObjectLike(value) {\n    return typeof value === 'object' && value !== null;\n}\nexport default function isObject(input) {\n    if (!isObjectLike(input) || Object.prototype.toString.call(input) !== '[object Object]') {\n        return false;\n    }\n    if (Object.getPrototypeOf(input) === null) {\n        return true;\n    }\n    let proto = input;\n    while (Object.getPrototypeOf(proto) !== null) {\n        proto = Object.getPrototypeOf(proto);\n    }\n    return Object.getPrototypeOf(input) === proto;\n}\n", "const bogusWebCrypto = [\n    { hash: 'SHA-256', name: 'HMAC' },\n    true,\n    ['sign'],\n];\nexport default bogusWebCrypto;\n", "import bogusWebCrypto from './bogus.js';\nimport crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkEncCryptoKey } from '../lib/crypto_key.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nfunction checkKeySize(key, alg) {\n    if (key.algorithm.length !== parseInt(alg.slice(1, 4), 10)) {\n        throw new TypeError(`Invalid key size for alg: ${alg}`);\n    }\n}\nfunction getCryptoKey(key, alg, usage) {\n    if (isCryptoKey(key)) {\n        checkEncCryptoKey(key, alg, usage);\n        return key;\n    }\n    if (key instanceof Uint8Array) {\n        return crypto.subtle.importKey('raw', key, 'AES-KW', true, [usage]);\n    }\n    throw new TypeError(invalidKeyInput(key, ...types, 'Uint8Array'));\n}\nexport const wrap = async (alg, key, cek) => {\n    const cryptoKey = await getCryptoKey(key, alg, 'wrapKey');\n    checkKeySize(cryptoKey, alg);\n    const cryptoKeyCek = await crypto.subtle.importKey('raw', cek, ...bogusWebCrypto);\n    return new Uint8Array(await crypto.subtle.wrapKey('raw', cryptoKeyCek, cryptoKey, 'AES-KW'));\n};\nexport const unwrap = async (alg, key, encryptedKey) => {\n    const cryptoKey = await getCryptoKey(key, alg, 'unwrapKey');\n    checkKeySize(cryptoKey, alg);\n    const cryptoKeyCek = await crypto.subtle.unwrapKey('raw', encryptedKey, cryptoKey, 'AES-KW', ...bogusWebCrypto);\n    return new Uint8Array(await crypto.subtle.exportKey('raw', cryptoKeyCek));\n};\n", "import { encoder, concat, uint32be, lengthAndInput, concatKdf } from '../lib/buffer_utils.js';\nimport crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkEncCryptoKey } from '../lib/crypto_key.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nexport async function deriveKey(publicKey, privateKey, algorithm, keyLength, apu = new Uint8Array(0), apv = new Uint8Array(0)) {\n    if (!isCryptoKey(publicKey)) {\n        throw new TypeError(invalidKeyInput(publicKey, ...types));\n    }\n    checkEncCryptoKey(publicKey, 'ECDH');\n    if (!isCryptoKey(privateKey)) {\n        throw new TypeError(invalidKeyInput(privateKey, ...types));\n    }\n    checkEncCryptoKey(privateKey, 'ECDH', 'deriveBits');\n    const value = concat(lengthAndInput(encoder.encode(algorithm)), lengthAndInput(apu), lengthAndInput(apv), uint32be(keyLength));\n    let length;\n    if (publicKey.algorithm.name === 'X25519') {\n        length = 256;\n    }\n    else if (publicKey.algorithm.name === 'X448') {\n        length = 448;\n    }\n    else {\n        length =\n            Math.ceil(parseInt(publicKey.algorithm.namedCurve.substr(-3), 10) / 8) <<\n                3;\n    }\n    const sharedSecret = new Uint8Array(await crypto.subtle.deriveBits({\n        name: publicKey.algorithm.name,\n        public: publicKey,\n    }, privateKey, length));\n    return concatKdf(sharedSecret, keyLength, value);\n}\nexport async function generateEpk(key) {\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types));\n    }\n    return crypto.subtle.generateKey(key.algorithm, true, ['deriveBits']);\n}\nexport function ecdhAllowed(key) {\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types));\n    }\n    return (['P-256', 'P-384', 'P-521'].includes(key.algorithm.namedCurve) ||\n        key.algorithm.name === 'X25519' ||\n        key.algorithm.name === 'X448');\n}\n", "import { JWEInvalid } from '../util/errors.js';\nexport default function checkP2s(p2s) {\n    if (!(p2s instanceof Uint8Array) || p2s.length < 8) {\n        throw new JWEInvalid('PBES2 Salt Input must be 8 or more octets');\n    }\n}\n", "import random from './random.js';\nimport { p2s as concatSalt } from '../lib/buffer_utils.js';\nimport { encode as base64url } from './base64url.js';\nimport { wrap, unwrap } from './aeskw.js';\nimport checkP2s from '../lib/check_p2s.js';\nimport crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkEncCryptoKey } from '../lib/crypto_key.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nfunction getCryptoKey(key, alg) {\n    if (key instanceof Uint8Array) {\n        return crypto.subtle.importKey('raw', key, 'PBKDF2', false, ['deriveBits']);\n    }\n    if (isCryptoKey(key)) {\n        checkEncCryptoKey(key, alg, 'deriveBits', 'deriveKey');\n        return key;\n    }\n    throw new TypeError(invalidKeyInput(key, ...types, 'Uint8Array'));\n}\nasync function deriveKey(p2s, alg, p2c, key) {\n    checkP2s(p2s);\n    const salt = concatSalt(alg, p2s);\n    const keylen = parseInt(alg.slice(13, 16), 10);\n    const subtleAlg = {\n        hash: `SHA-${alg.slice(8, 11)}`,\n        iterations: p2c,\n        name: 'PBKDF2',\n        salt,\n    };\n    const wrapAlg = {\n        length: keylen,\n        name: 'AES-KW',\n    };\n    const cryptoKey = await getCryptoKey(key, alg);\n    if (cryptoKey.usages.includes('deriveBits')) {\n        return new Uint8Array(await crypto.subtle.deriveBits(subtleAlg, cryptoKey, keylen));\n    }\n    if (cryptoKey.usages.includes('deriveKey')) {\n        return crypto.subtle.deriveKey(subtleAlg, cryptoKey, wrapAlg, false, ['wrapKey', 'unwrapKey']);\n    }\n    throw new TypeError('PBKDF2 key \"usages\" must include \"deriveBits\" or \"deriveKey\"');\n}\nexport const encrypt = async (alg, key, cek, p2c = 2048, p2s = random(new Uint8Array(16))) => {\n    const derived = await deriveKey(p2s, alg, p2c, key);\n    const encryptedKey = await wrap(alg.slice(-6), derived, cek);\n    return { encryptedKey, p2c, p2s: base64url(p2s) };\n};\nexport const decrypt = async (alg, key, encryptedKey, p2c, p2s) => {\n    const derived = await deriveKey(p2s, alg, p2c, key);\n    return unwrap(alg.slice(-6), derived, encryptedKey);\n};\n", "import { JOSENotSupported } from '../util/errors.js';\nexport default function subtleRsaEs(alg) {\n    switch (alg) {\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512':\n            return 'RSA-OAEP';\n        default:\n            throw new JOSENotSupported(`alg ${alg} is not supported either by JOSE or your javascript runtime`);\n    }\n}\n", "export default (alg, key) => {\n    if (alg.startsWith('RS') || alg.startsWith('PS')) {\n        const { modulusLength } = key.algorithm;\n        if (typeof modulusLength !== 'number' || modulusLength < 2048) {\n            throw new TypeError(`${alg} requires key modulusLength to be 2048 bits or larger`);\n        }\n    }\n};\n", "import subtleAlgorithm from './subtle_rsaes.js';\nimport bogusWebCrypto from './bogus.js';\nimport crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkEncCryptoKey } from '../lib/crypto_key.js';\nimport checkKeyLength from './check_key_length.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nexport const encrypt = async (alg, key, cek) => {\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types));\n    }\n    checkEncCryptoKey(key, alg, 'encrypt', 'wrapKey');\n    checkKeyLength(alg, key);\n    if (key.usages.includes('encrypt')) {\n        return new Uint8Array(await crypto.subtle.encrypt(subtleAlgorithm(alg), key, cek));\n    }\n    if (key.usages.includes('wrapKey')) {\n        const cryptoKeyCek = await crypto.subtle.importKey('raw', cek, ...bogusWebCrypto);\n        return new Uint8Array(await crypto.subtle.wrapKey('raw', cryptoKeyCek, key, subtleAlgorithm(alg)));\n    }\n    throw new TypeError('RSA-OAEP key \"usages\" must include \"encrypt\" or \"wrapKey\" for this operation');\n};\nexport const decrypt = async (alg, key, encryptedKey) => {\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types));\n    }\n    checkEncCryptoKey(key, alg, 'decrypt', 'unwrapKey');\n    checkKeyLength(alg, key);\n    if (key.usages.includes('decrypt')) {\n        return new Uint8Array(await crypto.subtle.decrypt(subtleAlgorithm(alg), key, encryptedKey));\n    }\n    if (key.usages.includes('unwrapKey')) {\n        const cryptoKeyCek = await crypto.subtle.unwrapKey('raw', encryptedKey, key, subtleAlgorithm(alg), ...bogusWebCrypto);\n        return new Uint8Array(await crypto.subtle.exportKey('raw', cryptoKeyCek));\n    }\n    throw new TypeError('RSA-OAEP key \"usages\" must include \"decrypt\" or \"unwrapKey\" for this operation');\n};\n", "import isObject from './is_object.js';\nexport function isJWK(key) {\n    return isObject(key) && typeof key.kty === 'string';\n}\nexport function isPrivateJWK(key) {\n    return key.kty !== 'oct' && typeof key.d === 'string';\n}\nexport function isPublicJWK(key) {\n    return key.kty !== 'oct' && typeof key.d === 'undefined';\n}\nexport function isSecretJWK(key) {\n    return isJWK(key) && key.kty === 'oct' && typeof key.k === 'string';\n}\n", "import crypto from './webcrypto.js';\nimport { JOSENotSupported } from '../util/errors.js';\nfunction subtleMapping(jwk) {\n    let algorithm;\n    let keyUsages;\n    switch (jwk.kty) {\n        case 'RSA': {\n            switch (jwk.alg) {\n                case 'PS256':\n                case 'PS384':\n                case 'PS512':\n                    algorithm = { name: 'RSA-PSS', hash: `SHA-${jwk.alg.slice(-3)}` };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'RS256':\n                case 'RS384':\n                case 'RS512':\n                    algorithm = { name: 'RSASSA-PKCS1-v1_5', hash: `SHA-${jwk.alg.slice(-3)}` };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'RSA-OAEP':\n                case 'RSA-OAEP-256':\n                case 'RSA-OAEP-384':\n                case 'RSA-OAEP-512':\n                    algorithm = {\n                        name: 'RSA-OAEP',\n                        hash: `SHA-${parseInt(jwk.alg.slice(-3), 10) || 1}`,\n                    };\n                    keyUsages = jwk.d ? ['decrypt', 'unwrapKey'] : ['encrypt', 'wrapKey'];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'EC': {\n            switch (jwk.alg) {\n                case 'ES256':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-256' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ES384':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-384' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ES512':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-521' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ECDH-ES':\n                case 'ECDH-ES+A128KW':\n                case 'ECDH-ES+A192KW':\n                case 'ECDH-ES+A256KW':\n                    algorithm = { name: 'ECDH', namedCurve: jwk.crv };\n                    keyUsages = jwk.d ? ['deriveBits'] : [];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'OKP': {\n            switch (jwk.alg) {\n                case 'Ed25519':\n                    algorithm = { name: 'Ed25519' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'EdDSA':\n                    algorithm = { name: jwk.crv };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ECDH-ES':\n                case 'ECDH-ES+A128KW':\n                case 'ECDH-ES+A192KW':\n                case 'ECDH-ES+A256KW':\n                    algorithm = { name: jwk.crv };\n                    keyUsages = jwk.d ? ['deriveBits'] : [];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        default:\n            throw new JOSENotSupported('Invalid or unsupported JWK \"kty\" (Key Type) Parameter value');\n    }\n    return { algorithm, keyUsages };\n}\nconst parse = async (jwk) => {\n    if (!jwk.alg) {\n        throw new TypeError('\"alg\" argument is required when \"jwk.alg\" is not present');\n    }\n    const { algorithm, keyUsages } = subtleMapping(jwk);\n    const rest = [\n        algorithm,\n        jwk.ext ?? false,\n        jwk.key_ops ?? keyUsages,\n    ];\n    const keyData = { ...jwk };\n    delete keyData.alg;\n    delete keyData.use;\n    return crypto.subtle.importKey('jwk', keyData, ...rest);\n};\nexport default parse;\n", "import { isJWK } from '../lib/is_jwk.js';\nimport { decode } from './base64url.js';\nimport importJWK from './jwk_to_key.js';\nconst exportKeyValue = (k) => decode(k);\nlet privCache;\nlet pubCache;\nconst isKeyObject = (key) => {\n    return key?.[Symbol.toStringTag] === 'KeyObject';\n};\nconst importAndCache = async (cache, key, jwk, alg, freeze = false) => {\n    let cached = cache.get(key);\n    if (cached?.[alg]) {\n        return cached[alg];\n    }\n    const cryptoKey = await importJWK({ ...jwk, alg });\n    if (freeze)\n        Object.freeze(key);\n    if (!cached) {\n        cache.set(key, { [alg]: cryptoKey });\n    }\n    else {\n        cached[alg] = cryptoKey;\n    }\n    return cryptoKey;\n};\nconst normalizePublicKey = (key, alg) => {\n    if (isKeyObject(key)) {\n        let jwk = key.export({ format: 'jwk' });\n        delete jwk.d;\n        delete jwk.dp;\n        delete jwk.dq;\n        delete jwk.p;\n        delete jwk.q;\n        delete jwk.qi;\n        if (jwk.k) {\n            return exportKeyValue(jwk.k);\n        }\n        pubCache || (pubCache = new WeakMap());\n        return importAndCache(pubCache, key, jwk, alg);\n    }\n    if (isJWK(key)) {\n        if (key.k)\n            return decode(key.k);\n        pubCache || (pubCache = new WeakMap());\n        const cryptoKey = importAndCache(pubCache, key, key, alg, true);\n        return cryptoKey;\n    }\n    return key;\n};\nconst normalizePrivateKey = (key, alg) => {\n    if (isKeyObject(key)) {\n        let jwk = key.export({ format: 'jwk' });\n        if (jwk.k) {\n            return exportKeyValue(jwk.k);\n        }\n        privCache || (privCache = new WeakMap());\n        return importAndCache(privCache, key, jwk, alg);\n    }\n    if (isJWK(key)) {\n        if (key.k)\n            return decode(key.k);\n        privCache || (privCache = new WeakMap());\n        const cryptoKey = importAndCache(privCache, key, key, alg, true);\n        return cryptoKey;\n    }\n    return key;\n};\nexport default { normalizePublicKey, normalizePrivateKey };\n", "import { JOSENotSupported } from '../util/errors.js';\nimport random from '../runtime/random.js';\nexport function bitLength(alg) {\n    switch (alg) {\n        case 'A128GCM':\n            return 128;\n        case 'A192GCM':\n            return 192;\n        case 'A256GCM':\n        case 'A128CBC-HS256':\n            return 256;\n        case 'A192CBC-HS384':\n            return 384;\n        case 'A256CBC-HS512':\n            return 512;\n        default:\n            throw new JOSENotSupported(`Unsupported JWE Algorithm: ${alg}`);\n    }\n}\nexport default (alg) => random(new Uint8Array(bitLength(alg) >> 3));\n", "import crypto, { isCryptoKey } from './webcrypto.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { encodeBase64, decodeBase64 } from './base64url.js';\nimport formatPEM from '../lib/format_pem.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport { types } from './is_key_like.js';\nconst genericExport = async (keyType, keyFormat, key) => {\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types));\n    }\n    if (!key.extractable) {\n        throw new TypeError('CryptoKey is not extractable');\n    }\n    if (key.type !== keyType) {\n        throw new TypeError(`key is not a ${keyType} key`);\n    }\n    return formatPEM(encodeBase64(new Uint8Array(await crypto.subtle.exportKey(keyFormat, key))), `${keyType.toUpperCase()} KEY`);\n};\nexport const toSPKI = (key) => {\n    return genericExport('public', 'spki', key);\n};\nexport const toPKCS8 = (key) => {\n    return genericExport('private', 'pkcs8', key);\n};\nconst findOid = (keyData, oid, from = 0) => {\n    if (from === 0) {\n        oid.unshift(oid.length);\n        oid.unshift(0x06);\n    }\n    const i = keyData.indexOf(oid[0], from);\n    if (i === -1)\n        return false;\n    const sub = keyData.subarray(i, i + oid.length);\n    if (sub.length !== oid.length)\n        return false;\n    return sub.every((value, index) => value === oid[index]) || findOid(keyData, oid, i + 1);\n};\nconst getNamedCurve = (keyData) => {\n    switch (true) {\n        case findOid(keyData, [0x2a, 0x86, 0x48, 0xce, 0x3d, 0x03, 0x01, 0x07]):\n            return 'P-256';\n        case findOid(keyData, [0x2b, 0x81, 0x04, 0x00, 0x22]):\n            return 'P-384';\n        case findOid(keyData, [0x2b, 0x81, 0x04, 0x00, 0x23]):\n            return 'P-521';\n        case findOid(keyData, [0x2b, 0x65, 0x6e]):\n            return 'X25519';\n        case findOid(keyData, [0x2b, 0x65, 0x6f]):\n            return 'X448';\n        case findOid(keyData, [0x2b, 0x65, 0x70]):\n            return 'Ed25519';\n        case findOid(keyData, [0x2b, 0x65, 0x71]):\n            return 'Ed448';\n        default:\n            throw new JOSENotSupported('Invalid or unsupported EC Key Curve or OKP Key Sub Type');\n    }\n};\nconst genericImport = async (replace, keyFormat, pem, alg, options) => {\n    let algorithm;\n    let keyUsages;\n    const keyData = new Uint8Array(atob(pem.replace(replace, ''))\n        .split('')\n        .map((c) => c.charCodeAt(0)));\n    const isPublic = keyFormat === 'spki';\n    switch (alg) {\n        case 'PS256':\n        case 'PS384':\n        case 'PS512':\n            algorithm = { name: 'RSA-PSS', hash: `SHA-${alg.slice(-3)}` };\n            keyUsages = isPublic ? ['verify'] : ['sign'];\n            break;\n        case 'RS256':\n        case 'RS384':\n        case 'RS512':\n            algorithm = { name: 'RSASSA-PKCS1-v1_5', hash: `SHA-${alg.slice(-3)}` };\n            keyUsages = isPublic ? ['verify'] : ['sign'];\n            break;\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512':\n            algorithm = {\n                name: 'RSA-OAEP',\n                hash: `SHA-${parseInt(alg.slice(-3), 10) || 1}`,\n            };\n            keyUsages = isPublic ? ['encrypt', 'wrapKey'] : ['decrypt', 'unwrapKey'];\n            break;\n        case 'ES256':\n            algorithm = { name: 'ECDSA', namedCurve: 'P-256' };\n            keyUsages = isPublic ? ['verify'] : ['sign'];\n            break;\n        case 'ES384':\n            algorithm = { name: 'ECDSA', namedCurve: 'P-384' };\n            keyUsages = isPublic ? ['verify'] : ['sign'];\n            break;\n        case 'ES512':\n            algorithm = { name: 'ECDSA', namedCurve: 'P-521' };\n            keyUsages = isPublic ? ['verify'] : ['sign'];\n            break;\n        case 'ECDH-ES':\n        case 'ECDH-ES+A128KW':\n        case 'ECDH-ES+A192KW':\n        case 'ECDH-ES+A256KW': {\n            const namedCurve = getNamedCurve(keyData);\n            algorithm = namedCurve.startsWith('P-') ? { name: 'ECDH', namedCurve } : { name: namedCurve };\n            keyUsages = isPublic ? [] : ['deriveBits'];\n            break;\n        }\n        case 'Ed25519':\n            algorithm = { name: 'Ed25519' };\n            keyUsages = isPublic ? ['verify'] : ['sign'];\n            break;\n        case 'EdDSA':\n            algorithm = { name: getNamedCurve(keyData) };\n            keyUsages = isPublic ? ['verify'] : ['sign'];\n            break;\n        default:\n            throw new JOSENotSupported('Invalid or unsupported \"alg\" (Algorithm) value');\n    }\n    return crypto.subtle.importKey(keyFormat, keyData, algorithm, options?.extractable ?? false, keyUsages);\n};\nexport const fromPKCS8 = (pem, alg, options) => {\n    return genericImport(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\\s)/g, 'pkcs8', pem, alg, options);\n};\nexport const fromSPKI = (pem, alg, options) => {\n    return genericImport(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\\s)/g, 'spki', pem, alg, options);\n};\nfunction getElement(seq) {\n    const result = [];\n    let next = 0;\n    while (next < seq.length) {\n        const nextPart = parseElement(seq.subarray(next));\n        result.push(nextPart);\n        next += nextPart.byteLength;\n    }\n    return result;\n}\nfunction parseElement(bytes) {\n    let position = 0;\n    let tag = bytes[0] & 0x1f;\n    position++;\n    if (tag === 0x1f) {\n        tag = 0;\n        while (bytes[position] >= 0x80) {\n            tag = tag * 128 + bytes[position] - 0x80;\n            position++;\n        }\n        tag = tag * 128 + bytes[position] - 0x80;\n        position++;\n    }\n    let length = 0;\n    if (bytes[position] < 0x80) {\n        length = bytes[position];\n        position++;\n    }\n    else if (length === 0x80) {\n        length = 0;\n        while (bytes[position + length] !== 0 || bytes[position + length + 1] !== 0) {\n            if (length > bytes.byteLength) {\n                throw new TypeError('invalid indefinite form length');\n            }\n            length++;\n        }\n        const byteLength = position + length + 2;\n        return {\n            byteLength,\n            contents: bytes.subarray(position, position + length),\n            raw: bytes.subarray(0, byteLength),\n        };\n    }\n    else {\n        const numberOfDigits = bytes[position] & 0x7f;\n        position++;\n        length = 0;\n        for (let i = 0; i < numberOfDigits; i++) {\n            length = length * 256 + bytes[position];\n            position++;\n        }\n    }\n    const byteLength = position + length;\n    return {\n        byteLength,\n        contents: bytes.subarray(position, byteLength),\n        raw: bytes.subarray(0, byteLength),\n    };\n}\nfunction spkiFromX509(buf) {\n    const tbsCertificate = getElement(getElement(parseElement(buf).contents)[0].contents);\n    return encodeBase64(tbsCertificate[tbsCertificate[0].raw[0] === 0xa0 ? 6 : 5].raw);\n}\nfunction getSPKI(x509) {\n    const pem = x509.replace(/(?:-----(?:BEGIN|END) CERTIFICATE-----|\\s)/g, '');\n    const raw = decodeBase64(pem);\n    return formatPEM(spkiFromX509(raw), 'PUBLIC KEY');\n}\nexport const fromX509 = (pem, alg, options) => {\n    let spki;\n    try {\n        spki = getSPKI(pem);\n    }\n    catch (cause) {\n        throw new TypeError('Failed to parse the X.509 certificate', { cause });\n    }\n    return fromSPKI(spki, alg, options);\n};\n", "import { decode as decodeBase64URL } from '../runtime/base64url.js';\nimport { fromSPKI, fromPKCS8, fromX509 } from '../runtime/asn1.js';\nimport asKeyObject from '../runtime/jwk_to_key.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport isObject from '../lib/is_object.js';\nexport async function importSPKI(spki, alg, options) {\n    if (typeof spki !== 'string' || spki.indexOf('-----BEGIN PUBLIC KEY-----') !== 0) {\n        throw new TypeError('\"spki\" must be SPKI formatted string');\n    }\n    return fromSPKI(spki, alg, options);\n}\nexport async function importX509(x509, alg, options) {\n    if (typeof x509 !== 'string' || x509.indexOf('-----BEGIN CERTIFICATE-----') !== 0) {\n        throw new TypeError('\"x509\" must be X.509 formatted string');\n    }\n    return fromX509(x509, alg, options);\n}\nexport async function importPKCS8(pkcs8, alg, options) {\n    if (typeof pkcs8 !== 'string' || pkcs8.indexOf('-----BEGIN PRIVATE KEY-----') !== 0) {\n        throw new TypeError('\"pkcs8\" must be PKCS#8 formatted string');\n    }\n    return fromPKCS8(pkcs8, alg, options);\n}\nexport async function importJWK(jwk, alg) {\n    if (!isObject(jwk)) {\n        throw new TypeError('JWK must be an object');\n    }\n    alg || (alg = jwk.alg);\n    switch (jwk.kty) {\n        case 'oct':\n            if (typeof jwk.k !== 'string' || !jwk.k) {\n                throw new TypeError('missing \"k\" (Key Value) Parameter value');\n            }\n            return decodeBase64URL(jwk.k);\n        case 'RSA':\n            if ('oth' in jwk && jwk.oth !== undefined) {\n                throw new JOSENotSupported('RSA JWK \"oth\" (Other Primes Info) Parameter value is not supported');\n            }\n        case 'EC':\n        case 'OKP':\n            return asKeyObject({ ...jwk, alg });\n        default:\n            throw new JOSENotSupported('Unsupported \"kty\" (Key Type) Parameter value');\n    }\n}\n", "import { withAlg as invalidKeyInput } from './invalid_key_input.js';\nimport isKeyLike, { types } from '../runtime/is_key_like.js';\nimport * as jwk from './is_jwk.js';\nconst tag = (key) => key?.[Symbol.toStringTag];\nconst jwkMatchesOp = (alg, key, usage) => {\n    if (key.use !== undefined && key.use !== 'sig') {\n        throw new TypeError('Invalid key for this operation, when present its use must be sig');\n    }\n    if (key.key_ops !== undefined && key.key_ops.includes?.(usage) !== true) {\n        throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${usage}`);\n    }\n    if (key.alg !== undefined && key.alg !== alg) {\n        throw new TypeError(`Invalid key for this operation, when present its alg must be ${alg}`);\n    }\n    return true;\n};\nconst symmetricTypeCheck = (alg, key, usage, allowJwk) => {\n    if (key instanceof Uint8Array)\n        return;\n    if (allowJwk && jwk.isJWK(key)) {\n        if (jwk.isSecretJWK(key) && jwkMatchesOp(alg, key, usage))\n            return;\n        throw new TypeError(`JSON Web Key for symmetric algorithms must have JWK \"kty\" (Key Type) equal to \"oct\" and the JWK \"k\" (Key Value) present`);\n    }\n    if (!isKeyLike(key)) {\n        throw new TypeError(invalidKeyInput(alg, key, ...types, 'Uint8Array', allowJwk ? 'JSON Web Key' : null));\n    }\n    if (key.type !== 'secret') {\n        throw new TypeError(`${tag(key)} instances for symmetric algorithms must be of type \"secret\"`);\n    }\n};\nconst asymmetricTypeCheck = (alg, key, usage, allowJwk) => {\n    if (allowJwk && jwk.isJWK(key)) {\n        switch (usage) {\n            case 'sign':\n                if (jwk.isPrivateJWK(key) && jwkMatchesOp(alg, key, usage))\n                    return;\n                throw new TypeError(`JSON Web Key for this operation be a private JWK`);\n            case 'verify':\n                if (jwk.isPublicJWK(key) && jwkMatchesOp(alg, key, usage))\n                    return;\n                throw new TypeError(`JSON Web Key for this operation be a public JWK`);\n        }\n    }\n    if (!isKeyLike(key)) {\n        throw new TypeError(invalidKeyInput(alg, key, ...types, allowJwk ? 'JSON Web Key' : null));\n    }\n    if (key.type === 'secret') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithms must not be of type \"secret\"`);\n    }\n    if (usage === 'sign' && key.type === 'public') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm signing must be of type \"private\"`);\n    }\n    if (usage === 'decrypt' && key.type === 'public') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm decryption must be of type \"private\"`);\n    }\n    if (key.algorithm && usage === 'verify' && key.type === 'private') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm verifying must be of type \"public\"`);\n    }\n    if (key.algorithm && usage === 'encrypt' && key.type === 'private') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm encryption must be of type \"public\"`);\n    }\n};\nfunction checkKeyType(allowJwk, alg, key, usage) {\n    const symmetric = alg.startsWith('HS') ||\n        alg === 'dir' ||\n        alg.startsWith('PBES2') ||\n        /^A\\d{3}(?:GCM)?KW$/.test(alg);\n    if (symmetric) {\n        symmetricTypeCheck(alg, key, usage, allowJwk);\n    }\n    else {\n        asymmetricTypeCheck(alg, key, usage, allowJwk);\n    }\n}\nexport default checkKeyType.bind(undefined, false);\nexport const checkKeyTypeWithJwk = checkKeyType.bind(undefined, true);\n", "import { concat, uint64be } from '../lib/buffer_utils.js';\nimport checkIvLength from '../lib/check_iv_length.js';\nimport checkCekLength from './check_cek_length.js';\nimport crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkEncCryptoKey } from '../lib/crypto_key.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport generateIv from '../lib/iv.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport { types } from './is_key_like.js';\nasync function cbcEncrypt(enc, plaintext, cek, iv, aad) {\n    if (!(cek instanceof Uint8Array)) {\n        throw new TypeError(invalidKeyInput(cek, 'Uint8Array'));\n    }\n    const keySize = parseInt(enc.slice(1, 4), 10);\n    const encKey = await crypto.subtle.importKey('raw', cek.subarray(keySize >> 3), 'AES-CBC', false, ['encrypt']);\n    const macKey = await crypto.subtle.importKey('raw', cek.subarray(0, keySize >> 3), {\n        hash: `SHA-${keySize << 1}`,\n        name: 'HMAC',\n    }, false, ['sign']);\n    const ciphertext = new Uint8Array(await crypto.subtle.encrypt({\n        iv,\n        name: 'AES-CBC',\n    }, encKey, plaintext));\n    const macData = concat(aad, iv, ciphertext, uint64be(aad.length << 3));\n    const tag = new Uint8Array((await crypto.subtle.sign('HMAC', macKey, macData)).slice(0, keySize >> 3));\n    return { ciphertext, tag, iv };\n}\nasync function gcmEncrypt(enc, plaintext, cek, iv, aad) {\n    let encKey;\n    if (cek instanceof Uint8Array) {\n        encKey = await crypto.subtle.importKey('raw', cek, 'AES-GCM', false, ['encrypt']);\n    }\n    else {\n        checkEncCryptoKey(cek, enc, 'encrypt');\n        encKey = cek;\n    }\n    const encrypted = new Uint8Array(await crypto.subtle.encrypt({\n        additionalData: aad,\n        iv,\n        name: 'AES-GCM',\n        tagLength: 128,\n    }, encKey, plaintext));\n    const tag = encrypted.slice(-16);\n    const ciphertext = encrypted.slice(0, -16);\n    return { ciphertext, tag, iv };\n}\nconst encrypt = async (enc, plaintext, cek, iv, aad) => {\n    if (!isCryptoKey(cek) && !(cek instanceof Uint8Array)) {\n        throw new TypeError(invalidKeyInput(cek, ...types, 'Uint8Array'));\n    }\n    if (iv) {\n        checkIvLength(enc, iv);\n    }\n    else {\n        iv = generateIv(enc);\n    }\n    switch (enc) {\n        case 'A128CBC-HS256':\n        case 'A192CBC-HS384':\n        case 'A256CBC-HS512':\n            if (cek instanceof Uint8Array) {\n                checkCekLength(cek, parseInt(enc.slice(-3), 10));\n            }\n            return cbcEncrypt(enc, plaintext, cek, iv, aad);\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM':\n            if (cek instanceof Uint8Array) {\n                checkCekLength(cek, parseInt(enc.slice(1, 4), 10));\n            }\n            return gcmEncrypt(enc, plaintext, cek, iv, aad);\n        default:\n            throw new JOSENotSupported('Unsupported JWE Content Encryption Algorithm');\n    }\n};\nexport default encrypt;\n", "import encrypt from '../runtime/encrypt.js';\nimport decrypt from '../runtime/decrypt.js';\nimport { encode as base64url } from '../runtime/base64url.js';\nexport async function wrap(alg, key, cek, iv) {\n    const jweAlgorithm = alg.slice(0, 7);\n    const wrapped = await encrypt(jweAlgorithm, cek, key, iv, new Uint8Array(0));\n    return {\n        encryptedKey: wrapped.ciphertext,\n        iv: base64url(wrapped.iv),\n        tag: base64url(wrapped.tag),\n    };\n}\nexport async function unwrap(alg, key, encryptedKey, iv, tag) {\n    const jweAlgorithm = alg.slice(0, 7);\n    return decrypt(jweAlgorithm, key, encryptedKey, iv, tag, new Uint8Array(0));\n}\n", "import { unwrap as aesKw } from '../runtime/aeskw.js';\nimport * as ECDH from '../runtime/ecdhes.js';\nimport { decrypt as pbes2Kw } from '../runtime/pbes2kw.js';\nimport { decrypt as rsaEs } from '../runtime/rsaes.js';\nimport { decode as base64url } from '../runtime/base64url.js';\nimport normalize from '../runtime/normalize_key.js';\nimport { JOSENotSupported, JWEInvalid } from '../util/errors.js';\nimport { bitLength as cekLength } from '../lib/cek.js';\nimport { importJWK } from '../key/import.js';\nimport checkKeyType from './check_key_type.js';\nimport isObject from './is_object.js';\nimport { unwrap as aesGcmKw } from './aesgcmkw.js';\nasync function decryptKeyManagement(alg, key, encryptedKey, joseHeader, options) {\n    checkKeyType(alg, key, 'decrypt');\n    key = (await normalize.normalizePrivateKey?.(key, alg)) || key;\n    switch (alg) {\n        case 'dir': {\n            if (encryptedKey !== undefined)\n                throw new JWEInvalid('Encountered unexpected JWE Encrypted Key');\n            return key;\n        }\n        case 'ECDH-ES':\n            if (encryptedKey !== undefined)\n                throw new JWEInvalid('Encountered unexpected JWE Encrypted Key');\n        case 'ECDH-ES+A128KW':\n        case 'ECDH-ES+A192KW':\n        case 'ECDH-ES+A256KW': {\n            if (!isObject(joseHeader.epk))\n                throw new JWEInvalid(`JOSE Header \"epk\" (Ephemeral Public Key) missing or invalid`);\n            if (!ECDH.ecdhAllowed(key))\n                throw new JOSENotSupported('ECDH with the provided key is not allowed or not supported by your javascript runtime');\n            const epk = await importJWK(joseHeader.epk, alg);\n            let partyUInfo;\n            let partyVInfo;\n            if (joseHeader.apu !== undefined) {\n                if (typeof joseHeader.apu !== 'string')\n                    throw new JWEInvalid(`JOSE Header \"apu\" (Agreement PartyUInfo) invalid`);\n                try {\n                    partyUInfo = base64url(joseHeader.apu);\n                }\n                catch {\n                    throw new JWEInvalid('Failed to base64url decode the apu');\n                }\n            }\n            if (joseHeader.apv !== undefined) {\n                if (typeof joseHeader.apv !== 'string')\n                    throw new JWEInvalid(`JOSE Header \"apv\" (Agreement PartyVInfo) invalid`);\n                try {\n                    partyVInfo = base64url(joseHeader.apv);\n                }\n                catch {\n                    throw new JWEInvalid('Failed to base64url decode the apv');\n                }\n            }\n            const sharedSecret = await ECDH.deriveKey(epk, key, alg === 'ECDH-ES' ? joseHeader.enc : alg, alg === 'ECDH-ES' ? cekLength(joseHeader.enc) : parseInt(alg.slice(-5, -2), 10), partyUInfo, partyVInfo);\n            if (alg === 'ECDH-ES')\n                return sharedSecret;\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            return aesKw(alg.slice(-6), sharedSecret, encryptedKey);\n        }\n        case 'RSA1_5':\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            return rsaEs(alg, key, encryptedKey);\n        }\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW': {\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            if (typeof joseHeader.p2c !== 'number')\n                throw new JWEInvalid(`JOSE Header \"p2c\" (PBES2 Count) missing or invalid`);\n            const p2cLimit = options?.maxPBES2Count || 10000;\n            if (joseHeader.p2c > p2cLimit)\n                throw new JWEInvalid(`JOSE Header \"p2c\" (PBES2 Count) out is of acceptable bounds`);\n            if (typeof joseHeader.p2s !== 'string')\n                throw new JWEInvalid(`JOSE Header \"p2s\" (PBES2 Salt) missing or invalid`);\n            let p2s;\n            try {\n                p2s = base64url(joseHeader.p2s);\n            }\n            catch {\n                throw new JWEInvalid('Failed to base64url decode the p2s');\n            }\n            return pbes2Kw(alg, key, encryptedKey, joseHeader.p2c, p2s);\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            return aesKw(alg, key, encryptedKey);\n        }\n        case 'A128GCMKW':\n        case 'A192GCMKW':\n        case 'A256GCMKW': {\n            if (encryptedKey === undefined)\n                throw new JWEInvalid('JWE Encrypted Key missing');\n            if (typeof joseHeader.iv !== 'string')\n                throw new JWEInvalid(`JOSE Header \"iv\" (Initialization Vector) missing or invalid`);\n            if (typeof joseHeader.tag !== 'string')\n                throw new JWEInvalid(`JOSE Header \"tag\" (Authentication Tag) missing or invalid`);\n            let iv;\n            try {\n                iv = base64url(joseHeader.iv);\n            }\n            catch {\n                throw new JWEInvalid('Failed to base64url decode the iv');\n            }\n            let tag;\n            try {\n                tag = base64url(joseHeader.tag);\n            }\n            catch {\n                throw new JWEInvalid('Failed to base64url decode the tag');\n            }\n            return aesGcmKw(alg, key, encryptedKey, iv, tag);\n        }\n        default: {\n            throw new JOSENotSupported('Invalid or unsupported \"alg\" (JWE Algorithm) header value');\n        }\n    }\n}\nexport default decryptKeyManagement;\n", "import { JOSENotSupported } from '../util/errors.js';\nfunction validateCrit(Err, recognizedDefault, recognizedOption, protectedHeader, joseHeader) {\n    if (joseHeader.crit !== undefined && protectedHeader?.crit === undefined) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be integrity protected');\n    }\n    if (!protectedHeader || protectedHeader.crit === undefined) {\n        return new Set();\n    }\n    if (!Array.isArray(protectedHeader.crit) ||\n        protectedHeader.crit.length === 0 ||\n        protectedHeader.crit.some((input) => typeof input !== 'string' || input.length === 0)) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be an array of non-empty strings when present');\n    }\n    let recognized;\n    if (recognizedOption !== undefined) {\n        recognized = new Map([...Object.entries(recognizedOption), ...recognizedDefault.entries()]);\n    }\n    else {\n        recognized = recognizedDefault;\n    }\n    for (const parameter of protectedHeader.crit) {\n        if (!recognized.has(parameter)) {\n            throw new JOSENotSupported(`Extension Header Parameter \"${parameter}\" is not recognized`);\n        }\n        if (joseHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" is missing`);\n        }\n        if (recognized.get(parameter) && protectedHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" MUST be integrity protected`);\n        }\n    }\n    return new Set(protectedHeader.crit);\n}\nexport default validateCrit;\n", "const validateAlgorithms = (option, algorithms) => {\n    if (algorithms !== undefined &&\n        (!Array.isArray(algorithms) || algorithms.some((s) => typeof s !== 'string'))) {\n        throw new TypeError(`\"${option}\" option must be an array of strings`);\n    }\n    if (!algorithms) {\n        return undefined;\n    }\n    return new Set(algorithms);\n};\nexport default validateAlgorithms;\n", "import { decode as base64url } from '../../runtime/base64url.js';\nimport decrypt from '../../runtime/decrypt.js';\nimport { JOSEAlgNotAllowed, JOSENotSupported, JWEInvalid } from '../../util/errors.js';\nimport isDisjoint from '../../lib/is_disjoint.js';\nimport isObject from '../../lib/is_object.js';\nimport decryptKeyManagement from '../../lib/decrypt_key_management.js';\nimport { encoder, decoder, concat } from '../../lib/buffer_utils.js';\nimport generateCek from '../../lib/cek.js';\nimport validateCrit from '../../lib/validate_crit.js';\nimport validateAlgorithms from '../../lib/validate_algorithms.js';\nexport async function flattenedDecrypt(jwe, key, options) {\n    if (!isObject(jwe)) {\n        throw new JWEInvalid('Flattened JWE must be an object');\n    }\n    if (jwe.protected === undefined && jwe.header === undefined && jwe.unprotected === undefined) {\n        throw new JWEInvalid('JOSE Header missing');\n    }\n    if (jwe.iv !== undefined && typeof jwe.iv !== 'string') {\n        throw new JWEInvalid('JWE Initialization Vector incorrect type');\n    }\n    if (typeof jwe.ciphertext !== 'string') {\n        throw new JWEInvalid('JWE Ciphertext missing or incorrect type');\n    }\n    if (jwe.tag !== undefined && typeof jwe.tag !== 'string') {\n        throw new JWEInvalid('JWE Authentication Tag incorrect type');\n    }\n    if (jwe.protected !== undefined && typeof jwe.protected !== 'string') {\n        throw new JWEInvalid('JWE Protected Header incorrect type');\n    }\n    if (jwe.encrypted_key !== undefined && typeof jwe.encrypted_key !== 'string') {\n        throw new JWEInvalid('JWE Encrypted Key incorrect type');\n    }\n    if (jwe.aad !== undefined && typeof jwe.aad !== 'string') {\n        throw new JWEInvalid('JWE AAD incorrect type');\n    }\n    if (jwe.header !== undefined && !isObject(jwe.header)) {\n        throw new JWEInvalid('JWE Shared Unprotected Header incorrect type');\n    }\n    if (jwe.unprotected !== undefined && !isObject(jwe.unprotected)) {\n        throw new JWEInvalid('JWE Per-Recipient Unprotected Header incorrect type');\n    }\n    let parsedProt;\n    if (jwe.protected) {\n        try {\n            const protectedHeader = base64url(jwe.protected);\n            parsedProt = JSON.parse(decoder.decode(protectedHeader));\n        }\n        catch {\n            throw new JWEInvalid('JWE Protected Header is invalid');\n        }\n    }\n    if (!isDisjoint(parsedProt, jwe.header, jwe.unprotected)) {\n        throw new JWEInvalid('JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint');\n    }\n    const joseHeader = {\n        ...parsedProt,\n        ...jwe.header,\n        ...jwe.unprotected,\n    };\n    validateCrit(JWEInvalid, new Map(), options?.crit, parsedProt, joseHeader);\n    if (joseHeader.zip !== undefined) {\n        throw new JOSENotSupported('JWE \"zip\" (Compression Algorithm) Header Parameter is not supported.');\n    }\n    const { alg, enc } = joseHeader;\n    if (typeof alg !== 'string' || !alg) {\n        throw new JWEInvalid('missing JWE Algorithm (alg) in JWE Header');\n    }\n    if (typeof enc !== 'string' || !enc) {\n        throw new JWEInvalid('missing JWE Encryption Algorithm (enc) in JWE Header');\n    }\n    const keyManagementAlgorithms = options && validateAlgorithms('keyManagementAlgorithms', options.keyManagementAlgorithms);\n    const contentEncryptionAlgorithms = options &&\n        validateAlgorithms('contentEncryptionAlgorithms', options.contentEncryptionAlgorithms);\n    if ((keyManagementAlgorithms && !keyManagementAlgorithms.has(alg)) ||\n        (!keyManagementAlgorithms && alg.startsWith('PBES2'))) {\n        throw new JOSEAlgNotAllowed('\"alg\" (Algorithm) Header Parameter value not allowed');\n    }\n    if (contentEncryptionAlgorithms && !contentEncryptionAlgorithms.has(enc)) {\n        throw new JOSEAlgNotAllowed('\"enc\" (Encryption Algorithm) Header Parameter value not allowed');\n    }\n    let encryptedKey;\n    if (jwe.encrypted_key !== undefined) {\n        try {\n            encryptedKey = base64url(jwe.encrypted_key);\n        }\n        catch {\n            throw new JWEInvalid('Failed to base64url decode the encrypted_key');\n        }\n    }\n    let resolvedKey = false;\n    if (typeof key === 'function') {\n        key = await key(parsedProt, jwe);\n        resolvedKey = true;\n    }\n    let cek;\n    try {\n        cek = await decryptKeyManagement(alg, key, encryptedKey, joseHeader, options);\n    }\n    catch (err) {\n        if (err instanceof TypeError || err instanceof JWEInvalid || err instanceof JOSENotSupported) {\n            throw err;\n        }\n        cek = generateCek(enc);\n    }\n    let iv;\n    let tag;\n    if (jwe.iv !== undefined) {\n        try {\n            iv = base64url(jwe.iv);\n        }\n        catch {\n            throw new JWEInvalid('Failed to base64url decode the iv');\n        }\n    }\n    if (jwe.tag !== undefined) {\n        try {\n            tag = base64url(jwe.tag);\n        }\n        catch {\n            throw new JWEInvalid('Failed to base64url decode the tag');\n        }\n    }\n    const protectedHeader = encoder.encode(jwe.protected ?? '');\n    let additionalData;\n    if (jwe.aad !== undefined) {\n        additionalData = concat(protectedHeader, encoder.encode('.'), encoder.encode(jwe.aad));\n    }\n    else {\n        additionalData = protectedHeader;\n    }\n    let ciphertext;\n    try {\n        ciphertext = base64url(jwe.ciphertext);\n    }\n    catch {\n        throw new JWEInvalid('Failed to base64url decode the ciphertext');\n    }\n    const plaintext = await decrypt(enc, cek, ciphertext, iv, tag, additionalData);\n    const result = { plaintext };\n    if (jwe.protected !== undefined) {\n        result.protectedHeader = parsedProt;\n    }\n    if (jwe.aad !== undefined) {\n        try {\n            result.additionalAuthenticatedData = base64url(jwe.aad);\n        }\n        catch {\n            throw new JWEInvalid('Failed to base64url decode the aad');\n        }\n    }\n    if (jwe.unprotected !== undefined) {\n        result.sharedUnprotectedHeader = jwe.unprotected;\n    }\n    if (jwe.header !== undefined) {\n        result.unprotectedHeader = jwe.header;\n    }\n    if (resolvedKey) {\n        return { ...result, key };\n    }\n    return result;\n}\n", "import { flattenedDecrypt } from '../flattened/decrypt.js';\nimport { JWEInvalid } from '../../util/errors.js';\nimport { decoder } from '../../lib/buffer_utils.js';\nexport async function compactDecrypt(jwe, key, options) {\n    if (jwe instanceof Uint8Array) {\n        jwe = decoder.decode(jwe);\n    }\n    if (typeof jwe !== 'string') {\n        throw new JWEInvalid('Compact JWE must be a string or Uint8Array');\n    }\n    const { 0: protectedHeader, 1: encryptedKey, 2: iv, 3: ciphertext, 4: tag, length, } = jwe.split('.');\n    if (length !== 5) {\n        throw new JWEInvalid('Invalid Compact JWE');\n    }\n    const decrypted = await flattenedDecrypt({\n        ciphertext,\n        iv: iv || undefined,\n        protected: protectedHeader,\n        tag: tag || undefined,\n        encrypted_key: encryptedKey || undefined,\n    }, key, options);\n    const result = { plaintext: decrypted.plaintext, protectedHeader: decrypted.protectedHeader };\n    if (typeof key === 'function') {\n        return { ...result, key: decrypted.key };\n    }\n    return result;\n}\n", "export const unprotected = Symbol();\n", "import crypto, { isCryptoKey } from './webcrypto.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { encode as base64url } from './base64url.js';\nimport { types } from './is_key_like.js';\nconst keyToJWK = async (key) => {\n    if (key instanceof Uint8Array) {\n        return {\n            kty: 'oct',\n            k: base64url(key),\n        };\n    }\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, ...types, 'Uint8Array'));\n    }\n    if (!key.extractable) {\n        throw new TypeError('non-extractable CryptoKey cannot be exported as a JWK');\n    }\n    const { ext, key_ops, alg, use, ...jwk } = await crypto.subtle.exportKey('jwk', key);\n    return jwk;\n};\nexport default keyToJWK;\n", "import { toSPKI as exportPublic } from '../runtime/asn1.js';\nimport { toPKCS8 as exportPrivate } from '../runtime/asn1.js';\nimport keyToJWK from '../runtime/key_to_jwk.js';\nexport async function exportSPKI(key) {\n    return exportPublic(key);\n}\nexport async function exportPKCS8(key) {\n    return exportPrivate(key);\n}\nexport async function exportJWK(key) {\n    return keyToJWK(key);\n}\n", "import { wrap as aesKw } from '../runtime/aeskw.js';\nimport * as ECDH from '../runtime/ecdhes.js';\nimport { encrypt as pbes2Kw } from '../runtime/pbes2kw.js';\nimport { encrypt as rsaEs } from '../runtime/rsaes.js';\nimport { encode as base64url } from '../runtime/base64url.js';\nimport normalize from '../runtime/normalize_key.js';\nimport generateCek, { bitLength as cekLength } from '../lib/cek.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport { exportJWK } from '../key/export.js';\nimport checkKeyType from './check_key_type.js';\nimport { wrap as aesGcmKw } from './aesgcmkw.js';\nasync function encryptKeyManagement(alg, enc, key, providedCek, providedParameters = {}) {\n    let encryptedKey;\n    let parameters;\n    let cek;\n    checkKeyType(alg, key, 'encrypt');\n    key = (await normalize.normalizePublicKey?.(key, alg)) || key;\n    switch (alg) {\n        case 'dir': {\n            cek = key;\n            break;\n        }\n        case 'ECDH-ES':\n        case 'ECDH-ES+A128KW':\n        case 'ECDH-ES+A192KW':\n        case 'ECDH-ES+A256KW': {\n            if (!ECDH.ecdhAllowed(key)) {\n                throw new JOSENotSupported('ECDH with the provided key is not allowed or not supported by your javascript runtime');\n            }\n            const { apu, apv } = providedParameters;\n            let { epk: ephemeralKey } = providedParameters;\n            ephemeralKey || (ephemeralKey = (await ECDH.generateEpk(key)).privateKey);\n            const { x, y, crv, kty } = await exportJWK(ephemeralKey);\n            const sharedSecret = await ECDH.deriveKey(key, ephemeralKey, alg === 'ECDH-ES' ? enc : alg, alg === 'ECDH-ES' ? cekLength(enc) : parseInt(alg.slice(-5, -2), 10), apu, apv);\n            parameters = { epk: { x, crv, kty } };\n            if (kty === 'EC')\n                parameters.epk.y = y;\n            if (apu)\n                parameters.apu = base64url(apu);\n            if (apv)\n                parameters.apv = base64url(apv);\n            if (alg === 'ECDH-ES') {\n                cek = sharedSecret;\n                break;\n            }\n            cek = providedCek || generateCek(enc);\n            const kwAlg = alg.slice(-6);\n            encryptedKey = await aesKw(kwAlg, sharedSecret, cek);\n            break;\n        }\n        case 'RSA1_5':\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            cek = providedCek || generateCek(enc);\n            encryptedKey = await rsaEs(alg, key, cek);\n            break;\n        }\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW': {\n            cek = providedCek || generateCek(enc);\n            const { p2c, p2s } = providedParameters;\n            ({ encryptedKey, ...parameters } = await pbes2Kw(alg, key, cek, p2c, p2s));\n            break;\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            cek = providedCek || generateCek(enc);\n            encryptedKey = await aesKw(alg, key, cek);\n            break;\n        }\n        case 'A128GCMKW':\n        case 'A192GCMKW':\n        case 'A256GCMKW': {\n            cek = providedCek || generateCek(enc);\n            const { iv } = providedParameters;\n            ({ encryptedKey, ...parameters } = await aesGcmKw(alg, key, cek, iv));\n            break;\n        }\n        default: {\n            throw new JOSENotSupported('Invalid or unsupported \"alg\" (JWE Algorithm) header value');\n        }\n    }\n    return { cek, encryptedKey, parameters };\n}\nexport default encryptKeyManagement;\n", "import { encode as base64url } from '../../runtime/base64url.js';\nimport { unprotected } from '../../lib/private_symbols.js';\nimport encrypt from '../../runtime/encrypt.js';\nimport encryptKeyManagement from '../../lib/encrypt_key_management.js';\nimport { JOSENotSupported, JWEInvalid } from '../../util/errors.js';\nimport isDisjoint from '../../lib/is_disjoint.js';\nimport { encoder, decoder, concat } from '../../lib/buffer_utils.js';\nimport validateCrit from '../../lib/validate_crit.js';\nexport class FlattenedEncrypt {\n    constructor(plaintext) {\n        if (!(plaintext instanceof Uint8Array)) {\n            throw new TypeError('plaintext must be an instance of Uint8Array');\n        }\n        this._plaintext = plaintext;\n    }\n    setKeyManagementParameters(parameters) {\n        if (this._keyManagementParameters) {\n            throw new TypeError('setKeyManagementParameters can only be called once');\n        }\n        this._keyManagementParameters = parameters;\n        return this;\n    }\n    setProtectedHeader(protectedHeader) {\n        if (this._protectedHeader) {\n            throw new TypeError('setProtectedHeader can only be called once');\n        }\n        this._protectedHeader = protectedHeader;\n        return this;\n    }\n    setSharedUnprotectedHeader(sharedUnprotectedHeader) {\n        if (this._sharedUnprotectedHeader) {\n            throw new TypeError('setSharedUnprotectedHeader can only be called once');\n        }\n        this._sharedUnprotectedHeader = sharedUnprotectedHeader;\n        return this;\n    }\n    setUnprotectedHeader(unprotectedHeader) {\n        if (this._unprotectedHeader) {\n            throw new TypeError('setUnprotectedHeader can only be called once');\n        }\n        this._unprotectedHeader = unprotectedHeader;\n        return this;\n    }\n    setAdditionalAuthenticatedData(aad) {\n        this._aad = aad;\n        return this;\n    }\n    setContentEncryptionKey(cek) {\n        if (this._cek) {\n            throw new TypeError('setContentEncryptionKey can only be called once');\n        }\n        this._cek = cek;\n        return this;\n    }\n    setInitializationVector(iv) {\n        if (this._iv) {\n            throw new TypeError('setInitializationVector can only be called once');\n        }\n        this._iv = iv;\n        return this;\n    }\n    async encrypt(key, options) {\n        if (!this._protectedHeader && !this._unprotectedHeader && !this._sharedUnprotectedHeader) {\n            throw new JWEInvalid('either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()');\n        }\n        if (!isDisjoint(this._protectedHeader, this._unprotectedHeader, this._sharedUnprotectedHeader)) {\n            throw new JWEInvalid('JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint');\n        }\n        const joseHeader = {\n            ...this._protectedHeader,\n            ...this._unprotectedHeader,\n            ...this._sharedUnprotectedHeader,\n        };\n        validateCrit(JWEInvalid, new Map(), options?.crit, this._protectedHeader, joseHeader);\n        if (joseHeader.zip !== undefined) {\n            throw new JOSENotSupported('JWE \"zip\" (Compression Algorithm) Header Parameter is not supported.');\n        }\n        const { alg, enc } = joseHeader;\n        if (typeof alg !== 'string' || !alg) {\n            throw new JWEInvalid('JWE \"alg\" (Algorithm) Header Parameter missing or invalid');\n        }\n        if (typeof enc !== 'string' || !enc) {\n            throw new JWEInvalid('JWE \"enc\" (Encryption Algorithm) Header Parameter missing or invalid');\n        }\n        let encryptedKey;\n        if (this._cek && (alg === 'dir' || alg === 'ECDH-ES')) {\n            throw new TypeError(`setContentEncryptionKey cannot be called with JWE \"alg\" (Algorithm) Header ${alg}`);\n        }\n        let cek;\n        {\n            let parameters;\n            ({ cek, encryptedKey, parameters } = await encryptKeyManagement(alg, enc, key, this._cek, this._keyManagementParameters));\n            if (parameters) {\n                if (options && unprotected in options) {\n                    if (!this._unprotectedHeader) {\n                        this.setUnprotectedHeader(parameters);\n                    }\n                    else {\n                        this._unprotectedHeader = { ...this._unprotectedHeader, ...parameters };\n                    }\n                }\n                else if (!this._protectedHeader) {\n                    this.setProtectedHeader(parameters);\n                }\n                else {\n                    this._protectedHeader = { ...this._protectedHeader, ...parameters };\n                }\n            }\n        }\n        let additionalData;\n        let protectedHeader;\n        let aadMember;\n        if (this._protectedHeader) {\n            protectedHeader = encoder.encode(base64url(JSON.stringify(this._protectedHeader)));\n        }\n        else {\n            protectedHeader = encoder.encode('');\n        }\n        if (this._aad) {\n            aadMember = base64url(this._aad);\n            additionalData = concat(protectedHeader, encoder.encode('.'), encoder.encode(aadMember));\n        }\n        else {\n            additionalData = protectedHeader;\n        }\n        const { ciphertext, tag, iv } = await encrypt(enc, this._plaintext, cek, this._iv, additionalData);\n        const jwe = {\n            ciphertext: base64url(ciphertext),\n        };\n        if (iv) {\n            jwe.iv = base64url(iv);\n        }\n        if (tag) {\n            jwe.tag = base64url(tag);\n        }\n        if (encryptedKey) {\n            jwe.encrypted_key = base64url(encryptedKey);\n        }\n        if (aadMember) {\n            jwe.aad = aadMember;\n        }\n        if (this._protectedHeader) {\n            jwe.protected = decoder.decode(protectedHeader);\n        }\n        if (this._sharedUnprotectedHeader) {\n            jwe.unprotected = this._sharedUnprotectedHeader;\n        }\n        if (this._unprotectedHeader) {\n            jwe.header = this._unprotectedHeader;\n        }\n        return jwe;\n    }\n}\n", "import { JOSENotSupported } from '../util/errors.js';\nexport default function subtleDsa(alg, algorithm) {\n    const hash = `SHA-${alg.slice(-3)}`;\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512':\n            return { hash, name: 'HMAC' };\n        case 'PS256':\n        case 'PS384':\n        case 'PS512':\n            return { hash, name: 'RSA-PSS', saltLength: alg.slice(-3) >> 3 };\n        case 'RS256':\n        case 'RS384':\n        case 'RS512':\n            return { hash, name: 'RSASSA-PKCS1-v1_5' };\n        case 'ES256':\n        case 'ES384':\n        case 'ES512':\n            return { hash, name: 'ECDSA', namedCurve: algorithm.namedCurve };\n        case 'Ed25519':\n            return { name: 'Ed25519' };\n        case 'EdDSA':\n            return { name: algorithm.name };\n        default:\n            throw new JOSENotSupported(`alg ${alg} is not supported either by JOSE or your javascript runtime`);\n    }\n}\n", "import crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkSigCryptoKey } from '../lib/crypto_key.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nimport normalize from './normalize_key.js';\nexport default async function getCryptoKey(alg, key, usage) {\n    if (usage === 'sign') {\n        key = await normalize.normalizePrivateKey(key, alg);\n    }\n    if (usage === 'verify') {\n        key = await normalize.normalizePublicKey(key, alg);\n    }\n    if (isCryptoKey(key)) {\n        checkSigCryptoKey(key, alg, usage);\n        return key;\n    }\n    if (key instanceof Uint8Array) {\n        if (!alg.startsWith('HS')) {\n            throw new TypeError(invalidKeyInput(key, ...types));\n        }\n        return crypto.subtle.importKey('raw', key, { hash: `SHA-${alg.slice(-3)}`, name: 'HMAC' }, false, [usage]);\n    }\n    throw new TypeError(invalidKeyInput(key, ...types, 'Uint8Array', 'JSON Web Key'));\n}\n", "export default (date) => Math.floor(date.getTime() / 1000);\n", "const minute = 60;\nconst hour = minute * 60;\nconst day = hour * 24;\nconst week = day * 7;\nconst year = day * 365.25;\nconst REGEX = /^(\\+|\\-)? ?(\\d+|\\d+\\.\\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;\nexport default (str) => {\n    const matched = REGEX.exec(str);\n    if (!matched || (matched[4] && matched[1])) {\n        throw new TypeError('Invalid time period format');\n    }\n    const value = parseFloat(matched[2]);\n    const unit = matched[3].toLowerCase();\n    let numericDate;\n    switch (unit) {\n        case 'sec':\n        case 'secs':\n        case 'second':\n        case 'seconds':\n        case 's':\n            numericDate = Math.round(value);\n            break;\n        case 'minute':\n        case 'minutes':\n        case 'min':\n        case 'mins':\n        case 'm':\n            numericDate = Math.round(value * minute);\n            break;\n        case 'hour':\n        case 'hours':\n        case 'hr':\n        case 'hrs':\n        case 'h':\n            numericDate = Math.round(value * hour);\n            break;\n        case 'day':\n        case 'days':\n        case 'd':\n            numericDate = Math.round(value * day);\n            break;\n        case 'week':\n        case 'weeks':\n        case 'w':\n            numericDate = Math.round(value * week);\n            break;\n        default:\n            numericDate = Math.round(value * year);\n            break;\n    }\n    if (matched[1] === '-' || matched[4] === 'ago') {\n        return -numericDate;\n    }\n    return numericDate;\n};\n", "import { JWTClaimValidationFailed, JWTExpired, JWTInvalid } from '../util/errors.js';\nimport { decoder } from './buffer_utils.js';\nimport epoch from './epoch.js';\nimport secs from './secs.js';\nimport isObject from './is_object.js';\nconst normalizeTyp = (value) => value.toLowerCase().replace(/^application\\//, '');\nconst checkAudiencePresence = (audPayload, audOption) => {\n    if (typeof audPayload === 'string') {\n        return audOption.includes(audPayload);\n    }\n    if (Array.isArray(audPayload)) {\n        return audOption.some(Set.prototype.has.bind(new Set(audPayload)));\n    }\n    return false;\n};\nexport default (protectedHeader, encodedPayload, options = {}) => {\n    let payload;\n    try {\n        payload = JSON.parse(decoder.decode(encodedPayload));\n    }\n    catch {\n    }\n    if (!isObject(payload)) {\n        throw new JWTInvalid('JWT Claims Set must be a top-level JSON object');\n    }\n    const { typ } = options;\n    if (typ &&\n        (typeof protectedHeader.typ !== 'string' ||\n            normalizeTyp(protectedHeader.typ) !== normalizeTyp(typ))) {\n        throw new JWTClaimValidationFailed('unexpected \"typ\" JWT header value', payload, 'typ', 'check_failed');\n    }\n    const { requiredClaims = [], issuer, subject, audience, maxTokenAge } = options;\n    const presenceCheck = [...requiredClaims];\n    if (maxTokenAge !== undefined)\n        presenceCheck.push('iat');\n    if (audience !== undefined)\n        presenceCheck.push('aud');\n    if (subject !== undefined)\n        presenceCheck.push('sub');\n    if (issuer !== undefined)\n        presenceCheck.push('iss');\n    for (const claim of new Set(presenceCheck.reverse())) {\n        if (!(claim in payload)) {\n            throw new JWTClaimValidationFailed(`missing required \"${claim}\" claim`, payload, claim, 'missing');\n        }\n    }\n    if (issuer &&\n        !(Array.isArray(issuer) ? issuer : [issuer]).includes(payload.iss)) {\n        throw new JWTClaimValidationFailed('unexpected \"iss\" claim value', payload, 'iss', 'check_failed');\n    }\n    if (subject && payload.sub !== subject) {\n        throw new JWTClaimValidationFailed('unexpected \"sub\" claim value', payload, 'sub', 'check_failed');\n    }\n    if (audience &&\n        !checkAudiencePresence(payload.aud, typeof audience === 'string' ? [audience] : audience)) {\n        throw new JWTClaimValidationFailed('unexpected \"aud\" claim value', payload, 'aud', 'check_failed');\n    }\n    let tolerance;\n    switch (typeof options.clockTolerance) {\n        case 'string':\n            tolerance = secs(options.clockTolerance);\n            break;\n        case 'number':\n            tolerance = options.clockTolerance;\n            break;\n        case 'undefined':\n            tolerance = 0;\n            break;\n        default:\n            throw new TypeError('Invalid clockTolerance option type');\n    }\n    const { currentDate } = options;\n    const now = epoch(currentDate || new Date());\n    if ((payload.iat !== undefined || maxTokenAge) && typeof payload.iat !== 'number') {\n        throw new JWTClaimValidationFailed('\"iat\" claim must be a number', payload, 'iat', 'invalid');\n    }\n    if (payload.nbf !== undefined) {\n        if (typeof payload.nbf !== 'number') {\n            throw new JWTClaimValidationFailed('\"nbf\" claim must be a number', payload, 'nbf', 'invalid');\n        }\n        if (payload.nbf > now + tolerance) {\n            throw new JWTClaimValidationFailed('\"nbf\" claim timestamp check failed', payload, 'nbf', 'check_failed');\n        }\n    }\n    if (payload.exp !== undefined) {\n        if (typeof payload.exp !== 'number') {\n            throw new JWTClaimValidationFailed('\"exp\" claim must be a number', payload, 'exp', 'invalid');\n        }\n        if (payload.exp <= now - tolerance) {\n            throw new JWTExpired('\"exp\" claim timestamp check failed', payload, 'exp', 'check_failed');\n        }\n    }\n    if (maxTokenAge) {\n        const age = now - payload.iat;\n        const max = typeof maxTokenAge === 'number' ? maxTokenAge : secs(maxTokenAge);\n        if (age - tolerance > max) {\n            throw new JWTExpired('\"iat\" claim timestamp check failed (too far in the past)', payload, 'iat', 'check_failed');\n        }\n        if (age < 0 - tolerance) {\n            throw new JWTClaimValidationFailed('\"iat\" claim timestamp check failed (it should be in the past)', payload, 'iat', 'check_failed');\n        }\n    }\n    return payload;\n};\n", "import { compactDecrypt } from '../jwe/compact/decrypt.js';\nimport jwtPayload from '../lib/jwt_claims_set.js';\nimport { JWTClaimValidationFailed } from '../util/errors.js';\nexport async function jwtDecrypt(jwt, key, options) {\n    const decrypted = await compactDecrypt(jwt, key, options);\n    const payload = jwtPayload(decrypted.protectedHeader, decrypted.plaintext, options);\n    const { protectedHeader } = decrypted;\n    if (protectedHeader.iss !== undefined && protectedHeader.iss !== payload.iss) {\n        throw new JWTClaimValidationFailed('replicated \"iss\" claim header parameter mismatch', payload, 'iss', 'mismatch');\n    }\n    if (protectedHeader.sub !== undefined && protectedHeader.sub !== payload.sub) {\n        throw new JWTClaimValidationFailed('replicated \"sub\" claim header parameter mismatch', payload, 'sub', 'mismatch');\n    }\n    if (protectedHeader.aud !== undefined &&\n        JSON.stringify(protectedHeader.aud) !== JSON.stringify(payload.aud)) {\n        throw new JWTClaimValidationFailed('replicated \"aud\" claim header parameter mismatch', payload, 'aud', 'mismatch');\n    }\n    const result = { payload, protectedHeader };\n    if (typeof key === 'function') {\n        return { ...result, key: decrypted.key };\n    }\n    return result;\n}\n", "import { FlattenedEncrypt } from '../flattened/encrypt.js';\nexport class CompactEncrypt {\n    constructor(plaintext) {\n        this._flattened = new FlattenedEncrypt(plaintext);\n    }\n    setContentEncryptionKey(cek) {\n        this._flattened.setContentEncryptionKey(cek);\n        return this;\n    }\n    setInitializationVector(iv) {\n        this._flattened.setInitializationVector(iv);\n        return this;\n    }\n    setProtectedHeader(protectedHeader) {\n        this._flattened.setProtectedHeader(protectedHeader);\n        return this;\n    }\n    setKeyManagementParameters(parameters) {\n        this._flattened.setKeyManagementParameters(parameters);\n        return this;\n    }\n    async encrypt(key, options) {\n        const jwe = await this._flattened.encrypt(key, options);\n        return [jwe.protected, jwe.encrypted_key, jwe.iv, jwe.ciphertext, jwe.tag].join('.');\n    }\n}\n", "import subtleAlgorithm from './subtle_dsa.js';\nimport crypto from './webcrypto.js';\nimport checkKeyLength from './check_key_length.js';\nimport getSignKey from './get_sign_verify_key.js';\nconst sign = async (alg, key, data) => {\n    const cryptoKey = await getSignKey(alg, key, 'sign');\n    checkKeyLength(alg, cryptoKey);\n    const signature = await crypto.subtle.sign(subtleAlgorithm(alg, cryptoKey.algorithm), cryptoKey, data);\n    return new Uint8Array(signature);\n};\nexport default sign;\n", "import { encode as base64url } from '../../runtime/base64url.js';\nimport sign from '../../runtime/sign.js';\nimport isDisjoint from '../../lib/is_disjoint.js';\nimport { JWSInvalid } from '../../util/errors.js';\nimport { encoder, decoder, concat } from '../../lib/buffer_utils.js';\nimport { checkKeyTypeWithJwk } from '../../lib/check_key_type.js';\nimport validateCrit from '../../lib/validate_crit.js';\nexport class FlattenedSign {\n    constructor(payload) {\n        if (!(payload instanceof Uint8Array)) {\n            throw new TypeError('payload must be an instance of Uint8Array');\n        }\n        this._payload = payload;\n    }\n    setProtectedHeader(protectedHeader) {\n        if (this._protectedHeader) {\n            throw new TypeError('setProtectedHeader can only be called once');\n        }\n        this._protectedHeader = protectedHeader;\n        return this;\n    }\n    setUnprotectedHeader(unprotectedHeader) {\n        if (this._unprotectedHeader) {\n            throw new TypeError('setUnprotectedHeader can only be called once');\n        }\n        this._unprotectedHeader = unprotectedHeader;\n        return this;\n    }\n    async sign(key, options) {\n        if (!this._protectedHeader && !this._unprotectedHeader) {\n            throw new JWSInvalid('either setProtectedHeader or setUnprotectedHeader must be called before #sign()');\n        }\n        if (!isDisjoint(this._protectedHeader, this._unprotectedHeader)) {\n            throw new JWSInvalid('JWS Protected and JWS Unprotected Header Parameter names must be disjoint');\n        }\n        const joseHeader = {\n            ...this._protectedHeader,\n            ...this._unprotectedHeader,\n        };\n        const extensions = validateCrit(JWSInvalid, new Map([['b64', true]]), options?.crit, this._protectedHeader, joseHeader);\n        let b64 = true;\n        if (extensions.has('b64')) {\n            b64 = this._protectedHeader.b64;\n            if (typeof b64 !== 'boolean') {\n                throw new JWSInvalid('The \"b64\" (base64url-encode payload) Header Parameter must be a boolean');\n            }\n        }\n        const { alg } = joseHeader;\n        if (typeof alg !== 'string' || !alg) {\n            throw new JWSInvalid('JWS \"alg\" (Algorithm) Header Parameter missing or invalid');\n        }\n        checkKeyTypeWithJwk(alg, key, 'sign');\n        let payload = this._payload;\n        if (b64) {\n            payload = encoder.encode(base64url(payload));\n        }\n        let protectedHeader;\n        if (this._protectedHeader) {\n            protectedHeader = encoder.encode(base64url(JSON.stringify(this._protectedHeader)));\n        }\n        else {\n            protectedHeader = encoder.encode('');\n        }\n        const data = concat(protectedHeader, encoder.encode('.'), payload);\n        const signature = await sign(alg, key, data);\n        const jws = {\n            signature: base64url(signature),\n            payload: '',\n        };\n        if (b64) {\n            jws.payload = decoder.decode(payload);\n        }\n        if (this._unprotectedHeader) {\n            jws.header = this._unprotectedHeader;\n        }\n        if (this._protectedHeader) {\n            jws.protected = decoder.decode(protectedHeader);\n        }\n        return jws;\n    }\n}\n", "import { FlattenedSign } from '../flattened/sign.js';\nexport class CompactSign {\n    constructor(payload) {\n        this._flattened = new FlattenedSign(payload);\n    }\n    setProtectedHeader(protectedHeader) {\n        this._flattened.setProtectedHeader(protectedHeader);\n        return this;\n    }\n    async sign(key, options) {\n        const jws = await this._flattened.sign(key, options);\n        if (jws.payload === undefined) {\n            throw new TypeError('use the flattened module for creating JWS with b64: false');\n        }\n        return `${jws.protected}.${jws.payload}.${jws.signature}`;\n    }\n}\n", "import epoch from '../lib/epoch.js';\nimport isObject from '../lib/is_object.js';\nimport secs from '../lib/secs.js';\nfunction validateInput(label, input) {\n    if (!Number.isFinite(input)) {\n        throw new TypeError(`Invalid ${label} input`);\n    }\n    return input;\n}\nexport class ProduceJWT {\n    constructor(payload = {}) {\n        if (!isObject(payload)) {\n            throw new TypeError('JWT Claims Set MUST be an object');\n        }\n        this._payload = payload;\n    }\n    setIssuer(issuer) {\n        this._payload = { ...this._payload, iss: issuer };\n        return this;\n    }\n    setSubject(subject) {\n        this._payload = { ...this._payload, sub: subject };\n        return this;\n    }\n    setAudience(audience) {\n        this._payload = { ...this._payload, aud: audience };\n        return this;\n    }\n    setJti(jwtId) {\n        this._payload = { ...this._payload, jti: jwtId };\n        return this;\n    }\n    setNotBefore(input) {\n        if (typeof input === 'number') {\n            this._payload = { ...this._payload, nbf: validateInput('setNotBefore', input) };\n        }\n        else if (input instanceof Date) {\n            this._payload = { ...this._payload, nbf: validateInput('setNotBefore', epoch(input)) };\n        }\n        else {\n            this._payload = { ...this._payload, nbf: epoch(new Date()) + secs(input) };\n        }\n        return this;\n    }\n    setExpirationTime(input) {\n        if (typeof input === 'number') {\n            this._payload = { ...this._payload, exp: validateInput('setExpirationTime', input) };\n        }\n        else if (input instanceof Date) {\n            this._payload = { ...this._payload, exp: validateInput('setExpirationTime', epoch(input)) };\n        }\n        else {\n            this._payload = { ...this._payload, exp: epoch(new Date()) + secs(input) };\n        }\n        return this;\n    }\n    setIssuedAt(input) {\n        if (typeof input === 'undefined') {\n            this._payload = { ...this._payload, iat: epoch(new Date()) };\n        }\n        else if (input instanceof Date) {\n            this._payload = { ...this._payload, iat: validateInput('setIssuedAt', epoch(input)) };\n        }\n        else if (typeof input === 'string') {\n            this._payload = {\n                ...this._payload,\n                iat: validateInput('setIssuedAt', epoch(new Date()) + secs(input)),\n            };\n        }\n        else {\n            this._payload = { ...this._payload, iat: validateInput('setIssuedAt', input) };\n        }\n        return this;\n    }\n}\n", "import { CompactSign } from '../jws/compact/sign.js';\nimport { JWTInvalid } from '../util/errors.js';\nimport { encoder } from '../lib/buffer_utils.js';\nimport { ProduceJWT } from './produce.js';\nexport class SignJWT extends ProduceJWT {\n    setProtectedHeader(protectedHeader) {\n        this._protectedHeader = protectedHeader;\n        return this;\n    }\n    async sign(key, options) {\n        const sig = new CompactSign(encoder.encode(JSON.stringify(this._payload)));\n        sig.setProtectedHeader(this._protectedHeader);\n        if (Array.isArray(this._protectedHeader?.crit) &&\n            this._protectedHeader.crit.includes('b64') &&\n            this._protectedHeader.b64 === false) {\n            throw new JWTInvalid('JWTs MUST NOT use unencoded payload');\n        }\n        return sig.sign(key, options);\n    }\n}\n", "import { CompactEncrypt } from '../jwe/compact/encrypt.js';\nimport { encoder } from '../lib/buffer_utils.js';\nimport { ProduceJWT } from './produce.js';\nexport class EncryptJWT extends ProduceJWT {\n    setProtectedHeader(protectedHeader) {\n        if (this._protectedHeader) {\n            throw new TypeError('setProtectedHeader can only be called once');\n        }\n        this._protectedHeader = protectedHeader;\n        return this;\n    }\n    setKeyManagementParameters(parameters) {\n        if (this._keyManagementParameters) {\n            throw new TypeError('setKeyManagementParameters can only be called once');\n        }\n        this._keyManagementParameters = parameters;\n        return this;\n    }\n    setContentEncryptionKey(cek) {\n        if (this._cek) {\n            throw new TypeError('setContentEncryptionKey can only be called once');\n        }\n        this._cek = cek;\n        return this;\n    }\n    setInitializationVector(iv) {\n        if (this._iv) {\n            throw new TypeError('setInitializationVector can only be called once');\n        }\n        this._iv = iv;\n        return this;\n    }\n    replicateIssuerAsHeader() {\n        this._replicateIssuerAsHeader = true;\n        return this;\n    }\n    replicateSubjectAsHeader() {\n        this._replicateSubjectAsHeader = true;\n        return this;\n    }\n    replicateAudienceAsHeader() {\n        this._replicateAudienceAsHeader = true;\n        return this;\n    }\n    async encrypt(key, options) {\n        const enc = new CompactEncrypt(encoder.encode(JSON.stringify(this._payload)));\n        if (this._replicateIssuerAsHeader) {\n            this._protectedHeader = { ...this._protectedHeader, iss: this._payload.iss };\n        }\n        if (this._replicateSubjectAsHeader) {\n            this._protectedHeader = { ...this._protectedHeader, sub: this._payload.sub };\n        }\n        if (this._replicateAudienceAsHeader) {\n            this._protectedHeader = { ...this._protectedHeader, aud: this._payload.aud };\n        }\n        enc.setProtectedHeader(this._protectedHeader);\n        if (this._iv) {\n            enc.setInitializationVector(this._iv);\n        }\n        if (this._cek) {\n            enc.setContentEncryptionKey(this._cek);\n        }\n        if (this._keyManagementParameters) {\n            enc.setKeyManagementParameters(this._keyManagementParameters);\n        }\n        return enc.encrypt(key, options);\n    }\n}\n", "import digest from '../runtime/digest.js';\nimport { encode as base64url } from '../runtime/base64url.js';\nimport { JOSENotSupported, JWKInvalid } from '../util/errors.js';\nimport { encoder } from '../lib/buffer_utils.js';\nimport isObject from '../lib/is_object.js';\nconst check = (value, description) => {\n    if (typeof value !== 'string' || !value) {\n        throw new JWKInvalid(`${description} missing or invalid`);\n    }\n};\nexport async function calculateJwkThumbprint(jwk, digestAlgorithm) {\n    if (!isObject(jwk)) {\n        throw new TypeError('JWK must be an object');\n    }\n    digestAlgorithm ?? (digestAlgorithm = 'sha256');\n    if (digestAlgorithm !== 'sha256' &&\n        digestAlgorithm !== 'sha384' &&\n        digestAlgorithm !== 'sha512') {\n        throw new TypeError('digestAlgorithm must one of \"sha256\", \"sha384\", or \"sha512\"');\n    }\n    let components;\n    switch (jwk.kty) {\n        case 'EC':\n            check(jwk.crv, '\"crv\" (Curve) Parameter');\n            check(jwk.x, '\"x\" (X Coordinate) Parameter');\n            check(jwk.y, '\"y\" (Y Coordinate) Parameter');\n            components = { crv: jwk.crv, kty: jwk.kty, x: jwk.x, y: jwk.y };\n            break;\n        case 'OKP':\n            check(jwk.crv, '\"crv\" (Subtype of Key Pair) Parameter');\n            check(jwk.x, '\"x\" (Public Key) Parameter');\n            components = { crv: jwk.crv, kty: jwk.kty, x: jwk.x };\n            break;\n        case 'RSA':\n            check(jwk.e, '\"e\" (Exponent) Parameter');\n            check(jwk.n, '\"n\" (Modulus) Parameter');\n            components = { e: jwk.e, kty: jwk.kty, n: jwk.n };\n            break;\n        case 'oct':\n            check(jwk.k, '\"k\" (Key Value) Parameter');\n            components = { k: jwk.k, kty: jwk.kty };\n            break;\n        default:\n            throw new JOSENotSupported('\"kty\" (Key Type) Parameter missing or unsupported');\n    }\n    const data = encoder.encode(JSON.stringify(components));\n    return base64url(await digest(digestAlgorithm, data));\n}\nexport async function calculateJwkThumbprintUri(jwk, digestAlgorithm) {\n    digestAlgorithm ?? (digestAlgorithm = 'sha256');\n    const thumbprint = await calculateJwkThumbprint(jwk, digestAlgorithm);\n    return `urn:ietf:params:oauth:jwk-thumbprint:sha-${digestAlgorithm.slice(-3)}:${thumbprint}`;\n}\n", "import fetchJwks from '../runtime/fetch_jwks.js';\nimport { JWKSNoMatchingKey } from '../util/errors.js';\nimport { createLocalJWKSet } from './local.js';\nimport isObject from '../lib/is_object.js';\nfunction isCloudflareWorkers() {\n    return (typeof WebSocketPair !== 'undefined' ||\n        (typeof navigator !== 'undefined' && navigator.userAgent === 'Cloudflare-Workers') ||\n        (typeof EdgeRuntime !== 'undefined' && EdgeRuntime === 'vercel'));\n}\nlet USER_AGENT;\nif (typeof navigator === 'undefined' || !navigator.userAgent?.startsWith?.('Mozilla/5.0 ')) {\n    const NAME = 'jose';\n    const VERSION = 'v5.10.0';\n    USER_AGENT = `${NAME}/${VERSION}`;\n}\nexport const jwksCache = Symbol();\nfunction isFreshJwksCache(input, cacheMaxAge) {\n    if (typeof input !== 'object' || input === null) {\n        return false;\n    }\n    if (!('uat' in input) || typeof input.uat !== 'number' || Date.now() - input.uat >= cacheMaxAge) {\n        return false;\n    }\n    if (!('jwks' in input) ||\n        !isObject(input.jwks) ||\n        !Array.isArray(input.jwks.keys) ||\n        !Array.prototype.every.call(input.jwks.keys, isObject)) {\n        return false;\n    }\n    return true;\n}\nclass RemoteJWKSet {\n    constructor(url, options) {\n        if (!(url instanceof URL)) {\n            throw new TypeError('url must be an instance of URL');\n        }\n        this._url = new URL(url.href);\n        this._options = { agent: options?.agent, headers: options?.headers };\n        this._timeoutDuration =\n            typeof options?.timeoutDuration === 'number' ? options?.timeoutDuration : 5000;\n        this._cooldownDuration =\n            typeof options?.cooldownDuration === 'number' ? options?.cooldownDuration : 30000;\n        this._cacheMaxAge = typeof options?.cacheMaxAge === 'number' ? options?.cacheMaxAge : 600000;\n        if (options?.[jwksCache] !== undefined) {\n            this._cache = options?.[jwksCache];\n            if (isFreshJwksCache(options?.[jwksCache], this._cacheMaxAge)) {\n                this._jwksTimestamp = this._cache.uat;\n                this._local = createLocalJWKSet(this._cache.jwks);\n            }\n        }\n    }\n    coolingDown() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cooldownDuration\n            : false;\n    }\n    fresh() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cacheMaxAge\n            : false;\n    }\n    async getKey(protectedHeader, token) {\n        if (!this._local || !this.fresh()) {\n            await this.reload();\n        }\n        try {\n            return await this._local(protectedHeader, token);\n        }\n        catch (err) {\n            if (err instanceof JWKSNoMatchingKey) {\n                if (this.coolingDown() === false) {\n                    await this.reload();\n                    return this._local(protectedHeader, token);\n                }\n            }\n            throw err;\n        }\n    }\n    async reload() {\n        if (this._pendingFetch && isCloudflareWorkers()) {\n            this._pendingFetch = undefined;\n        }\n        const headers = new Headers(this._options.headers);\n        if (USER_AGENT && !headers.has('User-Agent')) {\n            headers.set('User-Agent', USER_AGENT);\n            this._options.headers = Object.fromEntries(headers.entries());\n        }\n        this._pendingFetch || (this._pendingFetch = fetchJwks(this._url, this._timeoutDuration, this._options)\n            .then((json) => {\n            this._local = createLocalJWKSet(json);\n            if (this._cache) {\n                this._cache.uat = Date.now();\n                this._cache.jwks = json;\n            }\n            this._jwksTimestamp = Date.now();\n            this._pendingFetch = undefined;\n        })\n            .catch((err) => {\n            this._pendingFetch = undefined;\n            throw err;\n        }));\n        await this._pendingFetch;\n    }\n}\nexport function createRemoteJWKSet(url, options) {\n    const set = new RemoteJWKSet(url, options);\n    const remoteJWKSet = async (protectedHeader, token) => set.getKey(protectedHeader, token);\n    Object.defineProperties(remoteJWKSet, {\n        coolingDown: {\n            get: () => set.coolingDown(),\n            enumerable: true,\n            configurable: false,\n        },\n        fresh: {\n            get: () => set.fresh(),\n            enumerable: true,\n            configurable: false,\n        },\n        reload: {\n            value: () => set.reload(),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n        reloading: {\n            get: () => !!set._pendingFetch,\n            enumerable: true,\n            configurable: false,\n        },\n        jwks: {\n            value: () => set._local?.jwks(),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n    });\n    return remoteJWKSet;\n}\nexport const experimental_jwksCache = jwksCache;\n", "import * as base64url from '../runtime/base64url.js';\nexport const encode = base64url.encode;\nexport const decode = base64url.decode;\n", "/**\n * @source https://github.com/jshttp/cookie\n * @author blakeembrey\n * @license MIT\n */\n/**\n * This is a workaround to support ESM-only environments, until `cookie` ships ESM builds.\n * @see https://github.com/jshttp/cookie/issues/211\n */\n/**\n * RegExp to match cookie-name in RFC 6265 sec 4.1.1\n * This refers out to the obsoleted definition of token in RFC 2616 sec 2.2\n * which has been replaced by the token definition in RFC 7230 appendix B.\n *\n * cookie-name       = token\n * token             = 1*tchar\n * tchar             = \"!\" / \"#\" / \"$\" / \"%\" / \"&\" / \"'\" /\n *                     \"*\" / \"+\" / \"-\" / \".\" / \"^\" / \"_\" /\n *                     \"`\" / \"|\" / \"~\" / DIGIT / ALPHA\n */\nconst cookieNameRegExp = /^[!#$%&'*+\\-.^_`|~0-9A-Za-z]+$/;\n/**\n * RegExp to match cookie-value in RFC 6265 sec 4.1.1\n *\n * cookie-value      = *cookie-octet / ( DQUOTE *cookie-octet DQUOTE )\n * cookie-octet      = %x21 / %x23-2B / %x2D-3A / %x3C-5B / %x5D-7E\n *                     ; US-ASCII characters excluding CTLs,\n *                     ; whitespace DQUOTE, comma, semicolon,\n *                     ; and backslash\n */\nconst cookieValueRegExp = /^(\"?)[\\u0021\\u0023-\\u002B\\u002D-\\u003A\\u003C-\\u005B\\u005D-\\u007E]*\\1$/;\n/**\n * RegExp to match domain-value in RFC 6265 sec 4.1.1\n *\n * domain-value      = <subdomain>\n *                     ; defined in [RFC1034], Section 3.5, as\n *                     ; enhanced by [RFC1123], Section 2.1\n * <subdomain>       = <label> | <subdomain> \".\" <label>\n * <label>           = <let-dig> [ [ <ldh-str> ] <let-dig> ]\n *                     Labels must be 63 characters or less.\n *                     'let-dig' not 'letter' in the first char, per RFC1123\n * <ldh-str>         = <let-dig-hyp> | <let-dig-hyp> <ldh-str>\n * <let-dig-hyp>     = <let-dig> | \"-\"\n * <let-dig>         = <letter> | <digit>\n * <letter>          = any one of the 52 alphabetic characters A through Z in\n *                     upper case and a through z in lower case\n * <digit>           = any one of the ten digits 0 through 9\n *\n * Keep support for leading dot: https://github.com/jshttp/cookie/issues/173\n *\n * > (Note that a leading %x2E (\".\"), if present, is ignored even though that\n * character is not permitted, but a trailing %x2E (\".\"), if present, will\n * cause the user agent to ignore the attribute.)\n */\nconst domainValueRegExp = /^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i;\n/**\n * RegExp to match path-value in RFC 6265 sec 4.1.1\n *\n * path-value        = <any CHAR except CTLs or \";\">\n * CHAR              = %x01-7F\n *                     ; defined in RFC 5234 appendix B.1\n */\nconst pathValueRegExp = /^[\\u0020-\\u003A\\u003D-\\u007E]*$/;\nconst __toString = Object.prototype.toString;\nconst NullObject = /* @__PURE__ */ (() => {\n    const C = function () { };\n    C.prototype = Object.create(null);\n    return C;\n})();\n/**\n * Parse a cookie header.\n *\n * Parse the given cookie header string into an object\n * The object has the various cookies as keys(names) => values\n */\nexport function parse(str, options) {\n    const obj = new NullObject();\n    const len = str.length;\n    // RFC 6265 sec 4.1.1, RFC 2616 2.2 defines a cookie name consists of one char minimum, plus '='.\n    if (len < 2)\n        return obj;\n    const dec = options?.decode || decode;\n    let index = 0;\n    do {\n        const eqIdx = str.indexOf(\"=\", index);\n        if (eqIdx === -1)\n            break; // No more cookie pairs.\n        const colonIdx = str.indexOf(\";\", index);\n        const endIdx = colonIdx === -1 ? len : colonIdx;\n        if (eqIdx > endIdx) {\n            // backtrack on prior semicolon\n            index = str.lastIndexOf(\";\", eqIdx - 1) + 1;\n            continue;\n        }\n        const keyStartIdx = startIndex(str, index, eqIdx);\n        const keyEndIdx = endIndex(str, eqIdx, keyStartIdx);\n        const key = str.slice(keyStartIdx, keyEndIdx);\n        // only assign once\n        if (obj[key] === undefined) {\n            let valStartIdx = startIndex(str, eqIdx + 1, endIdx);\n            let valEndIdx = endIndex(str, endIdx, valStartIdx);\n            const value = dec(str.slice(valStartIdx, valEndIdx));\n            obj[key] = value;\n        }\n        index = endIdx + 1;\n    } while (index < len);\n    return obj;\n}\nfunction startIndex(str, index, max) {\n    do {\n        const code = str.charCodeAt(index);\n        if (code !== 0x20 /*   */ && code !== 0x09 /* \\t */)\n            return index;\n    } while (++index < max);\n    return max;\n}\nfunction endIndex(str, index, min) {\n    while (index > min) {\n        const code = str.charCodeAt(--index);\n        if (code !== 0x20 /*   */ && code !== 0x09 /* \\t */)\n            return index + 1;\n    }\n    return min;\n}\n/**\n * Serialize data into a cookie header.\n *\n * Serialize a name value pair into a cookie string suitable for\n * http headers. An optional options object specifies cookie parameters.\n *\n * serialize('foo', 'bar', { httpOnly: true })\n *   => \"foo=bar; httpOnly\"\n */\nexport function serialize(name, val, options) {\n    const enc = options?.encode || encodeURIComponent;\n    if (!cookieNameRegExp.test(name)) {\n        throw new TypeError(`argument name is invalid: ${name}`);\n    }\n    const value = enc(val);\n    if (!cookieValueRegExp.test(value)) {\n        throw new TypeError(`argument val is invalid: ${val}`);\n    }\n    let str = name + \"=\" + value;\n    if (!options)\n        return str;\n    if (options.maxAge !== undefined) {\n        if (!Number.isInteger(options.maxAge)) {\n            throw new TypeError(`option maxAge is invalid: ${options.maxAge}`);\n        }\n        str += \"; Max-Age=\" + options.maxAge;\n    }\n    if (options.domain) {\n        if (!domainValueRegExp.test(options.domain)) {\n            throw new TypeError(`option domain is invalid: ${options.domain}`);\n        }\n        str += \"; Domain=\" + options.domain;\n    }\n    if (options.path) {\n        if (!pathValueRegExp.test(options.path)) {\n            throw new TypeError(`option path is invalid: ${options.path}`);\n        }\n        str += \"; Path=\" + options.path;\n    }\n    if (options.expires) {\n        if (!isDate(options.expires) ||\n            !Number.isFinite(options.expires.valueOf())) {\n            throw new TypeError(`option expires is invalid: ${options.expires}`);\n        }\n        str += \"; Expires=\" + options.expires.toUTCString();\n    }\n    if (options.httpOnly) {\n        str += \"; HttpOnly\";\n    }\n    if (options.secure) {\n        str += \"; Secure\";\n    }\n    if (options.partitioned) {\n        str += \"; Partitioned\";\n    }\n    if (options.priority) {\n        const priority = typeof options.priority === \"string\"\n            ? options.priority.toLowerCase()\n            : undefined;\n        switch (priority) {\n            case \"low\":\n                str += \"; Priority=Low\";\n                break;\n            case \"medium\":\n                str += \"; Priority=Medium\";\n                break;\n            case \"high\":\n                str += \"; Priority=High\";\n                break;\n            default:\n                throw new TypeError(`option priority is invalid: ${options.priority}`);\n        }\n    }\n    if (options.sameSite) {\n        const sameSite = typeof options.sameSite === \"string\"\n            ? options.sameSite.toLowerCase()\n            : options.sameSite;\n        switch (sameSite) {\n            case true:\n            case \"strict\":\n                str += \"; SameSite=Strict\";\n                break;\n            case \"lax\":\n                str += \"; SameSite=Lax\";\n                break;\n            case \"none\":\n                str += \"; SameSite=None\";\n                break;\n            default:\n                throw new TypeError(`option sameSite is invalid: ${options.sameSite}`);\n        }\n    }\n    return str;\n}\n/**\n * URL-decode string value. Optimized to skip native call when no %.\n */\nfunction decode(str) {\n    if (str.indexOf(\"%\") === -1)\n        return str;\n    try {\n        return decodeURIComponent(str);\n    }\n    catch (e) {\n        return str;\n    }\n}\n/**\n * Determine if value is a Date.\n */\nfunction isDate(val) {\n    return __toString.call(val) === \"[object Date]\";\n}\n", "/**\n *\n *\n * This module contains functions and types\n * to encode and decode {@link https://authjs.dev/concepts/session-strategies#jwt-session JWT}s\n * issued and used by Auth.js.\n *\n * The JWT issued by Auth.js is _encrypted by default_, using the _A256CBC-HS512_ algorithm ({@link https://www.rfc-editor.org/rfc/rfc7518.html#section-5.2.5 JWE}).\n * It uses the `AUTH_SECRET` environment variable or the passed `secret` property to derive a suitable encryption key.\n *\n * :::info Note\n * Auth.js JWTs are meant to be used by the same app that issued them.\n * If you need JWT authentication for your third-party API, you should rely on your Identity Provider instead.\n * :::\n *\n * ## Installation\n *\n * ```bash npm2yarn\n * npm install @auth/core\n * ```\n *\n * You can then import this submodule from `@auth/core/jwt`.\n *\n * ## Usage\n *\n * :::warning Warning\n * This module *will* be refactored/changed. We do not recommend relying on it right now.\n * :::\n *\n *\n * ## Resources\n *\n * - [What is a JWT session strategy](https://authjs.dev/concepts/session-strategies#jwt-session)\n * - [RFC7519 - JSON Web Token (JWT)](https://www.rfc-editor.org/rfc/rfc7519)\n *\n * @module jwt\n */\nimport { hkdf } from \"@panva/hkdf\";\nimport { EncryptJWT, base64url, calculateJwkThumbprint, jwtDecrypt } from \"jose\";\nimport { defaultCookies, SessionStore } from \"./lib/utils/cookie.js\";\nimport { MissingSecret } from \"./errors.js\";\nimport * as cookie from \"./lib/vendored/cookie.js\";\nconst { parse: parseCookie } = cookie;\nconst DEFAULT_MAX_AGE = 30 * 24 * 60 * 60; // 30 days\nconst now = () => (Date.now() / 1000) | 0;\nconst alg = \"dir\";\nconst enc = \"A256CBC-HS512\";\n/** Issues a JWT. By default, the JWT is encrypted using \"A256CBC-HS512\". */\nexport async function encode(params) {\n    const { token = {}, secret, maxAge = DEFAULT_MAX_AGE, salt } = params;\n    const secrets = Array.isArray(secret) ? secret : [secret];\n    const encryptionSecret = await getDerivedEncryptionKey(enc, secrets[0], salt);\n    const thumbprint = await calculateJwkThumbprint({ kty: \"oct\", k: base64url.encode(encryptionSecret) }, `sha${encryptionSecret.byteLength << 3}`);\n    // @ts-expect-error `jose` allows any object as payload.\n    return await new EncryptJWT(token)\n        .setProtectedHeader({ alg, enc, kid: thumbprint })\n        .setIssuedAt()\n        .setExpirationTime(now() + maxAge)\n        .setJti(crypto.randomUUID())\n        .encrypt(encryptionSecret);\n}\n/** Decodes an Auth.js issued JWT. */\nexport async function decode(params) {\n    const { token, secret, salt } = params;\n    const secrets = Array.isArray(secret) ? secret : [secret];\n    if (!token)\n        return null;\n    const { payload } = await jwtDecrypt(token, async ({ kid, enc }) => {\n        for (const secret of secrets) {\n            const encryptionSecret = await getDerivedEncryptionKey(enc, secret, salt);\n            if (kid === undefined)\n                return encryptionSecret;\n            const thumbprint = await calculateJwkThumbprint({ kty: \"oct\", k: base64url.encode(encryptionSecret) }, `sha${encryptionSecret.byteLength << 3}`);\n            if (kid === thumbprint)\n                return encryptionSecret;\n        }\n        throw new Error(\"no matching decryption secret\");\n    }, {\n        clockTolerance: 15,\n        keyManagementAlgorithms: [alg],\n        contentEncryptionAlgorithms: [enc, \"A256GCM\"],\n    });\n    return payload;\n}\nexport async function getToken(params) {\n    const { secureCookie, cookieName = defaultCookies(secureCookie ?? false).sessionToken.name, decode: _decode = decode, salt = cookieName, secret, logger = console, raw, req, } = params;\n    if (!req)\n        throw new Error(\"Must pass `req` to JWT getToken()\");\n    const headers = req.headers instanceof Headers ? req.headers : new Headers(req.headers);\n    const sessionStore = new SessionStore({ name: cookieName, options: { secure: secureCookie } }, parseCookie(headers.get(\"cookie\") ?? \"\"), logger);\n    let token = sessionStore.value;\n    const authorizationHeader = headers.get(\"authorization\");\n    if (!token && authorizationHeader?.split(\" \")[0] === \"Bearer\") {\n        const urlEncodedToken = authorizationHeader.split(\" \")[1];\n        token = decodeURIComponent(urlEncodedToken);\n    }\n    if (!token)\n        return null;\n    if (raw)\n        return token;\n    if (!secret)\n        throw new MissingSecret(\"Must pass `secret` if not set to JWT getToken()\");\n    try {\n        return await _decode({ token, secret, salt });\n    }\n    catch {\n        return null;\n    }\n}\nasync function getDerivedEncryptionKey(enc, keyMaterial, salt) {\n    let length;\n    switch (enc) {\n        case \"A256CBC-HS512\":\n            length = 64;\n            break;\n        case \"A256GCM\":\n            length = 32;\n            break;\n        default:\n            throw new Error(\"Unsupported JWT Content Encryption Algorithm\");\n    }\n    return await hkdf(\"sha256\", keyMaterial, salt, `Auth.js Generated Encryption Key (${salt})`, length);\n}\n", "import { AuthError } from \"../../errors.js\";\nconst red = \"\\x1b[31m\";\nconst yellow = \"\\x1b[33m\";\nconst grey = \"\\x1b[90m\";\nconst reset = \"\\x1b[0m\";\nconst defaultLogger = {\n    error(error) {\n        const name = error instanceof AuthError ? error.type : error.name;\n        console.error(`${red}[auth][error]${reset} ${name}: ${error.message}`);\n        if (error.cause &&\n            typeof error.cause === \"object\" &&\n            \"err\" in error.cause &&\n            error.cause.err instanceof Error) {\n            const { err, ...data } = error.cause;\n            console.error(`${red}[auth][cause]${reset}:`, err.stack);\n            if (data)\n                console.error(`${red}[auth][details]${reset}:`, JSON.stringify(data, null, 2));\n        }\n        else if (error.stack) {\n            console.error(error.stack.replace(/.*/, \"\").substring(1));\n        }\n    },\n    warn(code) {\n        const url = `https://warnings.authjs.dev#${code}`;\n        console.warn(`${yellow}[auth][warn][${code}]${reset}`, `Read more: ${url}`);\n    },\n    debug(message, metadata) {\n        console.log(`${grey}[auth][debug]:${reset} ${message}`, JSON.stringify(metadata, null, 2));\n    },\n};\n/**\n * Override the built-in logger with user's implementation.\n * Any `undefined` level will use the default logger.\n */\nexport function setLogger(config) {\n    const newLogger = {\n        ...defaultLogger,\n    };\n    // Turn off debug logging if `debug` isn't set to `true`\n    if (!config.debug)\n        newLogger.debug = () => { };\n    if (config.logger?.error)\n        newLogger.error = config.logger.error;\n    if (config.logger?.warn)\n        newLogger.warn = config.logger.warn;\n    if (config.logger?.debug)\n        newLogger.debug = config.logger.debug;\n    config.logger ?? (config.logger = newLogger);\n    return newLogger;\n}\n", "import * as cookie from \"../vendored/cookie.js\";\nimport { UnknownAction } from \"../../errors.js\";\nimport { setLogger } from \"./logger.js\";\nimport { isAuthAction } from \"./actions.js\";\nconst { parse: parseCookie, serialize: serializeCookie } = cookie;\nasync function getBody(req) {\n    if (!(\"body\" in req) || !req.body || req.method !== \"POST\")\n        return;\n    const contentType = req.headers.get(\"content-type\");\n    if (contentType?.includes(\"application/json\")) {\n        return await req.json();\n    }\n    else if (contentType?.includes(\"application/x-www-form-urlencoded\")) {\n        const params = new URLSearchParams(await req.text());\n        return Object.fromEntries(params);\n    }\n}\nexport async function toInternalRequest(req, config) {\n    try {\n        if (req.method !== \"GET\" && req.method !== \"POST\")\n            throw new UnknownAction(\"Only GET and POST requests are supported\");\n        // Defaults are usually set in the `init` function, but this is needed below\n        config.basePath ?? (config.basePath = \"/auth\");\n        const url = new URL(req.url);\n        const { action, providerId } = parseActionAndProviderId(url.pathname, config.basePath);\n        return {\n            url,\n            action,\n            providerId,\n            method: req.method,\n            headers: Object.fromEntries(req.headers),\n            body: req.body ? await getBody(req) : undefined,\n            cookies: parseCookie(req.headers.get(\"cookie\") ?? \"\") ?? {},\n            error: url.searchParams.get(\"error\") ?? undefined,\n            query: Object.fromEntries(url.searchParams),\n        };\n    }\n    catch (e) {\n        const logger = setLogger(config);\n        logger.error(e);\n        logger.debug(\"request\", req);\n    }\n}\nexport function toRequest(request) {\n    return new Request(request.url, {\n        headers: request.headers,\n        method: request.method,\n        body: request.method === \"POST\"\n            ? JSON.stringify(request.body ?? {})\n            : undefined,\n    });\n}\nexport function toResponse(res) {\n    const headers = new Headers(res.headers);\n    res.cookies?.forEach((cookie) => {\n        const { name, value, options } = cookie;\n        const cookieHeader = serializeCookie(name, value, options);\n        if (headers.has(\"Set-Cookie\"))\n            headers.append(\"Set-Cookie\", cookieHeader);\n        else\n            headers.set(\"Set-Cookie\", cookieHeader);\n    });\n    let body = res.body;\n    if (headers.get(\"content-type\") === \"application/json\")\n        body = JSON.stringify(res.body);\n    else if (headers.get(\"content-type\") === \"application/x-www-form-urlencoded\")\n        body = new URLSearchParams(res.body).toString();\n    const status = res.redirect ? 302 : (res.status ?? 200);\n    const response = new Response(body, { headers, status });\n    if (res.redirect)\n        response.headers.set(\"Location\", res.redirect);\n    return response;\n}\n/** Web compatible method to create a hash, using SHA256 */\nexport async function createHash(message) {\n    const data = new TextEncoder().encode(message);\n    const hash = await crypto.subtle.digest(\"SHA-256\", data);\n    return Array.from(new Uint8Array(hash))\n        .map((b) => b.toString(16).padStart(2, \"0\"))\n        .join(\"\")\n        .toString();\n}\n/** Web compatible method to create a random string of a given length */\nexport function randomString(size) {\n    const i2hex = (i) => (\"0\" + i.toString(16)).slice(-2);\n    const r = (a, i) => a + i2hex(i);\n    const bytes = crypto.getRandomValues(new Uint8Array(size));\n    return Array.from(bytes).reduce(r, \"\");\n}\n/** @internal Parse the action and provider id from a URL pathname. */\nexport function parseActionAndProviderId(pathname, base) {\n    const a = pathname.match(new RegExp(`^${base}(.+)`));\n    if (a === null)\n        throw new UnknownAction(`Cannot parse action at ${pathname}`);\n    const actionAndProviderId = a.at(-1);\n    const b = actionAndProviderId.replace(/^\\//, \"\").split(\"/\").filter(Boolean);\n    if (b.length !== 1 && b.length !== 2)\n        throw new UnknownAction(`Cannot parse action at ${pathname}`);\n    const [action, providerId] = b;\n    if (!isAuthAction(action))\n        throw new UnknownAction(`Cannot parse action at ${pathname}`);\n    if (providerId &&\n        ![\"signin\", \"callback\", \"webauthn-options\"].includes(action))\n        throw new UnknownAction(`Cannot parse action at ${pathname}`);\n    return { action, providerId };\n}\n", "/**\n * :::danger\n * This option is intended for framework authors.\n * :::\n *\n * Auth.js comes with built-in CSRF protection, but\n * if you are implementing a framework that is already protected against CSRF attacks, you can skip this check by\n * passing this value to {@link AuthConfig.skipCSRFCheck}.\n */\nexport const skipCSRFCheck = Symbol(\"skip-csrf-check\");\n/**\n * :::danger\n * This option is intended for framework authors.\n * :::\n *\n * Auth.js returns a web standard {@link Response} by default, but\n * if you are implementing a framework you might want to get access to the raw internal response\n * by passing this value to {@link AuthConfig.raw}.\n */\nexport const raw = Symbol(\"return-type-raw\");\n/**\n * :::danger\n * This option allows you to override the default `fetch` function used by the provider\n * to make requests to the provider's OAuth endpoints directly.\n * Used incorrectly, it can have security implications.\n * :::\n *\n * It can be used to support corporate proxies, custom fetch libraries, cache discovery endpoints,\n * add mocks for testing, logging, set custom headers/params for non-spec compliant providers, etc.\n *\n * @example\n * ```ts\n * import { Auth, customFetch } from \"@auth/core\"\n * import GitHub from \"@auth/core/providers/github\"\n *\n * const dispatcher = new ProxyAgent(\"my.proxy.server\")\n * function proxy(...args: Parameters<typeof fetch>): ReturnType<typeof fetch> {\n *   return undici(args[0], { ...(args[1] ?? {}), dispatcher })\n * }\n *\n * const response = await Auth(request, {\n *   providers: [GitHub({ [customFetch]: proxy })]\n * })\n * ```\n *\n * @see https://undici.nodejs.org/#/docs/api/ProxyAgent?id=example-basic-proxy-request-with-local-agent-dispatcher\n * @see https://authjs.dev/guides/corporate-proxy\n */\nexport const customFetch = Symbol(\"custom-fetch\");\n/**\n * @internal\n *\n * Used to mark some providers for processing within the core library.\n *\n * **Do not use or you will be fired.**\n */\nexport const conformInternal = Symbol(\"conform-internal\");\n", "/** Normal hydration that attaches to a DOM tree but does not diff it. */\nexport const MODE_HYDRATE = 1 << 5;\n/** Signifies this VNode suspended on the previous render */\nexport const MODE_SUSPENDED = 1 << 7;\n/** Indicates that this node needs to be inserted while patching children */\nexport const INSERT_VNODE = 1 << 16;\n/** Indicates a VNode has been matched with another VNode in the diff */\nexport const MATCHED = 1 << 17;\n\n/** Reset all mode flags */\nexport const RESET_MODE = ~(MODE_HYDRATE | MODE_SUSPENDED);\n\nexport const EMPTY_OBJ = /** @type {any} */ ({});\nexport const EMPTY_ARR = [];\nexport const IS_NON_DIMENSIONAL =\n\t/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;\n", "import { EMPTY_ARR } from './constants';\n\nexport const isArray = Array.isArray;\n\n/**\n * Assign properties from `props` to `obj`\n * @template O, P The obj and props types\n * @param {O} obj The object to copy properties to\n * @param {P} props The object to copy properties from\n * @returns {O & P}\n */\nexport function assign(obj, props) {\n\t// @ts-expect-error We change the type of `obj` to be `O & P`\n\tfor (let i in props) obj[i] = props[i];\n\treturn /** @type {O & P} */ (obj);\n}\n\n/**\n * Remove a child node from its parent if attached. This is a workaround for\n * IE11 which doesn't support `Element.prototype.remove()`. Using this function\n * is smaller than including a dedicated polyfill.\n * @param {preact.ContainerNode} node The node to remove\n */\nexport function removeNode(node) {\n\tif (node && node.parentNode) node.parentNode.removeChild(node);\n}\n\nexport const slice = EMPTY_ARR.slice;\n", "import { _catchError } from './diff/catch-error';\n\n/**\n * The `option` object can potentially contain callback functions\n * that are called during various stages of our renderer. This is the\n * foundation on which all our addons like `preact/debug`, `preact/compat`,\n * and `preact/hooks` are based on. See the `Options` type in `internal.d.ts`\n * for a full list of available option hooks (most editors/IDEs allow you to\n * ctrl+click or cmd+click on mac the type definition below).\n * @type {Options}\n */\nconst options = {\n\t_catchError\n};\n\nexport default options;\n", "import { slice } from './util';\nimport options from './options';\n\nlet vnodeId = 0;\n\n/**\n * Create an virtual node (used for JSX)\n * @param {VNode[\"type\"]} type The node name or Component constructor for this\n * virtual node\n * @param {object | null | undefined} [props] The properties of the virtual node\n * @param {Array<import('.').ComponentChildren>} [children] The children of the\n * virtual node\n * @returns {VNode}\n */\nexport function createElement(type, props, children) {\n\tlet normalizedProps = {},\n\t\tkey,\n\t\tref,\n\t\ti;\n\tfor (i in props) {\n\t\tif (i == 'key') key = props[i];\n\t\telse if (i == 'ref') ref = props[i];\n\t\telse normalizedProps[i] = props[i];\n\t}\n\n\tif (arguments.length > 2) {\n\t\tnormalizedProps.children =\n\t\t\targuments.length > 3 ? slice.call(arguments, 2) : children;\n\t}\n\n\t// If a Component VNode, check for and apply defaultProps\n\t// Note: type may be undefined in development, must never error here.\n\tif (typeof type == 'function' && type.defaultProps != null) {\n\t\tfor (i in type.defaultProps) {\n\t\t\tif (normalizedProps[i] === undefined) {\n\t\t\t\tnormalizedProps[i] = type.defaultProps[i];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn createVNode(type, normalizedProps, key, ref, null);\n}\n\n/**\n * Create a VNode (used internally by Preact)\n * @param {VNode[\"type\"]} type The node name or Component\n * Constructor for this virtual node\n * @param {object | string | number | null} props The properties of this virtual node.\n * If this virtual node represents a text node, this is the text of the node (string or number).\n * @param {string | number | null} key The key for this virtual node, used when\n * diffing it against its children\n * @param {VNode[\"ref\"]} ref The ref property that will\n * receive a reference to its created child\n * @returns {VNode}\n */\nexport function createVNode(type, props, key, ref, original) {\n\t// V8 seems to be better at detecting type shapes if the object is allocated from the same call site\n\t// Do not inline into createElement and coerceToVNode!\n\t/** @type {VNode} */\n\tconst vnode = {\n\t\ttype,\n\t\tprops,\n\t\tkey,\n\t\tref,\n\t\t_children: null,\n\t\t_parent: null,\n\t\t_depth: 0,\n\t\t_dom: null,\n\t\t// _nextDom must be initialized to undefined b/c it will eventually\n\t\t// be set to dom.nextSibling which can return `null` and it is important\n\t\t// to be able to distinguish between an uninitialized _nextDom and\n\t\t// a _nextDom that has been set to `null`\n\t\t_nextDom: undefined,\n\t\t_component: null,\n\t\tconstructor: undefined,\n\t\t_original: original == null ? ++vnodeId : original,\n\t\t_index: -1,\n\t\t_flags: 0\n\t};\n\n\t// Only invoke the vnode hook if this was *not* a direct copy:\n\tif (original == null && options.vnode != null) options.vnode(vnode);\n\n\treturn vnode;\n}\n\nexport function createRef() {\n\treturn { current: null };\n}\n\nexport function Fragment(props) {\n\treturn props.children;\n}\n\n/**\n * Check if a the argument is a valid Preact VNode.\n * @param {*} vnode\n * @returns {vnode is VNode}\n */\nexport const isValidElement = vnode =>\n\tvnode != null && vnode.constructor == undefined;\n", "import { assign } from './util';\nimport { diff, commitRoot } from './diff/index';\nimport options from './options';\nimport { Fragment } from './create-element';\nimport { MODE_HYDRATE } from './constants';\n\n/**\n * Base Component class. Provides `setState()` and `forceUpdate()`, which\n * trigger rendering\n * @param {object} props The initial component props\n * @param {object} context The initial context from parent components'\n * getChildContext\n */\nexport function BaseComponent(props, context) {\n\tthis.props = props;\n\tthis.context = context;\n}\n\n/**\n * Update component state and schedule a re-render.\n * @this {Component}\n * @param {object | ((s: object, p: object) => object)} update A hash of state\n * properties to update with new values or a function that given the current\n * state and props returns a new partial state\n * @param {() => void} [callback] A function to be called once component state is\n * updated\n */\nBaseComponent.prototype.setState = function (update, callback) {\n\t// only clone state when copying to nextState the first time.\n\tlet s;\n\tif (this._nextState != null && this._nextState !== this.state) {\n\t\ts = this._nextState;\n\t} else {\n\t\ts = this._nextState = assign({}, this.state);\n\t}\n\n\tif (typeof update == 'function') {\n\t\t// Some libraries like `immer` mark the current state as readonly,\n\t\t// preventing us from mutating it, so we need to clone it. See #2716\n\t\tupdate = update(assign({}, s), this.props);\n\t}\n\n\tif (update) {\n\t\tassign(s, update);\n\t}\n\n\t// Skip update if updater function returned null\n\tif (update == null) return;\n\n\tif (this._vnode) {\n\t\tif (callback) {\n\t\t\tthis._stateCallbacks.push(callback);\n\t\t}\n\t\tenqueueRender(this);\n\t}\n};\n\n/**\n * Immediately perform a synchronous re-render of the component\n * @this {Component}\n * @param {() => void} [callback] A function to be called after component is\n * re-rendered\n */\nBaseComponent.prototype.forceUpdate = function (callback) {\n\tif (this._vnode) {\n\t\t// Set render mode so that we can differentiate where the render request\n\t\t// is coming from. We need this because forceUpdate should never call\n\t\t// shouldComponentUpdate\n\t\tthis._force = true;\n\t\tif (callback) this._renderCallbacks.push(callback);\n\t\tenqueueRender(this);\n\t}\n};\n\n/**\n * Accepts `props` and `state`, and returns a new Virtual DOM tree to build.\n * Virtual DOM is generally constructed via [JSX](http://jasonformat.com/wtf-is-jsx).\n * @param {object} props Props (eg: JSX attributes) received from parent\n * element/component\n * @param {object} state The component's current state\n * @param {object} context Context object, as returned by the nearest\n * ancestor's `getChildContext()`\n * @returns {ComponentChildren | void}\n */\nBaseComponent.prototype.render = Fragment;\n\n/**\n * @param {VNode} vnode\n * @param {number | null} [childIndex]\n */\nexport function getDomSibling(vnode, childIndex) {\n\tif (childIndex == null) {\n\t\t// Use childIndex==null as a signal to resume the search from the vnode's sibling\n\t\treturn vnode._parent\n\t\t\t? getDomSibling(vnode._parent, vnode._index + 1)\n\t\t\t: null;\n\t}\n\n\tlet sibling;\n\tfor (; childIndex < vnode._children.length; childIndex++) {\n\t\tsibling = vnode._children[childIndex];\n\n\t\tif (sibling != null && sibling._dom != null) {\n\t\t\t// Since updateParentDomPointers keeps _dom pointer correct,\n\t\t\t// we can rely on _dom to tell us if this subtree contains a\n\t\t\t// rendered DOM node, and what the first rendered DOM node is\n\t\t\treturn sibling._dom;\n\t\t}\n\t}\n\n\t// If we get here, we have not found a DOM node in this vnode's children.\n\t// We must resume from this vnode's sibling (in it's parent _children array)\n\t// Only climb up and search the parent if we aren't searching through a DOM\n\t// VNode (meaning we reached the DOM parent of the original vnode that began\n\t// the search)\n\treturn typeof vnode.type == 'function' ? getDomSibling(vnode) : null;\n}\n\n/**\n * Trigger in-place re-rendering of a component.\n * @param {Component} component The component to rerender\n */\nfunction renderComponent(component) {\n\tlet oldVNode = component._vnode,\n\t\toldDom = oldVNode._dom,\n\t\tcommitQueue = [],\n\t\trefQueue = [];\n\n\tif (component._parentDom) {\n\t\tconst newVNode = assign({}, oldVNode);\n\t\tnewVNode._original = oldVNode._original + 1;\n\t\tif (options.vnode) options.vnode(newVNode);\n\n\t\tdiff(\n\t\t\tcomponent._parentDom,\n\t\t\tnewVNode,\n\t\t\toldVNode,\n\t\t\tcomponent._globalContext,\n\t\t\tcomponent._parentDom.namespaceURI,\n\t\t\toldVNode._flags & MODE_HYDRATE ? [oldDom] : null,\n\t\t\tcommitQueue,\n\t\t\toldDom == null ? getDomSibling(oldVNode) : oldDom,\n\t\t\t!!(oldVNode._flags & MODE_HYDRATE),\n\t\t\trefQueue\n\t\t);\n\n\t\tnewVNode._original = oldVNode._original;\n\t\tnewVNode._parent._children[newVNode._index] = newVNode;\n\t\tcommitRoot(commitQueue, newVNode, refQueue);\n\n\t\tif (newVNode._dom != oldDom) {\n\t\t\tupdateParentDomPointers(newVNode);\n\t\t}\n\t}\n}\n\n/**\n * @param {VNode} vnode\n */\nfunction updateParentDomPointers(vnode) {\n\tif ((vnode = vnode._parent) != null && vnode._component != null) {\n\t\tvnode._dom = vnode._component.base = null;\n\t\tfor (let i = 0; i < vnode._children.length; i++) {\n\t\t\tlet child = vnode._children[i];\n\t\t\tif (child != null && child._dom != null) {\n\t\t\t\tvnode._dom = vnode._component.base = child._dom;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn updateParentDomPointers(vnode);\n\t}\n}\n\n/**\n * The render queue\n * @type {Array<Component>}\n */\nlet rerenderQueue = [];\n\n/*\n * The value of `Component.debounce` must asynchronously invoke the passed in callback. It is\n * important that contributors to Preact can consistently reason about what calls to `setState`, etc.\n * do, and when their effects will be applied. See the links below for some further reading on designing\n * asynchronous APIs.\n * * [Designing APIs for Asynchrony](https://blog.izs.me/2013/08/designing-apis-for-asynchrony)\n * * [Callbacks synchronous and asynchronous](https://blog.ometer.com/2011/07/24/callbacks-synchronous-and-asynchronous/)\n */\n\nlet prevDebounce;\n\nconst defer =\n\ttypeof Promise == 'function'\n\t\t? Promise.prototype.then.bind(Promise.resolve())\n\t\t: setTimeout;\n\n/**\n * Enqueue a rerender of a component\n * @param {Component} c The component to rerender\n */\nexport function enqueueRender(c) {\n\tif (\n\t\t(!c._dirty &&\n\t\t\t(c._dirty = true) &&\n\t\t\trerenderQueue.push(c) &&\n\t\t\t!process._rerenderCount++) ||\n\t\tprevDebounce !== options.debounceRendering\n\t) {\n\t\tprevDebounce = options.debounceRendering;\n\t\t(prevDebounce || defer)(process);\n\t}\n}\n\n/**\n * @param {Component} a\n * @param {Component} b\n */\nconst depthSort = (a, b) => a._vnode._depth - b._vnode._depth;\n\n/** Flush the render queue by rerendering all queued components */\nfunction process() {\n\tlet c;\n\trerenderQueue.sort(depthSort);\n\t// Don't update `renderCount` yet. Keep its value non-zero to prevent unnecessary\n\t// process() calls from getting scheduled while `queue` is still being consumed.\n\twhile ((c = rerenderQueue.shift())) {\n\t\tif (c._dirty) {\n\t\t\tlet renderQueueLength = rerenderQueue.length;\n\t\t\trenderComponent(c);\n\t\t\tif (rerenderQueue.length > renderQueueLength) {\n\t\t\t\t// When i.e. rerendering a provider additional new items can be injected, we want to\n\t\t\t\t// keep the order from top to bottom with those new items so we can handle them in a\n\t\t\t\t// single pass\n\t\t\t\trerenderQueue.sort(depthSort);\n\t\t\t}\n\t\t}\n\t}\n\tprocess._rerenderCount = 0;\n}\n\nprocess._rerenderCount = 0;\n", "import { IS_NON_DIMENSIONAL } from '../constants';\nimport options from '../options';\n\nfunction setStyle(style, key, value) {\n\tif (key[0] === '-') {\n\t\tstyle.setProperty(key, value == null ? '' : value);\n\t} else if (value == null) {\n\t\tstyle[key] = '';\n\t} else if (typeof value != 'number' || IS_NON_DIMENSIONAL.test(key)) {\n\t\tstyle[key] = value;\n\t} else {\n\t\tstyle[key] = value + 'px';\n\t}\n}\n\n// A logical clock to solve issues like https://github.com/preactjs/preact/issues/3927.\n// When the DOM performs an event it leaves micro-ticks in between bubbling up which means that\n// an event can trigger on a newly reated DOM-node while the event bubbles up.\n//\n// Originally inspired by Vue\n// (https://github.com/vuejs/core/blob/caeb8a68811a1b0f79/packages/runtime-dom/src/modules/events.ts#L90-L101),\n// but modified to use a logical clock instead of Date.now() in case event handlers get attached\n// and events get dispatched during the same millisecond.\n//\n// The clock is incremented after each new event dispatch. This allows 1 000 000 new events\n// per second for over 280 years before the value reaches Number.MAX_SAFE_INTEGER (2**53 - 1).\nlet eventClock = 0;\n\n/**\n * Set a property value on a DOM node\n * @param {PreactElement} dom The DOM node to modify\n * @param {string} name The name of the property to set\n * @param {*} value The value to set the property to\n * @param {*} oldValue The old value the property had\n * @param {string} namespace Whether or not this DOM node is an SVG node or not\n */\nexport function setProperty(dom, name, value, oldValue, namespace) {\n\tlet useCapture;\n\n\to: if (name === 'style') {\n\t\tif (typeof value == 'string') {\n\t\t\tdom.style.cssText = value;\n\t\t} else {\n\t\t\tif (typeof oldValue == 'string') {\n\t\t\t\tdom.style.cssText = oldValue = '';\n\t\t\t}\n\n\t\t\tif (oldValue) {\n\t\t\t\tfor (name in oldValue) {\n\t\t\t\t\tif (!(value && name in value)) {\n\t\t\t\t\t\tsetStyle(dom.style, name, '');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (value) {\n\t\t\t\tfor (name in value) {\n\t\t\t\t\tif (!oldValue || value[name] !== oldValue[name]) {\n\t\t\t\t\t\tsetStyle(dom.style, name, value[name]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t// Benchmark for comparison: https://esbench.com/bench/574c954bdb965b9a00965ac6\n\telse if (name[0] === 'o' && name[1] === 'n') {\n\t\tuseCapture =\n\t\t\tname !== (name = name.replace(/(PointerCapture)$|Capture$/i, '$1'));\n\n\t\t// Infer correct casing for DOM built-in events:\n\t\tif (\n\t\t\tname.toLowerCase() in dom ||\n\t\t\tname === 'onFocusOut' ||\n\t\t\tname === 'onFocusIn'\n\t\t)\n\t\t\tname = name.toLowerCase().slice(2);\n\t\telse name = name.slice(2);\n\n\t\tif (!dom._listeners) dom._listeners = {};\n\t\tdom._listeners[name + useCapture] = value;\n\n\t\tif (value) {\n\t\t\tif (!oldValue) {\n\t\t\t\tvalue._attached = eventClock;\n\t\t\t\tdom.addEventListener(\n\t\t\t\t\tname,\n\t\t\t\t\tuseCapture ? eventProxyCapture : eventProxy,\n\t\t\t\t\tuseCapture\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tvalue._attached = oldValue._attached;\n\t\t\t}\n\t\t} else {\n\t\t\tdom.removeEventListener(\n\t\t\t\tname,\n\t\t\t\tuseCapture ? eventProxyCapture : eventProxy,\n\t\t\t\tuseCapture\n\t\t\t);\n\t\t}\n\t} else {\n\t\tif (namespace == 'http://www.w3.org/2000/svg') {\n\t\t\t// Normalize incorrect prop usage for SVG:\n\t\t\t// - xlink:href / xlinkHref --> href (xlink:href was removed from SVG and isn't needed)\n\t\t\t// - className --> class\n\t\t\tname = name.replace(/xlink(H|:h)/, 'h').replace(/sName$/, 's');\n\t\t} else if (\n\t\t\tname != 'width' &&\n\t\t\tname != 'height' &&\n\t\t\tname != 'href' &&\n\t\t\tname != 'list' &&\n\t\t\tname != 'form' &&\n\t\t\t// Default value in browsers is `-1` and an empty string is\n\t\t\t// cast to `0` instead\n\t\t\tname != 'tabIndex' &&\n\t\t\tname != 'download' &&\n\t\t\tname != 'rowSpan' &&\n\t\t\tname != 'colSpan' &&\n\t\t\tname != 'role' &&\n\t\t\tname != 'popover' &&\n\t\t\tname in dom\n\t\t) {\n\t\t\ttry {\n\t\t\t\tdom[name] = value == null ? '' : value;\n\t\t\t\t// labelled break is 1b smaller here than a return statement (sorry)\n\t\t\t\tbreak o;\n\t\t\t} catch (e) {}\n\t\t}\n\n\t\t// aria- and data- attributes have no boolean representation.\n\t\t// A `false` value is different from the attribute not being\n\t\t// present, so we can't remove it. For non-boolean aria\n\t\t// attributes we could treat false as a removal, but the\n\t\t// amount of exceptions would cost too many bytes. On top of\n\t\t// that other frameworks generally stringify `false`.\n\n\t\tif (typeof value == 'function') {\n\t\t\t// never serialize functions as attribute values\n\t\t} else if (value != null && (value !== false || name[4] === '-')) {\n\t\t\tdom.setAttribute(name, name == 'popover' && value == true ? '' : value);\n\t\t} else {\n\t\t\tdom.removeAttribute(name);\n\t\t}\n\t}\n}\n\n/**\n * Create an event proxy function.\n * @param {boolean} useCapture Is the event handler for the capture phase.\n * @private\n */\nfunction createEventProxy(useCapture) {\n\t/**\n\t * Proxy an event to hooked event handlers\n\t * @param {PreactEvent} e The event object from the browser\n\t * @private\n\t */\n\treturn function (e) {\n\t\tif (this._listeners) {\n\t\t\tconst eventHandler = this._listeners[e.type + useCapture];\n\t\t\tif (e._dispatched == null) {\n\t\t\t\te._dispatched = eventClock++;\n\n\t\t\t\t// When `e._dispatched` is smaller than the time when the targeted event\n\t\t\t\t// handler was attached we know we have bubbled up to an element that was added\n\t\t\t\t// during patching the DOM.\n\t\t\t} else if (e._dispatched < eventHandler._attached) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn eventHandler(options.event ? options.event(e) : e);\n\t\t}\n\t};\n}\n\nconst eventProxy = createEventProxy(false);\nconst eventProxyCapture = createEventProxy(true);\n", "import { enqueueRender } from './component';\n\nexport let i = 0;\n\nexport function createContext(defaultValue, contextId) {\n\tcontextId = '__cC' + i++;\n\n\tconst context = {\n\t\t_id: contextId,\n\t\t_defaultValue: defaultValue,\n\t\t/** @type {FunctionComponent} */\n\t\tConsumer(props, contextValue) {\n\t\t\t// return props.children(\n\t\t\t// \tcontext[contextId] ? context[contextId].props.value : defaultValue\n\t\t\t// );\n\t\t\treturn props.children(contextValue);\n\t\t},\n\t\t/** @type {FunctionComponent} */\n\t\tProvider(props) {\n\t\t\tif (!this.getChildContext) {\n\t\t\t\t/** @type {Set<Component> | null} */\n\t\t\t\tlet subs = new Set();\n\t\t\t\tlet ctx = {};\n\t\t\t\tctx[contextId] = this;\n\n\t\t\t\tthis.getChildContext = () => ctx;\n\n\t\t\t\tthis.componentWillUnmount = () => {\n\t\t\t\t\tsubs = null;\n\t\t\t\t};\n\n\t\t\t\tthis.shouldComponentUpdate = function (_props) {\n\t\t\t\t\tif (this.props.value !== _props.value) {\n\t\t\t\t\t\tsubs.forEach(c => {\n\t\t\t\t\t\t\tc._force = true;\n\t\t\t\t\t\t\tenqueueRender(c);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis.sub = c => {\n\t\t\t\t\tsubs.add(c);\n\t\t\t\t\tlet old = c.componentWillUnmount;\n\t\t\t\t\tc.componentWillUnmount = () => {\n\t\t\t\t\t\tif (subs) {\n\t\t\t\t\t\t\tsubs.delete(c);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (old) old.call(c);\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn props.children;\n\t\t}\n\t};\n\n\t// Devtools needs access to the context object when it\n\t// encounters a Provider. This is necessary to support\n\t// setting `displayName` on the context object instead\n\t// of on the component itself. See:\n\t// https://reactjs.org/docs/context.html#contextdisplayname\n\n\treturn (context.Provider._contextRef = context.Consumer.contextType =\n\t\tcontext);\n}\n", "import { diff, unmount, applyRef } from './index';\nimport { createVNode, Fragment } from '../create-element';\nimport { EMPTY_OBJ, EMPTY_ARR, INSERT_VNODE, MATCHED } from '../constants';\nimport { isArray } from '../util';\nimport { getDomSibling } from '../component';\n\n/**\n * Diff the children of a virtual node\n * @param {PreactElement} parentDom The DOM element whose children are being\n * diffed\n * @param {ComponentChildren[]} renderResult\n * @param {VNode} newParentVNode The new virtual node whose children should be\n * diff'ed against oldParentVNode\n * @param {VNode} oldParentVNode The old virtual node whose children should be\n * diff'ed against newParentVNode\n * @param {object} globalContext The current context object - modified by\n * getChildContext\n * @param {string} namespace Current namespace of the DOM node (HTML, SVG, or MathML)\n * @param {Array<PreactElement>} excessDomChildren\n * @param {Array<Component>} commitQueue List of components which have callbacks\n * to invoke in commitRoot\n * @param {PreactElement} oldDom The current attached DOM element any new dom\n * elements should be placed around. Likely `null` on first render (except when\n * hydrating). Can be a sibling DOM element when diffing Fragments that have\n * siblings. In most cases, it starts out as `oldChildren[0]._dom`.\n * @param {boolean} isHydrating Whether or not we are in hydration\n * @param {any[]} refQueue an array of elements needed to invoke refs\n */\nexport function diffChildren(\n\tparentDom,\n\trenderResult,\n\tnewParentVNode,\n\toldParentVNode,\n\tglobalContext,\n\tnamespace,\n\texcessDomChildren,\n\tcommitQueue,\n\toldDom,\n\tisHydrating,\n\trefQueue\n) {\n\tlet i,\n\t\t/** @type {VNode} */\n\t\toldVNode,\n\t\t/** @type {VNode} */\n\t\tchildVNode,\n\t\t/** @type {PreactElement} */\n\t\tnewDom,\n\t\t/** @type {PreactElement} */\n\t\tfirstChildDom;\n\n\t// This is a compression of oldParentVNode!=null && oldParentVNode != EMPTY_OBJ && oldParentVNode._children || EMPTY_ARR\n\t// as EMPTY_OBJ._children should be `undefined`.\n\t/** @type {VNode[]} */\n\tlet oldChildren = (oldParentVNode && oldParentVNode._children) || EMPTY_ARR;\n\n\tlet newChildrenLength = renderResult.length;\n\n\tnewParentVNode._nextDom = oldDom;\n\tconstructNewChildrenArray(newParentVNode, renderResult, oldChildren);\n\toldDom = newParentVNode._nextDom;\n\n\tfor (i = 0; i < newChildrenLength; i++) {\n\t\tchildVNode = newParentVNode._children[i];\n\t\tif (childVNode == null) continue;\n\n\t\t// At this point, constructNewChildrenArray has assigned _index to be the\n\t\t// matchingIndex for this VNode's oldVNode (or -1 if there is no oldVNode).\n\t\tif (childVNode._index === -1) {\n\t\t\toldVNode = EMPTY_OBJ;\n\t\t} else {\n\t\t\toldVNode = oldChildren[childVNode._index] || EMPTY_OBJ;\n\t\t}\n\n\t\t// Update childVNode._index to its final index\n\t\tchildVNode._index = i;\n\n\t\t// Morph the old element into the new one, but don't append it to the dom yet\n\t\tdiff(\n\t\t\tparentDom,\n\t\t\tchildVNode,\n\t\t\toldVNode,\n\t\t\tglobalContext,\n\t\t\tnamespace,\n\t\t\texcessDomChildren,\n\t\t\tcommitQueue,\n\t\t\toldDom,\n\t\t\tisHydrating,\n\t\t\trefQueue\n\t\t);\n\n\t\t// Adjust DOM nodes\n\t\tnewDom = childVNode._dom;\n\t\tif (childVNode.ref && oldVNode.ref != childVNode.ref) {\n\t\t\tif (oldVNode.ref) {\n\t\t\t\tapplyRef(oldVNode.ref, null, childVNode);\n\t\t\t}\n\t\t\trefQueue.push(\n\t\t\t\tchildVNode.ref,\n\t\t\t\tchildVNode._component || newDom,\n\t\t\t\tchildVNode\n\t\t\t);\n\t\t}\n\n\t\tif (firstChildDom == null && newDom != null) {\n\t\t\tfirstChildDom = newDom;\n\t\t}\n\n\t\tif (\n\t\t\tchildVNode._flags & INSERT_VNODE ||\n\t\t\toldVNode._children === childVNode._children\n\t\t) {\n\t\t\toldDom = insert(childVNode, oldDom, parentDom);\n\t\t} else if (\n\t\t\ttypeof childVNode.type == 'function' &&\n\t\t\tchildVNode._nextDom !== undefined\n\t\t) {\n\t\t\t// Since Fragments or components that return Fragment like VNodes can\n\t\t\t// contain multiple DOM nodes as the same level, continue the diff from\n\t\t\t// the sibling of last DOM child of this child VNode\n\t\t\toldDom = childVNode._nextDom;\n\t\t} else if (newDom) {\n\t\t\toldDom = newDom.nextSibling;\n\t\t}\n\n\t\t// Eagerly cleanup _nextDom. We don't need to persist the value because it\n\t\t// is only used by `diffChildren` to determine where to resume the diff\n\t\t// after diffing Components and Fragments. Once we store it the nextDOM\n\t\t// local var, we can clean up the property. Also prevents us hanging on to\n\t\t// DOM nodes that may have been unmounted.\n\t\tchildVNode._nextDom = undefined;\n\n\t\t// Unset diffing flags\n\t\tchildVNode._flags &= ~(INSERT_VNODE | MATCHED);\n\t}\n\n\t// TODO: With new child diffing algo, consider alt ways to diff Fragments.\n\t// Such as dropping oldDom and moving fragments in place\n\t//\n\t// Because the newParentVNode is Fragment-like, we need to set it's\n\t// _nextDom property to the nextSibling of its last child DOM node.\n\t//\n\t// `oldDom` contains the correct value here because if the last child\n\t// is a Fragment-like, then oldDom has already been set to that child's _nextDom.\n\t// If the last child is a DOM VNode, then oldDom will be set to that DOM\n\t// node's nextSibling.\n\tnewParentVNode._nextDom = oldDom;\n\tnewParentVNode._dom = firstChildDom;\n}\n\n/**\n * @param {VNode} newParentVNode\n * @param {ComponentChildren[]} renderResult\n * @param {VNode[]} oldChildren\n */\nfunction constructNewChildrenArray(newParentVNode, renderResult, oldChildren) {\n\t/** @type {number} */\n\tlet i;\n\t/** @type {VNode} */\n\tlet childVNode;\n\t/** @type {VNode} */\n\tlet oldVNode;\n\n\tconst newChildrenLength = renderResult.length;\n\tlet oldChildrenLength = oldChildren.length,\n\t\tremainingOldChildren = oldChildrenLength;\n\n\tlet skew = 0;\n\n\tnewParentVNode._children = [];\n\tfor (i = 0; i < newChildrenLength; i++) {\n\t\t// @ts-expect-error We are reusing the childVNode variable to hold both the\n\t\t// pre and post normalized childVNode\n\t\tchildVNode = renderResult[i];\n\n\t\tif (\n\t\t\tchildVNode == null ||\n\t\t\ttypeof childVNode == 'boolean' ||\n\t\t\ttypeof childVNode == 'function'\n\t\t) {\n\t\t\tchildVNode = newParentVNode._children[i] = null;\n\t\t\tcontinue;\n\t\t}\n\t\t// If this newVNode is being reused (e.g. <div>{reuse}{reuse}</div>) in the same diff,\n\t\t// or we are rendering a component (e.g. setState) copy the oldVNodes so it can have\n\t\t// it's own DOM & etc. pointers\n\t\telse if (\n\t\t\ttypeof childVNode == 'string' ||\n\t\t\ttypeof childVNode == 'number' ||\n\t\t\t// eslint-disable-next-line valid-typeof\n\t\t\ttypeof childVNode == 'bigint' ||\n\t\t\tchildVNode.constructor == String\n\t\t) {\n\t\t\tchildVNode = newParentVNode._children[i] = createVNode(\n\t\t\t\tnull,\n\t\t\t\tchildVNode,\n\t\t\t\tnull,\n\t\t\t\tnull,\n\t\t\t\tnull\n\t\t\t);\n\t\t} else if (isArray(childVNode)) {\n\t\t\tchildVNode = newParentVNode._children[i] = createVNode(\n\t\t\t\tFragment,\n\t\t\t\t{ children: childVNode },\n\t\t\t\tnull,\n\t\t\t\tnull,\n\t\t\t\tnull\n\t\t\t);\n\t\t} else if (childVNode.constructor === undefined && childVNode._depth > 0) {\n\t\t\t// VNode is already in use, clone it. This can happen in the following\n\t\t\t// scenario:\n\t\t\t//   const reuse = <div />\n\t\t\t//   <div>{reuse}<span />{reuse}</div>\n\t\t\tchildVNode = newParentVNode._children[i] = createVNode(\n\t\t\t\tchildVNode.type,\n\t\t\t\tchildVNode.props,\n\t\t\t\tchildVNode.key,\n\t\t\t\tchildVNode.ref ? childVNode.ref : null,\n\t\t\t\tchildVNode._original\n\t\t\t);\n\t\t} else {\n\t\t\tchildVNode = newParentVNode._children[i] = childVNode;\n\t\t}\n\n\t\tconst skewedIndex = i + skew;\n\t\tchildVNode._parent = newParentVNode;\n\t\tchildVNode._depth = newParentVNode._depth + 1;\n\n\t\t// Temporarily store the matchingIndex on the _index property so we can pull\n\t\t// out the oldVNode in diffChildren. We'll override this to the VNode's\n\t\t// final index after using this property to get the oldVNode\n\t\tconst matchingIndex = (childVNode._index = findMatchingIndex(\n\t\t\tchildVNode,\n\t\t\toldChildren,\n\t\t\tskewedIndex,\n\t\t\tremainingOldChildren\n\t\t));\n\n\t\toldVNode = null;\n\t\tif (matchingIndex !== -1) {\n\t\t\toldVNode = oldChildren[matchingIndex];\n\t\t\tremainingOldChildren--;\n\t\t\tif (oldVNode) {\n\t\t\t\toldVNode._flags |= MATCHED;\n\t\t\t}\n\t\t}\n\n\t\t// Here, we define isMounting for the purposes of the skew diffing\n\t\t// algorithm. Nodes that are unsuspending are considered mounting and we detect\n\t\t// this by checking if oldVNode._original === null\n\t\tconst isMounting = oldVNode == null || oldVNode._original === null;\n\n\t\tif (isMounting) {\n\t\t\tif (matchingIndex == -1) {\n\t\t\t\tskew--;\n\t\t\t}\n\n\t\t\t// If we are mounting a DOM VNode, mark it for insertion\n\t\t\tif (typeof childVNode.type != 'function') {\n\t\t\t\tchildVNode._flags |= INSERT_VNODE;\n\t\t\t}\n\t\t} else if (matchingIndex !== skewedIndex) {\n\t\t\t// When we move elements around i.e. [0, 1, 2] --> [1, 0, 2]\n\t\t\t// --> we diff 1, we find it at position 1 while our skewed index is 0 and our skew is 0\n\t\t\t//     we set the skew to 1 as we found an offset.\n\t\t\t// --> we diff 0, we find it at position 0 while our skewed index is at 2 and our skew is 1\n\t\t\t//     this makes us increase the skew again.\n\t\t\t// --> we diff 2, we find it at position 2 while our skewed index is at 4 and our skew is 2\n\t\t\t//\n\t\t\t// this becomes an optimization question where currently we see a 1 element offset as an insertion\n\t\t\t// or deletion i.e. we optimize for [0, 1, 2] --> [9, 0, 1, 2]\n\t\t\t// while a more than 1 offset we see as a swap.\n\t\t\t// We could probably build heuristics for having an optimized course of action here as well, but\n\t\t\t// might go at the cost of some bytes.\n\t\t\t//\n\t\t\t// If we wanted to optimize for i.e. only swaps we'd just do the last two code-branches and have\n\t\t\t// only the first item be a re-scouting and all the others fall in their skewed counter-part.\n\t\t\t// We could also further optimize for swaps\n\t\t\tif (matchingIndex == skewedIndex - 1) {\n\t\t\t\tskew--;\n\t\t\t} else if (matchingIndex == skewedIndex + 1) {\n\t\t\t\tskew++;\n\t\t\t} else {\n\t\t\t\tif (matchingIndex > skewedIndex) {\n\t\t\t\t\tskew--;\n\t\t\t\t} else {\n\t\t\t\t\tskew++;\n\t\t\t\t}\n\n\t\t\t\t// Move this VNode's DOM if the original index (matchingIndex) doesn't\n\t\t\t\t// match the new skew index (i + new skew)\n\t\t\t\t// In the former two branches we know that it matches after skewing\n\t\t\t\tchildVNode._flags |= INSERT_VNODE;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Remove remaining oldChildren if there are any. Loop forwards so that as we\n\t// unmount DOM from the beginning of the oldChildren, we can adjust oldDom to\n\t// point to the next child, which needs to be the first DOM node that won't be\n\t// unmounted.\n\tif (remainingOldChildren) {\n\t\tfor (i = 0; i < oldChildrenLength; i++) {\n\t\t\toldVNode = oldChildren[i];\n\t\t\tif (oldVNode != null && (oldVNode._flags & MATCHED) === 0) {\n\t\t\t\tif (oldVNode._dom == newParentVNode._nextDom) {\n\t\t\t\t\tnewParentVNode._nextDom = getDomSibling(oldVNode);\n\t\t\t\t}\n\n\t\t\t\tunmount(oldVNode, oldVNode);\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * @param {VNode} parentVNode\n * @param {PreactElement} oldDom\n * @param {PreactElement} parentDom\n * @returns {PreactElement}\n */\nfunction insert(parentVNode, oldDom, parentDom) {\n\t// Note: VNodes in nested suspended trees may be missing _children.\n\n\tif (typeof parentVNode.type == 'function') {\n\t\tlet children = parentVNode._children;\n\t\tfor (let i = 0; children && i < children.length; i++) {\n\t\t\tif (children[i]) {\n\t\t\t\t// If we enter this code path on sCU bailout, where we copy\n\t\t\t\t// oldVNode._children to newVNode._children, we need to update the old\n\t\t\t\t// children's _parent pointer to point to the newVNode (parentVNode\n\t\t\t\t// here).\n\t\t\t\tchildren[i]._parent = parentVNode;\n\t\t\t\toldDom = insert(children[i], oldDom, parentDom);\n\t\t\t}\n\t\t}\n\n\t\treturn oldDom;\n\t} else if (parentVNode._dom != oldDom) {\n\t\tif (oldDom && parentVNode.type && !parentDom.contains(oldDom)) {\n\t\t\toldDom = getDomSibling(parentVNode);\n\t\t}\n\t\tparentDom.insertBefore(parentVNode._dom, oldDom || null);\n\t\toldDom = parentVNode._dom;\n\t}\n\n\tdo {\n\t\toldDom = oldDom && oldDom.nextSibling;\n\t} while (oldDom != null && oldDom.nodeType === 8);\n\n\treturn oldDom;\n}\n\n/**\n * Flatten and loop through the children of a virtual node\n * @param {ComponentChildren} children The unflattened children of a virtual\n * node\n * @returns {VNode[]}\n */\nexport function toChildArray(children, out) {\n\tout = out || [];\n\tif (children == null || typeof children == 'boolean') {\n\t} else if (isArray(children)) {\n\t\tchildren.some(child => {\n\t\t\ttoChildArray(child, out);\n\t\t});\n\t} else {\n\t\tout.push(children);\n\t}\n\treturn out;\n}\n\n/**\n * @param {VNode} childVNode\n * @param {VNode[]} oldChildren\n * @param {number} skewedIndex\n * @param {number} remainingOldChildren\n * @returns {number}\n */\nfunction findMatchingIndex(\n\tchildVNode,\n\toldChildren,\n\tskewedIndex,\n\tremainingOldChildren\n) {\n\tconst key = childVNode.key;\n\tconst type = childVNode.type;\n\tlet x = skewedIndex - 1;\n\tlet y = skewedIndex + 1;\n\tlet oldVNode = oldChildren[skewedIndex];\n\n\t// We only need to perform a search if there are more children\n\t// (remainingOldChildren) to search. However, if the oldVNode we just looked\n\t// at skewedIndex was not already used in this diff, then there must be at\n\t// least 1 other (so greater than 1) remainingOldChildren to attempt to match\n\t// against. So the following condition checks that ensuring\n\t// remainingOldChildren > 1 if the oldVNode is not already used/matched. Else\n\t// if the oldVNode was null or matched, then there could needs to be at least\n\t// 1 (aka `remainingOldChildren > 0`) children to find and compare against.\n\tlet shouldSearch =\n\t\tremainingOldChildren >\n\t\t(oldVNode != null && (oldVNode._flags & MATCHED) === 0 ? 1 : 0);\n\n\tif (\n\t\toldVNode === null ||\n\t\t(oldVNode &&\n\t\t\tkey == oldVNode.key &&\n\t\t\ttype === oldVNode.type &&\n\t\t\t(oldVNode._flags & MATCHED) === 0)\n\t) {\n\t\treturn skewedIndex;\n\t} else if (shouldSearch) {\n\t\twhile (x >= 0 || y < oldChildren.length) {\n\t\t\tif (x >= 0) {\n\t\t\t\toldVNode = oldChildren[x];\n\t\t\t\tif (\n\t\t\t\t\toldVNode &&\n\t\t\t\t\t(oldVNode._flags & MATCHED) === 0 &&\n\t\t\t\t\tkey == oldVNode.key &&\n\t\t\t\t\ttype === oldVNode.type\n\t\t\t\t) {\n\t\t\t\t\treturn x;\n\t\t\t\t}\n\t\t\t\tx--;\n\t\t\t}\n\n\t\t\tif (y < oldChildren.length) {\n\t\t\t\toldVNode = oldChildren[y];\n\t\t\t\tif (\n\t\t\t\t\toldVNode &&\n\t\t\t\t\t(oldVNode._flags & MATCHED) === 0 &&\n\t\t\t\t\tkey == oldVNode.key &&\n\t\t\t\t\ttype === oldVNode.type\n\t\t\t\t) {\n\t\t\t\t\treturn y;\n\t\t\t\t}\n\t\t\t\ty++;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn -1;\n}\n", "import {\n\tEMPTY_OBJ,\n\tMODE_HYDRATE,\n\tMODE_SUSPENDED,\n\tRESET_MODE\n} from '../constants';\nimport { BaseComponent, getDomSibling } from '../component';\nimport { Fragment } from '../create-element';\nimport { diffChildren } from './children';\nimport { setProperty } from './props';\nimport { assign, isArray, removeNode, slice } from '../util';\nimport options from '../options';\n\n/**\n * Diff two virtual nodes and apply proper changes to the DOM\n * @param {PreactElement} parentDom The parent of the DOM element\n * @param {VNode} newVNode The new virtual node\n * @param {VNode} oldVNode The old virtual node\n * @param {object} globalContext The current context object. Modified by\n * getChildContext\n * @param {string} namespace Current namespace of the DOM node (HTML, SVG, or MathML)\n * @param {Array<PreactElement>} excessDomChildren\n * @param {Array<Component>} commitQueue List of components which have callbacks\n * to invoke in commitRoot\n * @param {PreactElement} oldDom The current attached DOM element any new dom\n * elements should be placed around. Likely `null` on first render (except when\n * hydrating). Can be a sibling DOM element when diffing Fragments that have\n * siblings. In most cases, it starts out as `oldChildren[0]._dom`.\n * @param {boolean} isHydrating Whether or not we are in hydration\n * @param {any[]} refQueue an array of elements needed to invoke refs\n */\nexport function diff(\n\tparentDom,\n\tnewVNode,\n\toldVNode,\n\tglobalContext,\n\tnamespace,\n\texcessDomChildren,\n\tcommitQueue,\n\toldDom,\n\tisHydrating,\n\trefQueue\n) {\n\t/** @type {any} */\n\tlet tmp,\n\t\tnewType = newVNode.type;\n\n\t// When passing through createElement it assigns the object\n\t// constructor as undefined. This to prevent JSON-injection.\n\tif (newVNode.constructor !== undefined) return null;\n\n\t// If the previous diff bailed out, resume creating/hydrating.\n\tif (oldVNode._flags & MODE_SUSPENDED) {\n\t\tisHydrating = !!(oldVNode._flags & MODE_HYDRATE);\n\t\toldDom = newVNode._dom = oldVNode._dom;\n\t\texcessDomChildren = [oldDom];\n\t}\n\n\tif ((tmp = options._diff)) tmp(newVNode);\n\n\touter: if (typeof newType == 'function') {\n\t\ttry {\n\t\t\tlet c, isNew, oldProps, oldState, snapshot, clearProcessingException;\n\t\t\tlet newProps = newVNode.props;\n\t\t\tconst isClassComponent =\n\t\t\t\t'prototype' in newType && newType.prototype.render;\n\n\t\t\t// Necessary for createContext api. Setting this property will pass\n\t\t\t// the context value as `this.context` just for this component.\n\t\t\ttmp = newType.contextType;\n\t\t\tlet provider = tmp && globalContext[tmp._id];\n\t\t\tlet componentContext = tmp\n\t\t\t\t? provider\n\t\t\t\t\t? provider.props.value\n\t\t\t\t\t: tmp._defaultValue\n\t\t\t\t: globalContext;\n\n\t\t\t// Get component and set it to `c`\n\t\t\tif (oldVNode._component) {\n\t\t\t\tc = newVNode._component = oldVNode._component;\n\t\t\t\tclearProcessingException = c._processingException = c._pendingError;\n\t\t\t} else {\n\t\t\t\t// Instantiate the new component\n\t\t\t\tif (isClassComponent) {\n\t\t\t\t\t// @ts-expect-error The check above verifies that newType is suppose to be constructed\n\t\t\t\t\tnewVNode._component = c = new newType(newProps, componentContext); // eslint-disable-line new-cap\n\t\t\t\t} else {\n\t\t\t\t\t// @ts-expect-error Trust me, Component implements the interface we want\n\t\t\t\t\tnewVNode._component = c = new BaseComponent(\n\t\t\t\t\t\tnewProps,\n\t\t\t\t\t\tcomponentContext\n\t\t\t\t\t);\n\t\t\t\t\tc.constructor = newType;\n\t\t\t\t\tc.render = doRender;\n\t\t\t\t}\n\t\t\t\tif (provider) provider.sub(c);\n\n\t\t\t\tc.props = newProps;\n\t\t\t\tif (!c.state) c.state = {};\n\t\t\t\tc.context = componentContext;\n\t\t\t\tc._globalContext = globalContext;\n\t\t\t\tisNew = c._dirty = true;\n\t\t\t\tc._renderCallbacks = [];\n\t\t\t\tc._stateCallbacks = [];\n\t\t\t}\n\n\t\t\t// Invoke getDerivedStateFromProps\n\t\t\tif (isClassComponent && c._nextState == null) {\n\t\t\t\tc._nextState = c.state;\n\t\t\t}\n\n\t\t\tif (isClassComponent && newType.getDerivedStateFromProps != null) {\n\t\t\t\tif (c._nextState == c.state) {\n\t\t\t\t\tc._nextState = assign({}, c._nextState);\n\t\t\t\t}\n\n\t\t\t\tassign(\n\t\t\t\t\tc._nextState,\n\t\t\t\t\tnewType.getDerivedStateFromProps(newProps, c._nextState)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\toldProps = c.props;\n\t\t\toldState = c.state;\n\t\t\tc._vnode = newVNode;\n\n\t\t\t// Invoke pre-render lifecycle methods\n\t\t\tif (isNew) {\n\t\t\t\tif (\n\t\t\t\t\tisClassComponent &&\n\t\t\t\t\tnewType.getDerivedStateFromProps == null &&\n\t\t\t\t\tc.componentWillMount != null\n\t\t\t\t) {\n\t\t\t\t\tc.componentWillMount();\n\t\t\t\t}\n\n\t\t\t\tif (isClassComponent && c.componentDidMount != null) {\n\t\t\t\t\tc._renderCallbacks.push(c.componentDidMount);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (\n\t\t\t\t\tisClassComponent &&\n\t\t\t\t\tnewType.getDerivedStateFromProps == null &&\n\t\t\t\t\tnewProps !== oldProps &&\n\t\t\t\t\tc.componentWillReceiveProps != null\n\t\t\t\t) {\n\t\t\t\t\tc.componentWillReceiveProps(newProps, componentContext);\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\t!c._force &&\n\t\t\t\t\t((c.shouldComponentUpdate != null &&\n\t\t\t\t\t\tc.shouldComponentUpdate(\n\t\t\t\t\t\t\tnewProps,\n\t\t\t\t\t\t\tc._nextState,\n\t\t\t\t\t\t\tcomponentContext\n\t\t\t\t\t\t) === false) ||\n\t\t\t\t\t\tnewVNode._original === oldVNode._original)\n\t\t\t\t) {\n\t\t\t\t\t// More info about this here: https://gist.github.com/JoviDeCroock/bec5f2ce93544d2e6070ef8e0036e4e8\n\t\t\t\t\tif (newVNode._original !== oldVNode._original) {\n\t\t\t\t\t\t// When we are dealing with a bail because of sCU we have to update\n\t\t\t\t\t\t// the props, state and dirty-state.\n\t\t\t\t\t\t// when we are dealing with strict-equality we don't as the child could still\n\t\t\t\t\t\t// be dirtied see #3883\n\t\t\t\t\t\tc.props = newProps;\n\t\t\t\t\t\tc.state = c._nextState;\n\t\t\t\t\t\tc._dirty = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tnewVNode._dom = oldVNode._dom;\n\t\t\t\t\tnewVNode._children = oldVNode._children;\n\t\t\t\t\tnewVNode._children.some(vnode => {\n\t\t\t\t\t\tif (vnode) vnode._parent = newVNode;\n\t\t\t\t\t});\n\n\t\t\t\t\tfor (let i = 0; i < c._stateCallbacks.length; i++) {\n\t\t\t\t\t\tc._renderCallbacks.push(c._stateCallbacks[i]);\n\t\t\t\t\t}\n\t\t\t\t\tc._stateCallbacks = [];\n\n\t\t\t\t\tif (c._renderCallbacks.length) {\n\t\t\t\t\t\tcommitQueue.push(c);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak outer;\n\t\t\t\t}\n\n\t\t\t\tif (c.componentWillUpdate != null) {\n\t\t\t\t\tc.componentWillUpdate(newProps, c._nextState, componentContext);\n\t\t\t\t}\n\n\t\t\t\tif (isClassComponent && c.componentDidUpdate != null) {\n\t\t\t\t\tc._renderCallbacks.push(() => {\n\t\t\t\t\t\tc.componentDidUpdate(oldProps, oldState, snapshot);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tc.context = componentContext;\n\t\t\tc.props = newProps;\n\t\t\tc._parentDom = parentDom;\n\t\t\tc._force = false;\n\n\t\t\tlet renderHook = options._render,\n\t\t\t\tcount = 0;\n\t\t\tif (isClassComponent) {\n\t\t\t\tc.state = c._nextState;\n\t\t\t\tc._dirty = false;\n\n\t\t\t\tif (renderHook) renderHook(newVNode);\n\n\t\t\t\ttmp = c.render(c.props, c.state, c.context);\n\n\t\t\t\tfor (let i = 0; i < c._stateCallbacks.length; i++) {\n\t\t\t\t\tc._renderCallbacks.push(c._stateCallbacks[i]);\n\t\t\t\t}\n\t\t\t\tc._stateCallbacks = [];\n\t\t\t} else {\n\t\t\t\tdo {\n\t\t\t\t\tc._dirty = false;\n\t\t\t\t\tif (renderHook) renderHook(newVNode);\n\n\t\t\t\t\ttmp = c.render(c.props, c.state, c.context);\n\n\t\t\t\t\t// Handle setState called in render, see #2553\n\t\t\t\t\tc.state = c._nextState;\n\t\t\t\t} while (c._dirty && ++count < 25);\n\t\t\t}\n\n\t\t\t// Handle setState called in render, see #2553\n\t\t\tc.state = c._nextState;\n\n\t\t\tif (c.getChildContext != null) {\n\t\t\t\tglobalContext = assign(assign({}, globalContext), c.getChildContext());\n\t\t\t}\n\n\t\t\tif (isClassComponent && !isNew && c.getSnapshotBeforeUpdate != null) {\n\t\t\t\tsnapshot = c.getSnapshotBeforeUpdate(oldProps, oldState);\n\t\t\t}\n\n\t\t\tlet isTopLevelFragment =\n\t\t\t\ttmp != null && tmp.type === Fragment && tmp.key == null;\n\t\t\tlet renderResult = isTopLevelFragment ? tmp.props.children : tmp;\n\n\t\t\tdiffChildren(\n\t\t\t\tparentDom,\n\t\t\t\tisArray(renderResult) ? renderResult : [renderResult],\n\t\t\t\tnewVNode,\n\t\t\t\toldVNode,\n\t\t\t\tglobalContext,\n\t\t\t\tnamespace,\n\t\t\t\texcessDomChildren,\n\t\t\t\tcommitQueue,\n\t\t\t\toldDom,\n\t\t\t\tisHydrating,\n\t\t\t\trefQueue\n\t\t\t);\n\n\t\t\tc.base = newVNode._dom;\n\n\t\t\t// We successfully rendered this VNode, unset any stored hydration/bailout state:\n\t\t\tnewVNode._flags &= RESET_MODE;\n\n\t\t\tif (c._renderCallbacks.length) {\n\t\t\t\tcommitQueue.push(c);\n\t\t\t}\n\n\t\t\tif (clearProcessingException) {\n\t\t\t\tc._pendingError = c._processingException = null;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tnewVNode._original = null;\n\t\t\t// if hydrating or creating initial tree, bailout preserves DOM:\n\t\t\tif (isHydrating || excessDomChildren != null) {\n\t\t\t\tnewVNode._flags |= isHydrating\n\t\t\t\t\t? MODE_HYDRATE | MODE_SUSPENDED\n\t\t\t\t\t: MODE_SUSPENDED;\n\n\t\t\t\twhile (oldDom && oldDom.nodeType === 8 && oldDom.nextSibling) {\n\t\t\t\t\toldDom = oldDom.nextSibling;\n\t\t\t\t}\n\t\t\t\texcessDomChildren[excessDomChildren.indexOf(oldDom)] = null;\n\t\t\t\tnewVNode._dom = oldDom;\n\t\t\t} else {\n\t\t\t\tnewVNode._dom = oldVNode._dom;\n\t\t\t\tnewVNode._children = oldVNode._children;\n\t\t\t}\n\t\t\toptions._catchError(e, newVNode, oldVNode);\n\t\t}\n\t} else if (\n\t\texcessDomChildren == null &&\n\t\tnewVNode._original === oldVNode._original\n\t) {\n\t\tnewVNode._children = oldVNode._children;\n\t\tnewVNode._dom = oldVNode._dom;\n\t} else {\n\t\tnewVNode._dom = diffElementNodes(\n\t\t\toldVNode._dom,\n\t\t\tnewVNode,\n\t\t\toldVNode,\n\t\t\tglobalContext,\n\t\t\tnamespace,\n\t\t\texcessDomChildren,\n\t\t\tcommitQueue,\n\t\t\tisHydrating,\n\t\t\trefQueue\n\t\t);\n\t}\n\n\tif ((tmp = options.diffed)) tmp(newVNode);\n}\n\n/**\n * @param {Array<Component>} commitQueue List of components\n * which have callbacks to invoke in commitRoot\n * @param {VNode} root\n */\nexport function commitRoot(commitQueue, root, refQueue) {\n\troot._nextDom = undefined;\n\n\tfor (let i = 0; i < refQueue.length; i++) {\n\t\tapplyRef(refQueue[i], refQueue[++i], refQueue[++i]);\n\t}\n\n\tif (options._commit) options._commit(root, commitQueue);\n\n\tcommitQueue.some(c => {\n\t\ttry {\n\t\t\t// @ts-expect-error Reuse the commitQueue variable here so the type changes\n\t\t\tcommitQueue = c._renderCallbacks;\n\t\t\tc._renderCallbacks = [];\n\t\t\tcommitQueue.some(cb => {\n\t\t\t\t// @ts-expect-error See above comment on commitQueue\n\t\t\t\tcb.call(c);\n\t\t\t});\n\t\t} catch (e) {\n\t\t\toptions._catchError(e, c._vnode);\n\t\t}\n\t});\n}\n\n/**\n * Diff two virtual nodes representing DOM element\n * @param {PreactElement} dom The DOM element representing the virtual nodes\n * being diffed\n * @param {VNode} newVNode The new virtual node\n * @param {VNode} oldVNode The old virtual node\n * @param {object} globalContext The current context object\n * @param {string} namespace Current namespace of the DOM node (HTML, SVG, or MathML)\n * @param {Array<PreactElement>} excessDomChildren\n * @param {Array<Component>} commitQueue List of components which have callbacks\n * to invoke in commitRoot\n * @param {boolean} isHydrating Whether or not we are in hydration\n * @param {any[]} refQueue an array of elements needed to invoke refs\n * @returns {PreactElement}\n */\nfunction diffElementNodes(\n\tdom,\n\tnewVNode,\n\toldVNode,\n\tglobalContext,\n\tnamespace,\n\texcessDomChildren,\n\tcommitQueue,\n\tisHydrating,\n\trefQueue\n) {\n\tlet oldProps = oldVNode.props;\n\tlet newProps = newVNode.props;\n\tlet nodeType = /** @type {string} */ (newVNode.type);\n\t/** @type {any} */\n\tlet i;\n\t/** @type {{ __html?: string }} */\n\tlet newHtml;\n\t/** @type {{ __html?: string }} */\n\tlet oldHtml;\n\t/** @type {ComponentChildren} */\n\tlet newChildren;\n\tlet value;\n\tlet inputValue;\n\tlet checked;\n\n\t// Tracks entering and exiting namespaces when descending through the tree.\n\tif (nodeType === 'svg') namespace = 'http://www.w3.org/2000/svg';\n\telse if (nodeType === 'math')\n\t\tnamespace = 'http://www.w3.org/1998/Math/MathML';\n\telse if (!namespace) namespace = 'http://www.w3.org/1999/xhtml';\n\n\tif (excessDomChildren != null) {\n\t\tfor (i = 0; i < excessDomChildren.length; i++) {\n\t\t\tvalue = excessDomChildren[i];\n\n\t\t\t// if newVNode matches an element in excessDomChildren or the `dom`\n\t\t\t// argument matches an element in excessDomChildren, remove it from\n\t\t\t// excessDomChildren so it isn't later removed in diffChildren\n\t\t\tif (\n\t\t\t\tvalue &&\n\t\t\t\t'setAttribute' in value === !!nodeType &&\n\t\t\t\t(nodeType ? value.localName === nodeType : value.nodeType === 3)\n\t\t\t) {\n\t\t\t\tdom = value;\n\t\t\t\texcessDomChildren[i] = null;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (dom == null) {\n\t\tif (nodeType === null) {\n\t\t\treturn document.createTextNode(newProps);\n\t\t}\n\n\t\tdom = document.createElementNS(\n\t\t\tnamespace,\n\t\t\tnodeType,\n\t\t\tnewProps.is && newProps\n\t\t);\n\n\t\t// we are creating a new node, so we can assume this is a new subtree (in\n\t\t// case we are hydrating), this deopts the hydrate\n\t\tif (isHydrating) {\n\t\t\tif (options._hydrationMismatch)\n\t\t\t\toptions._hydrationMismatch(newVNode, excessDomChildren);\n\t\t\tisHydrating = false;\n\t\t}\n\t\t// we created a new parent, so none of the previously attached children can be reused:\n\t\texcessDomChildren = null;\n\t}\n\n\tif (nodeType === null) {\n\t\t// During hydration, we still have to split merged text from SSR'd HTML.\n\t\tif (oldProps !== newProps && (!isHydrating || dom.data !== newProps)) {\n\t\t\tdom.data = newProps;\n\t\t}\n\t} else {\n\t\t// If excessDomChildren was not null, repopulate it with the current element's children:\n\t\texcessDomChildren = excessDomChildren && slice.call(dom.childNodes);\n\n\t\toldProps = oldVNode.props || EMPTY_OBJ;\n\n\t\t// If we are in a situation where we are not hydrating but are using\n\t\t// existing DOM (e.g. replaceNode) we should read the existing DOM\n\t\t// attributes to diff them\n\t\tif (!isHydrating && excessDomChildren != null) {\n\t\t\toldProps = {};\n\t\t\tfor (i = 0; i < dom.attributes.length; i++) {\n\t\t\t\tvalue = dom.attributes[i];\n\t\t\t\toldProps[value.name] = value.value;\n\t\t\t}\n\t\t}\n\n\t\tfor (i in oldProps) {\n\t\t\tvalue = oldProps[i];\n\t\t\tif (i == 'children') {\n\t\t\t} else if (i == 'dangerouslySetInnerHTML') {\n\t\t\t\toldHtml = value;\n\t\t\t} else if (!(i in newProps)) {\n\t\t\t\tif (\n\t\t\t\t\t(i == 'value' && 'defaultValue' in newProps) ||\n\t\t\t\t\t(i == 'checked' && 'defaultChecked' in newProps)\n\t\t\t\t) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tsetProperty(dom, i, null, value, namespace);\n\t\t\t}\n\t\t}\n\n\t\t// During hydration, props are not diffed at all (including dangerouslySetInnerHTML)\n\t\t// @TODO we should warn in debug mode when props don't match here.\n\t\tfor (i in newProps) {\n\t\t\tvalue = newProps[i];\n\t\t\tif (i == 'children') {\n\t\t\t\tnewChildren = value;\n\t\t\t} else if (i == 'dangerouslySetInnerHTML') {\n\t\t\t\tnewHtml = value;\n\t\t\t} else if (i == 'value') {\n\t\t\t\tinputValue = value;\n\t\t\t} else if (i == 'checked') {\n\t\t\t\tchecked = value;\n\t\t\t} else if (\n\t\t\t\t(!isHydrating || typeof value == 'function') &&\n\t\t\t\toldProps[i] !== value\n\t\t\t) {\n\t\t\t\tsetProperty(dom, i, value, oldProps[i], namespace);\n\t\t\t}\n\t\t}\n\n\t\t// If the new vnode didn't have dangerouslySetInnerHTML, diff its children\n\t\tif (newHtml) {\n\t\t\t// Avoid re-applying the same '__html' if it did not changed between re-render\n\t\t\tif (\n\t\t\t\t!isHydrating &&\n\t\t\t\t(!oldHtml ||\n\t\t\t\t\t(newHtml.__html !== oldHtml.__html &&\n\t\t\t\t\t\tnewHtml.__html !== dom.innerHTML))\n\t\t\t) {\n\t\t\t\tdom.innerHTML = newHtml.__html;\n\t\t\t}\n\n\t\t\tnewVNode._children = [];\n\t\t} else {\n\t\t\tif (oldHtml) dom.innerHTML = '';\n\n\t\t\tdiffChildren(\n\t\t\t\tdom,\n\t\t\t\tisArray(newChildren) ? newChildren : [newChildren],\n\t\t\t\tnewVNode,\n\t\t\t\toldVNode,\n\t\t\t\tglobalContext,\n\t\t\t\tnodeType === 'foreignObject'\n\t\t\t\t\t? 'http://www.w3.org/1999/xhtml'\n\t\t\t\t\t: namespace,\n\t\t\t\texcessDomChildren,\n\t\t\t\tcommitQueue,\n\t\t\t\texcessDomChildren\n\t\t\t\t\t? excessDomChildren[0]\n\t\t\t\t\t: oldVNode._children && getDomSibling(oldVNode, 0),\n\t\t\t\tisHydrating,\n\t\t\t\trefQueue\n\t\t\t);\n\n\t\t\t// Remove children that are not part of any vnode.\n\t\t\tif (excessDomChildren != null) {\n\t\t\t\tfor (i = excessDomChildren.length; i--; ) {\n\t\t\t\t\tremoveNode(excessDomChildren[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// As above, don't diff props during hydration\n\t\tif (!isHydrating) {\n\t\t\ti = 'value';\n\t\t\tif (nodeType === 'progress' && inputValue == null) {\n\t\t\t\tdom.removeAttribute('value');\n\t\t\t} else if (\n\t\t\t\tinputValue !== undefined &&\n\t\t\t\t// #2756 For the <progress>-element the initial value is 0,\n\t\t\t\t// despite the attribute not being present. When the attribute\n\t\t\t\t// is missing the progress bar is treated as indeterminate.\n\t\t\t\t// To fix that we'll always update it when it is 0 for progress elements\n\t\t\t\t(inputValue !== dom[i] ||\n\t\t\t\t\t(nodeType === 'progress' && !inputValue) ||\n\t\t\t\t\t// This is only for IE 11 to fix <select> value not being updated.\n\t\t\t\t\t// To avoid a stale select value we need to set the option.value\n\t\t\t\t\t// again, which triggers IE11 to re-evaluate the select value\n\t\t\t\t\t(nodeType === 'option' && inputValue !== oldProps[i]))\n\t\t\t) {\n\t\t\t\tsetProperty(dom, i, inputValue, oldProps[i], namespace);\n\t\t\t}\n\n\t\t\ti = 'checked';\n\t\t\tif (checked !== undefined && checked !== dom[i]) {\n\t\t\t\tsetProperty(dom, i, checked, oldProps[i], namespace);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn dom;\n}\n\n/**\n * Invoke or update a ref, depending on whether it is a function or object ref.\n * @param {Ref<any> & { _unmount?: unknown }} ref\n * @param {any} value\n * @param {VNode} vnode\n */\nexport function applyRef(ref, value, vnode) {\n\ttry {\n\t\tif (typeof ref == 'function') {\n\t\t\tlet hasRefUnmount = typeof ref._unmount == 'function';\n\t\t\tif (hasRefUnmount) {\n\t\t\t\t// @ts-ignore TS doesn't like moving narrowing checks into variables\n\t\t\t\tref._unmount();\n\t\t\t}\n\n\t\t\tif (!hasRefUnmount || value != null) {\n\t\t\t\t// Store the cleanup function on the function\n\t\t\t\t// instance object itself to avoid shape\n\t\t\t\t// transitioning vnode\n\t\t\t\tref._unmount = ref(value);\n\t\t\t}\n\t\t} else ref.current = value;\n\t} catch (e) {\n\t\toptions._catchError(e, vnode);\n\t}\n}\n\n/**\n * Unmount a virtual node from the tree and apply DOM changes\n * @param {VNode} vnode The virtual node to unmount\n * @param {VNode} parentVNode The parent of the VNode that initiated the unmount\n * @param {boolean} [skipRemove] Flag that indicates that a parent node of the\n * current element is already detached from the DOM.\n */\nexport function unmount(vnode, parentVNode, skipRemove) {\n\tlet r;\n\tif (options.unmount) options.unmount(vnode);\n\n\tif ((r = vnode.ref)) {\n\t\tif (!r.current || r.current === vnode._dom) {\n\t\t\tapplyRef(r, null, parentVNode);\n\t\t}\n\t}\n\n\tif ((r = vnode._component) != null) {\n\t\tif (r.componentWillUnmount) {\n\t\t\ttry {\n\t\t\t\tr.componentWillUnmount();\n\t\t\t} catch (e) {\n\t\t\t\toptions._catchError(e, parentVNode);\n\t\t\t}\n\t\t}\n\n\t\tr.base = r._parentDom = null;\n\t}\n\n\tif ((r = vnode._children)) {\n\t\tfor (let i = 0; i < r.length; i++) {\n\t\t\tif (r[i]) {\n\t\t\t\tunmount(\n\t\t\t\t\tr[i],\n\t\t\t\t\tparentVNode,\n\t\t\t\t\tskipRemove || typeof vnode.type != 'function'\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!skipRemove) {\n\t\tremoveNode(vnode._dom);\n\t}\n\n\t// Must be set to `undefined` to properly clean up `_nextDom`\n\t// for which `null` is a valid value. See comment in `create-element.js`\n\tvnode._component = vnode._parent = vnode._dom = vnode._nextDom = undefined;\n}\n\n/** The `.render()` method for a PFC backing instance. */\nfunction doRender(props, state, context) {\n\treturn this.constructor(props, context);\n}\n", "import { EMPTY_OBJ } from './constants';\nimport { commitRoot, diff } from './diff/index';\nimport { createElement, Fragment } from './create-element';\nimport options from './options';\nimport { slice } from './util';\n\n/**\n * Render a Preact virtual node into a DOM element\n * @param {ComponentChild} vnode The virtual node to render\n * @param {PreactElement} parentDom The DOM element to render into\n * @param {PreactElement | object} [replaceNode] Optional: Attempt to re-use an\n * existing DOM tree rooted at `replaceNode`\n */\nexport function render(vnode, parentDom, replaceNode) {\n\tif (options._root) options._root(vnode, parentDom);\n\n\t// We abuse the `replaceNode` parameter in `hydrate()` to signal if we are in\n\t// hydration mode or not by passing the `hydrate` function instead of a DOM\n\t// element..\n\tlet isHydrating = typeof replaceNode == 'function';\n\n\t// To be able to support calling `render()` multiple times on the same\n\t// DOM node, we need to obtain a reference to the previous tree. We do\n\t// this by assigning a new `_children` property to DOM nodes which points\n\t// to the last rendered tree. By default this property is not present, which\n\t// means that we are mounting a new tree for the first time.\n\tlet oldVNode = isHydrating\n\t\t? null\n\t\t: (replaceNode && replaceNode._children) || parentDom._children;\n\n\tvnode = ((!isHydrating && replaceNode) || parentDom)._children =\n\t\tcreateElement(Fragment, null, [vnode]);\n\n\t// List of effects that need to be called after diffing.\n\tlet commitQueue = [],\n\t\trefQueue = [];\n\tdiff(\n\t\tparentDom,\n\t\t// Determine the new vnode tree and store it on the DOM element on\n\t\t// our custom `_children` property.\n\t\tvnode,\n\t\toldVNode || EMPTY_OBJ,\n\t\tEMPTY_OBJ,\n\t\tparentDom.namespaceURI,\n\t\t!isHydrating && replaceNode\n\t\t\t? [replaceNode]\n\t\t\t: oldVNode\n\t\t\t\t? null\n\t\t\t\t: parentDom.firstChild\n\t\t\t\t\t? slice.call(parentDom.childNodes)\n\t\t\t\t\t: null,\n\t\tcommitQueue,\n\t\t!isHydrating && replaceNode\n\t\t\t? replaceNode\n\t\t\t: oldVNode\n\t\t\t\t? oldVNode._dom\n\t\t\t\t: parentDom.firstChild,\n\t\tisHydrating,\n\t\trefQueue\n\t);\n\n\t// Flush all queued effects\n\tcommitRoot(commitQueue, vnode, refQueue);\n}\n\n/**\n * Update an existing DOM element with data from a Preact virtual node\n * @param {ComponentChild} vnode The virtual node to render\n * @param {PreactElement} parentDom The DOM element to update\n */\nexport function hydrate(vnode, parentDom) {\n\trender(vnode, parentDom, hydrate);\n}\n", "import { assign, slice } from './util';\nimport { createVNode } from './create-element';\n\n/**\n * Clones the given VNode, optionally adding attributes/props and replacing its\n * children.\n * @param {VNode} vnode The virtual DOM element to clone\n * @param {object} props Attributes/props to add when cloning\n * @param {Array<ComponentChildren>} rest Any additional arguments will be used\n * as replacement children.\n * @returns {VNode}\n */\nexport function cloneElement(vnode, props, children) {\n\tlet normalizedProps = assign({}, vnode.props),\n\t\tkey,\n\t\tref,\n\t\ti;\n\n\tlet defaultProps;\n\n\tif (vnode.type && vnode.type.defaultProps) {\n\t\tdefaultProps = vnode.type.defaultProps;\n\t}\n\n\tfor (i in props) {\n\t\tif (i == 'key') key = props[i];\n\t\telse if (i == 'ref') ref = props[i];\n\t\telse if (props[i] === undefined && defaultProps !== undefined) {\n\t\t\tnormalizedProps[i] = defaultProps[i];\n\t\t} else {\n\t\t\tnormalizedProps[i] = props[i];\n\t\t}\n\t}\n\n\tif (arguments.length > 2) {\n\t\tnormalizedProps.children =\n\t\t\targuments.length > 3 ? slice.call(arguments, 2) : children;\n\t}\n\n\treturn createVNode(\n\t\tvnode.type,\n\t\tnormalizedProps,\n\t\tkey || vnode.key,\n\t\tref || vnode.ref,\n\t\tnull\n\t);\n}\n", "/**\n * Find the closest error boundary to a thrown error and call it\n * @param {object} error The thrown value\n * @param {VNode} vnode The vnode that threw the error that was caught (except\n * for unmounting when this parameter is the highest parent that was being\n * unmounted)\n * @param {VNode} [oldVNode]\n * @param {ErrorInfo} [errorInfo]\n */\nexport function _catchError(error, vnode, oldVNode, errorInfo) {\n\t/** @type {Component} */\n\tlet component,\n\t\t/** @type {ComponentType} */\n\t\tctor,\n\t\t/** @type {boolean} */\n\t\thandled;\n\n\tfor (; (vnode = vnode._parent); ) {\n\t\tif ((component = vnode._component) && !component._processingException) {\n\t\t\ttry {\n\t\t\t\tctor = component.constructor;\n\n\t\t\t\tif (ctor && ctor.getDerivedStateFromError != null) {\n\t\t\t\t\tcomponent.setState(ctor.getDerivedStateFromError(error));\n\t\t\t\t\thandled = component._dirty;\n\t\t\t\t}\n\n\t\t\t\tif (component.componentDidCatch != null) {\n\t\t\t\t\tcomponent.componentDidCatch(error, errorInfo || {});\n\t\t\t\t\thandled = component._dirty;\n\t\t\t\t}\n\n\t\t\t\t// This is an error boundary. Mark it as having bailed out, and whether it was mid-hydration.\n\t\t\t\tif (handled) {\n\t\t\t\t\treturn (component._pendingError = component);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\terror = e;\n\t\t\t}\n\t\t}\n\t}\n\n\tthrow error;\n}\n", "export const VOID_ELEMENTS = /^(?:area|base|br|col|embed|hr|img|input|link|meta|param|source|track|wbr)$/;\nexport const UNSAFE_NAME = /[\\s\\n\\\\/='\"\\0<>]/;\nexport const NAMESPACE_REPLACE_REGEX = /^(xlink|xmlns|xml)([A-Z])/;\nexport const HTML_LOWER_CASE = /^accessK|^auto[A-Z]|^cell|^ch|^col|cont|cross|dateT|encT|form[A-Z]|frame|hrefL|inputM|maxL|minL|noV|playsI|popoverT|readO|rowS|src[A-Z]|tabI|useM|item[A-Z]/;\nexport const SVG_CAMEL_CASE = /^ac|^ali|arabic|basel|cap|clipPath$|clipRule$|color|dominant|enable|fill|flood|font|glyph[^R]|horiz|image|letter|lighting|marker[^WUH]|overline|panose|pointe|paint|rendering|shape|stop|strikethrough|stroke|text[^L]|transform|underline|unicode|units|^v[^i]|^w|^xH/;\n\n// Boolean DOM properties that translate to enumerated ('true'/'false') attributes\nexport const HTML_ENUMERATED = new Set(['draggable', 'spellcheck']);\n\n// DOM properties that should NOT have \"px\" added when numeric\nconst ENCODED_ENTITIES = /[\"&<]/;\n\n/** @param {string} str */\nexport function encodeEntities(str) {\n\t// Skip all work for strings with no entities needing encoding:\n\tif (str.length === 0 || ENCODED_ENTITIES.test(str) === false) return str;\n\n\tlet last = 0,\n\t\ti = 0,\n\t\tout = '',\n\t\tch = '';\n\n\t// Seek forward in str until the next entity char:\n\tfor (; i < str.length; i++) {\n\t\tswitch (str.charCodeAt(i)) {\n\t\t\tcase 34:\n\t\t\t\tch = '&quot;';\n\t\t\t\tbreak;\n\t\t\tcase 38:\n\t\t\t\tch = '&amp;';\n\t\t\t\tbreak;\n\t\t\tcase 60:\n\t\t\t\tch = '&lt;';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tcontinue;\n\t\t}\n\t\t// Append skipped/buffered characters and the encoded entity:\n\t\tif (i !== last) out = out + str.slice(last, i);\n\t\tout = out + ch;\n\t\t// Start the next seek/buffer after the entity's offset:\n\t\tlast = i + 1;\n\t}\n\tif (i !== last) out = out + str.slice(last, i);\n\treturn out;\n}\n\nexport let indent = (s, char) =>\n\tString(s).replace(/(\\n+)/g, '$1' + (char || '\\t'));\n\nexport let isLargeString = (s, length, ignoreLines) =>\n\tString(s).length > (length || 40) ||\n\t(!ignoreLines && String(s).indexOf('\\n') !== -1) ||\n\tString(s).indexOf('<') !== -1;\n\nconst JS_TO_CSS = {};\n\nconst IS_NON_DIMENSIONAL = new Set([\n\t'animation-iteration-count',\n\t'border-image-outset',\n\t'border-image-slice',\n\t'border-image-width',\n\t'box-flex',\n\t'box-flex-group',\n\t'box-ordinal-group',\n\t'column-count',\n\t'fill-opacity',\n\t'flex',\n\t'flex-grow',\n\t'flex-negative',\n\t'flex-order',\n\t'flex-positive',\n\t'flex-shrink',\n\t'flood-opacity',\n\t'font-weight',\n\t'grid-column',\n\t'grid-row',\n\t'line-clamp',\n\t'line-height',\n\t'opacity',\n\t'order',\n\t'orphans',\n\t'stop-opacity',\n\t'stroke-dasharray',\n\t'stroke-dashoffset',\n\t'stroke-miterlimit',\n\t'stroke-opacity',\n\t'stroke-width',\n\t'tab-size',\n\t'widows',\n\t'z-index',\n\t'zoom'\n]);\n\nconst CSS_REGEX = /[A-Z]/g;\n// Convert an Object style to a CSSText string\nexport function styleObjToCss(s) {\n\tlet str = '';\n\tfor (let prop in s) {\n\t\tlet val = s[prop];\n\t\tif (val != null && val !== '') {\n\t\t\tconst name =\n\t\t\t\tprop[0] == '-'\n\t\t\t\t\t? prop\n\t\t\t\t\t: JS_TO_CSS[prop] ||\n\t\t\t\t\t  (JS_TO_CSS[prop] = prop.replace(CSS_REGEX, '-$&').toLowerCase());\n\n\t\t\tlet suffix = ';';\n\t\t\tif (\n\t\t\t\ttypeof val === 'number' &&\n\t\t\t\t// Exclude custom-attributes\n\t\t\t\t!name.startsWith('--') &&\n\t\t\t\t!IS_NON_DIMENSIONAL.has(name)\n\t\t\t) {\n\t\t\t\tsuffix = 'px;';\n\t\t\t}\n\t\t\tstr = str + name + ':' + val + suffix;\n\t\t}\n\t}\n\treturn str || undefined;\n}\n\n/**\n * Get flattened children from the children prop\n * @param {Array} accumulator\n * @param {any} children A `props.children` opaque object.\n * @returns {Array} accumulator\n * @private\n */\nexport function getChildren(accumulator, children) {\n\tif (Array.isArray(children)) {\n\t\tchildren.reduce(getChildren, accumulator);\n\t} else if (children != null && children !== false) {\n\t\taccumulator.push(children);\n\t}\n\treturn accumulator;\n}\n\nfunction markAsDirty() {\n\tthis.__d = true;\n}\n\nexport function createComponent(vnode, context) {\n\treturn {\n\t\t__v: vnode,\n\t\tcontext,\n\t\tprops: vnode.props,\n\t\t// silently drop state updates\n\t\tsetState: markAsDirty,\n\t\tforceUpdate: markAsDirty,\n\t\t__d: true,\n\t\t// hooks\n\t\t__h: new Array(0)\n\t};\n}\n\n// Necessary for createContext api. Setting this property will pass\n// the context value as `this.context` just for this component.\nexport function getContext(nodeName, context) {\n\tlet cxType = nodeName.contextType;\n\tlet provider = cxType && context[cxType.__c];\n\treturn cxType != null\n\t\t? provider\n\t\t\t? provider.props.value\n\t\t\t: cxType.__\n\t\t: context;\n}\n\n/**\n * @template T\n */\nexport class Deferred {\n\tconstructor() {\n\t\t// eslint-disable-next-line lines-around-comment\n\t\t/** @type {Promise<T>} */\n\t\tthis.promise = new Promise((resolve, reject) => {\n\t\t\tthis.resolve = resolve;\n\t\t\tthis.reject = reject;\n\t\t});\n\t}\n}\n", "import {\n\tencodeEntities,\n\tstyleObjToCss,\n\tUNSAFE_NAME,\n\tNAMESPACE_REPLACE_REGEX,\n\tHTML_LOWER_CASE,\n\tHTML_ENUMERATED,\n\tSVG_CAMEL_CASE,\n\tcreateComponent\n} from './lib/util.js';\nimport { options, h, Fragment } from 'preact';\nimport {\n\tCHILDREN,\n\tCOMMIT,\n\tCOMPONENT,\n\tDIFF,\n\tDIFFED,\n\tDIRTY,\n\tNEXT_STATE,\n\tPARENT,\n\tRENDER,\n\tSKIP_EFFECTS,\n\tVNODE,\n\tCATCH_ERROR\n} from './lib/constants.js';\n\nconst EMPTY_OBJ = {};\nconst EMPTY_ARR = [];\nconst isArray = Array.isArray;\nconst assign = Object.assign;\nconst EMPTY_STR = '';\n\n// Global state for the current render pass\nlet beforeDiff, afterDiff, renderHook, ummountHook;\n\n/**\n * Render Preact JSX + Components to an HTML string.\n * @param {VNode} vnode\tJSX Element / VNode to render\n * @param {Object} [context={}] Initial root context object\n * @param {RendererState} [_rendererState] for internal use\n * @returns {string} serialized HTML\n */\nexport function renderToString(vnode, context, _rendererState) {\n\t// Performance optimization: `renderToString` is synchronous and we\n\t// therefore don't execute any effects. To do that we pass an empty\n\t// array to `options._commit` (`__c`). But we can go one step further\n\t// and avoid a lot of dirty checks and allocations by setting\n\t// `options._skipEffects` (`__s`) too.\n\tconst previousSkipEffects = options[SKIP_EFFECTS];\n\toptions[SKIP_EFFECTS] = true;\n\n\t// store options hooks once before each synchronous render call\n\tbeforeDiff = options[DIFF];\n\tafterDiff = options[DIFFED];\n\trenderHook = options[RENDER];\n\tummountHook = options.unmount;\n\n\tconst parent = h(Fragment, null);\n\tparent[CHILDREN] = [vnode];\n\n\ttry {\n\t\tconst rendered = _renderToString(\n\t\t\tvnode,\n\t\t\tcontext || EMPTY_OBJ,\n\t\t\tfalse,\n\t\t\tundefined,\n\t\t\tparent,\n\t\t\tfalse,\n\t\t\t_rendererState\n\t\t);\n\n\t\tif (isArray(rendered)) {\n\t\t\treturn rendered.join(EMPTY_STR);\n\t\t}\n\t\treturn rendered;\n\t} catch (e) {\n\t\tif (e.then) {\n\t\t\tthrow new Error('Use \"renderToStringAsync\" for suspenseful rendering.');\n\t\t}\n\n\t\tthrow e;\n\t} finally {\n\t\t// options._commit, we don't schedule any effects in this library right now,\n\t\t// so we can pass an empty queue to this hook.\n\t\tif (options[COMMIT]) options[COMMIT](vnode, EMPTY_ARR);\n\t\toptions[SKIP_EFFECTS] = previousSkipEffects;\n\t\tEMPTY_ARR.length = 0;\n\t}\n}\n\n/**\n * Render Preact JSX + Components to an HTML string.\n * @param {VNode} vnode\tJSX Element / VNode to render\n * @param {Object} [context={}] Initial root context object\n * @returns {string} serialized HTML\n */\nexport async function renderToStringAsync(vnode, context) {\n\t// Performance optimization: `renderToString` is synchronous and we\n\t// therefore don't execute any effects. To do that we pass an empty\n\t// array to `options._commit` (`__c`). But we can go one step further\n\t// and avoid a lot of dirty checks and allocations by setting\n\t// `options._skipEffects` (`__s`) too.\n\tconst previousSkipEffects = options[SKIP_EFFECTS];\n\toptions[SKIP_EFFECTS] = true;\n\n\t// store options hooks once before each synchronous render call\n\tbeforeDiff = options[DIFF];\n\tafterDiff = options[DIFFED];\n\trenderHook = options[RENDER];\n\tummountHook = options.unmount;\n\n\tconst parent = h(Fragment, null);\n\tparent[CHILDREN] = [vnode];\n\n\ttry {\n\t\tconst rendered = await _renderToString(\n\t\t\tvnode,\n\t\t\tcontext || EMPTY_OBJ,\n\t\t\tfalse,\n\t\t\tundefined,\n\t\t\tparent,\n\t\t\ttrue,\n\t\t\tundefined\n\t\t);\n\n\t\tif (isArray(rendered)) {\n\t\t\tlet count = 0;\n\t\t\tlet resolved = rendered;\n\n\t\t\t// Resolving nested Promises with a maximum depth of 25\n\t\t\twhile (\n\t\t\t\tresolved.some(\n\t\t\t\t\t(element) => element && typeof element.then === 'function'\n\t\t\t\t) &&\n\t\t\t\tcount++ < 25\n\t\t\t) {\n\t\t\t\tresolved = (await Promise.all(resolved)).flat();\n\t\t\t}\n\n\t\t\treturn resolved.join(EMPTY_STR);\n\t\t}\n\n\t\treturn rendered;\n\t} finally {\n\t\t// options._commit, we don't schedule any effects in this library right now,\n\t\t// so we can pass an empty queue to this hook.\n\t\tif (options[COMMIT]) options[COMMIT](vnode, EMPTY_ARR);\n\t\toptions[SKIP_EFFECTS] = previousSkipEffects;\n\t\tEMPTY_ARR.length = 0;\n\t}\n}\n\n/**\n * @param {VNode} vnode\n * @param {Record<string, unknown>} context\n */\nfunction renderClassComponent(vnode, context) {\n\tlet type = /** @type {import(\"preact\").ComponentClass<typeof vnode.props>} */ (vnode.type);\n\n\tlet isMounting = true;\n\tlet c;\n\tif (vnode[COMPONENT]) {\n\t\tisMounting = false;\n\t\tc = vnode[COMPONENT];\n\t\tc.state = c[NEXT_STATE];\n\t} else {\n\t\tc = new type(vnode.props, context);\n\t}\n\n\tvnode[COMPONENT] = c;\n\tc[VNODE] = vnode;\n\n\tc.props = vnode.props;\n\tc.context = context;\n\t// turn off stateful re-rendering:\n\tc[DIRTY] = true;\n\n\tif (c.state == null) c.state = EMPTY_OBJ;\n\n\tif (c[NEXT_STATE] == null) {\n\t\tc[NEXT_STATE] = c.state;\n\t}\n\n\tif (type.getDerivedStateFromProps) {\n\t\tc.state = assign(\n\t\t\t{},\n\t\t\tc.state,\n\t\t\ttype.getDerivedStateFromProps(c.props, c.state)\n\t\t);\n\t} else if (isMounting && c.componentWillMount) {\n\t\tc.componentWillMount();\n\n\t\t// If the user called setState in cWM we need to flush pending,\n\t\t// state updates. This is the same behaviour in React.\n\t\tc.state = c[NEXT_STATE] !== c.state ? c[NEXT_STATE] : c.state;\n\t} else if (!isMounting && c.componentWillUpdate) {\n\t\tc.componentWillUpdate();\n\t}\n\n\tif (renderHook) renderHook(vnode);\n\n\treturn c.render(c.props, c.state, context);\n}\n\n/**\n * Recursively render VNodes to HTML.\n * @param {VNode|any} vnode\n * @param {any} context\n * @param {boolean} isSvgMode\n * @param {any} selectValue\n * @param {VNode} parent\n * @param {boolean} asyncMode\n * @param {RendererState | undefined} [renderer]\n * @returns {string | Promise<string> | (string | Promise<string>)[]}\n */\nfunction _renderToString(\n\tvnode,\n\tcontext,\n\tisSvgMode,\n\tselectValue,\n\tparent,\n\tasyncMode,\n\trenderer\n) {\n\t// Ignore non-rendered VNodes/values\n\tif (\n\t\tvnode == null ||\n\t\tvnode === true ||\n\t\tvnode === false ||\n\t\tvnode === EMPTY_STR\n\t) {\n\t\treturn EMPTY_STR;\n\t}\n\n\tlet vnodeType = typeof vnode;\n\t// Text VNodes: escape as HTML\n\tif (vnodeType != 'object') {\n\t\tif (vnodeType == 'function') return EMPTY_STR;\n\t\treturn vnodeType == 'string' ? encodeEntities(vnode) : vnode + EMPTY_STR;\n\t}\n\n\t// Recurse into children / Arrays\n\tif (isArray(vnode)) {\n\t\tlet rendered = EMPTY_STR,\n\t\t\trenderArray;\n\t\tparent[CHILDREN] = vnode;\n\t\tfor (let i = 0; i < vnode.length; i++) {\n\t\t\tlet child = vnode[i];\n\t\t\tif (child == null || typeof child == 'boolean') continue;\n\n\t\t\tconst childRender = _renderToString(\n\t\t\t\tchild,\n\t\t\t\tcontext,\n\t\t\t\tisSvgMode,\n\t\t\t\tselectValue,\n\t\t\t\tparent,\n\t\t\t\tasyncMode,\n\t\t\t\trenderer\n\t\t\t);\n\n\t\t\tif (typeof childRender == 'string') {\n\t\t\t\trendered = rendered + childRender;\n\t\t\t} else {\n\t\t\t\tif (!renderArray) {\n\t\t\t\t\trenderArray = [];\n\t\t\t\t}\n\n\t\t\t\tif (rendered) renderArray.push(rendered);\n\n\t\t\t\trendered = EMPTY_STR;\n\n\t\t\t\tif (isArray(childRender)) {\n\t\t\t\t\trenderArray.push(...childRender);\n\t\t\t\t} else {\n\t\t\t\t\trenderArray.push(childRender);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (renderArray) {\n\t\t\tif (rendered) renderArray.push(rendered);\n\t\t\treturn renderArray;\n\t\t}\n\n\t\treturn rendered;\n\t}\n\n\t// VNodes have {constructor:undefined} to prevent JSON injection:\n\tif (vnode.constructor !== undefined) return EMPTY_STR;\n\n\tvnode[PARENT] = parent;\n\tif (beforeDiff) beforeDiff(vnode);\n\n\tlet type = vnode.type,\n\t\tprops = vnode.props;\n\n\t// Invoke rendering on Components\n\tif (typeof type == 'function') {\n\t\tlet cctx = context,\n\t\t\tcontextType,\n\t\t\trendered,\n\t\t\tcomponent;\n\t\tif (type === Fragment) {\n\t\t\t// Serialized precompiled JSX.\n\t\t\tif ('tpl' in props) {\n\t\t\t\tlet out = EMPTY_STR;\n\t\t\t\tfor (let i = 0; i < props.tpl.length; i++) {\n\t\t\t\t\tout = out + props.tpl[i];\n\n\t\t\t\t\tif (props.exprs && i < props.exprs.length) {\n\t\t\t\t\t\tconst value = props.exprs[i];\n\t\t\t\t\t\tif (value == null) continue;\n\n\t\t\t\t\t\t// Check if we're dealing with a vnode or an array of nodes\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\ttypeof value == 'object' &&\n\t\t\t\t\t\t\t(value.constructor === undefined || isArray(value))\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tout =\n\t\t\t\t\t\t\t\tout +\n\t\t\t\t\t\t\t\t_renderToString(\n\t\t\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t\t\t\tcontext,\n\t\t\t\t\t\t\t\t\tisSvgMode,\n\t\t\t\t\t\t\t\t\tselectValue,\n\t\t\t\t\t\t\t\t\tvnode,\n\t\t\t\t\t\t\t\t\tasyncMode,\n\t\t\t\t\t\t\t\t\trenderer\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Values are pre-escaped by the JSX transform\n\t\t\t\t\t\t\tout = out + value;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn out;\n\t\t\t} else if ('UNSTABLE_comment' in props) {\n\t\t\t\t// Fragments are the least used components of core that's why\n\t\t\t\t// branching here for comments has the least effect on perf.\n\t\t\t\treturn '<!--' + encodeEntities(props.UNSTABLE_comment) + '-->';\n\t\t\t}\n\n\t\t\trendered = props.children;\n\t\t} else {\n\t\t\tcontextType = type.contextType;\n\t\t\tif (contextType != null) {\n\t\t\t\tlet provider = context[contextType.__c];\n\t\t\t\tcctx = provider ? provider.props.value : contextType.__;\n\t\t\t}\n\n\t\t\tlet isClassComponent =\n\t\t\t\ttype.prototype && typeof type.prototype.render == 'function';\n\t\t\tif (isClassComponent) {\n\t\t\t\trendered = /**#__NOINLINE__**/ renderClassComponent(vnode, cctx);\n\t\t\t\tcomponent = vnode[COMPONENT];\n\t\t\t} else {\n\t\t\t\tvnode[COMPONENT] = component = /**#__NOINLINE__**/ createComponent(\n\t\t\t\t\tvnode,\n\t\t\t\t\tcctx\n\t\t\t\t);\n\n\t\t\t\t// If a hook invokes setState() to invalidate the component during rendering,\n\t\t\t\t// re-render it up to 25 times to allow \"settling\" of memoized states.\n\t\t\t\t// Note:\n\t\t\t\t//   This will need to be updated for Preact 11 to use internal.flags rather than component._dirty:\n\t\t\t\t//   https://github.com/preactjs/preact/blob/d4ca6fdb19bc715e49fd144e69f7296b2f4daa40/src/diff/component.js#L35-L44\n\t\t\t\tlet count = 0;\n\t\t\t\twhile (component[DIRTY] && count++ < 25) {\n\t\t\t\t\tcomponent[DIRTY] = false;\n\n\t\t\t\t\tif (renderHook) renderHook(vnode);\n\n\t\t\t\t\trendered = type.call(component, props, cctx);\n\t\t\t\t}\n\t\t\t\tcomponent[DIRTY] = true;\n\t\t\t}\n\n\t\t\tif (component.getChildContext != null) {\n\t\t\t\tcontext = assign({}, context, component.getChildContext());\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tisClassComponent &&\n\t\t\t\toptions.errorBoundaries &&\n\t\t\t\t(type.getDerivedStateFromError || component.componentDidCatch)\n\t\t\t) {\n\t\t\t\t// When a component returns a Fragment node we flatten it in core, so we\n\t\t\t\t// need to mirror that logic here too\n\t\t\t\tlet isTopLevelFragment =\n\t\t\t\t\trendered != null &&\n\t\t\t\t\trendered.type === Fragment &&\n\t\t\t\t\trendered.key == null &&\n\t\t\t\t\trendered.props.tpl == null;\n\t\t\t\trendered = isTopLevelFragment ? rendered.props.children : rendered;\n\n\t\t\t\ttry {\n\t\t\t\t\treturn _renderToString(\n\t\t\t\t\t\trendered,\n\t\t\t\t\t\tcontext,\n\t\t\t\t\t\tisSvgMode,\n\t\t\t\t\t\tselectValue,\n\t\t\t\t\t\tvnode,\n\t\t\t\t\t\tasyncMode,\n\t\t\t\t\t\trenderer\n\t\t\t\t\t);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tif (type.getDerivedStateFromError) {\n\t\t\t\t\t\tcomponent[NEXT_STATE] = type.getDerivedStateFromError(err);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (component.componentDidCatch) {\n\t\t\t\t\t\tcomponent.componentDidCatch(err, EMPTY_OBJ);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (component[DIRTY]) {\n\t\t\t\t\t\trendered = renderClassComponent(vnode, context);\n\t\t\t\t\t\tcomponent = vnode[COMPONENT];\n\n\t\t\t\t\t\tif (component.getChildContext != null) {\n\t\t\t\t\t\t\tcontext = assign({}, context, component.getChildContext());\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet isTopLevelFragment =\n\t\t\t\t\t\t\trendered != null &&\n\t\t\t\t\t\t\trendered.type === Fragment &&\n\t\t\t\t\t\t\trendered.key == null &&\n\t\t\t\t\t\t\trendered.props.tpl == null;\n\t\t\t\t\t\trendered = isTopLevelFragment ? rendered.props.children : rendered;\n\n\t\t\t\t\t\treturn _renderToString(\n\t\t\t\t\t\t\trendered,\n\t\t\t\t\t\t\tcontext,\n\t\t\t\t\t\t\tisSvgMode,\n\t\t\t\t\t\t\tselectValue,\n\t\t\t\t\t\t\tvnode,\n\t\t\t\t\t\t\tasyncMode,\n\t\t\t\t\t\t\trenderer\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn EMPTY_STR;\n\t\t\t\t} finally {\n\t\t\t\t\tif (afterDiff) afterDiff(vnode);\n\t\t\t\t\tvnode[PARENT] = null;\n\n\t\t\t\t\tif (ummountHook) ummountHook(vnode);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// When a component returns a Fragment node we flatten it in core, so we\n\t\t// need to mirror that logic here too\n\t\tlet isTopLevelFragment =\n\t\t\trendered != null &&\n\t\t\trendered.type === Fragment &&\n\t\t\trendered.key == null &&\n\t\t\trendered.props.tpl == null;\n\t\trendered = isTopLevelFragment ? rendered.props.children : rendered;\n\n\t\ttry {\n\t\t\t// Recurse into children before invoking the after-diff hook\n\t\t\tconst str = _renderToString(\n\t\t\t\trendered,\n\t\t\t\tcontext,\n\t\t\t\tisSvgMode,\n\t\t\t\tselectValue,\n\t\t\t\tvnode,\n\t\t\t\tasyncMode,\n\t\t\t\trenderer\n\t\t\t);\n\n\t\t\tif (afterDiff) afterDiff(vnode);\n\t\t\t// when we are dealing with suspense we can't do this...\n\t\t\tvnode[PARENT] = null;\n\n\t\t\tif (options.unmount) options.unmount(vnode);\n\n\t\t\treturn str;\n\t\t} catch (error) {\n\t\t\tif (!asyncMode && renderer && renderer.onError) {\n\t\t\t\tlet res = renderer.onError(error, vnode, (child) =>\n\t\t\t\t\t_renderToString(\n\t\t\t\t\t\tchild,\n\t\t\t\t\t\tcontext,\n\t\t\t\t\t\tisSvgMode,\n\t\t\t\t\t\tselectValue,\n\t\t\t\t\t\tvnode,\n\t\t\t\t\t\tasyncMode,\n\t\t\t\t\t\trenderer\n\t\t\t\t\t)\n\t\t\t\t);\n\n\t\t\t\tif (res !== undefined) return res;\n\n\t\t\t\tlet errorHook = options[CATCH_ERROR];\n\t\t\t\tif (errorHook) errorHook(error, vnode);\n\t\t\t\treturn EMPTY_STR;\n\t\t\t}\n\n\t\t\tif (!asyncMode) throw error;\n\n\t\t\tif (!error || typeof error.then != 'function') throw error;\n\n\t\t\tconst renderNestedChildren = () => {\n\t\t\t\ttry {\n\t\t\t\t\treturn _renderToString(\n\t\t\t\t\t\trendered,\n\t\t\t\t\t\tcontext,\n\t\t\t\t\t\tisSvgMode,\n\t\t\t\t\t\tselectValue,\n\t\t\t\t\t\tvnode,\n\t\t\t\t\t\tasyncMode,\n\t\t\t\t\t\trenderer\n\t\t\t\t\t);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (!e || typeof e.then != 'function') throw e;\n\n\t\t\t\t\treturn e.then(\n\t\t\t\t\t\t() =>\n\t\t\t\t\t\t\t_renderToString(\n\t\t\t\t\t\t\t\trendered,\n\t\t\t\t\t\t\t\tcontext,\n\t\t\t\t\t\t\t\tisSvgMode,\n\t\t\t\t\t\t\t\tselectValue,\n\t\t\t\t\t\t\t\tvnode,\n\t\t\t\t\t\t\t\tasyncMode,\n\t\t\t\t\t\t\t\trenderer\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\trenderNestedChildren\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn error.then(renderNestedChildren);\n\t\t}\n\t}\n\n\t// Serialize Element VNodes to HTML\n\tlet s = '<' + type,\n\t\thtml = EMPTY_STR,\n\t\tchildren;\n\n\tfor (let name in props) {\n\t\tlet v = props[name];\n\n\t\tif (typeof v == 'function' && name !== 'class' && name !== 'className') {\n\t\t\tcontinue;\n\t\t}\n\n\t\tswitch (name) {\n\t\t\tcase 'children':\n\t\t\t\tchildren = v;\n\t\t\t\tcontinue;\n\n\t\t\t// VDOM-specific props\n\t\t\tcase 'key':\n\t\t\tcase 'ref':\n\t\t\tcase '__self':\n\t\t\tcase '__source':\n\t\t\t\tcontinue;\n\n\t\t\t// prefer for/class over htmlFor/className\n\t\t\tcase 'htmlFor':\n\t\t\t\tif ('for' in props) continue;\n\t\t\t\tname = 'for';\n\t\t\t\tbreak;\n\t\t\tcase 'className':\n\t\t\t\tif ('class' in props) continue;\n\t\t\t\tname = 'class';\n\t\t\t\tbreak;\n\n\t\t\t// Form element reflected properties\n\t\t\tcase 'defaultChecked':\n\t\t\t\tname = 'checked';\n\t\t\t\tbreak;\n\t\t\tcase 'defaultSelected':\n\t\t\t\tname = 'selected';\n\t\t\t\tbreak;\n\n\t\t\t// Special value attribute handling\n\t\t\tcase 'defaultValue':\n\t\t\tcase 'value':\n\t\t\t\tname = 'value';\n\t\t\t\tswitch (type) {\n\t\t\t\t\t// <textarea value=\"a&b\"> --> <textarea>a&amp;b</textarea>\n\t\t\t\t\tcase 'textarea':\n\t\t\t\t\t\tchildren = v;\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t// <select value> is serialized as a selected attribute on the matching option child\n\t\t\t\t\tcase 'select':\n\t\t\t\t\t\tselectValue = v;\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t// Add a selected attribute to <option> if its value matches the parent <select> value\n\t\t\t\t\tcase 'option':\n\t\t\t\t\t\tif (selectValue == v && !('selected' in props)) {\n\t\t\t\t\t\t\ts = s + ' selected';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'dangerouslySetInnerHTML':\n\t\t\t\thtml = v && v.__html;\n\t\t\t\tcontinue;\n\n\t\t\t// serialize object styles to a CSS string\n\t\t\tcase 'style':\n\t\t\t\tif (typeof v === 'object') {\n\t\t\t\t\tv = styleObjToCss(v);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'acceptCharset':\n\t\t\t\tname = 'accept-charset';\n\t\t\t\tbreak;\n\t\t\tcase 'httpEquiv':\n\t\t\t\tname = 'http-equiv';\n\t\t\t\tbreak;\n\n\t\t\tdefault: {\n\t\t\t\tif (NAMESPACE_REPLACE_REGEX.test(name)) {\n\t\t\t\t\tname = name.replace(NAMESPACE_REPLACE_REGEX, '$1:$2').toLowerCase();\n\t\t\t\t} else if (UNSAFE_NAME.test(name)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t} else if (\n\t\t\t\t\t(name[4] === '-' || HTML_ENUMERATED.has(name)) &&\n\t\t\t\t\tv != null\n\t\t\t\t) {\n\t\t\t\t\t// serialize boolean aria-xyz or enumerated attribute values as strings\n\t\t\t\t\tv = v + EMPTY_STR;\n\t\t\t\t} else if (isSvgMode) {\n\t\t\t\t\tif (SVG_CAMEL_CASE.test(name)) {\n\t\t\t\t\t\tname =\n\t\t\t\t\t\t\tname === 'panose1'\n\t\t\t\t\t\t\t\t? 'panose-1'\n\t\t\t\t\t\t\t\t: name.replace(/([A-Z])/g, '-$1').toLowerCase();\n\t\t\t\t\t}\n\t\t\t\t} else if (HTML_LOWER_CASE.test(name)) {\n\t\t\t\t\tname = name.toLowerCase();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// write this attribute to the buffer\n\t\tif (v != null && v !== false) {\n\t\t\tif (v === true || v === EMPTY_STR) {\n\t\t\t\ts = s + ' ' + name;\n\t\t\t} else {\n\t\t\t\ts =\n\t\t\t\t\ts +\n\t\t\t\t\t' ' +\n\t\t\t\t\tname +\n\t\t\t\t\t'=\"' +\n\t\t\t\t\t(typeof v == 'string' ? encodeEntities(v) : v + EMPTY_STR) +\n\t\t\t\t\t'\"';\n\t\t\t}\n\t\t}\n\t}\n\n\tif (UNSAFE_NAME.test(type)) {\n\t\t// this seems to performs a lot better than throwing\n\t\t// return '<!-- -->';\n\t\tthrow new Error(`${type} is not a valid HTML tag name in ${s}>`);\n\t}\n\n\tif (html) {\n\t\t// dangerouslySetInnerHTML defined this node's contents\n\t} else if (typeof children === 'string') {\n\t\t// single text child\n\t\thtml = encodeEntities(children);\n\t} else if (children != null && children !== false && children !== true) {\n\t\t// recurse into this element VNode's children\n\t\tlet childSvgMode =\n\t\t\ttype === 'svg' || (type !== 'foreignObject' && isSvgMode);\n\t\thtml = _renderToString(\n\t\t\tchildren,\n\t\t\tcontext,\n\t\t\tchildSvgMode,\n\t\t\tselectValue,\n\t\t\tvnode,\n\t\t\tasyncMode,\n\t\t\trenderer\n\t\t);\n\t}\n\n\tif (afterDiff) afterDiff(vnode);\n\n\t// TODO: this was commented before\n\tvnode[PARENT] = null;\n\n\tif (ummountHook) ummountHook(vnode);\n\n\t// Emit self-closing tag for empty void elements:\n\tif (!html && SELF_CLOSING.has(type)) {\n\t\treturn s + '/>';\n\t}\n\n\tconst endTag = '</' + type + '>';\n\tconst startTag = s + '>';\n\n\tif (isArray(html)) return [startTag, ...html, endTag];\n\telse if (typeof html != 'string') return [startTag, html, endTag];\n\treturn startTag + html + endTag;\n}\n\nconst SELF_CLOSING = new Set([\n\t'area',\n\t'base',\n\t'br',\n\t'col',\n\t'command',\n\t'embed',\n\t'hr',\n\t'img',\n\t'input',\n\t'keygen',\n\t'link',\n\t'meta',\n\t'param',\n\t'source',\n\t'track',\n\t'wbr'\n]);\n\nexport default renderToString;\nexport const render = renderToString;\nexport const renderToStaticMarkup = renderToString;\n", "const ENCODED_ENTITIES = /[\"&<]/;\n\n/** @param {string} str */\nexport function encodeEntities(str) {\n\t// Skip all work for strings with no entities needing encoding:\n\tif (str.length === 0 || ENCODED_ENTITIES.test(str) === false) return str;\n\n\tlet last = 0,\n\t\ti = 0,\n\t\tout = '',\n\t\tch = '';\n\n\t// Seek forward in str until the next entity char:\n\tfor (; i < str.length; i++) {\n\t\tswitch (str.charCodeAt(i)) {\n\t\t\tcase 34:\n\t\t\t\tch = '&quot;';\n\t\t\t\tbreak;\n\t\t\tcase 38:\n\t\t\t\tch = '&amp;';\n\t\t\t\tbreak;\n\t\t\tcase 60:\n\t\t\t\tch = '&lt;';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tcontinue;\n\t\t}\n\t\t// Append skipped/buffered characters and the encoded entity:\n\t\tif (i !== last) out += str.slice(last, i);\n\t\tout += ch;\n\t\t// Start the next seek/buffer after the entity's offset:\n\t\tlast = i + 1;\n\t}\n\tif (i !== last) out += str.slice(last, i);\n\treturn out;\n}\n", "/** Normal hydration that attaches to a DOM tree but does not diff it. */\nexport const MODE_HYDRATE = 1 << 5;\n/** Signifies this VNode suspended on the previous render */\nexport const MODE_SUSPENDED = 1 << 7;\n/** Indicates that this node needs to be inserted while patching children */\nexport const INSERT_VNODE = 1 << 16;\n/** Indicates a VNode has been matched with another VNode in the diff */\nexport const MATCHED = 1 << 17;\n\n/** Reset all mode flags */\nexport const RESET_MODE = ~(MODE_HYDRATE | MODE_SUSPENDED);\n\nexport const EMPTY_OBJ = /** @type {any} */ ({});\nexport const EMPTY_ARR = [];\nexport const IS_NON_DIMENSIONAL =\n\t/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;\n", "import { options, Fragment } from 'preact';\nimport { encodeEntities } from './utils';\nimport { IS_NON_DIMENSIONAL } from '../../src/constants';\n\nlet vnodeId = 0;\n\nconst isArray = Array.isArray;\n\n/**\n * @fileoverview\n * This file exports various methods that implement Babel's \"automatic\" JSX runtime API:\n * - jsx(type, props, key)\n * - jsxs(type, props, key)\n * - jsxDEV(type, props, key, __source, __self)\n *\n * The implementation of createVNode here is optimized for performance.\n * Benchmarks: https://esbench.com/bench/5f6b54a0b4632100a7dcd2b3\n */\n\n/**\n * JSX.Element factory used by Babel's {runtime:\"automatic\"} JSX transform\n * @param {VNode['type']} type\n * @param {VNode['props']} props\n * @param {VNode['key']} [key]\n * @param {unknown} [isStaticChildren]\n * @param {unknown} [__source]\n * @param {unknown} [__self]\n */\nfunction createVNode(type, props, key, isStaticChildren, __source, __self) {\n\tif (!props) props = {};\n\t// We'll want to preserve `ref` in props to get rid of the need for\n\t// forwardRef components in the future, but that should happen via\n\t// a separate PR.\n\tlet normalizedProps = props,\n\t\tref,\n\t\ti;\n\n\tif ('ref' in props) {\n\t\tref = props.ref;\n\t\tdelete props.ref;\n\t}\n\n\t/** @type {VNode & { __source: any; __self: any }} */\n\tconst vnode = {\n\t\ttype,\n\t\tprops: normalizedProps,\n\t\tkey,\n\t\tref,\n\t\t_children: null,\n\t\t_parent: null,\n\t\t_depth: 0,\n\t\t_dom: null,\n\t\t_nextDom: undefined,\n\t\t_component: null,\n\t\tconstructor: undefined,\n\t\t_original: --vnodeId,\n\t\t_index: -1,\n\t\t_flags: 0,\n\t\t__source,\n\t\t__self\n\t};\n\n\t// If a Component VNode, check for and apply defaultProps.\n\t// Note: `type` is often a String, and can be `undefined` in development.\n\tif (typeof type === 'function' && (ref = type.defaultProps)) {\n\t\tfor (i in ref)\n\t\t\tif (typeof normalizedProps[i] === 'undefined') {\n\t\t\t\tnormalizedProps[i] = ref[i];\n\t\t\t}\n\t}\n\n\tif (options.vnode) options.vnode(vnode);\n\treturn vnode;\n}\n\n/**\n * Create a template vnode. This function is not expected to be\n * used directly, but rather through a precompile JSX transform\n * @param {string[]} templates\n * @param  {Array<string | null | VNode>} exprs\n * @returns {VNode}\n */\nfunction jsxTemplate(templates, ...exprs) {\n\tconst vnode = createVNode(Fragment, { tpl: templates, exprs });\n\t// Bypass render to string top level Fragment optimization\n\tvnode.key = vnode._vnode;\n\treturn vnode;\n}\n\nconst JS_TO_CSS = {};\nconst CSS_REGEX = /[A-Z]/g;\n\n/**\n * Serialize an HTML attribute to a string. This function is not\n * expected to be used directly, but rather through a precompile\n * JSX transform\n * @param {string} name The attribute name\n * @param {*} value The attribute value\n * @returns {string}\n */\nfunction jsxAttr(name, value) {\n\tif (options.attr) {\n\t\tconst result = options.attr(name, value);\n\t\tif (typeof result === 'string') return result;\n\t}\n\n\tif (name === 'ref' || name === 'key') return '';\n\tif (name === 'style' && typeof value === 'object') {\n\t\tlet str = '';\n\t\tfor (let prop in value) {\n\t\t\tlet val = value[prop];\n\t\t\tif (val != null && val !== '') {\n\t\t\t\tconst name =\n\t\t\t\t\tprop[0] == '-'\n\t\t\t\t\t\t? prop\n\t\t\t\t\t\t: JS_TO_CSS[prop] ||\n\t\t\t\t\t\t\t(JS_TO_CSS[prop] = prop.replace(CSS_REGEX, '-$&').toLowerCase());\n\n\t\t\t\tlet suffix = ';';\n\t\t\t\tif (\n\t\t\t\t\ttypeof val === 'number' &&\n\t\t\t\t\t// Exclude custom-attributes\n\t\t\t\t\t!name.startsWith('--') &&\n\t\t\t\t\t!IS_NON_DIMENSIONAL.test(name)\n\t\t\t\t) {\n\t\t\t\t\tsuffix = 'px;';\n\t\t\t\t}\n\t\t\t\tstr = str + name + ':' + val + suffix;\n\t\t\t}\n\t\t}\n\t\treturn name + '=\"' + str + '\"';\n\t}\n\n\tif (\n\t\tvalue == null ||\n\t\tvalue === false ||\n\t\ttypeof value === 'function' ||\n\t\ttypeof value === 'object'\n\t) {\n\t\treturn '';\n\t} else if (value === true) return name;\n\n\treturn name + '=\"' + encodeEntities(value) + '\"';\n}\n\n/**\n * Escape a dynamic child passed to `jsxTemplate`. This function\n * is not expected to be used directly, but rather through a\n * precompile JSX transform\n * @param {*} value\n * @returns {string | null | VNode | Array<string | null | VNode>}\n */\nfunction jsxEscape(value) {\n\tif (\n\t\tvalue == null ||\n\t\ttypeof value === 'boolean' ||\n\t\ttypeof value === 'function'\n\t) {\n\t\treturn null;\n\t}\n\n\tif (typeof value === 'object') {\n\t\t// Check for VNode\n\t\tif (value.constructor === undefined) return value;\n\n\t\tif (isArray(value)) {\n\t\t\tfor (let i = 0; i < value.length; i++) {\n\t\t\t\tvalue[i] = jsxEscape(value[i]);\n\t\t\t}\n\t\t\treturn value;\n\t\t}\n\t}\n\n\treturn encodeEntities('' + value);\n}\n\nexport {\n\tcreateVNode as jsx,\n\tcreateVNode as jsxs,\n\tcreateVNode as jsxDEV,\n\tFragment,\n\t// precompiled JSX transform\n\tjsxTemplate,\n\tjsxAttr,\n\tjsxEscape\n};\n", null, "import * as o from \"oauth4webapi\";\nimport { InvalidCheck } from \"../../../../errors.js\";\n// NOTE: We use the default JWT methods here because they encrypt/decrypt the payload, not just sign it.\nimport { decode, encode } from \"../../../../jwt.js\";\nconst COOKIE_TTL = 60 * 15; // 15 minutes\n/** Returns a cookie with a JWT encrypted payload. */\nasync function sealCookie(name, payload, options) {\n    const { cookies, logger } = options;\n    const cookie = cookies[name];\n    const expires = new Date();\n    expires.setTime(expires.getTime() + COOKIE_TTL * 1000);\n    logger.debug(`CREATE_${name.toUpperCase()}`, {\n        name: cookie.name,\n        payload,\n        COOKIE_TTL,\n        expires,\n    });\n    const encoded = await encode({\n        ...options.jwt,\n        maxAge: COOKIE_TTL,\n        token: { value: payload },\n        salt: cookie.name,\n    });\n    const cookieOptions = { ...cookie.options, expires };\n    return { name: cookie.name, value: encoded, options: cookieOptions };\n}\nasync function parseCookie(name, value, options) {\n    try {\n        const { logger, cookies, jwt } = options;\n        logger.debug(`PARSE_${name.toUpperCase()}`, { cookie: value });\n        if (!value)\n            throw new InvalidCheck(`${name} cookie was missing`);\n        const parsed = await decode({\n            ...jwt,\n            token: value,\n            salt: cookies[name].name,\n        });\n        if (parsed?.value)\n            return parsed.value;\n        throw new Error(\"Invalid cookie\");\n    }\n    catch (error) {\n        throw new InvalidCheck(`${name} value could not be parsed`, {\n            cause: error,\n        });\n    }\n}\nfunction clearCookie(name, options, resCookies) {\n    const { logger, cookies } = options;\n    const cookie = cookies[name];\n    logger.debug(`CLEAR_${name.toUpperCase()}`, { cookie });\n    resCookies.push({\n        name: cookie.name,\n        value: \"\",\n        options: { ...cookies[name].options, maxAge: 0 },\n    });\n}\nfunction useCookie(check, name) {\n    return async function (cookies, resCookies, options) {\n        const { provider, logger } = options;\n        if (!provider?.checks?.includes(check))\n            return;\n        const cookieValue = cookies?.[options.cookies[name].name];\n        logger.debug(`USE_${name.toUpperCase()}`, { value: cookieValue });\n        const parsed = await parseCookie(name, cookieValue, options);\n        clearCookie(name, options, resCookies);\n        return parsed;\n    };\n}\n/**\n * @see https://www.rfc-editor.org/rfc/rfc7636\n * @see https://danielfett.de/2020/05/16/pkce-vs-nonce-equivalent-or-not/#pkce\n */\nexport const pkce = {\n    /** Creates a PKCE code challenge and verifier pair. The verifier in stored in the cookie. */\n    async create(options) {\n        const code_verifier = o.generateRandomCodeVerifier();\n        const value = await o.calculatePKCECodeChallenge(code_verifier);\n        const cookie = await sealCookie(\"pkceCodeVerifier\", code_verifier, options);\n        return { cookie, value };\n    },\n    /**\n     * Returns code_verifier if the provider is configured to use PKCE,\n     * and clears the container cookie afterwards.\n     * An error is thrown if the code_verifier is missing or invalid.\n     */\n    use: useCookie(\"pkce\", \"pkceCodeVerifier\"),\n};\nconst STATE_MAX_AGE = 60 * 15; // 15 minutes in seconds\nconst encodedStateSalt = \"encodedState\";\n/**\n * @see https://www.rfc-editor.org/rfc/rfc6749#section-10.12\n * @see https://www.rfc-editor.org/rfc/rfc6749#section-4.1.1\n */\nexport const state = {\n    /** Creates a state cookie with an optionally encoded body. */\n    async create(options, origin) {\n        const { provider } = options;\n        if (!provider.checks.includes(\"state\")) {\n            if (origin) {\n                throw new InvalidCheck(\"State data was provided but the provider is not configured to use state\");\n            }\n            return;\n        }\n        // IDEA: Allow the user to pass data to be stored in the state\n        const payload = {\n            origin,\n            random: o.generateRandomState(),\n        };\n        const value = await encode({\n            secret: options.jwt.secret,\n            token: payload,\n            salt: encodedStateSalt,\n            maxAge: STATE_MAX_AGE,\n        });\n        const cookie = await sealCookie(\"state\", value, options);\n        return { cookie, value };\n    },\n    /**\n     * Returns state if the provider is configured to use state,\n     * and clears the container cookie afterwards.\n     * An error is thrown if the state is missing or invalid.\n     */\n    use: useCookie(\"state\", \"state\"),\n    /** Decodes the state. If it could not be decoded, it throws an error. */\n    async decode(state, options) {\n        try {\n            options.logger.debug(\"DECODE_STATE\", { state });\n            const payload = await decode({\n                secret: options.jwt.secret,\n                token: state,\n                salt: encodedStateSalt,\n            });\n            if (payload)\n                return payload;\n            throw new Error(\"Invalid state\");\n        }\n        catch (error) {\n            throw new InvalidCheck(\"State could not be decoded\", { cause: error });\n        }\n    },\n};\nexport const nonce = {\n    async create(options) {\n        if (!options.provider.checks.includes(\"nonce\"))\n            return;\n        const value = o.generateRandomNonce();\n        const cookie = await sealCookie(\"nonce\", value, options);\n        return { cookie, value };\n    },\n    /**\n     * Returns nonce if the provider is configured to use nonce,\n     * and clears the container cookie afterwards.\n     * An error is thrown if the nonce is missing or invalid.\n     * @see https://openid.net/specs/openid-connect-core-1_0.html#NonceNotes\n     * @see https://danielfett.de/2020/05/16/pkce-vs-nonce-equivalent-or-not/#nonce\n     */\n    use: useCookie(\"nonce\", \"nonce\"),\n};\nconst WEBAUTHN_CHALLENGE_MAX_AGE = 60 * 15; // 15 minutes in seconds\nconst webauthnChallengeSalt = \"encodedWebauthnChallenge\";\nexport const webauthnChallenge = {\n    async create(options, challenge, registerData) {\n        return {\n            cookie: await sealCookie(\"webauthnChallenge\", await encode({\n                secret: options.jwt.secret,\n                token: { challenge, registerData },\n                salt: webauthnChallengeSalt,\n                maxAge: WEBAUTHN_CHALLENGE_MAX_AGE,\n            }), options),\n        };\n    },\n    /** Returns WebAuthn challenge if present. */\n    async use(options, cookies, resCookies) {\n        const cookieValue = cookies?.[options.cookies.webauthnChallenge.name];\n        const parsed = await parseCookie(\"webauthnChallenge\", cookieValue, options);\n        const payload = await decode({\n            secret: options.jwt.secret,\n            token: parsed,\n            salt: webauthnChallengeSalt,\n        });\n        // Clear the WebAuthn challenge cookie after use\n        clearCookie(\"webauthnChallenge\", options, resCookies);\n        if (!payload)\n            throw new InvalidCheck(\"WebAuthn challenge was missing\");\n        return payload;\n    },\n};\n", "import { setLogger } from \"./logger.js\";\n/**\n *  Set default env variables on the config object\n * @param suppressWarnings intended for framework authors.\n */\nexport function setEnvDefaults(envObject, config, suppressBasePathWarning = false) {\n    try {\n        const url = envObject.AUTH_URL;\n        if (url) {\n            if (config.basePath) {\n                if (!suppressBasePathWarning) {\n                    const logger = setLogger(config);\n                    logger.warn(\"env-url-basepath-redundant\");\n                }\n            }\n            else {\n                config.basePath = new URL(url).pathname;\n            }\n        }\n    }\n    catch {\n        // Catching and swallowing potential URL parsing errors, we'll fall\n        // back to `/auth` below.\n    }\n    finally {\n        config.basePath ?? (config.basePath = `/auth`);\n    }\n    if (!config.secret?.length) {\n        config.secret = [];\n        const secret = envObject.AUTH_SECRET;\n        if (secret)\n            config.secret.push(secret);\n        for (const i of [1, 2, 3]) {\n            const secret = envObject[`AUTH_SECRET_${i}`];\n            if (secret)\n                config.secret.unshift(secret);\n        }\n    }\n    config.redirectProxyUrl ?? (config.redirectProxyUrl = envObject.AUTH_REDIRECT_PROXY_URL);\n    config.trustHost ?? (config.trustHost = !!(envObject.AUTH_URL ??\n        envObject.AUTH_TRUST_HOST ??\n        envObject.VERCEL ??\n        envObject.CF_PAGES ??\n        envObject.NODE_ENV !== \"production\"));\n    config.providers = config.providers.map((provider) => {\n        const { id } = typeof provider === \"function\" ? provider({}) : provider;\n        const ID = id.toUpperCase().replace(/-/g, \"_\");\n        const clientId = envObject[`AUTH_${ID}_ID`];\n        const clientSecret = envObject[`AUTH_${ID}_SECRET`];\n        const issuer = envObject[`AUTH_${ID}_ISSUER`];\n        const apiKey = envObject[`AUTH_${ID}_KEY`];\n        const finalProvider = typeof provider === \"function\"\n            ? provider({ clientId, clientSecret, issuer, apiKey })\n            : provider;\n        if (finalProvider.type === \"oauth\" || finalProvider.type === \"oidc\") {\n            finalProvider.clientId ?? (finalProvider.clientId = clientId);\n            finalProvider.clientSecret ?? (finalProvider.clientSecret = clientSecret);\n            finalProvider.issuer ?? (finalProvider.issuer = issuer);\n        }\n        else if (finalProvider.type === \"email\") {\n            finalProvider.apiKey ?? (finalProvider.apiKey = apiKey);\n        }\n        return finalProvider;\n    });\n}\nexport function createActionURL(action, protocol, headers, envObject, config) {\n    const basePath = config?.basePath;\n    const envUrl = envObject.AUTH_URL ?? envObject.NEXTAUTH_URL;\n    let url;\n    if (envUrl) {\n        url = new URL(envUrl);\n        if (basePath && basePath !== \"/\" && url.pathname !== \"/\") {\n            if (url.pathname !== basePath) {\n                const logger = setLogger(config);\n                logger.warn(\"env-url-basepath-mismatch\");\n            }\n            url.pathname = \"/\";\n        }\n    }\n    else {\n        const detectedHost = headers.get(\"x-forwarded-host\") ?? headers.get(\"host\");\n        const detectedProtocol = headers.get(\"x-forwarded-proto\") ?? protocol ?? \"https\";\n        const _protocol = detectedProtocol.endsWith(\":\")\n            ? detectedProtocol\n            : detectedProtocol + \":\";\n        url = new URL(`${_protocol}//${detectedHost}`);\n    }\n    // remove trailing slash\n    const sanitizedUrl = url.toString().replace(/\\/$/, \"\");\n    if (basePath) {\n        // remove leading and trailing slash\n        const sanitizedBasePath = basePath?.replace(/(^\\/|\\/$)/g, \"\") ?? \"\";\n        return new URL(`${sanitizedUrl}/${sanitizedBasePath}/${action}`);\n    }\n    return new URL(`${sanitizedUrl}/${action}`);\n}\n", "// Some code adapted from Auth.js. Original license:\n//\n// ISC License\n//\n// Copyright (c) 2022-2024, Balzs Orbn\n//\n// Permission to use, copy, modify, and/or distribute this software for any\n// purpose with or without fee is hereby granted, provided that the above\n// copyright notice and this permission notice appear in all copies.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES\n// WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF\n// MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR\n// ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES\n// WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN\n// ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF\n// OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\n\nimport { setEnvDefaults } from \"@auth/core\";\nimport {\n  AccountCallback,\n  OAuth2Config,\n  OAuthConfig,\n  OAuthEndpointType,\n  OIDCConfig,\n  ProfileCallback,\n} from \"@auth/core/providers\";\nimport { Profile } from \"@auth/core/types\";\nimport {\n  AuthProviderConfig,\n  AuthProviderMaterializedConfig,\n  ConvexAuthConfig,\n} from \"./types.js\";\n\n/**\n * @internal\n */\nexport function configDefaults(config_: ConvexAuthConfig) {\n  const config = materializeAndDefaultProviders(config_);\n  // Collect extra providers\n  const extraProviders = config.providers\n    .filter((p) => p.type === \"credentials\")\n    .map((p) => p.extraProviders)\n    .flat()\n    .filter((p) => p !== undefined);\n  return {\n    ...config,\n    extraProviders: materializeProviders(extraProviders),\n    theme: config.theme ?? {\n      colorScheme: \"auto\",\n      logo: \"\",\n      brandColor: \"\",\n      buttonText: \"\",\n    },\n  };\n}\n\n/**\n * @internal\n */\nexport function materializeProvider(provider: AuthProviderConfig) {\n  const config = { providers: [provider] };\n  materializeAndDefaultProviders(config);\n  return config.providers[0] as AuthProviderMaterializedConfig;\n}\n\nfunction materializeProviders(providers: AuthProviderConfig[]) {\n  const config = { providers };\n  materializeAndDefaultProviders(config);\n  return config.providers as AuthProviderMaterializedConfig[];\n}\n\nfunction materializeAndDefaultProviders(config_: ConvexAuthConfig) {\n  // Have to materialize first so that the correct env variables are used\n  const providers = config_.providers.map((provider) =>\n    providerDefaults(\n      typeof provider === \"function\" ? provider() : (provider as any),\n    ),\n  );\n  const config = { ...config_, providers };\n\n  // Unfortunately mutates its argument\n  setEnvDefaults(process.env, config as any);\n  // Manually do this for new provider type\n  config.providers.forEach((provider) => {\n    if (provider.type === \"phone\") {\n      const ID = provider.id.toUpperCase().replace(/-/g, \"_\");\n      // Should not require this env var at push time, as the provider's\n      // implementation might not use it\n      provider.apiKey ??= process.env[`AUTH_${ID}_KEY`];\n    }\n  });\n  return config;\n}\n\nfunction providerDefaults(provider: AuthProviderMaterializedConfig) {\n  // TODO: Add `redirectProxyUrl` to oauth providers\n  const merged = merge(\n    provider,\n    (provider as any).options,\n  ) as AuthProviderMaterializedConfig;\n  return merged.type === \"oauth\" || merged.type === \"oidc\"\n    ? normalizeOAuth(merged)\n    : merged;\n}\n\nconst defaultProfile: ProfileCallback<Profile> = (profile) => {\n  return stripUndefined({\n    id: profile.sub ?? profile.id ?? crypto.randomUUID(),\n    name: profile.name ?? profile.nickname ?? profile.preferred_username,\n    email: profile.email ?? undefined,\n    image: profile.picture ?? undefined,\n  });\n};\n\nconst defaultAccount: AccountCallback = (account) => {\n  return stripUndefined({\n    access_token: account.access_token,\n    id_token: account.id_token,\n    refresh_token: account.refresh_token,\n    expires_at: account.expires_at,\n    scope: account.scope,\n    token_type: account.token_type,\n    session_state: account.session_state,\n  });\n};\n\nfunction stripUndefined<T extends object>(o: T): T {\n  const result = {} as any;\n  for (const [k, v] of Object.entries(o)) v !== undefined && (result[k] = v);\n  return result as T;\n}\n\nfunction normalizeOAuth<T extends OIDCConfig<any> | OAuth2Config<any>>(\n  c: T,\n): T {\n  if (c.issuer) c.wellKnown ??= `${c.issuer}/.well-known/openid-configuration`;\n\n  const checks = c.checks ?? [\"pkce\"];\n  if (c.redirectProxyUrl) {\n    if (!checks.includes(\"state\")) checks.push(\"state\");\n    c.redirectProxyUrl = `${c.redirectProxyUrl}/callback/${c.id}`;\n  }\n\n  return {\n    ...c,\n    checks,\n    profile: c.profile ?? defaultProfile,\n    account: c.account ?? defaultAccount,\n  };\n}\n\nexport const PLACEHOLDER_URL_HOST = \"convexauth.mumbojumbo\";\n\nconst PLACEHOLDER_URL = `https://${PLACEHOLDER_URL_HOST}`;\n\nexport function normalizeEndpoint(\n  e?: OAuthConfig<any>[OAuthEndpointType],\n  issuer?: string,\n) {\n  if (!e && issuer) return undefined;\n  if (typeof e === \"string\") {\n    return { url: new URL(e) };\n  }\n  // Placeholder URL is used to pass around the URL object\n  // even if the URL hasn't been specified: the `issuer`\n  // is used instead.\n  const url = new URL(e?.url ?? PLACEHOLDER_URL);\n  if (e?.params != null) {\n    for (const [key, value] of Object.entries(e.params)) {\n      url.searchParams.set(\n        key,\n        String(key === \"claims\" ? JSON.stringify(value) : value),\n      );\n    }\n  }\n  return { url, request: e?.request, conform: e?.conform };\n}\n\n// Source: https://stackoverflow.com/a/34749873/5364135\n\n/**\n * Deep merge two objects\n *\n * @internal\n */\nexport function merge(target: any, ...sources: any[]): any {\n  if (!sources.length) return target;\n  const source = sources.shift();\n\n  if (isObject(target) && isObject(source)) {\n    for (const key in source) {\n      if (isObject(source[key])) {\n        if (!target[key]) Object.assign(target, { [key]: {} });\n        merge(target[key], source[key]);\n      } else {\n        Object.assign(target, { [key]: source[key] });\n      }\n    }\n  }\n\n  return merge(target, ...sources);\n}\n\n/** Simple object check */\nfunction isObject(item: any): boolean {\n  return item && typeof item === \"object\" && !Array.isArray(item);\n}\n/**\n * @internal\n */\nexport function listAvailableProviders(\n  config: ReturnType<typeof configDefaults>,\n  allowExtraProviders: boolean,\n) {\n  const availableProviders = config.providers\n    .concat(allowExtraProviders ? config.extraProviders : [])\n    .map((provider) => `\\`${provider.id}\\``);\n  return availableProviders.length > 0\n    ? availableProviders.join(\", \")\n    : \"no providers have been configured\";\n}\n", "import {\n  DataModelFromSchemaDefinition,\n  GenericActionCtx,\n  GenericMutationCtx,\n  GenericQueryCtx,\n  TableNamesInDataModel,\n  defineSchema,\n  defineTable,\n} from \"convex/server\";\nimport { GenericId, v } from \"convex/values\";\nimport { GenericDoc } from \"../convex_types.js\";\n\n/**\n * The table definitions required by the library.\n *\n * Your schema must include these so that the indexes\n * are set up:\n *\n *\n * ```ts filename=\"convex/schema.ts\"\n * import { defineSchema } from \"convex/server\";\n * import { authTables } from \"@convex-dev/auth/server\";\n *\n * const schema = defineSchema({\n *   ...authTables,\n * });\n *\n * export default schema;\n * ```\n *\n * You can inline the table definitions into your schema\n * and extend them with additional optional and required\n * fields. See https://labs.convex.dev/auth/setup/schema\n * for more details.\n */\nexport const authTables = {\n  /**\n   * Users.\n   */\n  users: defineTable({\n    name: v.optional(v.string()),\n    image: v.optional(v.string()),\n    email: v.optional(v.string()),\n    emailVerificationTime: v.optional(v.number()),\n    phone: v.optional(v.string()),\n    phoneVerificationTime: v.optional(v.number()),\n    isAnonymous: v.optional(v.boolean()),\n  })\n    .index(\"email\", [\"email\"])\n    .index(\"phone\", [\"phone\"]),\n  /**\n   * Sessions.\n   * A single user can have multiple active sessions.\n   * See [Session document lifecycle](https://labs.convex.dev/auth/advanced#session-document-lifecycle).\n   */\n  authSessions: defineTable({\n    userId: v.id(\"users\"),\n    expirationTime: v.number(),\n  }).index(\"userId\", [\"userId\"]),\n  /**\n   * Accounts. An account corresponds to\n   * a single authentication provider.\n   * A single user can have multiple accounts linked.\n   */\n  authAccounts: defineTable({\n    userId: v.id(\"users\"),\n    provider: v.string(),\n    providerAccountId: v.string(),\n    secret: v.optional(v.string()),\n    emailVerified: v.optional(v.string()),\n    phoneVerified: v.optional(v.string()),\n  })\n    .index(\"userIdAndProvider\", [\"userId\", \"provider\"])\n    .index(\"providerAndAccountId\", [\"provider\", \"providerAccountId\"]),\n  /**\n   * Refresh tokens.\n   * Refresh tokens are generally meant to be used once, to be exchanged for another\n   * refresh token and a JWT access token, but with a few exceptions:\n   * - The \"active refresh token\" is the most recently created refresh token that has\n   *   not been used yet. The parent of the active refresh token can always be used to\n   *   obtain the active refresh token.\n   * - A refresh token can be used within a 10 second window (\"reuse window\") to\n   *   obtain a new refresh token.\n   * - On any invalid use of a refresh token, the token itself and all its descendants\n   *   are invalidated.\n   */\n  authRefreshTokens: defineTable({\n    sessionId: v.id(\"authSessions\"),\n    expirationTime: v.number(),\n    firstUsedTime: v.optional(v.number()),\n    // This is the ID of the refresh token that was exchanged to create this one.\n    parentRefreshTokenId: v.optional(v.id(\"authRefreshTokens\")),\n  })\n    // Sort by creationTime\n    .index(\"sessionId\", [\"sessionId\"])\n    .index(\"sessionIdAndParentRefreshTokenId\", [\n      \"sessionId\",\n      \"parentRefreshTokenId\",\n    ]),\n  /**\n   * Verification codes:\n   * - OTP tokens\n   * - magic link tokens\n   * - OAuth codes\n   */\n  authVerificationCodes: defineTable({\n    accountId: v.id(\"authAccounts\"),\n    provider: v.string(),\n    code: v.string(),\n    expirationTime: v.number(),\n    verifier: v.optional(v.string()),\n    emailVerified: v.optional(v.string()),\n    phoneVerified: v.optional(v.string()),\n  })\n    .index(\"accountId\", [\"accountId\"])\n    .index(\"code\", [\"code\"]),\n  /**\n   * PKCE verifiers for OAuth.\n   */\n  authVerifiers: defineTable({\n    sessionId: v.optional(v.id(\"authSessions\")),\n    signature: v.optional(v.string()),\n  }).index(\"signature\", [\"signature\"]),\n  /**\n   * Rate limits for OTP and password sign-in.\n   */\n  authRateLimits: defineTable({\n    identifier: v.string(),\n    lastAttemptTime: v.number(),\n    attemptsLeft: v.number(),\n  }).index(\"identifier\", [\"identifier\"]),\n};\n\nconst defaultSchema = defineSchema(authTables);\n\nexport type AuthDataModel = DataModelFromSchemaDefinition<typeof defaultSchema>;\nexport type ActionCtx = GenericActionCtx<AuthDataModel>;\nexport type MutationCtx = GenericMutationCtx<AuthDataModel>;\nexport type QueryCtx = GenericQueryCtx<AuthDataModel>;\nexport type Doc<T extends TableNamesInDataModel<AuthDataModel>> = GenericDoc<\n  AuthDataModel,\n  T\n>;\n\nexport type Tokens = { token: string; refreshToken: string };\nexport type SessionInfo = {\n  userId: GenericId<\"users\">;\n  sessionId: GenericId<\"authSessions\">;\n  tokens: Tokens | null;\n};\nexport type SessionInfoWithTokens = {\n  userId: GenericId<\"users\">;\n  sessionId: GenericId<\"authSessions\">;\n  tokens: Tokens;\n};\n", "export async function sha1(data) {\n    return await crypto.subtle.digest(\"SHA-1\", data);\n}\nexport async function sha256(data) {\n    return await crypto.subtle.digest(\"SHA-256\", data);\n}\nexport async function sha384(data) {\n    return await crypto.subtle.digest(\"SHA-384\", data);\n}\nexport async function sha512(data) {\n    return await crypto.subtle.digest(\"SHA-512\", data);\n}\n", "export function byteToBinary(byte) {\n    return byte.toString(2).padStart(8, \"0\");\n}\nexport function bytesToBinary(bytes) {\n    return [...bytes].map((val) => byteToBinary(val)).join(\"\");\n}\nexport function binaryToInteger(bits) {\n    return parseInt(bits, 2);\n}\nexport function bytesToInteger(bytes) {\n    return parseInt(bytesToBinary(bytes), 2);\n}\nexport function compareBytes(buffer1, buffer2) {\n    const bytes1 = new Uint8Array(buffer1);\n    const bytes2 = new Uint8Array(buffer2);\n    if (bytes1.byteLength !== bytes2.byteLength)\n        return false;\n    for (let i = 0; i < bytes1.byteLength; i++) {\n        if (bytes1[i] !== bytes2[i])\n            return false;\n    }\n    return true;\n}\n", "import { bytesToInteger } from \"../bytes.js\";\nexport function random() {\n    const buffer = new ArrayBuffer(8);\n    const bytes = crypto.getRandomValues(new Uint8Array(buffer));\n    // sets the exponent value (11 bits) to 01111111111 (1023)\n    // since the bias is 1023 (2 * (11 - 1) - 1), 1023 - 1023 = 0\n    // 2^0 * (1 + [52 bit number between 0-1]) = number between 1-2\n    bytes[0] = 63;\n    bytes[1] = bytes[1] | 240;\n    return new DataView(buffer).getFloat64(0) - 1;\n}\nexport function generateRandomInteger(max) {\n    if (max < 0 || !Number.isInteger(max)) {\n        throw new Error(\"Argument 'max' must be an integer greater than or equal to 0\");\n    }\n    const bitLength = (max - 1).toString(2).length;\n    const shift = bitLength % 8;\n    const bytes = new Uint8Array(Math.ceil(bitLength / 8));\n    crypto.getRandomValues(bytes);\n    // This zeroes bits that can be ignored to increase the chance `result` < `max`.\n    // For example, if `max` can be represented with 10 bits, the leading 6 bits of the random 16 bits (2 bytes) can be ignored.\n    if (shift !== 0) {\n        bytes[0] &= (1 << shift) - 1;\n    }\n    let result = bytesToInteger(bytes);\n    while (result >= max) {\n        crypto.getRandomValues(bytes);\n        if (shift !== 0) {\n            bytes[0] &= (1 << shift) - 1;\n        }\n        result = bytesToInteger(bytes);\n    }\n    return result;\n}\nexport function generateRandomString(length, alphabet) {\n    let result = \"\";\n    for (let i = 0; i < length; i++) {\n        result += alphabet[generateRandomInteger(alphabet.length)];\n    }\n    return result;\n}\nexport function alphabet(...patterns) {\n    const patternSet = new Set(patterns);\n    let result = \"\";\n    for (const pattern of patternSet) {\n        if (pattern === \"a-z\") {\n            result += \"abcdefghijklmnopqrstuvwxyz\";\n        }\n        else if (pattern === \"A-Z\") {\n            result += \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\";\n        }\n        else if (pattern === \"0-9\") {\n            result += \"0123456789\";\n        }\n        else {\n            result += pattern;\n        }\n    }\n    return result;\n}\n", "const hexAlphabet = \"0123456789abcdef\";\nconst hexDecodeMap = new Map([\n    [\"0\", 0],\n    [\"1\", 1],\n    [\"2\", 2],\n    [\"3\", 3],\n    [\"4\", 4],\n    [\"5\", 5],\n    [\"6\", 6],\n    [\"7\", 7],\n    [\"8\", 8],\n    [\"9\", 9],\n    [\"A\", 10],\n    [\"B\", 11],\n    [\"C\", 12],\n    [\"D\", 13],\n    [\"E\", 14],\n    [\"F\", 15],\n    [\"a\", 10],\n    [\"b\", 11],\n    [\"c\", 12],\n    [\"d\", 13],\n    [\"e\", 14],\n    [\"f\", 15]\n]);\nexport function encodeHex(data) {\n    const bytes = new Uint8Array(data);\n    let result = \"\";\n    for (let i = 0; i < bytes.length; i++) {\n        const key1 = bytes[i] >> 4;\n        result += hexAlphabet[key1];\n        const key2 = bytes[i] & 0x0f;\n        result += hexAlphabet[key2];\n    }\n    return result;\n}\nexport function decodeHex(data) {\n    const chunkCount = Math.ceil(data.length / 2);\n    const result = new Uint8Array(chunkCount);\n    for (let i = 0; i < chunkCount; i++) {\n        let buffer = 0;\n        const encoded1 = data[i * 2];\n        const value1 = hexDecodeMap.get(encoded1) ?? null;\n        if (value1 === null) {\n            throw new Error(`Invalid character: ${encoded1}`);\n        }\n        buffer += value1 << 4;\n        const encoded2 = data[i * 2 + 1];\n        if (encoded2 === undefined) {\n            throw new Error(\"Invalid data\");\n        }\n        const value2 = hexDecodeMap.get(encoded2) ?? null;\n        if (value2 === null) {\n            throw new Error(`Invalid character: ${encoded1}`);\n        }\n        buffer += value2;\n        result[i] = buffer;\n    }\n    return result;\n}\n", "export class Base32Encoding {\n    alphabet;\n    padding;\n    decodeMap = new Map();\n    constructor(alphabet, options) {\n        if (alphabet.length !== 32) {\n            throw new Error(\"Invalid alphabet\");\n        }\n        this.alphabet = alphabet;\n        this.padding = options?.padding ?? \"=\";\n        if (this.alphabet.includes(this.padding) || this.padding.length !== 1) {\n            throw new Error(\"Invalid padding\");\n        }\n        for (let i = 0; i < alphabet.length; i++) {\n            this.decodeMap.set(alphabet[i], i);\n        }\n    }\n    encode(data, options) {\n        let result = \"\";\n        let buffer = 0;\n        let shift = 0;\n        for (let i = 0; i < data.length; i++) {\n            buffer = (buffer << 8) | data[i];\n            shift += 8;\n            while (shift >= 5) {\n                shift -= 5;\n                result += this.alphabet[(buffer >> shift) & 0x1f];\n            }\n        }\n        if (shift > 0) {\n            result += this.alphabet[(buffer << (5 - shift)) & 0x1f];\n        }\n        const includePadding = options?.includePadding ?? true;\n        if (includePadding) {\n            const padCount = (8 - (result.length % 8)) % 8;\n            for (let i = 0; i < padCount; i++) {\n                result += \"=\";\n            }\n        }\n        return result;\n    }\n    decode(data, options) {\n        const strict = options?.strict ?? true;\n        const chunkCount = Math.ceil(data.length / 8);\n        const result = [];\n        for (let i = 0; i < chunkCount; i++) {\n            let padCount = 0;\n            const chunks = [];\n            for (let j = 0; j < 8; j++) {\n                const encoded = data[i * 8 + j];\n                if (encoded === \"=\") {\n                    if (i + 1 !== chunkCount) {\n                        throw new Error(`Invalid character: ${encoded}`);\n                    }\n                    padCount += 1;\n                    continue;\n                }\n                if (encoded === undefined) {\n                    if (strict) {\n                        throw new Error(\"Invalid data\");\n                    }\n                    padCount += 1;\n                    continue;\n                }\n                const value = this.decodeMap.get(encoded) ?? null;\n                if (value === null) {\n                    throw new Error(`Invalid character: ${encoded}`);\n                }\n                chunks.push(value);\n            }\n            if (padCount === 8 || padCount === 7 || padCount === 5 || padCount === 2) {\n                throw new Error(\"Invalid padding\");\n            }\n            const byte1 = (chunks[0] << 3) + (chunks[1] >> 2);\n            result.push(byte1);\n            if (padCount < 6) {\n                const byte2 = ((chunks[1] & 0x03) << 6) + (chunks[2] << 1) + (chunks[3] >> 4);\n                result.push(byte2);\n            }\n            if (padCount < 4) {\n                const byte3 = ((chunks[3] & 0xff) << 4) + (chunks[4] >> 1);\n                result.push(byte3);\n            }\n            if (padCount < 3) {\n                const byte4 = ((chunks[4] & 0x01) << 7) + (chunks[5] << 2) + (chunks[6] >> 3);\n                result.push(byte4);\n            }\n            if (padCount < 1) {\n                const byte5 = ((chunks[6] & 0x07) << 5) + chunks[7];\n                result.push(byte5);\n            }\n        }\n        return Uint8Array.from(result);\n    }\n}\nexport const base32 = new Base32Encoding(\"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567\");\nexport const base32hex = new Base32Encoding(\"0123456789ABCDEFGHIJKLMNOPQRSTUV\");\n/** @deprecated Use `base32.encode()` instead */\nexport function encodeBase32(data, options) {\n    return base32.encode(new Uint8Array(data), {\n        includePadding: options?.padding ?? true\n    });\n}\n/** @deprecated Use `base32.decode()` instead */\nexport function decodeBase32(data) {\n    return base32.decode(data, {\n        strict: false\n    });\n}\n", "export class Base64Encoding {\n    alphabet;\n    padding;\n    decodeMap = new Map();\n    constructor(alphabet, options) {\n        if (alphabet.length !== 64) {\n            throw new Error(\"Invalid alphabet\");\n        }\n        this.alphabet = alphabet;\n        this.padding = options?.padding ?? \"=\";\n        if (this.alphabet.includes(this.padding) || this.padding.length !== 1) {\n            throw new Error(\"Invalid padding\");\n        }\n        for (let i = 0; i < alphabet.length; i++) {\n            this.decodeMap.set(alphabet[i], i);\n        }\n    }\n    encode(data, options) {\n        let result = \"\";\n        let buffer = 0;\n        let shift = 0;\n        for (let i = 0; i < data.length; i++) {\n            buffer = (buffer << 8) | data[i];\n            shift += 8;\n            while (shift >= 6) {\n                shift += -6;\n                result += this.alphabet[(buffer >> shift) & 0x3f];\n            }\n        }\n        if (shift > 0) {\n            result += this.alphabet[(buffer << (6 - shift)) & 0x3f];\n        }\n        const includePadding = options?.includePadding ?? true;\n        if (includePadding) {\n            const padCount = (4 - (result.length % 4)) % 4;\n            for (let i = 0; i < padCount; i++) {\n                result += \"=\";\n            }\n        }\n        return result;\n    }\n    decode(data, options) {\n        const strict = options?.strict ?? true;\n        const chunkCount = Math.ceil(data.length / 4);\n        const result = [];\n        for (let i = 0; i < chunkCount; i++) {\n            let padCount = 0;\n            let buffer = 0;\n            for (let j = 0; j < 4; j++) {\n                const encoded = data[i * 4 + j];\n                if (encoded === \"=\") {\n                    if (i + 1 !== chunkCount) {\n                        throw new Error(`Invalid character: ${encoded}`);\n                    }\n                    padCount += 1;\n                    continue;\n                }\n                if (encoded === undefined) {\n                    if (strict) {\n                        throw new Error(\"Invalid data\");\n                    }\n                    padCount += 1;\n                    continue;\n                }\n                const value = this.decodeMap.get(encoded) ?? null;\n                if (value === null) {\n                    throw new Error(`Invalid character: ${encoded}`);\n                }\n                buffer += value << (6 * (3 - j));\n            }\n            result.push((buffer >> 16) & 0xff);\n            if (padCount < 2) {\n                result.push((buffer >> 8) & 0xff);\n            }\n            if (padCount < 1) {\n                result.push(buffer & 0xff);\n            }\n        }\n        return Uint8Array.from(result);\n    }\n}\nexport const base64 = new Base64Encoding(\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\");\nexport const base64url = new Base64Encoding(\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_\");\n/** @deprecated Use `base64.encode()` instead */\nexport function encodeBase64(data, options) {\n    return base64.encode(new Uint8Array(data), {\n        includePadding: options?.padding ?? true\n    });\n}\n/** @deprecated Use `base64.decode()` instead */\nexport function decodeBase64(data) {\n    return base64.decode(data, {\n        strict: false\n    });\n}\n/** @deprecated Use `base64url.encode()` instead */\nexport function encodeBase64url(data) {\n    return base64.encode(new Uint8Array(data), {\n        includePadding: false\n    });\n}\n/** @deprecated Use `base64url.decode()` instead */\nexport function decodeBase64url(data) {\n    return base64url.decode(data, {\n        strict: false\n    });\n}\n", "import { sha256 as rawSha256 } from \"oslo/crypto\";\nimport { encodeHex } from \"oslo/encoding\";\n\nexport const TOKEN_SUB_CLAIM_DIVIDER = \"|\";\nexport const REFRESH_TOKEN_DIVIDER = \"|\";\n\nexport function stringToNumber(value: string | undefined) {\n  return value !== undefined ? Number(value) : undefined;\n}\n\nexport async function sha256(input: string) {\n  return encodeHex(await rawSha256(new TextEncoder().encode(input)));\n}\n\nexport function logError(error: unknown) {\n  logWithLevel(\n    LOG_LEVELS.ERROR,\n    error instanceof Error\n      ? error.message + \"\\n\" + error.stack?.replace(\"\\\\n\", \"\\n\")\n      : error,\n  );\n}\n\nexport const LOG_LEVELS = {\n  ERROR: \"ERROR\",\n  WARN: \"WARN\",\n  INFO: \"INFO\",\n  DEBUG: \"DEBUG\",\n} as const;\ntype LogLevel = keyof typeof LOG_LEVELS;\n\nexport function logWithLevel(level: LogLevel, ...args: unknown[]) {\n  const configuredLogLevel =\n    LOG_LEVELS[\n      (process.env.AUTH_LOG_LEVEL as LogLevel | undefined) ?? \"INFO\"\n    ] ?? \"INFO\";\n  switch (level) {\n    case \"ERROR\":\n      console.error(...args);\n      break;\n    case \"WARN\":\n      if (configuredLogLevel !== \"ERROR\") {\n        console.warn(...args);\n      }\n      break;\n    case \"INFO\":\n      if (configuredLogLevel === \"INFO\" || configuredLogLevel === \"DEBUG\") {\n        console.info(...args);\n      }\n      break;\n    case \"DEBUG\":\n      if (configuredLogLevel === \"DEBUG\") {\n        console.debug(...args);\n      }\n      break;\n  }\n}\n\nconst UNREDACTED_LENGTH = 5;\nexport function maybeRedact(value: string) {\n  if (value === \"\") {\n    return \"\";\n  }\n  const shouldRedact = process.env.AUTH_LOG_SECRETS !== \"true\";\n  if (shouldRedact) {\n    if (value.length < UNREDACTED_LENGTH * 2) {\n      return \"<redacted>\";\n    }\n    return (\n      value.substring(0, UNREDACTED_LENGTH) +\n      \"<redacted>\" +\n      value.substring(value.length - UNREDACTED_LENGTH)\n    );\n  } else {\n    return value;\n  }\n}\n", "import { GenericId } from \"convex/values\";\nimport { ConvexAuthConfig } from \"../index.js\";\nimport { SignJWT, importPKCS8 } from \"jose\";\nimport { requireEnv } from \"../utils.js\";\nimport { TOKEN_SUB_CLAIM_DIVIDER } from \"./utils.js\";\n\nconst DEFAULT_JWT_DURATION_MS = 1000 * 60 * 60; // 1 hour\n\nexport async function generateToken(\n  args: {\n    userId: GenericId<\"users\">;\n    sessionId: GenericId<\"authSessions\">;\n  },\n  config: ConvexAuthConfig,\n) {\n  const privateKey = await importPKCS8(requireEnv(\"JWT_PRIVATE_KEY\"), \"RS256\");\n  const expirationTime = new Date(\n    Date.now() + (config.jwt?.durationMs ?? DEFAULT_JWT_DURATION_MS),\n  );\n  return await new SignJWT({\n    sub: args.userId + TOKEN_SUB_CLAIM_DIVIDER + args.sessionId,\n  })\n    .setProtectedHeader({ alg: \"RS256\" })\n    .setIssuedAt()\n    .setIssuer(requireEnv(\"CONVEX_SITE_URL\"))\n    .setAudience(\"convex\")\n    .setExpirationTime(expirationTime)\n    .sign(privateKey);\n}\n", "import { GenericId } from \"convex/values\";\nimport { ConvexAuthConfig } from \"../index.js\";\nimport { Doc, MutationCtx, QueryCtx } from \"./types.js\";\nimport {\n  LOG_LEVELS,\n  REFRESH_TOKEN_DIVIDER,\n  logWithLevel,\n  maybeRedact,\n  stringToNumber,\n} from \"./utils.js\";\n\nconst DEFAULT_SESSION_INACTIVE_DURATION_MS = 1000 * 60 * 60 * 24 * 30; // 30 days\nexport const REFRESH_TOKEN_REUSE_WINDOW_MS = 10 * 1000; // 10 seconds\nexport async function createRefreshToken(\n  ctx: MutationCtx,\n  config: ConvexAuthConfig,\n  sessionId: GenericId<\"authSessions\">,\n  parentRefreshTokenId: GenericId<\"authRefreshTokens\"> | null,\n) {\n  const expirationTime =\n    Date.now() +\n    (config.session?.inactiveDurationMs ??\n      stringToNumber(process.env.AUTH_SESSION_INACTIVE_DURATION_MS) ??\n      DEFAULT_SESSION_INACTIVE_DURATION_MS);\n  const newRefreshTokenId = await ctx.db.insert(\"authRefreshTokens\", {\n    sessionId,\n    expirationTime,\n    parentRefreshTokenId: parentRefreshTokenId ?? undefined,\n  });\n  return newRefreshTokenId;\n}\n\nexport const formatRefreshToken = (\n  refreshTokenId: GenericId<\"authRefreshTokens\">,\n  sessionId: GenericId<\"authSessions\">,\n) => {\n  return `${refreshTokenId}${REFRESH_TOKEN_DIVIDER}${sessionId}`;\n};\n\nexport const parseRefreshToken = (\n  refreshToken: string,\n): {\n  refreshTokenId: GenericId<\"authRefreshTokens\">;\n  sessionId: GenericId<\"authSessions\">;\n} => {\n  const [refreshTokenId, sessionId] = refreshToken.split(REFRESH_TOKEN_DIVIDER);\n  if (!refreshTokenId || !sessionId) {\n    throw new Error(`Can't parse refresh token: ${maybeRedact(refreshToken)}`);\n  }\n  return {\n    refreshTokenId: refreshTokenId as GenericId<\"authRefreshTokens\">,\n    sessionId: sessionId as GenericId<\"authSessions\">,\n  };\n};\n\n/**\n * Mark all refresh tokens descending from the given refresh token as invalid immediately.\n * This is used when we detect an invalid use of a refresh token, and want to revoke\n * the entire tree.\n *\n * @param ctx\n * @param refreshToken\n */\nexport async function invalidateRefreshTokensInSubtree(\n  ctx: MutationCtx,\n  refreshToken: Doc<\"authRefreshTokens\">,\n) {\n  const tokensToInvalidate = [refreshToken];\n  let frontier = [refreshToken._id];\n  while (frontier.length > 0) {\n    const nextFrontier = [];\n    for (const currentTokenId of frontier) {\n      const children = await ctx.db\n        .query(\"authRefreshTokens\")\n        .withIndex(\"sessionIdAndParentRefreshTokenId\", (q) =>\n          q\n            .eq(\"sessionId\", refreshToken.sessionId)\n            .eq(\"parentRefreshTokenId\", currentTokenId),\n        )\n        .collect();\n      tokensToInvalidate.push(...children);\n      nextFrontier.push(...children.map((child) => child._id));\n    }\n    frontier = nextFrontier;\n  }\n  for (const token of tokensToInvalidate) {\n    // Mark these as used so they can't be used again (even within the reuse window)\n    if (\n      token.firstUsedTime === undefined ||\n      token.firstUsedTime > Date.now() - REFRESH_TOKEN_REUSE_WINDOW_MS\n    ) {\n      await ctx.db.patch(token._id, {\n        firstUsedTime: Date.now() - REFRESH_TOKEN_REUSE_WINDOW_MS,\n      });\n    }\n  }\n  return tokensToInvalidate;\n}\n\nexport async function deleteAllRefreshTokens(\n  ctx: MutationCtx,\n  sessionId: GenericId<\"authSessions\">,\n) {\n  const existingRefreshTokens = await ctx.db\n    .query(\"authRefreshTokens\")\n    .withIndex(\"sessionIdAndParentRefreshTokenId\", (q) =>\n      q.eq(\"sessionId\", sessionId),\n    )\n    .collect();\n  for (const refreshTokenDoc of existingRefreshTokens) {\n    await ctx.db.delete(refreshTokenDoc._id);\n  }\n}\n\nexport async function refreshTokenIfValid(\n  ctx: MutationCtx,\n  refreshTokenId: string,\n  tokenSessionId: string,\n) {\n  const refreshTokenDoc = await ctx.db.get(\n    refreshTokenId as GenericId<\"authRefreshTokens\">,\n  );\n\n  if (refreshTokenDoc === null) {\n    logWithLevel(LOG_LEVELS.ERROR, \"Invalid refresh token\");\n    return null;\n  }\n  if (refreshTokenDoc.expirationTime < Date.now()) {\n    logWithLevel(LOG_LEVELS.ERROR, \"Expired refresh token\");\n    return null;\n  }\n  if (refreshTokenDoc.sessionId !== tokenSessionId) {\n    logWithLevel(LOG_LEVELS.ERROR, \"Invalid refresh token session ID\");\n    return null;\n  }\n  const session = await ctx.db.get(refreshTokenDoc.sessionId);\n  if (session === null) {\n    logWithLevel(LOG_LEVELS.ERROR, \"Invalid refresh token session\");\n    return null;\n  }\n  if (session.expirationTime < Date.now()) {\n    logWithLevel(LOG_LEVELS.ERROR, \"Expired refresh token session\");\n    return null;\n  }\n  return { session, refreshTokenDoc };\n}\n/**\n * The active refresh token is the most recently created refresh token that has\n * never been used.\n *\n * @param ctx\n * @param sessionId\n */\nexport async function loadActiveRefreshToken(\n  ctx: QueryCtx,\n  sessionId: GenericId<\"authSessions\">,\n) {\n  return ctx.db\n    .query(\"authRefreshTokens\")\n    .withIndex(\"sessionId\", (q) => q.eq(\"sessionId\", sessionId))\n    .filter((q) => q.eq(q.field(\"firstUsedTime\"), undefined))\n    .order(\"desc\")\n    .first();\n}\n", "import { GenericId } from \"convex/values\";\nimport { ConvexAuthConfig } from \"../index.js\";\nimport { Doc, MutationCtx, SessionInfo } from \"./types.js\";\nimport { Auth } from \"convex/server\";\nimport {\n  LOG_LEVELS,\n  TOKEN_SUB_CLAIM_DIVIDER,\n  logWithLevel,\n  maybeRedact,\n  stringToNumber,\n} from \"./utils.js\";\nimport { generateToken } from \"./tokens.js\";\nimport {\n  createRefreshToken,\n  formatRefreshToken,\n  deleteAllRefreshTokens,\n} from \"./refreshTokens.js\";\n\nconst DEFAULT_SESSION_TOTAL_DURATION_MS = 1000 * 60 * 60 * 24 * 30; // 30 days\n\nexport async function maybeGenerateTokensForSession(\n  ctx: MutationCtx,\n  config: ConvexAuthConfig,\n  userId: GenericId<\"users\">,\n  sessionId: GenericId<\"authSessions\">,\n  generateTokens: boolean,\n): Promise<SessionInfo> {\n  return {\n    userId,\n    sessionId,\n    tokens: generateTokens\n      ? await generateTokensForSession(ctx, config, {\n          userId,\n          sessionId,\n          issuedRefreshTokenId: null,\n          parentRefreshTokenId: null,\n        })\n      : null,\n  };\n}\n\nexport async function createNewAndDeleteExistingSession(\n  ctx: MutationCtx,\n  config: ConvexAuthConfig,\n  userId: GenericId<\"users\">,\n) {\n  const existingSessionId = await getAuthSessionId(ctx);\n  if (existingSessionId !== null) {\n    const existingSession = await ctx.db.get(existingSessionId);\n    if (existingSession !== null) {\n      await deleteSession(ctx, existingSession);\n    }\n  }\n  return await createSession(ctx, userId, config);\n}\n\nexport async function generateTokensForSession(\n  ctx: MutationCtx,\n  config: ConvexAuthConfig,\n  args: {\n    userId: GenericId<\"users\">;\n    sessionId: GenericId<\"authSessions\">;\n    issuedRefreshTokenId: GenericId<\"authRefreshTokens\"> | null;\n    parentRefreshTokenId: GenericId<\"authRefreshTokens\"> | null;\n  },\n) {\n  const ids = { userId: args.userId, sessionId: args.sessionId };\n  const refreshTokenId =\n    args.issuedRefreshTokenId ??\n    (await createRefreshToken(\n      ctx,\n      config,\n      args.sessionId,\n      args.parentRefreshTokenId,\n    ));\n  const result = {\n    token: await generateToken(ids, config),\n    refreshToken: formatRefreshToken(refreshTokenId, args.sessionId),\n  };\n  logWithLevel(\n    LOG_LEVELS.DEBUG,\n    `Generated token ${maybeRedact(result.token)} and refresh token ${maybeRedact(refreshTokenId)} for session ${maybeRedact(args.sessionId)}`,\n  );\n  return result;\n}\n\nasync function createSession(\n  ctx: MutationCtx,\n  userId: GenericId<\"users\">,\n  config: ConvexAuthConfig,\n) {\n  const expirationTime =\n    Date.now() +\n    (config.session?.totalDurationMs ??\n      stringToNumber(process.env.AUTH_SESSION_TOTAL_DURATION_MS) ??\n      DEFAULT_SESSION_TOTAL_DURATION_MS);\n  return await ctx.db.insert(\"authSessions\", { expirationTime, userId });\n}\n\nexport async function deleteSession(\n  ctx: MutationCtx,\n  session: Doc<\"authSessions\">,\n) {\n  await ctx.db.delete(session._id);\n  await deleteAllRefreshTokens(ctx, session._id);\n}\n\n/**\n * Return the current session ID.\n *\n * ```ts filename=\"convex/myFunctions.tsx\"\n * import { mutation } from \"./_generated/server\";\n * import { getAuthSessionId } from \"@convex-dev/auth/server\";\n *\n * export const doSomething = mutation({\n *   args: {/* ... *\\/},\n *   handler: async (ctx, args) => {\n *     const sessionId = await getAuthSessionId(ctx);\n *     if (sessionId === null) {\n *       throw new Error(\"Client is not authenticated!\")\n *     }\n *     const session = await ctx.db.get(sessionId);\n *     // ...\n *   },\n * });\n * ```\n *\n * @param ctx query, mutation or action `ctx`\n * @returns the session ID or `null` if the client isn't authenticated\n */\nexport async function getAuthSessionId(ctx: { auth: Auth }) {\n  const identity = await ctx.auth.getUserIdentity();\n  if (identity === null) {\n    return null;\n  }\n  const [, sessionId] = identity.subject.split(TOKEN_SUB_CLAIM_DIVIDER);\n  return sessionId as GenericId<\"authSessions\">;\n}\n", "import { Infer, v } from \"convex/values\";\nimport { ActionCtx, MutationCtx, SessionInfo } from \"../types.js\";\nimport * as Provider from \"../provider.js\";\nimport {\n  createNewAndDeleteExistingSession,\n  maybeGenerateTokensForSession,\n} from \"../sessions.js\";\nimport { LOG_LEVELS, logWithLevel } from \"../utils.js\";\n\nexport const signInArgs = v.object({\n  userId: v.id(\"users\"),\n  sessionId: v.optional(v.id(\"authSessions\")),\n  generateTokens: v.boolean(),\n});\n\ntype ReturnType = SessionInfo;\n\nexport async function signInImpl(\n  ctx: MutationCtx,\n  args: Infer<typeof signInArgs>,\n  config: Provider.Config,\n): Promise<ReturnType> {\n  logWithLevel(LOG_LEVELS.DEBUG, \"signInImpl args:\", args);\n  const { userId, sessionId: existingSessionId, generateTokens } = args;\n  const sessionId =\n    existingSessionId ??\n    (await createNewAndDeleteExistingSession(ctx, config, userId));\n  return await maybeGenerateTokensForSession(\n    ctx,\n    config,\n    userId,\n    sessionId,\n    generateTokens,\n  );\n}\n\nexport const callSignIn = async (\n  ctx: ActionCtx,\n  args: Infer<typeof signInArgs>,\n): Promise<ReturnType> => {\n  return ctx.runMutation(\"auth:store\" as any, {\n    args: {\n      type: \"signIn\",\n      ...args,\n    },\n  });\n};\n", "import { GenericId } from \"convex/values\";\nimport { ActionCtx, MutationCtx } from \"../types.js\";\nimport { deleteSession, getAuthSessionId } from \"../sessions.js\";\n\ntype ReturnType = {\n  userId: GenericId<\"users\">;\n  sessionId: GenericId<\"authSessions\">;\n} | null;\n\nexport async function signOutImpl(ctx: MutationCtx): Promise<ReturnType> {\n  const sessionId = await getAuthSessionId(ctx);\n  if (sessionId !== null) {\n    const session = await ctx.db.get(sessionId);\n    if (session !== null) {\n      await deleteSession(ctx, session);\n      return { userId: session.userId, sessionId: session._id };\n    }\n  }\n  return null;\n}\n\nexport const callSignOut = async (ctx: ActionCtx): Promise<void> => {\n  return ctx.runMutation(\"auth:store\" as any, {\n    args: {\n      type: \"signOut\",\n    },\n  });\n};\n", "import { Infer, v } from \"convex/values\";\nimport { ActionCtx, MutationCtx } from \"../types.js\";\nimport * as Provider from \"../provider.js\";\nimport { logWithLevel, maybeRedact } from \"../utils.js\";\nimport {\n  deleteAllRefreshTokens,\n  invalidateRefreshTokensInSubtree,\n  loadActiveRefreshToken,\n  parseRefreshToken,\n  REFRESH_TOKEN_REUSE_WINDOW_MS,\n  refreshTokenIfValid,\n} from \"../refreshTokens.js\";\nimport { generateTokensForSession } from \"../sessions.js\";\n\nexport const refreshSessionArgs = v.object({\n  refreshToken: v.string(),\n});\n\ntype ReturnType = null | {\n  token: string;\n  refreshToken: string;\n};\n\nexport async function refreshSessionImpl(\n  ctx: MutationCtx,\n  args: Infer<typeof refreshSessionArgs>,\n  getProviderOrThrow: Provider.GetProviderOrThrowFunc,\n  config: Provider.Config,\n): Promise<ReturnType> {\n  const { refreshToken } = args;\n  const { refreshTokenId, sessionId: tokenSessionId } =\n    parseRefreshToken(refreshToken);\n  logWithLevel(\n    \"DEBUG\",\n    `refreshSessionImpl args: Token ID: ${maybeRedact(refreshTokenId)} Session ID: ${maybeRedact(\n      tokenSessionId,\n    )}`,\n  );\n  const validationResult = await refreshTokenIfValid(\n    ctx,\n    refreshTokenId,\n    tokenSessionId,\n  );\n\n  if (validationResult === null) {\n    // Replicating `deleteSession` but ensuring that we delete both the session\n    // and the refresh token, even if one of them is missing.\n    const session = await ctx.db.get(tokenSessionId);\n    if (session !== null) {\n      await ctx.db.delete(session._id);\n    }\n    await deleteAllRefreshTokens(ctx, tokenSessionId);\n    return null;\n  }\n  const { session } = validationResult;\n  const sessionId = session._id;\n  const userId = session.userId;\n\n  const tokenFirstUsed = validationResult.refreshTokenDoc.firstUsedTime;\n\n  // First use -- mark as used and generate new refresh token\n  if (tokenFirstUsed === undefined) {\n    await ctx.db.patch(refreshTokenId, {\n      firstUsedTime: Date.now(),\n    });\n    const result = await generateTokensForSession(ctx, config, {\n      userId,\n      sessionId,\n      issuedRefreshTokenId: null,\n      parentRefreshTokenId: refreshTokenId,\n    });\n    const { refreshTokenId: newRefreshTokenId } = parseRefreshToken(\n      result.refreshToken,\n    );\n    logWithLevel(\n      \"DEBUG\",\n      `Exchanged ${maybeRedact(validationResult.refreshTokenDoc._id)} (first use) for new refresh token ${maybeRedact(newRefreshTokenId)}`,\n    );\n    return result;\n  }\n\n  // Token has been used before\n  // Check if parent of active refresh token\n  const activeRefreshToken = await loadActiveRefreshToken(ctx, tokenSessionId);\n  logWithLevel(\n    \"DEBUG\",\n    `Active refresh token: ${maybeRedact(activeRefreshToken?._id ?? \"(none)\")}, parent ${maybeRedact(activeRefreshToken?.parentRefreshTokenId ?? \"(none)\")}`,\n  );\n  if (\n    activeRefreshToken !== null &&\n    activeRefreshToken.parentRefreshTokenId === refreshTokenId\n  ) {\n    logWithLevel(\n      \"DEBUG\",\n      `Token ${maybeRedact(validationResult.refreshTokenDoc._id)} is parent of active refresh token ${maybeRedact(activeRefreshToken._id)}, so returning that token`,\n    );\n\n    const result = await generateTokensForSession(ctx, config, {\n      userId,\n      sessionId,\n      issuedRefreshTokenId: activeRefreshToken._id,\n      parentRefreshTokenId: refreshTokenId,\n    });\n    return result;\n  }\n\n  // Check if within reuse window\n  if (tokenFirstUsed + REFRESH_TOKEN_REUSE_WINDOW_MS > Date.now()) {\n    const result = await generateTokensForSession(ctx, config, {\n      userId,\n      sessionId,\n      issuedRefreshTokenId: null,\n      parentRefreshTokenId: refreshTokenId,\n    });\n    const { refreshTokenId: newRefreshTokenId } = parseRefreshToken(\n      result.refreshToken,\n    );\n    logWithLevel(\n      \"DEBUG\",\n      `Exchanged ${maybeRedact(validationResult.refreshTokenDoc._id)} (reuse) for new refresh token ${maybeRedact(newRefreshTokenId)}`,\n    );\n    return result;\n  } else {\n    // Outside of reuse window -- invalidate all refresh tokens in subtree\n    logWithLevel(\"ERROR\", \"Refresh token used outside of reuse window\");\n    logWithLevel(\n      \"DEBUG\",\n      `Token ${maybeRedact(validationResult.refreshTokenDoc._id)} being used outside of reuse window, so invalidating all refresh tokens in subtree`,\n    );\n    const tokensToInvalidate = await invalidateRefreshTokensInSubtree(\n      ctx,\n      validationResult.refreshTokenDoc,\n    );\n    logWithLevel(\n      \"DEBUG\",\n      `Invalidated ${tokensToInvalidate.length} refresh tokens in subtree: ${tokensToInvalidate\n        .map((token) => maybeRedact(token._id))\n        .join(\", \")}`,\n    );\n    return null;\n  }\n}\n\nexport const callRefreshSession = async (\n  ctx: ActionCtx,\n  args: Infer<typeof refreshSessionArgs>,\n): Promise<ReturnType> => {\n  return ctx.runMutation(\"auth:store\" as any, {\n    args: {\n      type: \"refreshSession\",\n      ...args,\n    },\n  });\n};\n", "import { ConvexAuthConfig } from \"../index.js\";\nimport { MutationCtx } from \"./types.js\";\n\nconst DEFAULT_MAX_SIGN_IN_ATTEMPTS_PER_HOUR = 10;\n\nexport async function isSignInRateLimited(\n  ctx: MutationCtx,\n  identifier: string,\n  config: ConvexAuthConfig,\n) {\n  const state = await getRateLimitState(ctx, identifier, config);\n  if (state === null) {\n    return false;\n  }\n  return state.attempsLeft < 1;\n}\n\nexport async function recordFailedSignIn(\n  ctx: MutationCtx,\n  identifier: string,\n  config: ConvexAuthConfig,\n) {\n  const state = await getRateLimitState(ctx, identifier, config);\n  if (state !== null) {\n    await ctx.db.patch(state.limit._id, {\n      attemptsLeft: state.attempsLeft - 1,\n      lastAttemptTime: Date.now(),\n    });\n  } else {\n    const maxAttempsPerHour = configuredMaxAttempsPerHour(config);\n    await ctx.db.insert(\"authRateLimits\", {\n      identifier,\n      attemptsLeft: maxAttempsPerHour - 1,\n      lastAttemptTime: Date.now(),\n    });\n  }\n}\n\nexport async function resetSignInRateLimit(\n  ctx: MutationCtx,\n  identifier: string,\n) {\n  const existingState = await ctx.db\n    .query(\"authRateLimits\")\n    .withIndex(\"identifier\", (q) => q.eq(\"identifier\", identifier))\n    .unique();\n  if (existingState !== null) {\n    await ctx.db.delete(existingState._id);\n  }\n}\n\nasync function getRateLimitState(\n  ctx: MutationCtx,\n  identifier: string,\n  config: ConvexAuthConfig,\n) {\n  const now = Date.now();\n  const maxAttempsPerHour = configuredMaxAttempsPerHour(config);\n  const limit = await ctx.db\n    .query(\"authRateLimits\")\n    .withIndex(\"identifier\", (q) => q.eq(\"identifier\", identifier))\n    .unique();\n  if (limit === null) {\n    return null;\n  }\n  const elapsed = now - limit.lastAttemptTime;\n  const maxAttempsPerMs = maxAttempsPerHour / (60 * 60 * 1000);\n  const attempsLeft = Math.min(\n    maxAttempsPerHour,\n    limit.attemptsLeft + elapsed * maxAttempsPerMs,\n  );\n  return { limit, attempsLeft };\n}\n\nfunction configuredMaxAttempsPerHour(config: ConvexAuthConfig) {\n  return (\n    config.signIn?.maxFailedAttempsPerHour ??\n    DEFAULT_MAX_SIGN_IN_ATTEMPTS_PER_HOUR\n  );\n}\n", "import { GenericId } from \"convex/values\";\nimport { Doc, MutationCtx, QueryCtx } from \"./types.js\";\nimport { AuthProviderMaterializedConfig, ConvexAuthConfig } from \"../types.js\";\nimport { LOG_LEVELS, logWithLevel } from \"./utils.js\";\n\ntype CreateOrUpdateUserArgs = {\n  type: \"oauth\" | \"credentials\" | \"email\" | \"phone\" | \"verification\";\n  provider: AuthProviderMaterializedConfig;\n  profile: Record<string, unknown> & {\n    email?: string;\n    phone?: string;\n    emailVerified?: boolean;\n    phoneVerified?: boolean;\n  };\n  shouldLinkViaEmail?: boolean;\n  shouldLinkViaPhone?: boolean;\n};\n\nexport async function upsertUserAndAccount(\n  ctx: MutationCtx,\n  sessionId: GenericId<\"authSessions\"> | null,\n  account:\n    | { existingAccount: Doc<\"authAccounts\"> }\n    | {\n        providerAccountId: string;\n        secret?: string;\n      },\n  args: CreateOrUpdateUserArgs,\n  config: ConvexAuthConfig,\n): Promise<{\n  userId: GenericId<\"users\">;\n  accountId: GenericId<\"authAccounts\">;\n}> {\n  const userId = await defaultCreateOrUpdateUser(\n    ctx,\n    sessionId,\n    \"existingAccount\" in account ? account.existingAccount : null,\n    args,\n    config,\n  );\n  const accountId = await createOrUpdateAccount(ctx, userId, account, args);\n  return { userId, accountId };\n}\n\nasync function defaultCreateOrUpdateUser(\n  ctx: MutationCtx,\n  existingSessionId: GenericId<\"authSessions\"> | null,\n  existingAccount: Doc<\"authAccounts\"> | null,\n  args: CreateOrUpdateUserArgs,\n  config: ConvexAuthConfig,\n) {\n  logWithLevel(LOG_LEVELS.DEBUG, \"defaultCreateOrUpdateUser args:\", {\n    existingAccountId: existingAccount?._id,\n    existingSessionId,\n    args,\n  });\n  const existingUserId = existingAccount?.userId ?? null;\n  if (config.callbacks?.createOrUpdateUser !== undefined) {\n    logWithLevel(LOG_LEVELS.DEBUG, \"Using custom createOrUpdateUser callback\");\n    return await config.callbacks.createOrUpdateUser(ctx, {\n      existingUserId,\n      ...args,\n    });\n  }\n\n  const {\n    provider,\n    profile: {\n      emailVerified: profileEmailVerified,\n      phoneVerified: profilePhoneVerified,\n      ...profile\n    },\n  } = args;\n  const emailVerified =\n    profileEmailVerified ??\n    ((provider.type === \"oauth\" || provider.type === \"oidc\") &&\n      provider.allowDangerousEmailAccountLinking !== false);\n  const phoneVerified = profilePhoneVerified ?? false;\n  const shouldLinkViaEmail =\n    args.shouldLinkViaEmail || emailVerified || provider.type === \"email\";\n  const shouldLinkViaPhone =\n    args.shouldLinkViaPhone || phoneVerified || provider.type === \"phone\";\n\n  let userId = existingUserId;\n  if (existingUserId === null) {\n    const existingUserWithVerifiedEmailId =\n      typeof profile.email === \"string\" && shouldLinkViaEmail\n        ? (await uniqueUserWithVerifiedEmail(ctx, profile.email))?._id ?? null\n        : null;\n\n    const existingUserWithVerifiedPhoneId =\n      typeof profile.phone === \"string\" && shouldLinkViaPhone\n        ? (await uniqueUserWithVerifiedPhone(ctx, profile.phone))?._id ?? null\n        : null;\n    // If there is both email and phone verified user\n    // already we can't link.\n    if (\n      existingUserWithVerifiedEmailId !== null &&\n      existingUserWithVerifiedPhoneId !== null\n    ) {\n      logWithLevel(\n        LOG_LEVELS.DEBUG,\n        `Found existing email and phone verified users, so not linking: email: ${existingUserWithVerifiedEmailId}, phone: ${existingUserWithVerifiedPhoneId}`,\n      );\n      userId = null;\n    } else if (existingUserWithVerifiedEmailId !== null) {\n      logWithLevel(\n        LOG_LEVELS.DEBUG,\n        `Found existing email verified user, linking: ${existingUserWithVerifiedEmailId}`,\n      );\n      userId = existingUserWithVerifiedEmailId;\n    } else if (existingUserWithVerifiedPhoneId !== null) {\n      logWithLevel(\n        LOG_LEVELS.DEBUG,\n        `Found existing phone verified user, linking: ${existingUserWithVerifiedPhoneId}`,\n      );\n      userId = existingUserWithVerifiedPhoneId;\n    } else {\n      logWithLevel(\n        LOG_LEVELS.DEBUG,\n        \"No existing verified users found, creating new user\",\n      );\n      userId = null;\n    }\n  }\n  const userData = {\n    ...(emailVerified ? { emailVerificationTime: Date.now() } : null),\n    ...(phoneVerified ? { phoneVerificationTime: Date.now() } : null),\n    ...profile,\n  };\n  const existingOrLinkedUserId = userId;\n  if (userId !== null) {\n    try {\n      await ctx.db.patch(userId, userData);\n    } catch (error) {\n      throw new Error(\n        `Could not update user document with ID \\`${userId}\\`, ` +\n          `either the user has been deleted but their account has not, ` +\n          `or the profile data doesn't match the \\`users\\` table schema: ` +\n          `${(error as Error).message}`,\n      );\n    }\n  } else {\n    userId = await ctx.db.insert(\"users\", userData);\n  }\n  const afterUserCreatedOrUpdated = config.callbacks?.afterUserCreatedOrUpdated;\n  if (afterUserCreatedOrUpdated !== undefined) {\n    logWithLevel(\n      LOG_LEVELS.DEBUG,\n      \"Calling custom afterUserCreatedOrUpdated callback\",\n    );\n    await afterUserCreatedOrUpdated(ctx, {\n      userId,\n      existingUserId: existingOrLinkedUserId,\n      ...args,\n    });\n  } else {\n    logWithLevel(\n      LOG_LEVELS.DEBUG,\n      \"No custom afterUserCreatedOrUpdated callback, skipping\",\n    );\n  }\n  return userId;\n}\n\nasync function uniqueUserWithVerifiedEmail(ctx: QueryCtx, email: string) {\n  const users = await ctx.db\n    .query(\"users\")\n    .withIndex(\"email\", (q) => q.eq(\"email\", email))\n    .filter((q) => q.neq(q.field(\"emailVerificationTime\"), undefined))\n    .take(2);\n  return users.length === 1 ? users[0] : null;\n}\n\nasync function uniqueUserWithVerifiedPhone(ctx: QueryCtx, phone: string) {\n  const users = await ctx.db\n    .query(\"users\")\n    .withIndex(\"phone\", (q) => q.eq(\"phone\", phone))\n    .filter((q) => q.neq(q.field(\"phoneVerificationTime\"), undefined))\n    .take(2);\n  return users.length === 1 ? users[0] : null;\n}\n\nasync function createOrUpdateAccount(\n  ctx: MutationCtx,\n  userId: GenericId<\"users\">,\n  account:\n    | { existingAccount: Doc<\"authAccounts\"> }\n    | {\n        providerAccountId: string;\n        secret?: string;\n      },\n  args: CreateOrUpdateUserArgs,\n) {\n  const accountId =\n    \"existingAccount\" in account\n      ? account.existingAccount._id\n      : await ctx.db.insert(\"authAccounts\", {\n          userId,\n          provider: args.provider.id,\n          providerAccountId: account.providerAccountId,\n          secret: account.secret,\n        });\n  // This is never used with the default `createOrUpdateUser` implementation,\n  // but it is used for manual linking via custom `createOrUpdateUser`:\n  if (\n    \"existingAccount\" in account &&\n    account.existingAccount.userId !== userId\n  ) {\n    await ctx.db.patch(accountId, { userId });\n  }\n  if (args.profile.emailVerified) {\n    await ctx.db.patch(accountId, { emailVerified: args.profile.email });\n  }\n  if (args.profile.phoneVerified) {\n    await ctx.db.patch(accountId, { phoneVerified: args.profile.phone });\n  }\n  return accountId;\n}\n\nexport async function getAccountOrThrow(\n  ctx: QueryCtx,\n  existingAccountId: GenericId<\"authAccounts\">,\n) {\n  const existingAccount = await ctx.db.get(existingAccountId);\n  if (existingAccount === null) {\n    throw new Error(\n      `Expected an account to exist for ID \"${existingAccountId}\"`,\n    );\n  }\n  return existingAccount;\n}\n", "import { GenericId, Infer, v } from \"convex/values\";\nimport { ActionCtx, MutationCtx, SessionInfo } from \"../types.js\";\nimport {\n  isSignInRateLimited,\n  recordFailedSignIn,\n  resetSignInRateLimit,\n} from \"../rateLimit.js\";\nimport * as Provider from \"../provider.js\";\nimport {\n  createNewAndDeleteExistingSession,\n  getAuthSessionId,\n  maybeGenerateTokensForSession,\n} from \"../sessions.js\";\nimport { ConvexAuthConfig } from \"../../types.js\";\nimport { LOG_LEVELS, logWithLevel, sha256 } from \"../utils.js\";\nimport { upsertUserAndAccount } from \"../users.js\";\n\nexport const verifyCodeAndSignInArgs = v.object({\n  params: v.any(),\n  provider: v.optional(v.string()),\n  verifier: v.optional(v.string()),\n  generateTokens: v.boolean(),\n  allowExtraProviders: v.boolean(),\n});\n\ntype ReturnType = null | SessionInfo;\n\nexport async function verifyCodeAndSignInImpl(\n  ctx: MutationCtx,\n  args: Infer<typeof verifyCodeAndSignInArgs>,\n  getProviderOrThrow: Provider.GetProviderOrThrowFunc,\n  config: Provider.Config,\n): Promise<ReturnType> {\n  logWithLevel(LOG_LEVELS.DEBUG, \"verifyCodeAndSignInImpl args:\", {\n    params: { email: args.params.email, phone: args.params.phone },\n    provider: args.provider,\n    verifier: args.verifier,\n    generateTokens: args.generateTokens,\n    allowExtraProviders: args.allowExtraProviders,\n  });\n  const { generateTokens, provider, allowExtraProviders } = args;\n  const identifier = args.params.email ?? args.params.phone;\n  if (identifier !== undefined) {\n    if (await isSignInRateLimited(ctx, identifier, config)) {\n      logWithLevel(\n        LOG_LEVELS.ERROR,\n        \"Too many failed attempts to verify code for this email\",\n      );\n      return null;\n    }\n  }\n  const verifyResult = await verifyCodeOnly(\n    ctx,\n    args,\n    provider ?? null,\n    getProviderOrThrow,\n    allowExtraProviders,\n    config,\n    await getAuthSessionId(ctx),\n  );\n  if (verifyResult === null) {\n    if (identifier !== undefined) {\n      await recordFailedSignIn(ctx, identifier, config);\n    }\n    return null;\n  }\n  if (identifier !== undefined) {\n    await resetSignInRateLimit(ctx, identifier);\n  }\n  const { userId } = verifyResult;\n  const sessionId = await createNewAndDeleteExistingSession(\n    ctx,\n    config,\n    userId,\n  );\n  return await maybeGenerateTokensForSession(\n    ctx,\n    config,\n    userId,\n    sessionId,\n    generateTokens,\n  );\n}\n\nexport const callVerifyCodeAndSignIn = async (\n  ctx: ActionCtx,\n  args: Infer<typeof verifyCodeAndSignInArgs>,\n): Promise<ReturnType> => {\n  return ctx.runMutation(\"auth:store\" as any, {\n    args: {\n      type: \"verifyCodeAndSignIn\",\n      ...args,\n    },\n  });\n};\n\nasync function verifyCodeOnly(\n  ctx: MutationCtx,\n  args: {\n    params: any;\n    verifier?: string;\n    identifier?: string;\n  },\n  /**\n   * There are two providers at play:\n   * 1. the provider that generated the code\n   * 2. the provider the account is tied to.\n   * This is because we allow signing into an account\n   * via another provider, see {@link signInViaProvider}.\n   * This is the first provider.\n   */\n  methodProviderId: string | null,\n  getProviderOrThrow: Provider.GetProviderOrThrowFunc,\n  allowExtraProviders: boolean,\n  config: ConvexAuthConfig,\n  sessionId: GenericId<\"authSessions\"> | null,\n) {\n  const { params, verifier } = args;\n  const codeHash = await sha256(params.code);\n  const verificationCode = await ctx.db\n    .query(\"authVerificationCodes\")\n    .withIndex(\"code\", (q) => q.eq(\"code\", codeHash))\n    .unique();\n  if (verificationCode === null) {\n    logWithLevel(LOG_LEVELS.ERROR, \"Invalid verification code\");\n    return null;\n  }\n  await ctx.db.delete(verificationCode._id);\n  if (verificationCode.verifier !== verifier) {\n    logWithLevel(LOG_LEVELS.ERROR, \"Invalid verifier\");\n    return null;\n  }\n  if (verificationCode.expirationTime < Date.now()) {\n    logWithLevel(LOG_LEVELS.ERROR, \"Expired verification code\");\n    return null;\n  }\n  const { accountId, emailVerified, phoneVerified } = verificationCode;\n  const account = await ctx.db.get(accountId);\n  if (account === null) {\n    logWithLevel(\n      LOG_LEVELS.ERROR,\n      \"Account associated with this email has been deleted\",\n    );\n    return null;\n  }\n  if (\n    methodProviderId !== null &&\n    verificationCode.provider !== methodProviderId\n  ) {\n    logWithLevel(\n      LOG_LEVELS.ERROR,\n      `Invalid provider \"${methodProviderId}\" for given \\`code\\`, ` +\n        `which was generated by provider \"${verificationCode.provider}\"`,\n    );\n    return null;\n  }\n  // OTP providers perform an additional check against the provided\n  // params.\n  const methodProvider = getProviderOrThrow(\n    verificationCode.provider,\n    allowExtraProviders,\n  );\n  if (\n    methodProvider !== null &&\n    (methodProvider.type === \"email\" || methodProvider.type === \"phone\") &&\n    methodProvider.authorize !== undefined\n  ) {\n    await methodProvider.authorize(args.params, account);\n  }\n  let userId = account.userId;\n  const provider = getProviderOrThrow(account.provider);\n  if (!(provider.type === \"oauth\" || provider.type === \"oidc\")) {\n    ({ userId } = await upsertUserAndAccount(\n      ctx,\n      sessionId,\n      { existingAccount: account },\n      {\n        type: \"verification\",\n        provider,\n        profile: {\n          ...(emailVerified !== undefined\n            ? { email: emailVerified, emailVerified: true }\n            : {}),\n          ...(phoneVerified !== undefined\n            ? { phone: phoneVerified, phoneVerified: true }\n            : {}),\n        },\n      },\n      config,\n    ));\n  }\n\n  return { providerAccountId: account.providerAccountId, userId };\n}\n", "import { GenericId, Infer, v } from \"convex/values\";\nimport { ActionCtx, MutationCtx } from \"../types.js\";\n\nexport const verifierSignatureArgs = v.object({\n  verifier: v.string(),\n  signature: v.string(),\n});\n\ntype ReturnType = void;\n\nexport async function verifierSignatureImpl(\n  ctx: MutationCtx,\n  args: Infer<typeof verifierSignatureArgs>,\n): Promise<ReturnType> {\n  const { verifier, signature } = args;\n  const verifierDoc = await ctx.db.get(verifier as GenericId<\"authVerifiers\">);\n  if (verifierDoc === null) {\n    throw new Error(\"Invalid verifier\");\n  }\n  return await ctx.db.patch(verifierDoc._id, { signature });\n}\n\nexport const callVerifierSignature = async (\n  ctx: ActionCtx,\n  args: Infer<typeof verifierSignatureArgs>,\n): Promise<void> => {\n  return ctx.runMutation(\"auth:store\" as any, {\n    args: {\n      type: \"verifierSignature\",\n      ...args,\n    },\n  });\n};\n", "import { Infer, v } from \"convex/values\";\nimport { ActionCtx, MutationCtx } from \"../types.js\";\nimport * as Provider from \"../provider.js\";\nimport { OAuthConfig } from \"@auth/core/providers/oauth.js\";\nimport { upsertUserAndAccount } from \"../users.js\";\nimport { logWithLevel, sha256 } from \"../utils.js\";\nimport { alphabet, generateRandomString } from \"oslo/crypto\";\n\nconst OAUTH_SIGN_IN_EXPIRATION_MS = 1000 * 60 * 2; // 2 minutes\n\nexport const userOAuthArgs = v.object({\n  provider: v.string(),\n  providerAccountId: v.string(),\n  profile: v.any(),\n  signature: v.string(),\n});\n\ntype ReturnType = string;\n\nexport async function userOAuthImpl(\n  ctx: MutationCtx,\n  args: Infer<typeof userOAuthArgs>,\n  getProviderOrThrow: Provider.GetProviderOrThrowFunc,\n  config: Provider.Config,\n): Promise<ReturnType> {\n  logWithLevel(\"DEBUG\", \"userOAuthImpl args:\", args);\n  const { profile, provider, providerAccountId, signature } = args;\n  const providerConfig = getProviderOrThrow(provider) as OAuthConfig<any>;\n  const existingAccount = await ctx.db\n    .query(\"authAccounts\")\n    .withIndex(\"providerAndAccountId\", (q) =>\n      q.eq(\"provider\", provider).eq(\"providerAccountId\", providerAccountId),\n    )\n    .unique();\n\n  const verifier = await ctx.db\n    .query(\"authVerifiers\")\n    .withIndex(\"signature\", (q) => q.eq(\"signature\", signature))\n    .unique();\n  if (verifier === null) {\n    throw new Error(\"Invalid state\");\n  }\n\n  const { accountId } = await upsertUserAndAccount(\n    ctx,\n    verifier.sessionId ?? null,\n    existingAccount !== null ? { existingAccount } : { providerAccountId },\n    { type: \"oauth\", provider: providerConfig, profile },\n    config,\n  );\n\n  const code = generateRandomString(8, alphabet(\"0-9\"));\n  await ctx.db.delete(verifier._id);\n  const existingVerificationCode = await ctx.db\n    .query(\"authVerificationCodes\")\n    .withIndex(\"accountId\", (q) => q.eq(\"accountId\", accountId))\n    .unique();\n  if (existingVerificationCode !== null) {\n    await ctx.db.delete(existingVerificationCode._id);\n  }\n  await ctx.db.insert(\"authVerificationCodes\", {\n    code: await sha256(code),\n    accountId,\n    provider,\n    expirationTime: Date.now() + OAUTH_SIGN_IN_EXPIRATION_MS,\n    // The use of a verifier means we don't need an identifier\n    // during verification.\n    verifier: verifier._id,\n  });\n  return code;\n}\n\nexport const callUserOAuth = async (\n  ctx: ActionCtx,\n  args: Infer<typeof userOAuthArgs>,\n): Promise<ReturnType> => {\n  return ctx.runMutation(\"auth:store\" as any, {\n    args: {\n      type: \"userOAuth\",\n      ...args,\n    },\n  });\n};\n", "import { GenericId, Infer, v } from \"convex/values\";\nimport { ActionCtx, MutationCtx } from \"../types.js\";\nimport * as Provider from \"../provider.js\";\nimport { EmailConfig, PhoneConfig } from \"../../types.js\";\nimport { getAccountOrThrow, upsertUserAndAccount } from \"../users.js\";\nimport { getAuthSessionId } from \"../sessions.js\";\nimport { LOG_LEVELS, logWithLevel, sha256 } from \"../utils.js\";\n\nexport const createVerificationCodeArgs = v.object({\n  accountId: v.optional(v.id(\"authAccounts\")),\n  provider: v.string(),\n  email: v.optional(v.string()),\n  phone: v.optional(v.string()),\n  code: v.string(),\n  expirationTime: v.number(),\n  allowExtraProviders: v.boolean(),\n});\n\ntype ReturnType = string;\n\nexport async function createVerificationCodeImpl(\n  ctx: MutationCtx,\n  args: Infer<typeof createVerificationCodeArgs>,\n  getProviderOrThrow: Provider.GetProviderOrThrowFunc,\n  config: Provider.Config,\n): Promise<ReturnType> {\n  logWithLevel(LOG_LEVELS.DEBUG, \"createVerificationCodeImpl args:\", args);\n  const {\n    email,\n    phone,\n    code,\n    expirationTime,\n    provider: providerId,\n    accountId: existingAccountId,\n    allowExtraProviders,\n  } = args;\n  const existingAccount =\n    existingAccountId !== undefined\n      ? await getAccountOrThrow(ctx, existingAccountId)\n      : await ctx.db\n          .query(\"authAccounts\")\n          .withIndex(\"providerAndAccountId\", (q) =>\n            q\n              .eq(\"provider\", providerId)\n              .eq(\"providerAccountId\", email ?? phone!),\n          )\n          .unique();\n\n  const provider = getProviderOrThrow(providerId, allowExtraProviders) as\n    | EmailConfig\n    | PhoneConfig;\n  const { accountId } = await upsertUserAndAccount(\n    ctx,\n    await getAuthSessionId(ctx),\n    existingAccount !== null\n      ? { existingAccount }\n      : { providerAccountId: email ?? phone! },\n    provider.type === \"email\"\n      ? { type: \"email\", provider, profile: { email: email! } }\n      : { type: \"phone\", provider, profile: { phone: phone! } },\n    config,\n  );\n  await generateUniqueVerificationCode(\n    ctx,\n    accountId,\n    providerId,\n    code,\n    expirationTime,\n    { email, phone },\n  );\n  return email ?? phone!;\n}\n\nexport const callCreateVerificationCode = async (\n  ctx: ActionCtx,\n  args: Infer<typeof createVerificationCodeArgs>,\n): Promise<ReturnType> => {\n  return ctx.runMutation(\"auth:store\" as any, {\n    args: {\n      type: \"createVerificationCode\",\n      ...args,\n    },\n  });\n};\n\nasync function generateUniqueVerificationCode(\n  ctx: MutationCtx,\n  accountId: GenericId<\"authAccounts\">,\n  provider: string,\n  code: string,\n  expirationTime: number,\n  { email, phone }: { email?: string; phone?: string },\n) {\n  const existingCode = await ctx.db\n    .query(\"authVerificationCodes\")\n    .withIndex(\"accountId\", (q) => q.eq(\"accountId\", accountId))\n    .unique();\n  if (existingCode !== null) {\n    await ctx.db.delete(existingCode._id);\n  }\n  await ctx.db.insert(\"authVerificationCodes\", {\n    accountId,\n    provider,\n    code: await sha256(code),\n    expirationTime,\n    emailVerified: email,\n    phoneVerified: phone,\n  });\n}\n", "import { AuthProviderMaterializedConfig } from \"../index.js\";\n\nexport async function hash(provider: any, secret: string) {\n  if (provider.type !== \"credentials\") {\n    throw new Error(`Provider ${provider.id} is not a credentials provider`);\n  }\n  const hashSecretFn = provider.crypto?.hashSecret;\n  if (hashSecretFn === undefined) {\n    throw new Error(\n      `Provider ${provider.id} does not have a \\`crypto.hashSecret\\` function`,\n    );\n  }\n  return await hashSecretFn(secret);\n}\n\nexport async function verify(\n  provider: AuthProviderMaterializedConfig,\n  secret: string,\n  hash: string,\n) {\n  if (provider.type !== \"credentials\") {\n    throw new Error(`Provider ${provider.id} is not a credentials provider`);\n  }\n  const verifySecretFn = provider.crypto?.verifySecret;\n  if (verifySecretFn === undefined) {\n    throw new Error(\n      `Provider ${provider.id} does not have a \\`crypto.verifySecret\\` function`,\n    );\n  }\n  return await verifySecretFn(secret, hash);\n}\n\nexport type GetProviderOrThrowFunc = (\n  provider: string,\n  allowExtraProviders?: boolean,\n) => AuthProviderMaterializedConfig;\n\nexport type Config = any;\n", "import { Infer, v } from \"convex/values\";\nimport { ActionCtx, Doc, MutationCtx } from \"../types.js\";\nimport * as Provider from \"../provider.js\";\nimport { ConvexCredentialsConfig } from \"../../types.js\";\nimport { upsertUserAndAccount } from \"../users.js\";\nimport { getAuthSessionId } from \"../sessions.js\";\nimport { LOG_LEVELS, logWithLevel, maybeRedact } from \"../utils.js\";\n\nexport const createAccountFromCredentialsArgs = v.object({\n  provider: v.string(),\n  account: v.object({ id: v.string(), secret: v.optional(v.string()) }),\n  profile: v.any(),\n  shouldLinkViaEmail: v.optional(v.boolean()),\n  shouldLinkViaPhone: v.optional(v.boolean()),\n});\n\ntype ReturnType = { account: Doc<\"authAccounts\">; user: Doc<\"users\"> };\n\nexport async function createAccountFromCredentialsImpl(\n  ctx: MutationCtx,\n  args: Infer<typeof createAccountFromCredentialsArgs>,\n  getProviderOrThrow: Provider.GetProviderOrThrowFunc,\n  config: Provider.Config,\n): Promise<ReturnType> {\n  logWithLevel(LOG_LEVELS.DEBUG, \"createAccountFromCredentialsImpl args:\", {\n    provider: args.provider,\n    account: {\n      id: args.account.id,\n      secret: maybeRedact(args.account.secret ?? \"\"),\n    },\n  });\n  const {\n    provider: providerId,\n    account,\n    profile,\n    shouldLinkViaEmail,\n    shouldLinkViaPhone,\n  } = args;\n  const provider = getProviderOrThrow(providerId) as ConvexCredentialsConfig;\n  const existingAccount = await ctx.db\n    .query(\"authAccounts\")\n    .withIndex(\"providerAndAccountId\", (q) =>\n      q.eq(\"provider\", provider.id).eq(\"providerAccountId\", account.id),\n    )\n    .unique();\n  if (existingAccount !== null) {\n    if (\n      account.secret !== undefined &&\n      !(await Provider.verify(\n        provider,\n        account.secret,\n        existingAccount.secret ?? \"\",\n      ))\n    ) {\n      throw new Error(`Account ${account.id} already exists`);\n    }\n    return {\n      account: existingAccount,\n      // TODO: Ian removed this,\n      user: (await ctx.db.get(existingAccount.userId))!,\n    };\n  }\n\n  const secret =\n    account.secret !== undefined\n      ? await Provider.hash(provider, account.secret)\n      : undefined;\n  const { userId, accountId } = await upsertUserAndAccount(\n    ctx,\n    await getAuthSessionId(ctx),\n    { providerAccountId: account.id, secret },\n    {\n      type: \"credentials\",\n      provider,\n      profile,\n      shouldLinkViaEmail,\n      shouldLinkViaPhone,\n    },\n    config,\n  );\n\n  return {\n    account: (await ctx.db.get(accountId))!,\n    user: (await ctx.db.get(userId))!,\n  };\n}\n\nexport const callCreateAccountFromCredentials = async (\n  ctx: ActionCtx,\n  args: Infer<typeof createAccountFromCredentialsArgs>,\n): Promise<ReturnType> => {\n  return ctx.runMutation(\"auth:store\" as any, {\n    args: {\n      type: \"createAccountFromCredentials\",\n      ...args,\n    },\n  });\n};\n", "import { Infer, v } from \"convex/values\";\nimport { ActionCtx, Doc, MutationCtx } from \"../types.js\";\nimport {\n  isSignInRateLimited,\n  recordFailedSignIn,\n  resetSignInRateLimit,\n} from \"../rateLimit.js\";\nimport * as Provider from \"../provider.js\";\nimport { LOG_LEVELS, logWithLevel, maybeRedact } from \"../utils.js\";\n\nexport const retrieveAccountWithCredentialsArgs = v.object({\n  provider: v.string(),\n  account: v.object({ id: v.string(), secret: v.optional(v.string()) }),\n});\n\ntype ReturnType =\n  | \"InvalidAccountId\"\n  | \"TooManyFailedAttempts\"\n  | \"InvalidSecret\"\n  | { account: Doc<\"authAccounts\">; user: Doc<\"users\"> };\n\nexport async function retrieveAccountWithCredentialsImpl(\n  ctx: MutationCtx,\n  args: Infer<typeof retrieveAccountWithCredentialsArgs>,\n  getProviderOrThrow: Provider.GetProviderOrThrowFunc,\n  config: Provider.Config,\n): Promise<ReturnType> {\n  const { provider: providerId, account } = args;\n  logWithLevel(LOG_LEVELS.DEBUG, \"retrieveAccountWithCredentialsImpl args:\", {\n    provider: providerId,\n    account: {\n      id: account.id,\n      secret: maybeRedact(account.secret ?? \"\"),\n    },\n  });\n  const existingAccount = await ctx.db\n    .query(\"authAccounts\")\n    .withIndex(\"providerAndAccountId\", (q) =>\n      q.eq(\"provider\", providerId).eq(\"providerAccountId\", account.id),\n    )\n    .unique();\n  if (existingAccount === null) {\n    return \"InvalidAccountId\";\n  }\n  if (account.secret !== undefined) {\n    if (await isSignInRateLimited(ctx, existingAccount._id, config)) {\n      return \"TooManyFailedAttempts\";\n    }\n    if (\n      !(await Provider.verify(\n        getProviderOrThrow(providerId),\n        account.secret,\n        existingAccount.secret ?? \"\",\n      ))\n    ) {\n      await recordFailedSignIn(ctx, existingAccount._id, config);\n      return \"InvalidSecret\";\n    }\n    await resetSignInRateLimit(ctx, existingAccount._id);\n  }\n  return {\n    account: existingAccount,\n    // TODO: Ian removed this\n    user: (await ctx.db.get(existingAccount.userId))!,\n  };\n}\n\nexport const callRetreiveAccountWithCredentials = async (\n  ctx: ActionCtx,\n  args: Infer<typeof retrieveAccountWithCredentialsArgs>,\n): Promise<ReturnType> => {\n  return ctx.runMutation(\"auth:store\" as any, {\n    args: {\n      type: \"retrieveAccountWithCredentials\",\n      ...args,\n    },\n  });\n};\n", "import { Infer, v } from \"convex/values\";\nimport { ActionCtx, MutationCtx } from \"../types.js\";\nimport { GetProviderOrThrowFunc, hash } from \"../provider.js\";\nimport { LOG_LEVELS, logWithLevel, maybeRedact } from \"../utils.js\";\n\nexport const modifyAccountArgs = v.object({\n  provider: v.string(),\n  account: v.object({ id: v.string(), secret: v.string() }),\n});\n\nexport async function modifyAccountImpl(\n  ctx: MutationCtx,\n  args: Infer<typeof modifyAccountArgs>,\n  getProviderOrThrow: GetProviderOrThrowFunc,\n): Promise<void> {\n  const { provider, account } = args;\n  logWithLevel(LOG_LEVELS.DEBUG, \"retrieveAccountWithCredentialsImpl args:\", {\n    provider: provider,\n    account: {\n      id: account.id,\n      secret: maybeRedact(account.secret ?? \"\"),\n    },\n  });\n  const existingAccount = await ctx.db\n    .query(\"authAccounts\")\n    .withIndex(\"providerAndAccountId\", (q) =>\n      q.eq(\"provider\", provider).eq(\"providerAccountId\", account.id),\n    )\n    .unique();\n  if (existingAccount === null) {\n    throw new Error(\n      `Cannot modify account with ID ${account.id} because it does not exist`,\n    );\n  }\n  await ctx.db.patch(existingAccount._id, {\n    secret: await hash(getProviderOrThrow(provider), account.secret),\n  });\n  return;\n}\n\nexport const callModifyAccount = async (\n  ctx: ActionCtx,\n  args: Infer<typeof modifyAccountArgs>,\n): Promise<void> => {\n  return ctx.runMutation(\"auth:store\" as any, {\n    args: {\n      type: \"modifyAccount\",\n      ...args,\n    },\n  });\n};\n", "import { Infer, v } from \"convex/values\";\nimport { deleteSession } from \"../sessions.js\";\nimport { ActionCtx, MutationCtx } from \"../types.js\";\nimport { LOG_LEVELS, logWithLevel } from \"../utils.js\";\n\nexport const invalidateSessionsArgs = v.object({\n  userId: v.id(\"users\"),\n  except: v.optional(v.array(v.id(\"authSessions\"))),\n});\n\nexport const callInvalidateSessions = async (\n  ctx: ActionCtx,\n  args: Infer<typeof invalidateSessionsArgs>,\n): Promise<void> => {\n  return ctx.runMutation(\"auth:store\" as any, {\n    args: {\n      type: \"invalidateSessions\",\n      ...args,\n    },\n  });\n};\n\nexport const invalidateSessionsImpl = async (\n  ctx: MutationCtx,\n  args: Infer<typeof invalidateSessionsArgs>,\n): Promise<void> => {\n  logWithLevel(LOG_LEVELS.DEBUG, \"invalidateSessionsImpl args:\", args);\n  const { userId, except } = args;\n  const exceptSet = new Set(except ?? []);\n  const sessions = await ctx.db\n    .query(\"authSessions\")\n    .withIndex(\"userId\", (q) => q.eq(\"userId\", userId))\n    .collect();\n  for (const session of sessions) {\n    if (!exceptSet.has(session._id)) {\n      await deleteSession(ctx, session);\n    }\n  }\n  return;\n};\n", "import { GenericId } from \"convex/values\";\nimport { ActionCtx, MutationCtx } from \"../types.js\";\nimport { getAuthSessionId } from \"../sessions.js\";\n\ntype ReturnType = GenericId<\"authVerifiers\">;\n\nexport async function verifierImpl(ctx: MutationCtx): Promise<ReturnType> {\n  return await ctx.db.insert(\"authVerifiers\", {\n    sessionId: (await getAuthSessionId(ctx)) ?? undefined,\n  });\n}\n\nexport const callVerifier = async (ctx: ActionCtx): Promise<ReturnType> => {\n  return ctx.runMutation(\"auth:store\" as any, {\n    args: {\n      type: \"verifier\",\n    },\n  });\n};\n", "import { Infer, v } from \"convex/values\";\nimport { MutationCtx } from \"../types.js\";\nimport { signInArgs, signInImpl } from \"./signIn.js\";\nimport { signOutImpl } from \"./signOut.js\";\nimport { refreshSessionArgs, refreshSessionImpl } from \"./refreshSession.js\";\nimport {\n  verifyCodeAndSignInArgs,\n  verifyCodeAndSignInImpl,\n} from \"./verifyCodeAndSignIn.js\";\nimport {\n  verifierSignatureArgs,\n  verifierSignatureImpl,\n} from \"./verifierSignature.js\";\nimport { userOAuthArgs, userOAuthImpl } from \"./userOAuth.js\";\nimport {\n  createVerificationCodeArgs,\n  createVerificationCodeImpl,\n} from \"./createVerificationCode.js\";\nimport {\n  createAccountFromCredentialsArgs,\n  createAccountFromCredentialsImpl,\n} from \"./createAccountFromCredentials.js\";\nimport {\n  retrieveAccountWithCredentialsArgs,\n  retrieveAccountWithCredentialsImpl,\n} from \"./retrieveAccountWithCredentials.js\";\nimport { modifyAccountArgs, modifyAccountImpl } from \"./modifyAccount.js\";\nimport {\n  invalidateSessionsArgs,\n  invalidateSessionsImpl,\n} from \"./invalidateSessions.js\";\nimport * as Provider from \"../provider.js\";\nimport { verifierImpl } from \"./verifier.js\";\nimport { LOG_LEVELS, logWithLevel } from \"../utils.js\";\nexport { callInvalidateSessions } from \"./invalidateSessions.js\";\nexport { callModifyAccount } from \"./modifyAccount.js\";\nexport { callRetreiveAccountWithCredentials } from \"./retrieveAccountWithCredentials.js\";\nexport { callCreateAccountFromCredentials } from \"./createAccountFromCredentials.js\";\nexport { callCreateVerificationCode } from \"./createVerificationCode.js\";\nexport { callUserOAuth } from \"./userOAuth.js\";\nexport { callVerifierSignature } from \"./verifierSignature.js\";\nexport { callVerifyCodeAndSignIn } from \"./verifyCodeAndSignIn.js\";\nexport { callVerifier } from \"./verifier.js\";\nexport { callRefreshSession } from \"./refreshSession.js\";\nexport { callSignOut } from \"./signOut.js\";\nexport { callSignIn } from \"./signIn.js\";\n\nexport const storeArgs = v.object({\n  args: v.union(\n    v.object({\n      type: v.literal(\"signIn\"),\n      ...signInArgs.fields,\n    }),\n    v.object({\n      type: v.literal(\"signOut\"),\n    }),\n    v.object({\n      type: v.literal(\"refreshSession\"),\n      ...refreshSessionArgs.fields,\n    }),\n    v.object({\n      type: v.literal(\"verifyCodeAndSignIn\"),\n      ...verifyCodeAndSignInArgs.fields,\n    }),\n    v.object({\n      type: v.literal(\"verifier\"),\n    }),\n    v.object({\n      type: v.literal(\"verifierSignature\"),\n      ...verifierSignatureArgs.fields,\n    }),\n    v.object({\n      type: v.literal(\"userOAuth\"),\n      ...userOAuthArgs.fields,\n    }),\n    v.object({\n      type: v.literal(\"createVerificationCode\"),\n      ...createVerificationCodeArgs.fields,\n    }),\n    v.object({\n      type: v.literal(\"createAccountFromCredentials\"),\n      ...createAccountFromCredentialsArgs.fields,\n    }),\n    v.object({\n      type: v.literal(\"retrieveAccountWithCredentials\"),\n      ...retrieveAccountWithCredentialsArgs.fields,\n    }),\n    v.object({\n      type: v.literal(\"modifyAccount\"),\n      ...modifyAccountArgs.fields,\n    }),\n    v.object({\n      type: v.literal(\"invalidateSessions\"),\n      ...invalidateSessionsArgs.fields,\n    }),\n  ),\n});\n\nexport const storeImpl = async (\n  ctx: MutationCtx,\n  fnArgs: Infer<typeof storeArgs>,\n  getProviderOrThrow: Provider.GetProviderOrThrowFunc,\n  config: Provider.Config,\n) => {\n  const args = fnArgs.args;\n  logWithLevel(LOG_LEVELS.INFO, `\\`auth:store\\` type: ${args.type}`);\n  switch (args.type) {\n    case \"signIn\": {\n      return signInImpl(ctx, args, config);\n    }\n    case \"signOut\": {\n      return signOutImpl(ctx);\n    }\n    case \"refreshSession\": {\n      return refreshSessionImpl(ctx, args, getProviderOrThrow, config);\n    }\n    case \"verifyCodeAndSignIn\": {\n      return verifyCodeAndSignInImpl(ctx, args, getProviderOrThrow, config);\n    }\n    case \"verifier\": {\n      return verifierImpl(ctx);\n    }\n    case \"verifierSignature\": {\n      return verifierSignatureImpl(ctx, args);\n    }\n    case \"userOAuth\": {\n      return userOAuthImpl(ctx, args, getProviderOrThrow, config);\n    }\n    case \"createVerificationCode\": {\n      return createVerificationCodeImpl(ctx, args, getProviderOrThrow, config);\n    }\n    case \"createAccountFromCredentials\": {\n      return createAccountFromCredentialsImpl(\n        ctx,\n        args,\n        getProviderOrThrow,\n        config,\n      );\n    }\n    case \"retrieveAccountWithCredentials\": {\n      return retrieveAccountWithCredentialsImpl(\n        ctx,\n        args,\n        getProviderOrThrow,\n        config,\n      );\n    }\n    case \"modifyAccount\": {\n      return modifyAccountImpl(ctx, args, getProviderOrThrow);\n    }\n    case \"invalidateSessions\": {\n      return invalidateSessionsImpl(ctx, args);\n    }\n    default:\n      args satisfies never;\n  }\n};\n", "import { ConvexAuthMaterializedConfig } from \"../index.js\";\nimport { requireEnv } from \"../utils.js\";\n\nexport async function redirectAbsoluteUrl(\n  config: ConvexAuthMaterializedConfig,\n  params: { redirectTo: unknown },\n) {\n  if (params.redirectTo !== undefined) {\n    if (typeof params.redirectTo !== \"string\") {\n      throw new Error(\n        `Expected \\`redirectTo\\` to be a string, got ${params.redirectTo as any}`,\n      );\n    }\n    const redirectCallback =\n      config.callbacks?.redirect ?? defaultRedirectCallback;\n    return await redirectCallback(params as { redirectTo: string });\n  }\n  return siteUrl();\n}\n\nasync function defaultRedirectCallback({ redirectTo }: { redirectTo: string }) {\n  const baseUrl = siteUrl();\n  if (redirectTo.startsWith(\"?\") || redirectTo.startsWith(\"/\")) {\n    return `${baseUrl}${redirectTo}`;\n  }\n  if (redirectTo.startsWith(baseUrl)) {\n    const after = redirectTo[baseUrl.length];\n    if (after === undefined || after === \"?\" || after === \"/\") {\n      return redirectTo;\n    }\n  }\n  throw new Error(\n    `Invalid \\`redirectTo\\` ${redirectTo} for configured SITE_URL: ${baseUrl.toString()}`,\n  );\n}\n\n// Temporary work-around because Convex doesn't support\n// schemes other than http and https.\nexport function setURLSearchParam(\n  absoluteUrl: string,\n  param: string,\n  value: string,\n) {\n  const pattern = /([^:]+):(.*)/;\n  const [, scheme, rest] = absoluteUrl.match(pattern)!;\n  const hasNoDomain = /^\\/\\/(?:\\/|$|\\?)/.test(rest);\n  const startsWithPath = hasNoDomain && rest.startsWith(\"///\");\n  const url = new URL(\n    `http:${hasNoDomain ? \"//googblibok\" + rest.slice(2) : rest}`,\n  );\n  url.searchParams.set(param, value);\n  const [, , withParam] = url.toString().match(pattern)!;\n  return `${scheme}:${hasNoDomain ? (startsWithPath ? \"/\" : \"\") + \"//\" + withParam.slice(13) : withParam}`;\n}\n\nfunction siteUrl() {\n  return requireEnv(\"SITE_URL\").replace(/\\/$/, \"\");\n}\n", "import { GenericId } from \"convex/values\";\nimport {\n  AuthProviderMaterializedConfig,\n  ConvexCredentialsConfig,\n  EmailConfig,\n  GenericActionCtxWithAuthConfig,\n  PhoneConfig,\n} from \"../types.js\";\nimport {\n  AuthDataModel,\n  SessionInfo,\n  SessionInfoWithTokens,\n  Tokens,\n} from \"./types.js\";\nimport {\n  callCreateVerificationCode,\n  callRefreshSession,\n  callSignIn,\n  callVerifier,\n  callVerifyCodeAndSignIn,\n} from \"./mutations/index.js\";\nimport { alphabet, generateRandomString } from \"oslo/crypto\";\nimport { redirectAbsoluteUrl, setURLSearchParam } from \"./redirects.js\";\nimport { requireEnv } from \"../utils.js\";\nimport { OAuth2Config, OIDCConfig } from \"@auth/core/providers/oauth.js\";\n\nconst DEFAULT_EMAIL_VERIFICATION_CODE_DURATION_S = 60 * 60 * 24; // 24 hours\n\ntype EnrichedActionCtx = GenericActionCtxWithAuthConfig<AuthDataModel>;\n\nexport async function signInImpl(\n  ctx: EnrichedActionCtx,\n  provider: AuthProviderMaterializedConfig | null,\n  args: {\n    accountId?: GenericId<\"authAccounts\">;\n    params?: Record<string, any>;\n    verifier?: string;\n    refreshToken?: string;\n    calledBy?: string;\n  },\n  options: {\n    generateTokens: boolean;\n    allowExtraProviders: boolean;\n  },\n): Promise<\n  | { kind: \"signedIn\"; signedIn: SessionInfo | null }\n  // refresh tokens\n  | { kind: \"refreshTokens\"; signedIn: { tokens: Tokens } }\n  // Multi-step flows like magic link + OTP\n  | { kind: \"started\"; started: true }\n  // OAuth2 and OIDC flows\n  | { kind: \"redirect\"; redirect: string; verifier: string }\n> {\n  if (provider === null && args.refreshToken) {\n    const tokens: Tokens = (await callRefreshSession(ctx, {\n      refreshToken: args.refreshToken,\n    }))!;\n    return { kind: \"refreshTokens\", signedIn: { tokens } };\n  }\n  if (provider === null && args.params?.code !== undefined) {\n    const result = await callVerifyCodeAndSignIn(ctx, {\n      params: args.params,\n      verifier: args.verifier,\n      generateTokens: true,\n      allowExtraProviders: options.allowExtraProviders,\n    });\n    return {\n      kind: \"signedIn\",\n      signedIn: result,\n    };\n  }\n\n  if (provider === null) {\n    throw new Error(\n      \"Cannot sign in: Missing `provider`, `params.code` or `refreshToken`\",\n    );\n  }\n  if (provider.type === \"email\" || provider.type === \"phone\") {\n    return handleEmailAndPhoneProvider(ctx, provider, args, options);\n  }\n  if (provider.type === \"credentials\") {\n    return handleCredentials(ctx, provider, args, options);\n  }\n  if (provider.type === \"oauth\" || provider.type === \"oidc\") {\n    return handleOAuthProvider(ctx, provider, args, options);\n  }\n  const _typecheck: never = provider;\n  throw new Error(\n    `Provider type ${(provider as any).type} is not supported yet`,\n  );\n}\n\nasync function handleEmailAndPhoneProvider(\n  ctx: EnrichedActionCtx,\n  provider: EmailConfig | PhoneConfig,\n  args: {\n    params?: Record<string, any>;\n    accountId?: GenericId<\"authAccounts\">;\n  },\n  options: {\n    generateTokens: boolean;\n    allowExtraProviders: boolean;\n  },\n): Promise<\n  | { kind: \"started\"; started: true }\n  | { kind: \"signedIn\"; signedIn: SessionInfoWithTokens }\n> {\n  if (args.params?.code !== undefined) {\n    const result = await callVerifyCodeAndSignIn(ctx, {\n      params: args.params,\n      provider: provider.id,\n      generateTokens: options.generateTokens,\n      allowExtraProviders: options.allowExtraProviders,\n    });\n    if (result === null) {\n      throw new Error(\"Could not verify code\");\n    }\n    return {\n      kind: \"signedIn\",\n      signedIn: result as SessionInfoWithTokens,\n    };\n  }\n\n  const code = provider.generateVerificationToken\n    ? await provider.generateVerificationToken()\n    : generateRandomString(32, alphabet(\"0-9\", \"A-Z\", \"a-z\"));\n  const expirationTime =\n    Date.now() +\n    (provider.maxAge ?? DEFAULT_EMAIL_VERIFICATION_CODE_DURATION_S) * 1000;\n\n  const identifier = await callCreateVerificationCode(ctx, {\n    provider: provider.id,\n    accountId: args.accountId,\n    email: args.params?.email,\n    phone: args.params?.phone,\n    code,\n    expirationTime,\n    allowExtraProviders: options.allowExtraProviders,\n  });\n  const destination = await redirectAbsoluteUrl(\n    ctx.auth.config,\n    (args.params ?? {}) as { redirectTo: unknown },\n  );\n  const verificationArgs = {\n    identifier,\n    url: setURLSearchParam(destination, \"code\", code),\n    token: code,\n    expires: new Date(expirationTime),\n  };\n  if (provider.type === \"email\") {\n    await provider.sendVerificationRequest(\n      {\n        ...verificationArgs,\n        provider: {\n          ...provider,\n          from:\n            // Simplifies demo configuration of Resend\n            provider.from === \"Auth.js <no-reply@authjs.dev>\" &&\n            provider.id === \"resend\"\n              ? \"My App <onboarding@resend.dev>\"\n              : provider.from,\n        },\n        request: new Request(\"http://localhost\"), // TODO: Document\n        theme: ctx.auth.config.theme,\n      },\n      // @ts-expect-error Figure out typing for email providers so they can\n      // access ctx.\n      ctx,\n    );\n  } else if (provider.type === \"phone\") {\n    await provider.sendVerificationRequest(\n      { ...verificationArgs, provider },\n      ctx,\n    );\n  }\n  return { kind: \"started\", started: true };\n}\n\nasync function handleCredentials(\n  ctx: EnrichedActionCtx,\n  provider: ConvexCredentialsConfig,\n  args: {\n    params?: Record<string, any>;\n  },\n  options: {\n    generateTokens: boolean;\n  },\n): Promise<{ kind: \"signedIn\"; signedIn: SessionInfo | null }> {\n  const result = await provider.authorize(args.params ?? {}, ctx);\n  if (result === null) {\n    return { kind: \"signedIn\", signedIn: null };\n  }\n  const idsAndTokens = await callSignIn(ctx, {\n    userId: result.userId,\n    sessionId: result.sessionId,\n    generateTokens: options.generateTokens,\n  });\n  return {\n    kind: \"signedIn\",\n    signedIn: idsAndTokens,\n  };\n}\n\nasync function handleOAuthProvider(\n  ctx: EnrichedActionCtx,\n  provider: OAuth2Config<any> | OIDCConfig<any>,\n  args: {\n    params?: Record<string, any>;\n    verifier?: string;\n  },\n  options: {\n    allowExtraProviders: boolean;\n  },\n): Promise<\n  | { kind: \"signedIn\"; signedIn: SessionInfoWithTokens | null }\n  | { kind: \"redirect\"; redirect: string; verifier: string }\n> {\n  // We have this action because:\n  // 1. We remember the current sessionId if any, so we can link accounts\n  // 2. The client doesn't need to know the HTTP Actions URL\n  //    of the backend (this simplifies using local backend)\n  // 3. The client doesn't need to know which provider is of which type,\n  //    and hence which provider requires client-side redirect\n  // 4. On mobile the client can complete the flow manually\n  if (args.params?.code !== undefined) {\n    const result = await callVerifyCodeAndSignIn(ctx, {\n      params: args.params,\n      verifier: args.verifier,\n      generateTokens: true,\n      allowExtraProviders: options.allowExtraProviders,\n    });\n    return {\n      kind: \"signedIn\",\n      signedIn: result as SessionInfoWithTokens | null,\n    };\n  }\n  const redirect = new URL(\n    (process.env.CUSTOM_AUTH_SITE_URL ?? requireEnv(\"CONVEX_SITE_URL\")) + `/api/auth/signin/${provider.id}`,\n  );\n  const verifier = await callVerifier(ctx);\n  redirect.searchParams.set(\"code\", verifier);\n  if (args.params?.redirectTo !== undefined) {\n    if (typeof args.params.redirectTo !== \"string\") {\n      throw new Error(\n        `Expected \\`redirectTo\\` to be a string, got ${args.params.redirectTo}`,\n      );\n    }\n    redirect.searchParams.set(\"redirectTo\", args.params.redirectTo);\n  }\n  return { kind: \"redirect\", redirect: redirect.toString(), verifier };\n}\n", "// This maps to packages/core/src/lib/actions/callback/oauth/checks.ts in the @auth/core package (commit 5af1f30a32e64591abc50ae4d2dba4682e525431)\n\nimport * as o from \"oauth4webapi\";\n\nimport type { InternalOptions } from \"./types.js\";\nimport { Cookie } from \"@auth/core/lib/utils/cookie.js\";\nimport { CookiesOptions } from \"@auth/core/types.js\";\nimport { logWithLevel } from \"../implementation/utils.js\";\n\nconst COOKIE_TTL = 60 * 15; // 15 minutes\n\n/** Returns a cookie with the given payload and options. */\n// ConvexAuth: Auth.js calls this `sealCookie` and encrypts the payload wrapped in a JWT.\nasync function createCookie(\n  name: keyof CookiesOptions,\n  payload: string,\n  options: InternalOptions<\"oauth\" | \"oidc\">,\n): Promise<Cookie> {\n  const { cookies } = options;\n  const cookie = cookies[name];\n  const expires = new Date();\n  expires.setTime(expires.getTime() + COOKIE_TTL * 1000);\n\n  logWithLevel(\"DEBUG\", `CREATE_${name.toUpperCase()}`, {\n    name: cookie.name,\n    payload,\n    COOKIE_TTL,\n    expires,\n  });\n\n  const cookieOptions = { ...cookie.options, expires };\n\n  return { name: cookie.name, value: payload, options: cookieOptions };\n}\n\nfunction clearCookie(\n  name: keyof CookiesOptions,\n  options: InternalOptions<\"oauth\" | \"oidc\">,\n  resCookies: Cookie[],\n) {\n  const { cookies } = options;\n  const cookie = cookies[name];\n  logWithLevel(\"DEBUG\", `CLEAR_${name.toUpperCase()}`, { cookie });\n  resCookies.push({\n    name: cookie.name,\n    value: \"\",\n    options: { ...cookies[name].options, maxAge: 0 },\n  });\n}\n\nfunction useCookie(\n  check: \"state\" | \"pkce\" | \"nonce\",\n  name: keyof CookiesOptions,\n) {\n  return async function (\n    // ConvexAuth: `cookies` is a Record<string, string | undefined> instead of RequestInternal[\"cookies\"]\n    cookies: Record<string, string | undefined>,\n    resCookies: Cookie[],\n    options: InternalOptions<\"oidc\">,\n  ) {\n    const { provider } = options;\n    if (!provider?.checks?.includes(check)) return;\n    const cookieValue = cookies?.[options.cookies[name].name];\n    logWithLevel(\"DEBUG\", `USE_${name.toUpperCase()}`, { value: cookieValue });\n    clearCookie(name, options, resCookies);\n    return cookieValue;\n  };\n}\n\n/**\n * @see https://www.rfc-editor.org/rfc/rfc7636\n * @see https://danielfett.de/2020/05/16/pkce-vs-nonce-equivalent-or-not/#pkce\n */\nexport const pkce = {\n  /** Creates a PKCE code challenge and verifier pair. The verifier is stored in the cookie. */\n  async create(options: InternalOptions<\"oauth\">) {\n    const codeVerifier = o.generateRandomCodeVerifier();\n    const codeChallenge = await o.calculatePKCECodeChallenge(codeVerifier);\n    const cookie = await createCookie(\"pkceCodeVerifier\", codeVerifier, options);\n    return { cookie, codeChallenge: codeChallenge, codeVerifier };\n  },\n  /**\n   * Returns code_verifier if the provider is configured to use PKCE,\n   * and clears the container cookie afterwards.\n   * An error is thrown if the code_verifier is missing or invalid.\n   */\n  use: useCookie(\"pkce\", \"pkceCodeVerifier\"),\n};\n\n/**\n * @see https://www.rfc-editor.org/rfc/rfc6749#section-10.12\n * @see https://www.rfc-editor.org/rfc/rfc6749#section-4.1.1\n */\nexport const state = {\n  /** Creates a state cookie with an optionally encoded body. */\n  async create(options: InternalOptions<\"oauth\">, origin?: string) {\n    const { provider } = options;\n    if (!provider.checks.includes(\"state\")) {\n      if (origin) {\n        throw new Error(\n          \"State data was provided but the provider is not configured to use state\",\n        );\n      }\n      return;\n    }\n\n    const payload = o.generateRandomState();\n    const cookie = await createCookie(\"state\", payload, options);\n    return { cookie, value: payload };\n  },\n  /**\n   * Returns state if the provider is configured to use state,\n   * and clears the container cookie afterwards.\n   * An error is thrown if the state is missing or invalid.\n   */\n  use: useCookie(\"state\", \"state\"),\n};\n\nexport const nonce = {\n  async create(options: InternalOptions<\"oidc\">) {\n    if (!options.provider.checks.includes(\"nonce\")) return;\n    const value = o.generateRandomNonce();\n    const cookie = await createCookie(\"nonce\", value, options);\n    return { cookie, value };\n  },\n  /**\n   * Returns nonce if the provider is configured to use nonce,\n   * and clears the container cookie afterwards.\n   * An error is thrown if the nonce is missing or invalid.\n   * @see https://openid.net/specs/openid-connect-core-1_0.html#NonceNotes\n   * @see https://danielfett.de/2020/05/16/pkce-vs-nonce-equivalent-or-not/#nonce\n   */\n  use: useCookie(\"nonce\", \"nonce\"),\n};\n\n// ConvexAuth: All WebAuthn checks are omitted.\n", "// This file is adapted from packages/core/src/lib/utils/custom-fetch.ts in the @auth/core package (commit 5af1f30a32e64591abc50ae4d2dba4682e525431).\n\nimport * as o from \"oauth4webapi\";\nimport type { InternalProvider } from \"../../types\";\nimport { customFetch } from \"@auth/core\";\nimport { OAuthConfig } from \"@auth/core/providers/index.js\";\n// ConvexAuth:re-export the symbol from @auth/core\nexport { customFetch } from \"@auth/core\";\n\ntype FetchOptResult = {\n  [o.customFetch]: typeof fetch;\n};\n\n// ConvexAuth: Expose this internal function so we can use it.\n// ConvexAuth: Make a version that works on InternalProvider and OAuthConfig\nexport function fetchOpt(providerOrConfig: InternalProvider<\"oauth\" | \"oidc\"> | OAuthConfig<any>): FetchOptResult {\n  return { [o.customFetch]: providerOrConfig[customFetch] ?? fetch };\n}", "import { CookieOption, CookiesOptions } from \"@auth/core/types.js\";\nimport { requireEnv } from \"../utils.js\";\nimport { InternalProvider } from \"./types.js\";\nimport { SHARED_COOKIE_OPTIONS } from \"../cookies.js\";\nimport { fetchOpt } from \"./lib/utils/customFetch.js\";\nimport * as o from \"oauth4webapi\";\nimport { normalizeEndpoint } from \"../provider_utils.js\";\nimport { isLocalHost } from \"../utils.js\";\nimport { OAuthConfig } from \"@auth/core/providers/oauth.js\";\n\n// ConvexAuth: The logic for the callback URL is different from Auth.js\nexport function callbackUrl(providerId: string) {\n  return (process.env.CUSTOM_AUTH_SITE_URL ?? requireEnv(\"CONVEX_SITE_URL\")) + \"/api/auth/callback/\" + providerId;\n}\n\n// ConvexAuth: This is a ConvexAuth specific function that produces a string that the\n// Convex functions will validate\nexport function getAuthorizationSignature({\n  codeVerifier,\n  state,\n  nonce,\n}: {\n  codeVerifier?: string;\n  state?: string;\n  nonce?: string;\n}) {\n  return [codeVerifier, state, nonce]\n    .filter((param) => param !== undefined)\n    .join(\" \");\n}\n\nfunction oauthStateCookieName(\n  type: \"state\" | \"pkce\" | \"nonce\",\n  providerId: string,\n) {\n  return (!isLocalHost(process.env.CONVEX_SITE_URL) ? \"__Host-\" : \"\") + providerId + \"OAuth\" + type;\n}\n\nexport const defaultCookiesOptions: (\n  providerId: string,\n) => Record<keyof CookiesOptions, CookieOption> = (providerId) => {\n  return {\n    pkceCodeVerifier: {\n      name: oauthStateCookieName(\"pkce\", providerId),\n      options: {\n        ...SHARED_COOKIE_OPTIONS,\n      },\n    },\n    state: {\n      name: oauthStateCookieName(\"state\", providerId),\n      options: {\n        ...SHARED_COOKIE_OPTIONS,\n      },\n    },\n    nonce: {\n      name: oauthStateCookieName(\"nonce\", providerId),\n      options: {\n        ...SHARED_COOKIE_OPTIONS,\n      },\n    },\n    // ConvexAuth: We don't support webauthn, so this value doesn't actually matter\n    webauthnChallenge: {\n      name: \"ConvexAuth_shouldNotBeUsed_webauthnChallenge\",\n      options: {\n        ...SHARED_COOKIE_OPTIONS,\n      },\n    },\n    // ConvexAuth: We don't use these cookies, so their values should never be used\n    sessionToken: {\n      name: \"ConvexAuth_shouldNotBeUsed_sessionToken\",\n      options: {\n        ...SHARED_COOKIE_OPTIONS,\n      },\n    },\n    callbackUrl: {\n      name: \"ConvexAuth_shouldNotBeUsed_callbackUrl\",\n      options: {\n        ...SHARED_COOKIE_OPTIONS,\n      },\n    },\n    csrfToken: {\n      name: \"ConvexAuth_shouldNotBeUsed_csrfToken\",\n      options: {\n        ...SHARED_COOKIE_OPTIONS,\n      },\n    },\n  };\n};\n\nexport async function oAuthConfigToInternalProvider(config: OAuthConfig<any>): Promise<InternalProvider<\"oauth\" | \"oidc\">> {\n  // Only do service discovery if the provider does not have the required configuration\n  if (!config.authorization || !config.token || !config.userinfo) {\n    // Taken from https://github.com/nextauthjs/next-auth/blob/a7491dcb9355ff2d01fb8e9236636605e2090145/packages/core/src/lib/actions/callback/oauth/callback.ts#L63\n    if (!config.issuer) {\n      throw new Error(\n        `Provider \\`${config.id}\\` is missing an \\`issuer\\` URL configuration. Consult the provider docs.`,\n      );\n    }\n\n    const issuer = new URL(config.issuer);\n    // TODO: move away from allowing insecure HTTP requests\n    const discoveryResponse = await o.discoveryRequest(issuer, {\n      ...fetchOpt(config),\n      [o.allowInsecureRequests]: true,\n    });\n    const discoveredAs = await o.processDiscoveryResponse(\n      issuer,\n      discoveryResponse,\n    );\n\n    if (!discoveredAs.token_endpoint)\n      throw new TypeError(\n        \"TODO: Authorization server did not provide a token endpoint.\",\n      );\n\n    const as: o.AuthorizationServer = discoveredAs;\n    return {\n      ...config,\n      checks: config.checks!,\n      profile: config.profile!,\n      account: config.account!,\n      clientId: config.clientId!,\n      idToken: config.type === \"oidc\" ? config.idToken : undefined,\n      // ConvexAuth: Apparently it's important for us to normalize the endpoint after\n      // service discovery (https://github.com/get-convex/convex-auth/commit/35bf716bfb0d29dbce1cbca318973b0732f75015)\n      authorization: normalizeEndpoint({\n        ...config.authorization,\n        url: as.authorization_endpoint,\n      }),\n      token: normalizeEndpoint({\n        ...config.token,\n        url: as.token_endpoint,\n      }),\n      userinfo: as.userinfo_endpoint\n        ? normalizeEndpoint({\n            ...config.userinfo,\n            url: as.userinfo_endpoint,\n          })\n        : config.userinfo,\n      as,\n      configSource: \"discovered\"\n    };\n  }\n\n  const authorization = normalizeEndpoint(config.authorization);\n  const token = normalizeEndpoint(config.token);\n  const userinfo = config.userinfo\n    ? normalizeEndpoint(config.userinfo)\n    : undefined;\n  return {\n    ...config,\n    checks: config.checks!,\n    profile: config.profile!,\n    account: config.account!,\n    clientId: config.clientId!,\n    idToken: config.type === \"oidc\" ? config.idToken : undefined,\n    authorization,\n    token,\n    userinfo,\n    as: {\n      issuer: config.issuer ?? \"theremustbeastringhere.dev\",\n      authorization_endpoint: authorization?.url.toString(),\n      token_endpoint: token?.url.toString(),\n      userinfo_endpoint: userinfo?.url.toString(),\n    },\n    configSource: \"provided\",\n  };\n}", "// This file corresponds to packages/core/src/lib/actions/signin/authorization-url.ts in the @auth/core package (commit 5af1f30a32e64591abc50ae4d2dba4682e525431).\nimport * as checks from \"./checks.js\";\nimport { InternalOptions } from \"./types.js\";\nimport {\n  callbackUrl,\n  getAuthorizationSignature,\n} from \"./convexAuth.js\";\nimport { Cookie } from \"@auth/core/lib/utils/cookie.js\";\nimport { logWithLevel } from \"../implementation/utils.js\";\n\n/**\n * Generates an authorization/request token URL.\n *\n * [OAuth 2](https://www.oauth.com/oauth2-servers/authorization/the-authorization-request/)\n */\nexport async function getAuthorizationUrl(\n  // ConvexAuth: we don't accept a query argument\n  options: InternalOptions<\"oauth\" | \"oidc\">,\n) {\n  const { provider } = options;\n\n  let url = provider.authorization?.url;\n\n  // ConvexAuth: ConvexAuth does slightly different logic to determine the authorization endpoint\n  const { as, authorization: authorizationEndpoint, configSource } = provider;\n\n  if (!authorizationEndpoint) {\n    throw new TypeError(\"Could not determine the authorization endpoint.\");\n  }\n  if (!url) {\n    url = new URL(authorizationEndpoint.url);\n  }\n\n  const authParams = url.searchParams;\n\n  // ConvexAuth: The logic for the callback URL is different from Auth.js\n  const redirect_uri = callbackUrl(provider.id);\n  // TODO(ConvexAuth): Support redirect proxy URLs.\n  // If we do so, update state.create to take the data value as an origin parameter (see the Auth.js code for ref).\n  // let data: string | undefined;\n  // if (!options.isOnRedirectProxy && provider.redirectProxyUrl) {\n  //   redirect_uri = provider.redirectProxyUrl;\n  //   data = provider.callbackUrl;\n  //   logger.debug(\"using redirect proxy\", { redirect_uri, data });\n  // }\n\n  const params = Object.assign(\n    {\n      response_type: \"code\",\n      // clientId can technically be undefined, should we check this in assert.ts or rely on the Authorization Server to do it?\n      client_id: provider.clientId,\n      redirect_uri,\n      // @ts-expect-error TODO:\n      ...provider.authorization?.params,\n    },\n    Object.fromEntries(url.searchParams.entries() ?? []),\n    // ConvexAuth: no query arguments are combined in the params\n  );\n\n  for (const k in params) authParams.set(k, params[k]);\n\n  const cookies: Cookie[] = [];\n\n  // ConvexAuth: no value passed for `origin` (Auth.js uses `data` from above)\n  const state = await checks.state.create(options);\n  if (state) {\n    authParams.set(\"state\", state.value);\n    cookies.push(state.cookie);\n  }\n\n  // ConvexAuth: We need to save the value of the codeVerifier.\n  let codeVerifier: string | undefined;\n  if (provider.checks?.includes(\"pkce\")) {\n    // ConvexAuth: we check where the config came from to help decide which branch to take here\n    if (configSource === \"discovered\" && !as.code_challenge_methods_supported?.includes(\"S256\")) {\n      // We assume S256 PKCE support, if the server does not advertise that,\n      // a random `nonce` must be used for CSRF protection.\n      if (provider.type === \"oidc\") provider.checks = [\"nonce\"];\n    } else {\n      const pkce = await checks.pkce.create(options);\n      authParams.set(\"code_challenge\", pkce.codeChallenge);\n      authParams.set(\"code_challenge_method\", \"S256\");\n      cookies.push(pkce.cookie);\n      codeVerifier = pkce.codeVerifier;\n    }\n  }\n\n  const nonce = await checks.nonce.create(options);\n  if (nonce) {\n    authParams.set(\"nonce\", nonce.value);\n    cookies.push(nonce.cookie);\n  }\n\n  // TODO: This does not work in normalizeOAuth because authorization endpoint can come from discovery\n  // Need to make normalizeOAuth async\n  if (provider.type === \"oidc\" && !url.searchParams.has(\"scope\")) {\n    url.searchParams.set(\"scope\", \"openid profile email\");\n  }\n\n  logWithLevel(\"DEBUG\", \"authorization url is ready\", {\n    url,\n    cookies,\n    provider,\n  });\n\n  const convexAuthSignature = getAuthorizationSignature({\n    codeVerifier,\n    state: authParams.get(\"state\") ?? undefined,\n    nonce: authParams.get(\"nonce\") ?? undefined,\n  });\n\n  return { redirect: url.toString(), cookies, signature: convexAuthSignature };\n}\n", "// This file maps to packages/core/src/lib/utils/providers.ts in the @auth/core package (commit 5af1f30a32e64591abc50ae4d2dba4682e525431).\n\nimport { InternalProvider } from \"../../types.js\";\n\nexport function isOIDCProvider(\n  provider: InternalProvider<\"oidc\" | \"oauth\">,\n): provider is InternalProvider<\"oidc\"> {\n  return provider.type === \"oidc\";\n}\n\n// ConvexAuth: There are several more functions in the original file which we don't need,\n// and are omitted here.\n", "// This maps to packages/core/src/lib/actions/callback/oauth/callback.ts in the @auth/core package (commit 5af1f30a32e64591abc50ae4d2dba4682e525431)\n\nimport * as checks from \"./checks.js\";\nimport * as o from \"oauth4webapi\";\nimport { InternalOptions } from \"./types.js\";\nimport { fetchOpt } from \"./lib/utils/customFetch.js\";\nimport { Cookie } from \"@auth/core/lib/utils/cookie.js\";\nimport { logWithLevel } from \"../implementation/utils.js\";\nimport { Account, Profile, TokenSet } from \"@auth/core/types.js\";\nimport { isOIDCProvider } from \"./lib/utils/providers.js\";\nimport {\n  callbackUrl,\n  getAuthorizationSignature,\n} from \"./convexAuth.js\";\n\nfunction formUrlEncode(token: string) {\n  return encodeURIComponent(token).replace(/%20/g, \"+\");\n}\n\n/**\n * Formats client_id and client_secret as an HTTP Basic Authentication header as per the OAuth 2.0\n * specified in RFC6749.\n */\nfunction clientSecretBasic(clientId: string, clientSecret: string) {\n  const username = formUrlEncode(clientId);\n  const password = formUrlEncode(clientSecret);\n  const credentials = btoa(`${username}:${password}`);\n  return `Basic ${credentials}`;\n}\n\n/**\n * Handles the following OAuth steps.\n * https://www.rfc-editor.org/rfc/rfc6749#section-4.1.1\n * https://www.rfc-editor.org/rfc/rfc6749#section-4.1.3\n * https://openid.net/specs/openid-connect-core-1_0.html#UserInfoRequest\n *\n * @note Although requesting userinfo is not required by the OAuth2.0 spec,\n * we fetch it anyway. This is because we always want a user profile.\n */\nexport async function handleOAuth(\n  // ConvexAuth: `params` is a Record<string, string> instead of RequestInternal[\"query\"]\n  params: Record<string, string>,\n  // ConvexAuth: `cookies` is a Record<string, string | undefined> instead of RequestInternal[\"cookies\"]\n  cookies: Record<string, string | undefined>,\n  options: InternalOptions<\"oauth\" | \"oidc\">,\n): Promise<{\n  profile: Profile,\n  tokens: TokenSet & Pick<Account, \"expires_at\">,\n  cookies: Cookie[],\n  signature: string,\n}> {\n  const { provider } = options;\n\n  // ConvexAuth: The `token` property is not used here\n  const { userinfo, as } = provider;\n\n  const client: o.Client = {\n    client_id: provider.clientId,\n    ...provider.client,\n  };\n\n  let clientAuth: o.ClientAuth;\n\n  switch (client.token_endpoint_auth_method) {\n    // TODO: in the next breaking major version have undefined be `client_secret_post`\n    case undefined:\n    case \"client_secret_basic\":\n      // TODO: in the next breaking major version use o.ClientSecretBasic() here\n      clientAuth = (_as, _client, _body, headers) => {\n        headers.set(\n          \"authorization\",\n          clientSecretBasic(provider.clientId, provider.clientSecret!),\n        );\n      };\n      break;\n    case \"client_secret_post\":\n      clientAuth = o.ClientSecretPost(provider.clientSecret!);\n      break;\n    case \"client_secret_jwt\":\n      clientAuth = o.ClientSecretJwt(provider.clientSecret!);\n      break;\n    case \"private_key_jwt\":\n      clientAuth = o.PrivateKeyJwt(provider.token!.clientPrivateKey!, {\n        // TODO: review in the next breaking change\n        [o.modifyAssertion](_header, payload) {\n          payload.aud = [as.issuer, as.token_endpoint!];\n        },\n      });\n      break;\n    default:\n      throw new Error(\"unsupported client authentication method\");\n  }\n\n  const resCookies: Cookie[] = [];\n\n  const state = await checks.state.use(cookies, resCookies, options);\n\n  let codeGrantParams: URLSearchParams;\n  try {\n    codeGrantParams = o.validateAuthResponse(\n      as,\n      client,\n      new URLSearchParams(params),\n      provider.checks.includes(\"state\") ? state : o.skipStateCheck,\n    );\n  } catch (err) {\n    if (err instanceof o.AuthorizationResponseError) {\n      const cause = {\n        providerId: provider.id,\n        ...Object.fromEntries(err.cause.entries()),\n      };\n      logWithLevel(\"DEBUG\", \"OAuthCallbackError\", cause);\n      throw new Error(\"OAuth Provider returned an error\", { cause });\n    }\n    throw err;\n  }\n\n  const codeVerifier = await checks.pkce.use(cookies, resCookies, options);\n\n  // ConvexAuth: The logic for the callback URL is different from Auth.js\n  const redirect_uri = callbackUrl(provider.id);\n  // TODO(ConvexAuth): Support redirect proxy URLs\n  // if (!options.isOnRedirectProxy && provider.redirectProxyUrl) {\n  //   redirect_uri = provider.redirectProxyUrl;\n  // }\n\n  let codeGrantResponse = await o.authorizationCodeGrantRequest(\n    as,\n    client,\n    clientAuth,\n    codeGrantParams,\n    redirect_uri,\n    codeVerifier ?? \"decoy\",\n    {\n      // TODO: move away from allowing insecure HTTP requests\n      [o.allowInsecureRequests]: true,\n      [o.customFetch]: (...args) => {\n        if (!provider.checks.includes(\"pkce\")) {\n          args[1].body.delete(\"code_verifier\");\n        }\n        return fetchOpt(provider)[o.customFetch](...args);\n      },\n    },\n  );\n\n  if (provider.token?.conform) {\n    codeGrantResponse =\n      (await provider.token.conform(codeGrantResponse.clone())) ??\n      codeGrantResponse;\n  }\n\n  let profile: Profile = {};\n\n  // ConvexAuth: We use the value of the nonce later, aside from feeding it into the\n  // `processAuthorizationCodeResponse` function.\n  const nonce = await checks.nonce.use(cookies, resCookies, options);\n\n  const isOidc = isOIDCProvider(provider);\n  const processedCodeResponse = await o.processAuthorizationCodeResponse(\n    as,\n    client,\n    codeGrantResponse,\n    {\n      expectedNonce: nonce,\n      requireIdToken: isOidc,\n    },\n  );\n\n  const tokens: TokenSet & Pick<Account, \"expires_at\"> = processedCodeResponse;\n\n  if (isOidc) {\n    // ConvexAuth: the next few lines are changed slightly to make TypeScript happy\n    const idTokenClaimsOrUndefined = o.getValidatedIdTokenClaims(\n      processedCodeResponse,\n    );\n    if (idTokenClaimsOrUndefined === undefined) {\n      throw new Error(\"ID Token claims are missing\");\n    }\n    const idTokenClaims = idTokenClaimsOrUndefined;\n    profile = idTokenClaims;\n\n    // Apple sends some of the user information in a `user` parameter as a stringified JSON.\n    // It also only does so the first time the user consents to share their information.\n    if (provider.id === \"apple\") {\n      try {\n        profile.user = JSON.parse(params?.user)\n        // ConvexAuth: disabled lint for empty block\n        // eslint-disable-next-line no-empty\n      } catch {}\n    } \n    \n    if (provider.idToken === false) {\n      const userinfoResponse = await o.userInfoRequest(\n        as,\n        client,\n        processedCodeResponse.access_token,\n        {\n          ...fetchOpt(provider),\n          // TODO: move away from allowing insecure HTTP requests\n          [o.allowInsecureRequests]: true,\n        },\n      );\n\n      profile = await o.processUserInfoResponse(\n        as,\n        client,\n        idTokenClaims.sub,\n        userinfoResponse,\n      );\n    }\n  } else {\n    if (userinfo?.request) {\n      const _profile = await userinfo.request({ tokens, provider });\n      if (_profile instanceof Object) profile = _profile;\n    } else if (userinfo?.url) {\n      const userinfoResponse = await o.userInfoRequest(\n        as,\n        client,\n        processedCodeResponse.access_token,\n        fetchOpt(provider),\n      );\n      profile = await userinfoResponse.json();\n    } else {\n      throw new TypeError(\"No userinfo endpoint configured\");\n    }\n  }\n\n  if (tokens.expires_in) {\n    tokens.expires_at =\n      Math.floor(Date.now() / 1000) + Number(tokens.expires_in);\n  }\n\n  // ConvexAuth: The Auth.js code would handle user + account creation here, but for\n  // ConvexAuth we want to handle that in a Convex function. Instead, we return the\n  // information needed for the mutation.\n\n  return {\n    profile,\n    tokens,\n    cookies: resCookies,\n    signature: getAuthorizationSignature({ codeVerifier, state, nonce }),\n  };\n}\n"],
  "mappings": "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",
  "names": ["parse", "serialize", "cookieNameRegExp", "cookieValueRegExp", "domainValueRegExp", "pathValueRegExp", "__toString", "NullObject", "C", "decode", "startIndex", "endIndex", "enc", "isDate", "e", "import_cookie", "state", "f", "_SessionStore_chunk", "i", "c", "_SessionStore_clean", "_a", "message", "_a", "digest", "digest", "buf", "i", "alg", "CHUNK_SIZE", "i", "message", "_a", "message", "alg", "enc", "a", "b", "i", "hash", "alg", "types", "_a", "alg", "enc", "tag", "alg", "p2s", "getCryptoKey", "alg", "deriveKey", "p2s", "decrypt", "alg", "alg", "encrypt", "alg", "decrypt", "k", "alg", "bitLength", "alg", "i", "getNamedCurve", "alg", "c", "alg", "alg", "_a", "_b", "enc", "tag", "encrypt", "wrap", "alg", "unwrap", "tag", "alg", "_a", "_b", "bitLength", "decrypt", "p2s", "tag", "unwrap", "s", "protectedHeader", "alg", "enc", "tag", "tag", "alg", "alg", "enc", "_a", "_b", "x", "y", "bitLength", "encrypt", "p2s", "wrap", "alg", "enc", "tag", "alg", "hash", "getCryptoKey", "alg", "now", "alg", "getCryptoKey", "alg", "_a", "enc", "base64url_exports", "decode", "encode", "encode", "decode", "parse", "C", "decode", "enc", "e", "encode", "base64url_exports", "decode", "enc", "secret", "enc", "message", "_a", "_b", "parseCookie", "slice", "options", "vnodeId", "isValidElement", "rerenderQueue", "prevDebounce", "defer", "depthSort", "eventClock", "eventProxy", "eventProxyCapture", "i", "EMPTY_OBJ", "EMPTY_ARR", "IS_NON_DIMENSIONAL", "isArray", "Array", "assign", "obj", "props", "removeNode", "node", "parentNode", "removeChild", "createVNode", "type", "props", "key", "ref", "original", "vnode", "__k", "__", "__b", "__e", "__d", "__c", "constructor", "__v", "vnodeId", "__i", "__u", "options", "Fragment", "props", "children", "BaseComponent", "context", "this", "getDomSibling", "vnode", "childIndex", "__", "__i", "sibling", "__k", "length", "__e", "type", "updateParentDomPointers", "i", "child", "__c", "base", "enqueueRender", "c", "__d", "rerenderQueue", "push", "process", "__r", "prevDebounce", "options", "debounceRendering", "defer", "renderQueueLength", "component", "newVNode", "oldVNode", "oldDom", "commitQueue", "refQueue", "sort", "depthSort", "shift", "__v", "__P", "assign", "diff", "__n", "namespaceURI", "__u", "commitRoot", "diffChildren", "parentDom", "renderResult", "newParentVNode", "oldParentVNode", "globalContext", "namespace", "excessDomChildren", "isHydrating", "childVNode", "newDom", "firstChildDom", "oldChildren", "EMPTY_ARR", "newChildrenLength", "constructNewChildrenArray", "EMPTY_OBJ", "ref", "applyRef", "insert", "nextSibling", "skewedIndex", "matchingIndex", "oldChildrenLength", "remainingOldChildren", "skew", "constructor", "String", "createVNode", "isArray", "__b", "key", "findMatchingIndex", "unmount", "parentVNode", "contains", "insertBefore", "nodeType", "findMatchingIndex", "childVNode", "oldChildren", "skewedIndex", "remainingOldChildren", "key", "type", "x", "y", "oldVNode", "__u", "length", "setStyle", "style", "value", "setProperty", "IS_NON_DIMENSIONAL", "test", "dom", "name", "oldValue", "namespace", "useCapture", "o", "cssText", "replace", "toLowerCase", "slice", "l", "_attached", "eventClock", "addEventListener", "eventProxyCapture", "eventProxy", "removeEventListener", "e", "removeAttribute", "setAttribute", "createEventProxy", "this", "eventHandler", "_dispatched", "options", "event", "diff", "parentDom", "newVNode", "globalContext", "excessDomChildren", "commitQueue", "oldDom", "isHydrating", "refQueue", "tmp", "c", "isNew", "oldProps", "oldState", "snapshot", "clearProcessingException", "newProps", "isClassComponent", "provider", "componentContext", "i", "renderHook", "count", "renderResult", "newType", "constructor", "__e", "__b", "outer", "props", "prototype", "render", "contextType", "__c", "__", "__E", "BaseComponent", "doRender", "sub", "state", "context", "__n", "__d", "__h", "_sb", "__s", "getDerivedStateFromProps", "assign", "__v", "componentWillMount", "componentDidMount", "push", "componentWillReceiveProps", "shouldComponentUpdate", "__k", "some", "vnode", "componentWillUpdate", "componentDidUpdate", "__P", "__r", "getChildContext", "getSnapshotBeforeUpdate", "diffChildren", "isArray", "Fragment", "children", "base", "MODE_HYDRATE", "nodeType", "nextSibling", "indexOf", "diffElementNodes", "diffed", "commitRoot", "root", "applyRef", "cb", "call", "newHtml", "oldHtml", "newChildren", "inputValue", "checked", "localName", "document", "createTextNode", "createElementNS", "is", "__m", "data", "childNodes", "EMPTY_OBJ", "attributes", "__html", "innerHTML", "getDomSibling", "removeNode", "ref", "hasRefUnmount", "current", "unmount", "parentVNode", "skipRemove", "r", "componentWillUnmount", "slice", "EMPTY_ARR", "options", "__e", "error", "vnode", "oldVNode", "errorInfo", "component", "ctor", "handled", "__", "__c", "constructor", "getDerivedStateFromError", "setState", "__d", "componentDidCatch", "__E", "e", "vnodeId", "isValidElement", "undefined", "BaseComponent", "prototype", "update", "callback", "s", "this", "__s", "state", "assign", "props", "__v", "_sb", "push", "enqueueRender", "forceUpdate", "__h", "render", "Fragment", "rerenderQueue", "defer", "Promise", "then", "bind", "resolve", "setTimeout", "depthSort", "a", "b", "__b", "process", "__r", "eventClock", "eventProxy", "createEventProxy", "eventProxyCapture", "i", "v", "pact", "state", "value", "s", "o", "_settle", "bind", "then", "observer", "e", "_Pact", "prototype", "onFulfilled", "onRejected", "result", "this", "callback", "_this", "renderToStringAsync", "isArray", "Array", "isArray", "Array", "USER_AGENT", "_a", "_b", "message", "customFetch", "jwksCache", "encoder", "decoder", "CHUNK_SIZE", "i", "USER_AGENT", "customFetch", "types", "now", "_a", "message", "_a", "_a", "customFetch", "_a", "customFetch", "_a", "now", "clockSkew", "clockTolerance", "now", "state", "check", "encode", "parseCookie", "decode", "check", "_a", "state", "_a", "i", "secret", "p", "merge", "o", "k", "v", "c", "e", "isObject", "bitLength", "alphabet", "i", "i", "alphabet", "i", "j", "alphabet", "i", "j", "sha256", "_a", "_a", "_a", "q", "session", "_a", "session", "session", "session", "state", "q", "now", "_a", "_a", "_b", "q", "sha256", "q", "q", "sha256", "q", "sha256", "_a", "hash", "q", "q", "q", "q", "session", "_a", "signInImpl", "_a", "_b", "COOKIE_TTL", "clearCookie", "useCookie", "check", "_a", "pkce", "state", "nonce", "customFetch", "state", "nonce", "getAuthorizationUrl", "_a", "_b", "k", "state", "pkce", "nonce", "isOIDCProvider", "handleOAuth", "_a", "state", "pkce", "customFetch", "nonce", "isOIDCProvider", "idTokenClaims", "message", "getAuthorizationUrl", "serializeCookie", "handleOAuth", "_a", "signInImpl", "parseCookies"]
}
